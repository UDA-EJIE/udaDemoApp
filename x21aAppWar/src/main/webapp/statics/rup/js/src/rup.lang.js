/*! For license information please see rup.lang.js.LICENSE.txt */
!function(a){"function"==typeof define&&define.amd?define(["jquery","./rup.base","./rup.tooltip"],a):a(jQuery)}((function(a){a.widget("$.rup_language",{options:{languages:null,active:null,modo:"default"},_create:function(){const e=this;global.initRupI18nPromise.then((()=>{var n;this.options.active=null==a.rup.lang?"[lang]":a.rup.lang,n=this.options.active,this.options.languages=a.rup.AVAILABLE_LANGS.split(",");var t=this.element,i=a(`<a id="rup_language_choice" class="rup-language_change_option">${a.rup.i18nParse(a.rup.i18n.base,"rup_language.changeLanguage")}</a>`);if(a(t).addClass("ui-widget"),"default"===this.options.modo){let n,i=t.parent(),r=t.find("[data-rup-lang-current]");i.addClass("dropdown"),t.addClass("dropdown-toggle").attr({"data-toogle":"dropdown","aria-haspopup":"true","aria-expanded":"false"}),r.text(a.rup.i18nParse(a.rup.i18n.base,"rup_language."+this.options.active)),n=i.find("[aria-labelledby="+t.attr("id")+"]"),a.each(this.options.languages,(function(t,i){i=i.replace(/^\s*|\s*$/g,"");var r=a.rup.i18nParse(a.rup.i18n.base,"rup_language."+i),l=e._getLocaleChangeUrl(i);n.append(a(`<a href="${l}" class="dropdown-item">${r}</a>`))})),i.append(n)}else if("portal"===this.options.modo){let i=a("<ul>").addClass("rup-language_portal"),r=a(this.options.languages).length;a.each(this.options.languages,(function(t,l){l=l.replace(/^\s*|\s*$/g,"");var u=a.rup.i18nParse(a.rup.i18n.base,"rup_language."+l+"_short");if(l!==n){const n=a.rup.i18nParse(a.rup.i18n.base,"rup_language.changeLanguageLiteral_"+l)+a.rup.i18nParse(a.rup.i18n.base,"rup_language."+l);var s=e._getLocaleChangeUrl(l);a(`<li><a href="${s}"\n                                class="rup-language_portal_list ui-corner-all"\n                                title="${n}">${u}</a></li>`).appendTo(i)}else{const e=a.rup.i18nParse(a.rup.i18n.base,"rup_language.changeLanguageLiteral")+a.rup.i18nParse(a.rup.i18n.base,"rup_language."+l);a(`<li class="ui-state-active"><a href="javascript:void(0);"\n                                class="rup-language_portal_list_active ui-corner-all"\n                                title="${e}">${u}</a></li>`).appendTo(i)}t<r-1&&i.append(a("<div>").html("|").addClass("rup-language_portal_separator"))})),t.append(i)}else if("classic"===this.options.modo||"jquery-ui"===this.options.modo){let u=a("<ul>").attr("id","ulGeneral"),s=a("<li>").attr("id","rup_active_language").addClass("rup-language_active").text(a.rup.i18nParse(a.rup.i18n.base,"rup_language."+this.options.active)).attr("title",a.rup.i18nParse(a.rup.i18n.base,"rup_language.changeLanguageLiteral")+a.rup.i18nParse(a.rup.i18n.base,"rup_language."+n)),g=a("<li>").addClass("rup-language_change").attr("id","rup_language_link"),p=a("<li>").attr("id","rup_language_list").addClass("rup-language_change_opened").css("visibility","hidden"),o=a("<div>"),c=a("<div>").addClass("rup-language_language_list"),d=a("<a>").addClass("rup-language_close_languages").attr("id","rup_language_close").attr("href","#").attr("title",a.rup.i18nParse(a.rup.i18n.base,"rup_language.closingLiteral")).html(a.rup.i18nParse(a.rup.i18n.base,"rup_global.cerrar")),_=a("<ul>");u.append(s),a("<a>").attr("href","#").text(a.rup.i18nParse(a.rup.i18n.base,"rup_language.changeLanguage")).appendTo(g),u.append(g),o.append(i),c.append(d),a.each(this.options.languages,(function(t,i){i=i.replace(/^\s*|\s*$/g,"");var r=a("<li>").attr("id","rup_language_lng_"+i),l=a.rup.i18nParse(a.rup.i18n.base,"rup_language."+i);if(i!==n){var u=e._getLocaleChangeUrl(i);a("<a>").appendTo(r).attr("href",u).text(l).attr("title",a.rup.i18nParse(a.rup.i18n.base,"rup_language.changeLanguageLiteral_"+i)+a.rup.i18nParse(a.rup.i18n.base,"rup_language."+i))}else a("<a>").appendTo(r).attr("href","javascript:void(0);").text(l).attr("title",a.rup.i18nParse(a.rup.i18n.base,"rup_language.changeLanguageLiteral")+a.rup.i18nParse(a.rup.i18n.base,"rup_language."+i));r.appendTo(_)})),c.append(_),o.append(c),p.append(o),u.append(p),t.append(u);var r=c.css("width","0.8em").width(),l=g.css("margin-right");g.css("margin-right","0px"),c.width(p.position().left-r),c.css("padding-left","0.6em"),c.css("padding-right","0.2em"),c.css("top",s.height()-1),p.hide(),p.css("visibility",""),g.css("margin-right",l),a("#rup_language_lng_"+a.rup.lang).addClass("ui-state-active"),g.click((function(){g.hide(),p.show(),a(".rup-language_language_list").find("li:not(.rup-language_language_list_active)").first().children("a").focus()})),i.click((function(){p.hide(),g.show()})),d.click((function(){p.hide(),g.show()})),p.mouseenter((function(){t.one("mouseleave",(function(){p.hide(),g.show()}))})),t.on("keydown",(function(e){switch(e.code){case"ArrowUp":a(e.target).parent().prevAll("li:not(.rup-language_language_list_active)").length>0?a(e.target).parent().prevAll("li:not(.rup-language_language_list_active)").first().children().focus():a(e.target).parent().siblings("li:not(.rup-language_language_list_active)").last().children().focus();break;case"ArrowDown":a(e.target).parent().nextAll("li:not(.rup-language_language_list_active)").length>0?a(e.target).parent().nextAll("li:not(.rup-language_language_list_active)").first().children().focus():a(e.target).parent().siblings("li:not(.rup-language_language_list_active)").first().children().focus();break;case"Escape":p.hide(),g.show()}}))}t.find("[title]").rup_tooltip({applyToPortal:!0})}))},_getLocaleChangeUrl:function(e,n){const t=new URL(window.location),i=n||a.rup.LOCALE_PARAM_NAME;return t.searchParams.set(i,e),t.toString()},_changeLocale:function(a,e){const n=this._getLocaleChangeUrl(a,e);window.location.href=n},_setOption:function(){a.Widget.prototype._setOption.apply(this,arguments)},destroy:function(){a.Widget.prototype.destroy.apply(this,arguments)},getLocaleChangeUrl:function(a){return this._getLocaleChangeUrl(a)},changeLocale:function(a){this._changeLocale(a)}})}));