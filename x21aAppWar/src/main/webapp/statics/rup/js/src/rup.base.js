/*! For license information please see rup.base.js.LICENSE.txt */
!function(e){"function"==typeof define&&define.amd?define(["jquery","./rup.utils","./adapter/rup.adapter","./external/modernizr"],e):e(jQuery)}((function(e){jQuery.migrateMute=!0,global.initRupI18nPromise=jQuery.Deferred(),String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)},e.extend({set_uda_ajax_mode_on:function(){e.ajax!==e.rup_ajax&&(e.ajaxUDA=e.ajax,e.ajax=e.rup_ajax)},rup_ajax:function(r){var t,n,a,u,s=e.extend({},{cache:!1,error:null},r);return n=s.error,t=function(r,t,a){var u=e.rup.rupAjaxDefaultError(r,t,a);null!=n?e(n(r,t,a)):u&&e.rup.showErrorToUser(u)},a=s.complete,u=function(r,t){e.ajax===e.rup_ajax&&e.ajaxUDA!==e.rup_ajax&&(e.ajax=e.ajaxUDA),null!=a&&a(r,t)},s.complete=u,s.error=t,s.url=e.rup_utils.setNoPortalParam(s.url),"function"==typeof e.ajaxUDA?e.ajaxUDA(s):e.ajax(s)}}),e.rup=e.rup||{},e.extend(e.rup,{_uaMatch:function(e){e=e.toLowerCase();var r=/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[];return{browser:r[1]||"",version:r[2]||"0"}}});var r=e.rup._uaMatch(navigator.userAgent),t={};function n(){clearTimeout(this.timeout)}function a(){clearTimeout(this.timeout)}function u(r){var t=e(this);clearTimeout(this.timeout),this.timeout=setTimeout((function(){t.trigger("mousestop",r)}),t.data("mousestop").delay)}r.browser&&(t[r.browser]=!0,t.version=r.version),t.chrome?t.webkit=!0:t.webkit&&(t.safari=!0),e.rup._browser=t,e.browser=t,e.extend(e.rup,{i18n:{},appResources:{},lang:null,version:"6.3.0",getBrowserLenguage:function(){return(navigator.language||navigator.userLanguage).split("-")[0].toLowerCase()},browser:{version:e.rup._browser.version,versionNumber:e.rup_utils.isNumeric(e.rup._browser.version)?parseInt(e.rup._browser.version):void 0,isIE:/Trident\//.test(navigator.userAgent),isSafari:!(!e.rup._browser.safari||!e.rup._browser.webkit),isChrome:!(!e.rup._browser.safari||!e.rup._browser.webkit),isFF:!!e.rup._browser.mozilla,isOpera:!!e.rup._browser.opera,xhrFileUploadSupport:void 0!==(new XMLHttpRequest).upload},setLiterals:function(r){return null!=r&&""!==r&&(e.rup.lang=r),e.rup_ajax({url:e.rup.RUP+"/resources/rup.i18n_"+e.rup.lang+".json",dataType:"json",type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",success:function(r){e.rup.i18n.base=r},error:function(r,t){e.rup.errorGestor(e.rup.i18nTemplate(e.rup.i18n.base,"rup_base.i18nRupJsonParseError",t,t,r.status,r.statusText))}})},getFile_i18n:function(){return e.rup_ajax({url:e.rup.APP_STATICS+"/resources/"+e.rup.WAR_NAME+".i18n_"+e.rup.lang+".json",dataType:"json",type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",success:function(r){e.rup.i18n.app=r},error:function(r,t){e.rup.errorGestor(e.rup.i18nTemplate(e.rup.i18n.base,"rup_base.i18nAppJsonParseError",t,t,r.status,r.statusText))}})},getFile:function(r){void 0===r&&null===r&&""===r?e.rup.errorGestor("No se ha definido el fichero a cargar"):e.rup.i18n[r]||e.rup_ajax({url:e.rup.APP_STATICS+"/resources/"+r+".json",dataType:"json",type:"GET",async:!1,contentType:"application/x-www-form-urlencoded; charset=UTF-8",success:function(t){e.rup.i18n[r]=t},error:function(r,t,n){e.rup.errorGestor("Se ha producido un error en el parseo del fichero JSON de la aplicación => "+t+".<br>Error devuelto:<br>"+n)}})},i18nParse:function(r,t,n="Error de i18n: "+t+" no encontrado"){if(null!=t&&""!==t){for(var a=t.split("."),u=r,s=0;s<a.length;s++){if(e.isEmptyObject(u)){u=null==n||""===n?t:n;break}u=u[a[s]]}return null==u?t:u}return"null_i18nCaption"},i18nTemplate:function(r,t){var n=jQuery.rup.i18nParse(r,t),a=e.makeArray(arguments).slice(2);return void 0===n&&(n=""),n.replace(/\{(\d+)\}/g,(function(e,r){return a[r]}))},errorGestor:function(r,t=e.rup.i18nParse(e.rup.i18n.base,"rup_global.developerError")){throw e.rup_messages("msgError",{title:t,message:"<p>"+r+"</p>"}),r},iniRup:function(){e.rup.i18n.app={},e.rup.i18n.base={},window.LOCALE_PARAM_NAME||(window.LOCALE_PARAM_NAME="locale"),e.rup.APP_RESOURCES=window.APP_RESOURCES,e.rup.APP_STATICS=window.STATICS+"/"+window.APP_RESOURCES,e.rup.CTX_PATH=window.CTX_PATH,e.rup.RUP=window.RUP,e.rup.STATICS=window.STATICS,e.rup.WAR_NAME=window.WAR_NAME,e.rup.LANG=window.LANG,e.rup.AVAILABLE_LANGS=window.AVAILABLE_LANGS,e.rup.AVAILABLE_LANGS_ARRAY=e.map(e.rup.AVAILABLE_LANGS.split(","),(function(e){return e.replace(/^\s*|\s*$/g,"")})),e.rup.DEFAULT_LANG=window.DEFAULT_LANG,e.rup.LAYOUT=window.LAYOUT,e.rup.LOCALE_PARAM_NAME=window.LOCALE_PARAM_NAME,e.rup.IFRAME_ONLY_SUPPORTED_METHODS=["GET","POST"],window.IS_EJIE?e.rup.IS_EJIE=window.IS_EJIE:e.rup.IS_EJIE=!1,this.lang=e.rup.LANG,e.rup.setLiterals().then((()=>{""!==jQuery.rup.WAR_NAME?e.rup.getFile_i18n().then((()=>{global.initRupI18nPromise.resolve()})):global.initRupI18nPromise.resolve()}))},_avoidRUPFails:function(){"rup_date.dateFormat"===e.rup.i18nParse(e.rup.i18n.base,"rup_date.dateFormat")&&(e.rup.i18n.base.rup_date={dateFormat:"dd/mm/yy"}),e.jgrid={formatter:{integer:{}}}},getAccessor:function(r,t,n){if("string"==typeof n){var a=r[n];if(void 0!==a)return a;e.rup.errorGestor(t+' - No Existe el método "'+n+'"  en el patrón.')}else"function"==typeof n&&e.rup.errorGestor(t+" - No es posible pasar funciones al patrón.")},rupAjaxDefaultError:function(r){var t=null;if(0==r.status)t=e.rup.i18nParse(e.rup.i18n.base,"rup_ajax.httpStatus0");else if(401==r.status)t=e.rup.i18nParse(e.rup.i18n.base,"rup_ajax.httpStatus401");else if(404==r.status)t=e.rup.i18nParse(e.rup.i18n.base,"rup_ajax.httpStatus404");else if(500==r.status)t=e.rup.i18nParse(e.rup.i18n.base,"rup_ajax.httpStatus500");else if(503==r.status)t=e.rup.i18nParse(e.rup.i18n.base,"rup_ajax.httpStatus503");else if(406==r.status){let e="";try{e=JSON.parse(r.responseText),t=e}catch(e){t=r.responseText}}else if(413==r.status){let e="";try{e=JSON.parse(r.responseText),t=e.rupFeedback.message.label}catch(e){t=r.responseText}}return t},rupObjectConstructor:function(r,t){void 0===e[r]&&(e[r]=function(r){var n=r,a="string"==typeof n,u=e.makeArray(arguments).slice(1),s=this;if(a&&"_"===n.charAt(0))return s;if(a)if("extend"!==n){let r=e.isEmptyObject(e.data(t))?e.data(t,t):e.data(t),a=r&&"function"==typeof r[n]?r[n].apply(r,u):"no-function";if("no-function"===a)return!1;s=a}else t=e.extend.apply(null,[!0,t].concat(u[0]));else{let r=e.isEmptyObject(e.data(t))?e.data(t,t):e.data(t);r&&void 0!==t._init&&null!==t._init&&r._init(e.makeArray(arguments))}return s})},rupSelectorObjectConstructor:function(r,t){void 0===e.fn[r]&&(e.fn[r]=function(r){var n=r,a="string"==typeof n,u=e.makeArray(arguments).slice(1),s=this;if(a&&"_"===n.charAt(0))return s;if(a)if("extend"!==n){let r=e.extend(this,t),a=r&&"function"==typeof r[n]?r[n].apply(r,u):"no-function";if("no-function"===a)return!1;s=a}else t=e.fn.extend.apply(null,[!0,t].concat(u[0]));else{let r=e.extend(this,t);r&&void 0!==t._init&&null!==t._init&&r._init(e.makeArray(arguments))}return s})},showErrorToUser:function(r){if(null!=r&&""!==r){var t=e(".ui-dialog:visible .rup-feedback"),n=0!==t.length?t:e(".rup-feedback");if(0!=n.length){var a=e("#"+e.escapeSelector(n[n.length-1].id));a.rup_feedback("option",{delay:null}),a.rup_feedback("set",r,"error"),a.rup_feedback("show")}else e.rup_messages("msgError",{title:e.rup.i18nParse(e.rup.i18n.base,"rup_ajax.errorTitle"),message:r})}}}),e.fn.extend({storeEvents:function(){return this.each((function(){e(this).data("storedEvents",e.extend(!0,{},e._data(e(this)[0],"events")))})),e(this).off(),this},restoreEvents:function(){return this.each((function(){var r=e.data(this,"storedEvents");if(r)for(var t in e(this).off(),r)for(var n in r[t])"object"==typeof r[t][n]&&e.event.add(this,t,r[t][n],r[t][n].data)})),this}}),e.fn.mousestop={},e.fn.mousestop.defaults={delay:300},e.event.special.mousestop={setup:function(r){var t=e(this);t.data("mousestop",e.extend(!0,{},e.fn.mousestop.defaults,r)),t.on({"mouseenter.rup_mousestop":n,"mouseleave.rup_mousestop":a,"mousemove.rup_mousestop":u})},teardown:function(){e(this).removeData("mousestop").off(".rup_mousestop")}},jQuery("body").on({"keydown.rup":function(e){var r=jQuery("body");switch(e.which){case 16:if(!0!==r.data("tmp.multiselect.shiftPressed")&&(r.data("tmp.multiselect.shiftPressed",!0),!1===r.triggerHandler("rup_shiftKeyDown")))return e.preventDefault(),!1;break;case 17:if(!0!==r.data("tmp.multiselect.ctrlPressed")&&(r.data("tmp.multiselect.ctrlPressed",!0),!1===r.triggerHandler("rup_ctrlKeyDown")))return e.preventDefault(),!1}},"keyup.rup":function(r){var t=jQuery("body");switch(r.which){case 16:if(!1!==t.data("tmp.multiselect.shiftPressed")&&(t.data("tmp.multiselect.shiftPressed",!1),!1===t.triggerHandler("rup_shiftKeyUp")))return!1;break;case 17:if(!1!==t.data("tmp.multiselect.ctrlPressed")&&(t.data("tmp.multiselect.ctrlPressed",!1),!1===t.triggerHandler("rup_ctrlKeyUp")))return!1;break;case 32:"undefined"==typeof InstallTrigger&&e(r.target).is(":checkbox")&&(r.preventDefault(),e(r.target).prop("checked",(function(){return!this.checked})))}}}),jQuery.extend(e.rup,{isCtrlPressed:function(){return!0===jQuery("body").data("tmp.multiselect.ctrlPressed")},isShiftPressed:function(){return!0===jQuery("body").data("tmp.multiselect.shiftPressed")}}),e.rup.iniRup()}));