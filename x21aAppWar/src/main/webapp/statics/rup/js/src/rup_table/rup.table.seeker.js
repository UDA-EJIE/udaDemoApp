/*! For license information please see rup.table.seeker.js.LICENSE.txt */
!function(e){"function"==typeof define&&define.amd?define(["jquery","datatables.net"],(function(r){return e(r,window,document)})):"object"==typeof exports?module.exports=function(r,a){return r||(r=window),a&&a.fn.dataTable||(a=require("datatables.net")(r,a).$),e(a,0,r.document)}:e(jQuery,window,document)}((function(e,r,a,t){"use strict";var s=e.fn.dataTable;function c(r,a,c){if(e("#"+e.escapeSelector(a.sTableId)+" tbody tr td.select-checkbox i.filtered-row").remove(),e("#"+e.escapeSelector(a.sTableId)+" tbody tr td i.filtered-row").remove(),c.length>0&&a.fnRecordsTotal()>0){var o="";e.each(a.json.rows,(function(t,n){if(c[a.seeker.search.pos].pageLine-1===t&&(o=r.rows().nodes()[t]),1===e.grep(c,(function(e){return s.Api().rupTable.comparePKs(e.pk,n)})).length){var i=e("<i></i>").addClass("mdi mdi-magnify ui-icon-rupInfoCol filtered-row");e(e("#"+e.escapeSelector(a.sTableId)+" tbody tr td:nth-child(1)")[t]).append(i)}}));var n=c[a.seeker.search.pos],i=a.json.rows[n.pageLine-1];""!==o&&o.className.indexOf("selected")<0&&n.page===Number(a.json.page)&&s.Api().rupTable.comparePKs(n.pk,i)&&(a.oInit.formEdit===t||a.oInit.formEdit.$navigationBar.funcionParams===t||a.oInit.formEdit.$navigationBar.funcionParams.length===t)&&(a.oInit.multiSelect!==t?r.row(n.pageLine-1).multiSelect():a.oInit.select!==t&&s.Api().select.selectRowIndex(r,n.pageLine-1,!0)),a.seeker.search.accion=""}e("#"+e.escapeSelector(a.sTableId)).trigger("selected.rup.dt",a)}function o(r,a,t){1===r?(t.seeker.search.$firstNavButton.prop("disabled",!0),t.seeker.search.$backNavButton.prop("disabled",!0)):(t.seeker.search.$firstNavButton.prop("disabled",!1),t.seeker.search.$backNavButton.prop("disabled",!1)),r===a?(t.seeker.search.$forwardNavButton.prop("disabled",!0),t.seeker.search.$lastNavButton.prop("disabled",!0)):(t.seeker.search.$forwardNavButton.prop("disabled",!1),t.seeker.search.$lastNavButton.prop("disabled",!1)),t.seeker.search.$matchedLabel.html(e.rup_utils.format(jQuery.rup.i18nParse(jQuery.rup.i18n.base,"rup_table.plugins.search.matchedRecordsCount"),Number(r),Number(a)))}function n(r,a,n){a.oInit.multiSelect!==t?s.Api().multiSelect.deselectAll(r):a.oInit.select!==t&&s.Api().select.deselect(a),function(e,r){var a=!1;return r!==t&&r.page!==Number(e.json.page)&&(a=!0),a}(a,n[a.seeker.search.pos])?e("#"+e.escapeSelector(a.sTableId)).DataTable().page(n[a.seeker.search.pos].page-1).draw("page"):c(r,a,n),0===n.length?(a.seeker.search.$firstNavButton.add(a.seeker.search.$backNavButton).add(a.seeker.search.$forwardNavButton).add(a.seeker.search.$lastNavButton).prop("disabled",!0),a.seeker.search.$matchedLabel.html(e.rup_utils.format(jQuery.rup.i18nParse(jQuery.rup.i18n.base,"rup_table.plugins.search.matchedRecords"),"0"))):o(a.seeker.search.pos+1,n.length,a)}function i(r){const a=r.aBaseJson;return e("#"+e.escapeSelector(r.sTableId)+"_seeker_form"),a!==t&&r.seeker.search.$searchForm[0]!==t&&(a.search=form2object(r.seeker.search.$searchForm[0])),a}function l(r,a){e("#"+e.escapeSelector(a.sTableId)).triggerHandler("tableSeekerBeforeClear",a);const s=e("#"+e.escapeSelector(a.sTableId)+"_search_searchForm");s.resetForm(),jQuery.each(e("select[rupType=select]",s),(function(e,r){const a=jQuery(r).data("settings");if(a!=t){const e=jQuery(r).attr("ruptype");a.parent==t&&"select"==e&&jQuery(r).rup_select("clear"),"select"==e&&jQuery(r).rup_select("reload")}})),a.seeker.search.funcionParams={},a.seeker.search.pos=0,n(r,a,[]),e("#"+e.escapeSelector(a.sTableId)).triggerHandler("tableSeekerAfterClear",a)}s.seeker={},s.seeker.version="1.2.4",s.seeker.init=function(r){var a=r.settings()[0];a.seeker={},function(r,a){let s=a.sTableId;e("#"+e.escapeSelector(s)+" tfoot").css("display","table-header-group"),e("#"+e.escapeSelector(s)+" tfoot th").each((function(){let r=this.innerText,c=e(this).index(),o=a.oInit.colModel;if(c>0||a.oInit.multiSelect===t){let a=c+1,n=e("#"+e.escapeSelector(s)+" thead th:nth-child("+a+")").attr("data-col-prop"),i=e.grep(o,(function(e){return e.name.toUpperCase()===n.toUpperCase()}));if(o!=t&&i[0]?.hidden)e(this).empty();else if("select"==i[0]?.rupType||"select"==i[0]?.searchoptions?.rupType)e(this).html('<select name="'+n+'" id="'+n+"_"+s+'_seeker"></select>');else{const a=e.rup_utils.isNumeric(i[0]?.searchoptions?.maxlength)?' maxlength="'+i[0].searchoptions.maxlength+'"':"";e(this).html('<input type="text" placeholder="'+r+'" name="'+n+'" id="'+n+"_"+s+'_seeker"'+a+"/>")}}})),r.columns().eq(0).each((function(r){if(r>0||a.oInit.multiSelect===t){let c=e("#"+e.escapeSelector(s)+" tfoot")[0].rows[0].cells[r];c!==t&&e("input",c).on("keypress",(function(r){if(this.focus(),"Enter"===r.code&&""!==this.value){let r=a.oInit.validarBuscar;if("function"==typeof r&&r(a))return!1;a.seeker.ajaxOption.data=i(a);var t=e.extend(!0,[],a.seeker.ajaxOption);e("#"+e.escapeSelector(a.sTableId)).triggerHandler("tableSeekerBeforeSearch",a),jQuery.isEmptyObject(t.data.search)||(t.data=JSON.stringify(t.data),e.rup_ajax(t)),e("#"+e.escapeSelector(a.sTableId)).triggerHandler("tableSeekerAfterSearch",a)}}))}})),function(r,a){var t=a.sTableId,s=jQuery("tfoot","#"+t),c="<button id='{0}' class='btn-material btn-material-sm btn-material-secondary-low-emphasis col-3 col-sm-auto me-sm-2' type='button' alt='{1}' disabled>{1}</button>",o=e("<tr class='search_row'></tr>"),p=e(e.rup_utils.format("<th class='search_row_header' colspan='{0}'></th>",s.find("th").length)),u=e(e.rup_utils.format("<div id='{0}' class='search_collapse_layer'></div>","searchCollapseLayer_"+t)),d=e(e.rup_utils.format("<span id='{0}' class='collapse_icon mdi mdi-chevron-right'></span>","searchCollapseIcon_"+t)),h=e(e.rup_utils.format("<a id='{0}' class='text-primary text-decoration-underline' href='#0'>{1}:</a>","searchCollapsLabel_"+t,jQuery.rup.i18nParse(jQuery.rup.i18n.base,"rup_table.plugins.search.searchCriteria"))),m=e(e.rup_utils.format("<div id='{0}' class='matched_layer me-3'></div>","matchedLayer_"+t)),f=e(e.rup_utils.format("<span id='{0}' class='ms-2'>{1}</span>","matchedLabel_"+t,e.rup_utils.format(jQuery.rup.i18nParse(jQuery.rup.i18n.base,"rup_table.plugins.search.matchedRecords"),0))),b=e(e.rup_utils.format("<div id='{0}' class='search_nav_layer row no-gutters'></div>","searchNavLayer_"+t)),k=e(e.rup_utils.format(c,"search_nav_first_"+t,jQuery.rup.i18nParse(jQuery.rup.i18n.base,"rup_table.first"))),_=e(e.rup_utils.format(c,"search_nav_back_"+t,jQuery.rup.i18nParse(jQuery.rup.i18n.base,"rup_table.previous"))),y=e(e.rup_utils.format(c,"search_nav_forward_"+t,jQuery.rup.i18nParse(jQuery.rup.i18n.base,"rup_table.next"))),g=e(e.rup_utils.format(c,"search_nav_last_"+t,jQuery.rup.i18nParse(jQuery.rup.i18n.base,"rup_table.last"))),v=e(e.rup_utils.format("<button id='{0}' class='btn-material btn-material-sm btn-material-primary-low-emphasis col-5 ms-4 mt-2 col-sm-auto ms-sm-0 mt-sm-auto me-sm-2' type='button' alt='{1}'><i class='mdi mdi-eraser'></i><span class='ui-button-text'>{1}</span></button>","search_nav_clear_button"+t,jQuery.rup.i18nParse(jQuery.rup.i18n.base,"rup_table.search.Reset"))),S=e(e.rup_utils.format("<button id='{0}' class='btn-material btn-material-sm btn-material-primary-low-emphasis col-5 ms-4 mt-2 col-sm-auto ms-sm-0 mt-sm-auto me-sm-2' type='button'><i class='mdi mdi-magnify'></i><span class='ui-button-text'>{1}</span></button>","search_nav_button_"+t,jQuery.rup.i18nParse(jQuery.rup.i18n.base,"rup_table.search.Find")));u.append(d).append(h),m.append(f),b.append(k).append(_).append(y).append(g).append(v).append(S),p.append(u),p.append(m),p.append(b),o.append(p),s.prepend(o),jQuery("tfoot tr.search_row","#"+t).addClass("ui-state-default"),a.seeker.search=a.seeker.search||{},a.seeker.search.created=!1,a.seeker.search.$collapseIcon=d,a.seeker.search.$searchRow=o,a.seeker.search.$matchedLabel=f,a.seeker.search.$firstNavButton=k,a.seeker.search.$backNavButton=_,a.seeker.search.$forwardNavButton=y,a.seeker.search.$lastNavButton=g,d.add(h).on("click",(function(){a.seeker.search.created?(a.seeker.search.$collapseIcon.removeClass("mdi-chevron-down"),a.seeker.search.$collapseIcon.addClass("mdi-chevron-right"),a.seeker.search.created=!1,a.seeker.searchForm.hide(),b.hide()):(a.seeker.search.$collapseIcon.removeClass("mdi-chevron-right"),a.seeker.search.$collapseIcon.addClass("mdi-chevron-down"),a.seeker.search.created=!0,a.seeker.searchForm.show(),b.show())})),S.on("click",(function(){e("#"+e.escapeSelector(a.sTableId)).triggerHandler("tableSeekerBeforeSearch",a);let r=a.oInit.validarBuscar;if("function"==typeof r&&r(a))return!1;a.seeker.ajaxOption.data=i(a);var t=e.extend(!0,[],a.seeker.ajaxOption);if(e("#"+e.escapeSelector(a.sTableId)).triggerHandler("tableSeekerBeforeSearch",a),!jQuery.isEmptyObject(t.data.search)){var s=t.success;t.success=function(){s(arguments[0],arguments[1],arguments[2]),t.success=s,e("#"+e.escapeSelector(a.sTableId)).triggerHandler("tableSeekerAfterSearch",a)},t.data=JSON.stringify(t.data),e.rup_ajax(t)}})),v.on("click",(function(){l(r,a)})),b.hide(),k.on("click",(function(){a.seeker.search.pos=0,n(r,a,a.seeker.search.funcionParams)})),_.on("click",(function(){a.seeker.search.pos--,n(r,a,a.seeker.search.funcionParams)})),y.on("click",(function(){a.seeker.search.accion="next",a.seeker.search.pos++,n(r,a,a.seeker.search.funcionParams)})),g.on("click",(function(){a.seeker.search.pos=a.seeker.search.funcionParams.length-1,n(r,a,a.seeker.search.funcionParams)}));var j=jQuery("<form>").attr("id",t+"_search_searchForm").addClass("w-100");e("#"+e.escapeSelector(t)).wrapAll(j),a.seeker.search.$searchForm=e("#"+e.escapeSelector(t)+"_search_searchForm"),a.seeker.search.$searchRow.hide(),a.seeker.search.pos=0,a.seeker.search.accion=""}(r,a),a.seeker.searchForm=e("#"+e.escapeSelector(s)+" tfoot tr:nth-child(2)"),a.seeker.searchForm.hide(),function(r,a){var s=a.oInit.colModel;if(s!==t){var c=e.escapeSelector(a.sTableId),o=e("#"+c+" tfoot tr").eq(1).find("th:not(.select-checkbox)"),n=o.find("input, select");0===n.length&&(n=(o=e("#"+c+" tfoot tr").eq(2).find("th:not(.select-checkbox)")).find("input, select")),o.each((function(){e(this).addClass("form-groupMaterial");let r=e(this).find("input, select").attr("name"),o=e.grep(s,(function(e){return e.name.toUpperCase()===r.toUpperCase()}));if(o!==t&&o.length>0){o=o[0];const r=o.searchoptions?.rupType!==t?o.searchoptions.rupType:o.rupType;var n=e("[name='"+o.name+"']",a.seeker.searchForm);1==n.length&&(n.attr({title:e("#"+o.name+"_"+c+"_seeker").attr("placeholder"),class:"editable customelement form-control-customer"}).removeAttr("readOnly"),e("<label></label>",{for:n.attr("id"),class:"d-none",text:n.attr("placeholder")}).insertAfter(n),r!==t&&("select"===r&&o.searchoptions===t?console.error(e.rup_utils.format(jQuery.rup.i18nParse(jQuery.rup.i18n.base,"rup_table.errors.wrongColModel"),o.name,"searchoptions")):"tree"===r?console.error(e.rup_utils.format(jQuery.rup.i18nParse(jQuery.rup.i18n.base,"rup_table.errors.treeSeeker"),o.name)):(new Set(["select"]).has(r)&&(o.searchoptions.$forceForm=e("#"+c+"_seeker_form")),n["rup_"+r](o.searchoptions))))}}))}}(0,a)}(r,a);var s={url:a.oInit.urlBase+"/search",accepts:{"*":"*/*",html:"text/html",json:"application/json, text/javascript",script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript",text:"text/plain",xml:"application/xml, text/xml"},type:"POST",data:i(a),dataType:"json",showLoading:!1,contentType:"application/json",async:!0,success:function(t,s,c){e("#"+e.escapeSelector(a.sTableId)).triggerHandler("tableSeekerSearchSuccess",a),a.seeker.search.funcionParams=t,a.seeker.search.pos=0,n(r,a,t)},error:function(r,t,s){a.oInit.feedback.$feedbackContainer.rup_feedback("set",s+": "+r.responseText,"error"),a.oInit.feedback.$feedbackContainer.rup_feedback("show"),e("#"+e.escapeSelector(a.sTableId)).triggerHandler("tableSeekerSearchError",a)},complete:function(r,t){e("#"+e.escapeSelector(a.sTableId)).triggerHandler("tableSeekerSearchComplete",a)}};a.seeker.ajaxOption=s,0===a.fnRecordsTotal()?a.seeker.search.$searchRow.hide():a.seeker.search.$searchRow.show(),e("#"+e.escapeSelector(a.sTableId)).triggerHandler("tableSeekerAfterCreateToolbar",a)};var p=s.Api.register;return p("seeker.eventTrigger()",(function(e,r,a,t){s.seeker._eventTrigger(e,r,a,t)})),p("seeker.selectSearch()",(function(e,r,a){c(e,r,a)})),p("seeker.limpiarSeeker()",(function(e,r){l(e,r)})),p("seeker.updateDetailSeekPagination()",(function(e,r,a){o(e,r,a)})),p("seeker.disabledButtons()",(function(r){!function(r){r.seeker!==t&&e.each(e("#"+e.escapeSelector(r.sTableId)+' tfoot [id*="seeker"]:not(a)'),(function(r,a){const t=e(this).attr("ruptype");"date"===t?e(this).rup_date("enable"):"select"===t?e(this).rup_select("enable"):"time"===t?e(this).rup_time("enable"):e(this).prop("disabled",!1)}))}(r)})),p("seeker.enabledButtons()",(function(r){!function(r){r.seeker!==t&&e.each(e("#"+e.escapeSelector(r.sTableId)+' tfoot [id*="seeker"]:not(a)'),(function(r,a){const t=e(this).attr("ruptype");"date"===t?(e(this).rup_date("disable"),e(this).next().addClass("form-control-customer")):"select"===t?e(this).rup_select("disable"):"time"===t?e(this).rup_time("disable"):e(this).prop("disabled",!0)}))}(r)})),e(a).on("plugin-init.dt",(function(r,a){"dt"===r.namespace&&(a.oInit.seeker!==t&&!1!==a.oInit.seeker.activate?(s.seeker.init(new s.Api(a)),a.oInit.scrollX&&e("#"+e.escapeSelector(a.sTableId)+"_wrapper .dataTables_scrollBody").on("scroll",(function(){e.fn.dataTable.seeker.init(new e.fn.dataTable.Api(e("#"+e.escapeSelector(a.sTableId)).DataTable().settings()[0]))}))):e("tfoot").hide())})),s.seeker}));