/*! For license information please see rup.tabs.js.LICENSE.txt */
!function(e){"function"==typeof define&&define.amd?define(["jquery","./templates","jquery.scrollto","./rup.base","./rup.tooltip"],e):e(jQuery,window.Rup)}((function(e,a){$.extend($.rup.iniRup,$.rup.rupSelectorObjectConstructor("rup_tabs",{})),$.fn.rup_tabs("extend",{disableTabs:function(e){var a;if("number"==typeof e.position)$("#"+$.escapeSelector(e.idTab)).tabs("disable",e.position),this.trigger("disable",null,a,$("#"+$.escapeSelector(e.idTab)));else if("object"==typeof e.position)for(var i in e.position)$("#"+$.escapeSelector(e.idTab)).tabs("disable",e.position[i]),this.trigger("disable",null,a,$("#"+$.escapeSelector(e.idTab)));else if(void 0===e.position){$("#"+$.escapeSelector(e.idTab)).tabs("disable");for(var t=$("#"+$.escapeSelector(e.idTab)).find(".ui-tabs-nav li").length,r=1;r<=t;r++)a=$("#"+$.escapeSelector(e.idTab)).find(".ui-tabs-nav li").eq(r),this.trigger("disable",null,a,$("#"+$.escapeSelector(e.idTab)))}},enableTabs:function(e){var a;if("number"==typeof e.position)a=$("#"+$.escapeSelector(e.idTab)).find(".ui-tabs-nav li").eq(e.position),$("#"+$.escapeSelector(e.idTab)).tabs("enable",e.position),this.trigger("enable",null,a,$("#"+$.escapeSelector(e.idTab)));else if("object"==typeof e.position)for(var i in e.position)a=$("#"+$.escapeSelector(e.idTab)).find(".ui-tabs-nav li").eq(e.position[i]),$("#"+$.escapeSelector(e.idTab)).tabs("enable",e.position[i]),this.trigger("enable",null,a,$("#"+$.escapeSelector(e.idTab)));else if(void 0===e.position){$("#"+$.escapeSelector(e.idTab)).tabs("enable");for(var t=$("#"+$.escapeSelector(e.idTab)).find(".ui-tabs-nav li").length,r=1;r<=t;r++)a=$("#"+$.escapeSelector(e.idTab)).find(".ui-tabs-nav li").eq(r),this.trigger("enable",null,a,$("#"+$.escapeSelector(e.idTab)))}},loadTab:function(e){e.url?this._changeUrlTab({idTab:e.idTab,position:e.position,url:$.rup_utils.setNoPortalParam(e.url)}):$("#"+$.escapeSelector(e.idTab)).tabs("load",e.position)},changeUrlTab:function(e){this._changeUrlTab({idTab:e.idTab,position:e.position,url:$.rup_utils.setNoPortalParam(e.url)})},changeLayerTab:function(e){this._includeLayer($("#"+$.escapeSelector(e.idTab)+" ul:first-child"),e.layer,$($("#"+$.escapeSelector(e.idTab)+" ul li a").get(e.position)))},selectTab:function(e){$("#"+$.escapeSelector(e.idTab)).tabs("option","active",e.position)},addTab:function(e){var a,i,t="rup-tabs-",r=0,s="";if(void 0!==e.maxNumberTabs&&$("#"+$.escapeSelector(e.idTab)+" li").length+1>e.maxNumberTabs)return $("#"+$.escapeSelector(e.idTab)).trigger("limitTabs"),!1;if(void 0!==e.lengthLiteral&&(s=e.label,e.label.length>e.lengthLiteral&&(e.label=e.label.substr(0,e.lengthLiteral).concat("..."))),void 0!==e.tabs){if(void 0===e.idNewTab||0!==$("#"+$.escapeSelector(e.idNewTab)).length)return $.rup.errorGestor($.rup.i18nParse($.rup.i18n.base,"rup_global.parameterError")),!1;(a=$("<div>").attr("id",e.idNewTab)).appendTo("body"),i=this._includeLayer($("#"+$.escapeSelector(e.idTab)+" > ul:first-child"),"#"+$.escapeSelector(e.idNewTab),null),a.rup_tabs(e),this._addTab({idTab:e.idTab,url:e.idNewTab,label:e.label,position:e.position,orientation:e.orientation}),$(i).remove()}else void 0!==e.layer?(e.layer=this._includeLayer($("#"+$.escapeSelector(e.idTab)+" > ul:first-child"),e.layer,null),this._addTab({idTab:e.idTab,url:e.layer,label:e.label,position:e.position,orientation:e.orientation}),$.each($("#"+$.escapeSelector(e.idTab)+" div[id*='"+t+"']"),(function(e,a){r<parseFloat(a.id.split(t)[1])&&(r=a.id.split(t)[1])}))):(this._addTab({idTab:e.idTab,url:$.rup_utils.setNoPortalParam(e.url),label:e.label,position:e.position,orientation:e.orientation}),$.each($("#"+$.escapeSelector(e.idTab)+" div[id*='"+t+"']"),(function(e,a){r<parseFloat(a.id.split(t)[1])&&(r=a.id.split(t)[1])})),$("#"+$.escapeSelector(e.idTab)+" div[id='rup-tabs-"+r+"']").addClass("ui-tabs-hide"),void 0!==e.fixedHeight&&$("#"+$.escapeSelector(e.idTab)+" div[id='rup-tabs-"+r+"']").css("height",e.fixedHeight));$("#"+$.escapeSelector(e.idTab)+" ul").first().find("li:nth-child("+(e.position+1)+") a").attr("title",s).rup_tooltip({}),e.tabsAtBottom&&$("#"+$.escapeSelector(e.idTab)+" ul li").last().not(".rup-tabs_loading").removeClass("ui-corner-top").addClass("ui-corner-botttom");var n=e.position;void 0!==e.orientation&&(n-=1);var l=$("#"+$.escapeSelector(e.idTab)+" ul li a").eq(n);if(!0===e.close){l.text("");var o=$.rup.i18nParse($.rup.i18n.app[$(this).attr("id")],e.label);void 0!==e.label&&""!==e.label&&(o=e.label),l.append($("<div>").addClass("rup-tabs_title").text(o)).append($("<span>").addClass("rup-tabs_loading")).append('<span class="ui-icon ui-icon-close" role="presentation">Remove Tab</span>'),$("span.ui-icon-close").on("click",(function(){var e=$(this).parent().parent().parent().parent(),a=$(this).parent().attr("href");$(this).parent().parent().remove(),$(a).remove(),e.tabs("refresh")})),$("span.ui-icon-close").addClass("rup-tabs-close"),$("span.ui-icon-close").on({mouseenter:function(){$(this).addClass("rup-tabs-close-hover")},mouseleave:function(){$(this).removeClass("rup-tabs-close-hover")}})}else{l.text("");var d=$.rup.i18nParse($.rup.i18n.app[$(this).attr("id")],e.label);void 0!==e.label&&""!==e.label&&(d=e.label),l.append($("<div>").addClass("rup-tabs_title").text(d)).append($("<span>").addClass("rup-tabs_loading"))}},removeTab:function(e){this._removeTab({idTab:e.idTab,position:e.position})},selected:0}),$.fn.rup_tabs("extend",{_init:function(e){global.initRupI18nPromise.then((()=>{var a=$(this);if(e.length>1)$.rup.errorGestor($.rup.i18nParse($.rup.i18n.base,"rup_global.initError")+$(this).attr("id"));else{var i=$.extend({},$.fn.rup_tabs.defaults,e[0]);i.id=$(this).attr("id"),i.iniLoad=!1,this.on("tabsload",(()=>{setTimeout((function(){a.trigger("afterTabDataLoad")}),300)})),void 0!==i.width&&$("#"+$.escapeSelector(i.id)).css("width",i.width).addClass("rup-tabs_overflow"),void 0!==i.height&&$("#"+$.escapeSelector(i.id)).css("height",i.height).addClass("rup-tabs_overflow");for(var t=i.tabs,r=0;void 0!==t;)r+=1,t=t[0].tabs;if(i.profun=r,this._parseJSON(i.tabs,$.rup.i18n.app[i.id],$("#"+$.escapeSelector(i.id)),"",1,i),i.iniLoad=!0,this._tabify($("#"+$.escapeSelector(i.id)),i),void 0!==i.fixedHeight&&$("#"+$.escapeSelector(i.id)+">.ui-tabs-panel").css("height",i.fixedHeight),$("#"+$.escapeSelector(i.id)).on("limitTabs",(function(){$.rup.errorGestor($.rup.i18nParse($.rup.i18n.base,"rup_tabs.tabLimitError"))})),void 0!==i.disabled)for(var s in i.disabled)$("#"+$.escapeSelector(i.id)).rup_tabs("disableTabs",{idTab:s,position:i.disabled[s]});$("#"+$.escapeSelector(i.id)).triggerHandler("load")}})).catch((e=>{console.error("Error al inicializar el componente:\n",e)}))},_tabify:function(e,a){e.addClass("rup-tabs_container"),e.data("settings",a);var i=$.extend({},a.ajaxOptions);i.beforeSend=function(){if(void 0!==a.ajaxOptions.beforeSend&&null!==a.ajaxOptions.beforeSend&&"function"==typeof a.ajaxOptions.beforeSend&&a.ajaxOptions.beforeSend.call(),!a.iniLoad)return e.data("cargado",!1),!1},i.complete=function(i,t){e.find("span.rup-tabs_loading_img").remove(),void 0!==a.ajaxOptions.complete&&null!==a.ajaxOptions.complete&&"function"==typeof a.ajaxOptions.complete&&a.ajaxOptions.complete(i,t)},i.success=function(e,i,t){void 0!==a.ajaxOptions.success&&null!==a.ajaxOptions.success&&"function"==typeof a.ajaxOptions.success&&a.ajaxOptions.success(e,i,t)},i.error=function(e,i,t){var r;void 0!==a.ajaxOptions.error&&null!==a.ajaxOptions.error&&"function"==typeof a.ajaxOptions.error&&(r=function(){a.ajaxOptions.error(e,i,t)}),$.rup_messages("msgError",{title:$.rup.i18nParse($.rup.i18n.base,"rup_global.developerError"),message:"<p>"+$.rup.i18nParse($.rup.i18n.base,"rup_tabs.serverError")+"<b> "+i+":  "+e.status+" - "+e.statusText+".</b></p>",width:"40%",beforeClose:r})};const t=$("div.rup-dialog").length;a.show=function(){$("div.rup-dialog").length>t&&$("div.rup-dialog").last().remove()},$(e).tabs({ajaxOptions:!1===a.cache?$.extend(i,{cache:!1}):i,cache:a.cache,cookie:null,show:a.fx?a.fx[0]:null,hide:a.fx?a.fx[1]:null,idPrefix:"rup-tabs-",panelTemplate:a.panelTemplate,active:a.selected,spinner:"<span class='rup-tabs_loading_img'></span>",create:a.create,beforeActivate:function(e,i){void 0!==$(i.panel).data("cargado")&&!1===$(i.panel).data("cargado")&&$(i.panel).length>0&&($(i.panel).tabs("load",a.selected),$(i.panel).data("cargado",!0)),void 0!==a.select&&null!==a.select&&"function"==typeof a.select&&a.select(e,i),$(i.newPanel).data("cargado",!0)},load:a.load,activate:a.show,add:a.add,remove:a.remove}),!0===a.scrollable&&this._scrollable(a),!0===a.tabsAtBottom&&($(e).addClass("tabs-bottom"),$(e).find(".tabs-spacer").css("float","left").css("height","200px"),$(".ui-tabs-nav, .ui-tabs-nav > *",$(e)).removeClass("ui-corner-all ui-corner-top").addClass("ui-corner-bottom"),$(".ui-tabs-panel.ui-widget-content.ui-corner-bottom",$(e)).removeClass("ui-corner-bottom").addClass("ui-corner-top"),$(".ui-tabs-nav",$(e)).appendTo(".tabs-bottom"))},_parseJSON:function(i,t,r,s,n,l){var o,d,p,c="",b=$(a.Templates.rup.tabs.container());function u(){var e=$(this).parent().attr("href");$(this).parent().parent().remove(),$(e).remove(),r.parent().tabs("refresh")}function f(){$(this).addClass("rup-tabs-close-hover")}function v(){$(this).removeClass("rup-tabs-close-hover")}r.append(b),r=$(r).children("ul");for(var h=0;h<i.length;h++)if(d=s+h,o=i[h],0===h&&n===l.profun?l.iniLoad=!0:l.iniLoad=!1,p=void 0!==o.label?o.label:$.rup.i18nParse(t,o.i18nCaption),void 0!==l.lengthLiteral&&(c=p,p.length>l.lengthLiteral&&(p=p.substr(0,l.lengthLiteral).concat("..."))),void 0!==o.layer)o.layer=this._includeLayer(r,o.layer,null),b.append(a.Templates.rup.tabs.tab({id:o.i18nCaption,href:o.layer,rupLevel:d,title:c,"aria-controls":c,alt:c,label:p,btnClose:l.close})),$("span.ui-icon-close").on("click",u),$("span.ui-icon-close").addClass("rup-tabs-close"),$("span.ui-icon-close").on({mouseenter:f,mouseleave:v});else if(void 0!==o.url)b.append(a.Templates.rup.tabs.tab({id:"#"+o.i18nCaption,href:$.rup_utils.setNoPortalParam(o.url),rupLevel:d,title:c,"aria-controls":c,alt:c,label:p,btnClose:l.close}));else if(void 0!==o.tabs){b.append(a.Templates.rup.tabs.tab({id:"#"+o.i18nCaption,href:"#"+o.i18nCaption,rupLevel:d,title:c,"aria-controls":c,alt:c,label:p,btnClose:l.close,tabs:o.tabs})),r=$(r).parent();var g="rupRandomLayerId-"+$.rup_utils.autoGenerateIdNum++,T=$(a.Templates.rup.tabs.subtab({rupRandomLayerId:g,id:o.i18nCaption,actualTab:!0}));r.append(T),(r=$(r).children("#"+g)).prepend($("<div>").attr("id",o.i18nCaption).attr("actualTab",!0)),r=$(r).children("div:first-child");var m=e.extend(!0,{},l);m.selected=o.selected,r.append(this._parseJSON(o.tabs,t,r,d,n+1,m)),this._tabify(r,m)}},_includeLayer:function(e,a,i){var t,r;return $(a).length>0?(r=1===$(a).length?$(a).css("display",""):$("<div>").append($(a).css("display","")),null===i?(t=$("<div>").append(r),e.parent().append(t),a="#"+$.rup_utils.randomIdGenerator(t)):(a=i.attr("href"),(t=$(i.attr("href"))).children().remove(),t.append(r))):(a="#load-tab-error",null===i?e.parent().append($("<div>").attr("id","load-tab-error").append($("<div>").addClass("rup-loading_tab_error").append($.rup.i18nParse($.rup.i18n.base,"rup_global.selectorError")))):(a=i.attr("href"),(t=$(i.attr("href"))).children().remove(),t.append($("<div>").attr("id","load-tab-error").append($("<div>").addClass("rup-loading_tab_error").append($.rup.i18nParse($.rup.i18n.base,"rup_global.selectorError")))))),a},_scrollable:function(e){var a,i=$.extend({},e),t=$(this),r=t.find(".ui-tabs-nav");t.css({padding:2,position:"relative"}),t.wrap('<div id="stTabswrapper" class="stTabsMainWrapper" style="position:relative"></div>').find(".ui-tabs-nav").css("overflow","hidden").wrapInner('<div class="stTabsInnerWrapper" style="width:30000px"><span class="stWidthChecker"></span></div>');var s=t.parents("#stTabswrapper").width(t.outerWidth(!0));$.browser.safari&&s.width(t.width()+6),i.resizable&&($.fn.resizable?s.resizable({minWidth:s.width(),maxWidth:2*s.width(),minHeight:s.height(),maxHeight:2*s.height(),handles:i.resizeHandles,alsoResize:t,resize:function(){t.trigger("resized")}}):$.rup.errorGestor($.rup.i18nParse($.rup.i18n.base,"rup_tabs.resizeError")));var n=parseInt(parseInt(r.innerHeight()/2)-8),l={cursor:"pointer","z-index":1e3,position:"absolute",top:3,height:r.outerHeight()-($.browser.safari?2:1)};s.prepend(a=$("<div></div>").disableSelection().css({position:"relative","z-index":3e3,display:"block"}).append($("<span></span>").disableSelection().attr("title","Previous tab").css(l).addClass("ui-state-active ui-corner-tl ui-corner-bl stPrev stNav").css("left",3).append($("<span/>").disableSelection().addClass("ui-icon ui-icon-carat-1-w").html("Previous tab").css("margin-top",n)).click((function(){if(!$(this).hasClass("ui-state-disabled")){var e=r.find("li.ui-tabs-active").prevAll().length-1;return r.find("li").eq(e).find("a").trigger("click"),!1}})),$("<span></span>").disableSelection().attr("title","Next tab").css(l).addClass("ui-state-active ui-corner-tr ui-corner-br stNext stNav").css({right:3}).append($("<span></span>").addClass("ui-icon ui-icon-carat-1-e").html("Next tab").css("margin-top",n)).click((function(){var e=r.find("li.ui-tabs-active").prevAll().length+1;return r.find("li").eq(e).find("a").trigger("click"),!1})))),t.on("navEnabler",(function(){setTimeout((function(){var e=r.find(".ui-tabs-active").is(":last-child"),a=r.find(".ui-tabs-active").is(":first-child"),i=s.find(".stNext"),t=s.find(".stPrev");e?(t.removeClass("ui-state-disabled"),i.addClass("ui-state-disabled")):a?(i.removeClass("ui-state-disabled"),t.addClass("ui-state-disabled")):(i.removeClass("ui-state-disabled"),t.removeClass("ui-state-disabled"))}),i.animationSpeed)})).on("navHandler",(function(){$(".stWidthChecker").children().length>5?(a.show(),r.find("li").first().css("margin-left",a.find(".stPrev").outerWidth(!0))):(a.hide(),r.find("li").first().css("margin-left",0))})).on("scrollToTab",(function(e,s,n,l){s=void 0!==s?$(s):r.find("li.ui-tabs-active");var o=a.is(":visible")?a.find(".stPrev").outerWidth(!0):0,d=-(t.width()-(s.outerWidth(!0)+o+parseInt(r.find("li").last().css("margin-right"),10))),p={axis:"x",margin:!0,offset:{left:d="tabClicked"==n&&"left"==l?-o:d},easing:i.easing||""};r.scrollTo(s,i.animationSpeed,p)})).on("bindTabClick",(function(){r.find("a").click((function(){var e=$(this).parents("li"),i=a.find(".stPrev").outerWidth(!0);return e.position().left-i<0?t.trigger("scrollToTab",[e,"tabClicked","left"]):e.outerWidth()+e.position().left>t.width()-i&&t.trigger("scrollToTab",[e,"tabClicked","right"]),t.trigger("navEnabler"),!1}))})).on("resized",(function(){t.trigger("navHandler"),t.trigger("scrollToTab",r.find("li.ui-tabs-active"))})).trigger("navHandler").trigger("navEnabler").trigger("bindTabClick")},_addTab:function(e){void 0===e.url&&(e.url="#");var a=$("#"+$.escapeSelector(e.idTab)).find(".ui-tabs-nav li").eq(e.position-1);void 0!==e.orientation?$("<li><a href='"+e.url+"'>"+e.label+"</a></li>").insertBefore(a):$("<li><a href='"+e.url+"'>"+e.label+"</a></li>").insertAfter(a),$("#"+$.escapeSelector(e.idTab)).tabs("refresh")},_removeTab:function(e){$("#"+$.escapeSelector(e.idTab)).find(".ui-tabs-nav li").eq(e.position-1).remove(),$("#"+$.escapeSelector(e.idTab)).tabs("refresh")},_changeUrlTab:function(e){var a=$("#"+$.escapeSelector(e.idTab)).find("ul > li").eq(e.position).find("> a");$(a).attr("href",e.url)}}),$.fn.rup_tabs.defaults={ajaxOptions:{},cache:!0,cookie:null,show:null,hide:null,panelTemplate:"<div></div>",profun:0,active:0,create:null,beforeActivate:null,load:null,activate:null,add:null,remove:null,enable:null,disable:null,tabsAtBottom:!1}}));