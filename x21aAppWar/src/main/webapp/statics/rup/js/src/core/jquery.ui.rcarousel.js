!function(e){e.widget("ui.rcarousel",{_create:function(){var t,a=e(this.element),n=this,i=this.options;this._checkOptionsValidity(this.options),this._createDataObject(),t=a.data("data"),a.addClass("ui-carousel").children().wrapAll("<div class='wrapper'></div>"),this._saveElements(),this._generatePages(),this._loadElements(),this._setCarouselWidth(),this._setCarouselHeight(),e(i.navigation.next).click((function(e){n.next(),e.preventDefault()})),e(i.navigation.prev).click((function(e){n.prev(),e.preventDefault()})),t.navigation.next=e(i.navigation.next),t.navigation.prev=e(i.navigation.prev),a.hover((function(){i.auto.enabled&&(clearInterval(t.interval),t.hoveredOver=!0)}),(function(){i.auto.enabled&&(t.hoveredOver=!1,n._autoMode(i.auto.direction))})),this._setStep(),i.auto.enabled&&this._autoMode(i.auto.direction),this._trigger("start")},_addElement:function(t,a){var n=e(this.element).find("div.wrapper"),i=this.options;t.height(i.height),"horizontal"===i.orientation?e(t).css("marginRight",i.margin):e(t).css({marginBottom:i.margin,float:"none"}),"prev"===a?n.prepend(t.clone(!0,!0)):n.append(t.clone(!0,!0))},append:function(t){var a=e(this.element).data("data");t.each((function(t,n){a.paths.push(e(n))})),a.oldPage=a.pages[a.oldPageIndex].slice(0),a.appended=!0,this._generatePages()},_autoMode:function(t){var a=this.options;e(this.element).data("data").interval="next"===t?setTimeout(this.next.bind(this),a.auto.interval):setTimeout(this.prev.bind(this),a.auto.interval)},_checkOptionsValidity:function(t){var a,n=this,i="";e.each(t,(function(o,r){switch(o){case"visible":if(!r||"number"!=typeof r||r<=0||Math.ceil(r)-r>0)throw new Error("visible should be defined as a positive integer");break;case"step":if(!r||"number"!=typeof r||r<=0||Math.ceil(r)-r>0)throw new Error("step should be defined as a positive integer");if(r>n.options.visible){for(a=1;a<=Math.floor(t.visible);a++)i+=a<Math.floor(r)?a+", ":a;throw new Error("Only following step values are correct: "+i)}break;case"width":if(!r||"number"!=typeof r||r<=0||Math.ceil(r)-r>0)throw new Error("width should be defined as a positive integer");break;case"height":if(!r||"number"!=typeof r||r<=0||Math.ceil(r)-r>0)throw new Error("height should be defined as a positive integer");break;case"speed":if(!r&&0!==r)throw new Error("speed should be defined as a number or a string");if("number"==typeof r&&r<0)throw new Error("speed should be a positive number");if("string"==typeof r&&"slow"!==r&&"normal"!==r&&"fast"!==r)throw new Error('Only "slow", "normal" and "fast" values are valid');break;case"navigation":if(!r||!1===e.isPlainObject(r))throw new Error("navigation should be defined as an object with at least one of the properties: 'prev' or 'next' in it");if(r.prev&&"string"!=typeof r.prev)throw new Error("navigation.prev should be defined as a string and point to '.class' or '#id' of an element");if(r.next&&"string"!=typeof r.next)throw new Error(" navigation.next should be defined as a string and point to '.class' or '#id' of an element");break;case"auto":if("string"!=typeof r.direction)throw new Error("direction should be defined as a string");if("next"!==r.direction&&"prev"!==r.direction)throw new Error("direction: only 'right' and 'left' values are valid");if(isNaN(r.interval)||"number"!=typeof r.interval||r.interval<0||Math.ceil(r.interval)-r.interval>0)throw new Error("interval should be a positive number");break;case"margin":if(isNaN(r)||"number"!=typeof r||r<0||Math.ceil(r)-r>0)throw new Error("margin should be a positive number")}}))},_createDataObject:function(){e(this.element).data("data",{paths:[],pathsLen:0,pages:[],lastPage:[],oldPageIndex:this.options.startAtPage,pageIndex:this.options.startAtPage,navigation:{},animated:!1,appended:!1,hoveredOver:!1})},_generatePages:function(){var t=this.options,a=e(this.element).data("data"),n=t.visible,i=a.paths.length;function o(e){for(var t=!1,n=0;n<a.lastPage.length;n++){if(a.lastPage[n].get(0)!==e[n].get(0)){t=!1;break}t=!0}return t}function r(e,t,n){var i=n||a.pages.length;n||(a.pages[i]=[]);for(var o=e;o<t;o++)a.pages[i].push(a.paths[o]);return i}!function(){a.pages=[],a.lastPage=[],a.pages[0]=[];for(var e=i-1;e>=i-n;e--)a.lastPage.unshift(a.paths[e]);for(e=0;e<n;e++)a.pages[0][a.pages[0].length]=a.paths[e]}(),function(){for(var e,s,d,l=!0,h=t.step;!o(a.pages[a.pages.length-1])||l;)l=!1,(e=h+n)>i&&(e=i),e-h<n?(s=r(d=h-(n-(e-h)),d+(n-(e-h))),r(h,e,s)):(r(h,e),h+=t.step)}()},getCurrentPage:function(){return e(this.element).data("data").pageIndex+1},getTotalPages:function(){return e(this.element).data("data").pages.length},goToPage:function(t){var a,n=e(this.element).data("data");n.animated||t===n.pageIndex||(n.animated=!0,t>n.pages.length-1?t=n.pages.length-1:t<0&&(t=0),n.pageIndex=t,(a=t-n.oldPageIndex)>=0?this._goToNextPage(a):this._goToPrevPage(a),n.oldPageIndex=t)},_loadElements:function(t,a){var n=this.options,i=e(this.element).data("data"),o=a||"next",r=t||i.pages[n.startAtPage],s=r.length;if("next"===o)for(var d=0;d<s;d++)this._addElement(r[d],o);else for(d=s-1;d>=0;d--)this._addElement(r[d],o)},_goToPrevPage:function(t){var a,n,i,o,r,s,d,l,h,g=e(this.element),p=this,c=this.options,v=e(this.element).data("data");n=v.appended?v.oldPage:v.pages[v.oldPageIndex],o=v.oldPageIndex+t,a=v.pages[o].slice(0),e(a).each((function(t,a){h=a.get(0)===e(n[t]).get(0)})),v.appended&&h&&(o=0===v.pageIndex?v.pageIndex=v.pages.length-1:--v.pageIndex,a=v.pages[o].slice(0)),s=a[a.length-1].get(0);for(var f=n.length-1;f>=0;f--){if(s===e(n[f]).get(0)){d=!1,l=f;break}d=!0}if(!d)for(;l>=0;)a[a.length-1].get(0)===n[l].get(0)&&a.pop(),--l;p._loadElements(a,"prev"),i=c.width*a.length+c.margin*a.length,"horizontal"===c.orientation?(r={scrollLeft:0},g.scrollLeft(i)):(r={scrollTop:0},g.scrollTop(i)),g.animate(r,c.speed,(function(){p._removeOldElements("last",a.length),v.animated=!1,!v.hoveredOver&&c.auto.enabled&&(clearInterval(v.interval),p._autoMode(c.auto.direction)),p._trigger("pageLoaded",null,{page:o})})),v.appended=!1},_goToNextPage:function(t){var a,n,i,o,r,s,d,l,h,g=e(this.element),p=this.options,c=g.data("data"),v=this;n=c.appended?c.oldPage:c.pages[c.oldPageIndex],o=c.oldPageIndex+t,a=c.pages[o].slice(0),e(a).each((function(t,a){h=a.get(0)===e(n[t]).get(0)})),c.appended&&h&&(a=c.pages[++c.pageIndex].slice(0)),s=a[0].get(0);for(var f=0;f<a.length;f++){if(s===e(n[f]).get(0)){d=!1,l=f;break}d=!0}if(!d)for(;l<n.length;)a[0].get(0)===n[l].get(0)&&a.shift(),++l;this._loadElements(a,"next"),i=p.width*a.length+p.margin*a.length,r="horizontal"===p.orientation?{scrollLeft:"+="+i}:{scrollTop:"+="+i},g.animate(r,p.speed,(function(){v._removeOldElements("first",a.length),"horizontal"===p.orientation?g.scrollLeft(0):g.scrollTop(0),c.animated=!1,!c.hoveredOver&&p.auto.enabled&&(clearInterval(c.interval),v._autoMode(p.auto.direction)),v._trigger("pageLoaded",null,{page:o})})),c.appended=!1},next:function(){this.options;var t=e(this.element).data("data");t.animated||(t.animated=!0,t.appended||++t.pageIndex,t.pageIndex>t.pages.length-1&&(t.pageIndex=0),this._goToNextPage(t.pageIndex-t.oldPageIndex),t.oldPageIndex=t.pageIndex)},prev:function(){this.options;var t=e(this.element).data("data");t.animated||(t.animated=!0,t.appended||--t.pageIndex,t.pageIndex<0&&(t.pageIndex=t.pages.length-1),this._goToPrevPage(t.pageIndex-t.oldPageIndex),t.oldPageIndex=t.pageIndex)},_removeOldElements:function(t,a){for(var n=e(this.element),i=0;i<a;i++)"first"===t?n.find("div.wrapper").children().first().remove():n.find("div.wrapper").children().last().remove()},_saveElements:function(){var t,a=e(this.element),n=a.find("div.wrapper").children(),i=a.data("data");n.each((function(a,n){t=e(n),i.paths.push(t.clone(!0,!0)),t.remove()}))},_setOption:function(t,a){var n,i=this.options;switch(e(this.element).data("data"),t){case"speed":this._checkOptionsValidity({speed:a}),i.speed=a,e.Widget.prototype._setOption.apply(this,arguments);break;case"auto":n=e.extend(i.auto,a),this._checkOptionsValidity({auto:n}),i.auto.enabled&&this._autoMode(i.auto.direction)}},_setStep:function(t){var a,n=this.options,i=e(this.element).data("data");a=t||n.step,n.step=a,i.step=n.width*a},_setCarouselHeight:function(){var t,a=e(this.element),n=(e(this.element).data("data"),this.options);t="vertical"===n.orientation?n.visible*n.height+n.margin*(n.visible-1):n.height,a.height(t)},_setCarouselWidth:function(){var t,a=e(this.element),n=this.options;e(this.element).data("data"),t="horizontal"===n.orientation?n.visible*n.width+n.margin*(n.visible-1):n.width,a.css({width:t,overflow:"hidden"})},options:{visible:3,step:3,width:100,height:100,speed:1e3,margin:0,orientation:"horizontal",auto:{enabled:!1,direction:"next",interval:5e3},startAtPage:0,navigation:{next:"#ui-carousel-next",prev:"#ui-carousel-prev"}}})}(jQuery);