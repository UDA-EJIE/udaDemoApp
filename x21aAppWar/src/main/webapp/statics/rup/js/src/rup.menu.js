/*! For license information please see rup.menu.js.LICENSE.txt */
!function(e){"function"==typeof define&&define.amd?define(["jquery","./rup.base"],e):e(jQuery)}((function(e){e.extend(e.rup.iniRup,e.rup.rupSelectorObjectConstructor("rup_menu",{})),e.fn.rup_menu("extend",{disable:function(n){e("#"+e.escapeSelector(n)).addClass("ui-state-disabled")},enable:function(n){e("#"+e.escapeSelector(n)).removeClass("ui-state-disabled")}}),e.fn.rup_menu("extend",{_init:function(n){if(n.length>1)e.rup.errorGestor(e.rup.i18nParse(e.rup.i18n.base,"rup_global.initError"+e(this).attr("id")));else if(this.length>0){var t,i,r=e.extend(!0,{},e.fn.rup_menu.defaults,n[0]),a=this,o=this,s=a[0].id;o.removeClass("rup_invisible_menu"),void 0===r.i18nId&&(r.i18nId=s),i=e.rup.i18n.app[r.i18nId],void 0!==r.menu?t=r.menu:void 0!==r.json&&(t=r.json),void 0!==t&&(a._parseJSON(t,i,o,r.forceAbs),o=window.widgetMenu("#"+a.attr("id")));var l=r.select;if(r.select=function(n,t){if(null!=l&&"function"==typeof l&&!1===l(n,t))return!1;if(/^keydown/.test(n.originalEvent.type)){n.stopImmediatePropagation();var i=e(t.item.children());"_blank"!==i.attr("target")?e(location).attr("href",i.attr("href")):e.rup.browser.isFF?window.Components.classes["@mozilla.org/appshell/window-mediator;1"].getService(window.Components.interfaces.nsIWindowMediator).getMostRecentWindow("navigator:browser").delayedOpenTab(i.attr("href"),null,null,null,null):e.rup.browser.isChrome?window.chrome.tabs.create({url:i.attr("href")}):window.open(i.attr("href"),"_blank")}return!1},o.find("a[target='_blank']").append("<span class='ui-icon ui-icon-extlink rup_external_link'></span>"),"horizontal"===r.display){o.on("mouseenter",".ui-menu-item",(function(n){var t=o.data().uiMenu;if(!t.previousFilter){var i=e(n.currentTarget);return i.hasClass("rup_menu_horizontal_children")?t.options.position={my:"left top",at:"left bottom",collision:"none none",of:this}:t.options.position={my:"left bottom",at:"right bottom"},i.siblings(".ui-state-active").removeClass("ui-state-active"),t.focus(n,i),n.stopImmediatePropagation(),n.preventDefault(),n.stopPropagation(),!1}})),o.on("keydown",(function(e){var n=o.data().uiMenu;switch(e.code){case"ArrowUp":n.previous(e),e.stopImmediatePropagation(),e.preventDefault(),e.stopPropagation();break;case"ArrowDown":n.active&&!n.active.is(".ui-state-disabled")&&(n.active.hasClass("rup_menu_horizontal_children")?(n.options.position={my:"left top",at:"left bottom",collision:"none none",of:n.active},n.expand(e)):n.next(e)),e.stopImmediatePropagation(),e.preventDefault(),e.stopPropagation();break;case"Left":n.active.hasClass("rup_menu_horizontal_children")?n.previous(e):n.collapse(e),e.stopImmediatePropagation(),e.preventDefault(),e.stopPropagation();break;case"Right":!n.active.hasClass("rup_menu_horizontal_children")&&n.active.is("[aria-haspopup='true']")?(n.options.position={my:"left bottom",at:"right bottom"},n.expand(e)):n.next(e),e.stopImmediatePropagation(),e.preventDefault(),e.stopPropagation();break;case"Home":n._move("first","first",e),e.stopImmediatePropagation(),e.preventDefault(),e.stopPropagation()}})),o.addClass("rup_menu_horizontal").addClass("ui-widget-header"),o.children().addClass("rup_menu_horizontal_children"),o.children().children("a").addClass("rup_menu_horizontal_children_entry"),o.menu(r),o.children(".ui-menu-divider").remove(),o.children(".ui-state-disabled").css({"margin-top":"0em","margin-bottom":"0em"}),e("#"+e.escapeSelector(s)+" li.rup_menu_horizontal_children > a .ui-icon-caret-1-e").removeClass("ui-icon-caret-1-e").addClass("ui-icon-caret-1-s").addClass("rup-menu_horizontalIcon"),o.children().children("a").css("font-weight","bold"),o.children().each((function(n,t){var i=0;e(t).children(".rup_menu_horizontal_children_entry:has(span:not(.rup-menu_horizontalIcon))").each((function(n,t){i=1===e(t).find("span").length?e(t).find("span").width():e(t).find("span:not(.rup-menu_horizontalIcon)").width()/2})),e(t).css("width",e(t).width()+i)})),o.children().children("a").css("font-weight",""),o.children(":has(.rup_menu_horizontal_children_entry span:not(.rup-menu_horizontalIcon))").addClass("rup_menu_horizontal_childrenIcon"),o.find(".rup_menu_horizontal_children_entry span:not(.rup-menu_horizontalIcon)").addClass("rup_menu_horizontal_children_icon"),o.children(":has(.rup_menu_horizontal_children_entry span.rup-menu_horizontalIcon)").addClass("rup_menu_horizontal_childrenMenuIcon"),o.children(":has(.rup_menu_horizontal_children_entry span.rup_menu_horizontal_children_icon):has(span.rup-menu_horizontalIcon)").addClass("rup_menu_horizontal_children_double"),o.children(":last-child").addClass("rup_menu_horizontal_children_last"),o.children().children("[aria-haspopup='true']").parent().attr("rupMenu_firsLevel","true"),e("#"+e.escapeSelector(s)+" [rupmenu_firslevel='true'] [role='menu']").addClass("rup_menu_vertical_horizontal"),void 0===r.verticalWidth?e("#"+e.escapeSelector(s)+" [rupmenu_firslevel='true'] [role='menu']").css("white-space","nowrap"):e("#"+e.escapeSelector(s)+" [rupmenu_firslevel='true'] [role='menu']").css("width",r.verticalWidth),o.find("a[target='_blank'] span.rup_menu_horizontal_children_icon").each((function(n,t){e(t).is(".ui-icon-extlink")&&e(t).addClass("ui-menu-icon").removeClass("rup_menu_horizontal_children_icon")}));var u=o.find("a[target='_blank'] span.rup_menu_horizontal_children_icon").parents("li");u.css("width",u.width()+16),u.find("span.ui-icon-extlink").css("margin-left","-1em")}else"vertical"===r.display?(o.addClass("rup_menu_vertical"),void 0===r.verticalWidth?o.css("white-space","nowrap"):o.css("width",r.verticalWidth),o.children().addClass("rup_menu_vertical_children"),o.menu(r),void 0!==r.verticalWidth&&e("#"+e.escapeSelector(s)+" .ui-menu .ui-menu-item").css("width",r.verticalWidth)):e.rup.errorGestor(e.rup.i18n.base.rup_menu.displayMenuError);o.addClass("ui-corner-all"),o.find("ul.rup_menu_vertical_horizontal").addClass("ui-corner-all");var d=!1;e("ul.rup_menu_vertical, ul.rup_menu_vertical ul, ul.rup_menu_vertical_horizontal").each((function(n,t){e(t).children("li").children("a").children("span").each((function(n,t){if(!e(t).is(".ui-icon.ui-icon-extlink, .ui-icon.ui-icon-carat-1-e"))return d=!0,!1})),d&&e(t).children("li").children("a").css("padding-left","2em"),d=!1})),o.find("a").on("click",(function(n){e(n.currentTarget).hasClass("ui-state-disabled")&&(n.preventDefault(),n.stopImmediatePropagation())}))}},_parseJSON:function(n,t,i,r){var a,o,s,l="";"true"===i.attr("uda-submenu")?i.attr("uda-submenu",""):(i.replaceWith(e("<ul>").attr("id",i.attr("id")).attr("style",i.attr("style")).attr("class",i.attr("class"))),i=e("#"+e.escapeSelector(i.attr("id"))));for(var u=n.length;u--;)o=n[u],s=e("<a>"),void 0!==o&&(null!==o.divider&&!0!==o.divider?(void 0!==o.pathUrl||void 0!==o.url?(l=void 0!==o.pathUrl?!0===r||!0===o.forceAbs?e.rup_utils.relToAbsUrl(o.pathUrl):o.pathUrl:e.rup.CTX_PATH+o.url,!0!==o.newWindow?void 0!==o.icon?i.prepend(e("<li>").append(s.text(e.rup.i18nParse(t,o.i18nCaption)).attr("href",l).css("text-decoration","underline").append(e("<span>").addClass("ui-icon").addClass(o.icon)))):i.prepend(e("<li>").append(s.text(e.rup.i18nParse(t,o.i18nCaption)).attr("href",l).css("text-decoration","underline"))):void 0!==o.icon?i.prepend(e("<li>").append(s.text(e.rup.i18nParse(t,o.i18nCaption)).attr("href",l).attr("target","_blank").css("text-decoration","underline").append(e("<span>").addClass("ui-icon").addClass(o.icon)))):i.prepend(e("<li>").append(s.text(e.rup.i18nParse(t,o.i18nCaption)).attr("href",l).attr("target","_blank").css("text-decoration","underline")))):(void 0!==o.icon?i.prepend(e("<li>").append(s.text(e.rup.i18nParse(t,o.i18nCaption)).css("cursor","default").append(e("<span>").addClass("ui-icon").addClass(o.icon))).append(e("<ul>").attr("uda-submenu","true"))):i.prepend(e("<li>").append(s.text(e.rup.i18nParse(t,o.i18nCaption)).css("cursor","default")).append(e("<ul>").attr("uda-submenu","true"))),(a=e("[uda-submenu = 'true']")).append(this._parseJSON(o.submenu,t,a))),!0===o.disabled&&s.parent().addClass("ui-state-disabled")):void 0===o.i18nCaption?i.prepend(e("<li>").addClass("ui-widget-content ui-menu-divider")):i.prepend(e("<li>").append(e("<strong>").text(e.rup.i18nParse(t,o.i18nCaption)))))}}),e.fn.rup_menu.defaults={verticalWidth:void 0,display:"horizontal",forceAbs:!1,i18nId:void 0,menus:"ul",position:{my:"left bottom",at:"right bottom"}}}));