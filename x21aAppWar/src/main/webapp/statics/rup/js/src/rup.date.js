/*! For license information please see rup.date.js.LICENSE.txt */
!function(e){"function"==typeof define&&define.amd?define(["jquery","./rup.base","./core/ui/jquery-ui.timepicker","./core/ui/jquery-ui.multidatespicker"],e):e(jQuery)}((function(e){e.extend(e.rup.iniRup,e.rup.rupSelectorObjectConstructor("rup_date",{})),e.extend(e.rup.iniRup,e.rup.rupObjectConstructor("rup_date",{})),e.fn.rup_date("extend",{getRupValue:function(){if(e(this).data("datepicker").settings.datetimepicker){var t=e(this).datepicker("getDate");if(null===t||"Invalid Date"===t.toString())return"";const s=e(this).data("datepicker").settings;var i=e(this).rup_date("getDate").split(" "),r=s.timeFormat[2],a=!!i[1]&&i[1].split(r).join(":"),n=s.dateFormat;return a?e.datepicker.formatDate(n,t)+" "+a:(console.error(e.rup_utils.format(jQuery.rup.i18nParse(jQuery.rup.i18n.base,"rup_date.errors.missingTime")),s.id),e.datepicker.formatDate(n,t))}return e(this).rup_date("getDate")},setRupValue:function(t=""){const i=e(this);if(""===t)return i.val(t),t;const r=this,a=i.data("datepicker").settings;let n;if(a.datetimepicker){let e=r._splitDate(t);if(e[0]=r._defineCorrectFormat(e[0]),void 0!==e[1]){const t=e[0]+" "+e[1];n=new Date(t)}else n=new Date(e[0])}else if(a.multiSelect){n=[],Array.isArray(t)||(t=r._splitDate(t.replace(",","")));for(let i=0;i<a.multiSelect&&t[i];i++){const s=new Date(r._defineCorrectFormat(r._splitDate(t[i])[0]));"Invalid Date"===s.toString()?console.error(e.rup_utils.format(jQuery.rup.i18nParse(jQuery.rup.i18n.base,"rup_date.errors.invalidDate")),a.id):n.push(s)}n.length>0&&t.length>a.multiSelect&&console.error(e.rup_utils.format(jQuery.rup.i18nParse(jQuery.rup.i18n.base,"rup_date.errors.multiSelectLimitExceeded")),t.length,a.multiSelect,t)}else n=new Date(r._defineCorrectFormat(t));if(!a.multiSelect&&"Invalid Date"===n.toString())return console.error(e.rup_utils.format(jQuery.rup.i18nParse(jQuery.rup.i18n.base,"rup_date.errors.invalidDate")),a.id),"";a.datetimepicker?e.datepicker._setDateDatepicker(e("#"+e.escapeSelector(a.id))[0],n):a.multiSelect?n.length>0&&(i.multiDatesPicker("resetDates"),i.multiDatesPicker("addDates",n)):e.datepicker._setDate(e.datepicker._getInst(e("#"+e.escapeSelector(a.id))[0]),n)},destroy:function(){var t=e(this).data("datepicker").settings.labelMaskId;t&&e("#"+e.escapeSelector(t)).text(""),e(this).datepicker("destroy")},disable:function(){e(this).datepicker("option","showOn","button"),e(this).next("button").prop("disabled",!0),e(this).prop("readonly",!0)},enable:function(){e(this).next("button").prop("disabled",!1),e(this).datepicker("option","showOn","both"),e(this).prop("readonly",!1)},isDisabled:function(){return e(this).prop("readonly")},hide:function(){e(this).datepicker("hide")},show:function(){e(this).datepicker("show")},getDate:function(){return e(this).val()},setDate:function(t){e(this).datepicker("setDate",t)},refresh:function(){e(this).datepicker("refresh")},option:function(t,i){if(void 0===i)return e(this).datepicker("option",t);e(this).datepicker("option",t,i)}}),e.fn.rup_date("extend",{_init:function(t){if(t.length>1)e.rup.errorGestor(e.rup.i18nParse(e.rup.i18n.base,"rup_global.initError")+e(this).attr("id"));else{var i=e.extend({},e.fn.rup_date.defaults,t[0]);this._ADAPTER=e.rup.adapter[i.adapter],i._onClose=i.onClose,i.onClose=function(t,r){void 0!==i._onClose&&i._onClose(t,r),e.rup.browser.isIE||e(this).focus()},i.multiSelect&&(i._beforeShow=i.beforeShow,i.beforeShow=function(t,r){void 0!==i._beforeShow&&i._beforeShow(t,r);var a,n=e(t),s=n.attr("value");void 0!==s&&""!==s&&(a=s.split(",")).length>1&&n.multiDatesPicker("addDates",a)}),i.id=e(this).attr("id"),e(this).attr("ruptype","date");var r=e.rup.i18n.base.rup_date;for(var a in r)void 0===i[a]&&(i[a]=r[a]);if(i.labelMaskId&&(i.datetimepicker?i.showSecond?e("#"+e.escapeSelector(i.labelMaskId)).text(e.rup.i18nParse(e.rup.i18n.base,"rup_date.maskDateTimeSec")+" "):e("#"+e.escapeSelector(i.labelMaskId)).text(e.rup.i18nParse(e.rup.i18n.base,"rup_date.maskDateTime")+" "):e("#"+e.escapeSelector(i.labelMaskId)).text(e.rup.i18nParse(e.rup.i18n.base,"rup_date.mask")+" ")),i.placeholderMask&&(i.datetimepicker?i.showSecond?e(this).attr("placeholder",e.rup.i18nParse(e.rup.i18n.base,"rup_date.maskDateTimeSec")+" "):e(this).attr("placeholder",e.rup.i18nParse(e.rup.i18n.base,"rup_date.maskDateTime")+" "):e(this).attr("placeholder",e.rup.i18nParse(e.rup.i18n.base,"rup_date.mask")+" ")),e("#"+e.escapeSelector(i.id)).is("div")&&1===i.numberOfMonths[1]&&(i.showWeek?e("#"+e.escapeSelector(i.id)).css("width","17.1em"):e("#"+e.escapeSelector(i.id)).css("width","15.4em")),i.noWeekend&&(i.beforeShowDay=e.datepicker.noWeekends),this._ADAPTER.initIconTrigger(i),i.multiSelect){var n=0;"number"==typeof i.multiSelect?(i.mode={modeName:"normal",options:{maxPicks:i.multiSelect}},i.maxPicks=i.multiSelect,n=10*i.multiSelect+(i.multiSelect-1)):"object"==typeof i.multiSelect&&(i.mode={modeName:"daysRange",options:{autoselectRange:i.multiSelect}},n=10*(n=i.multiSelect[1]-i.multiSelect[0])+(n-1)),this.attr("maxlength",n),e.datepicker._defaults.dateFormat=i.dateFormat,e("#"+e.escapeSelector(i.id)).multiDatesPicker(i),e(this).keypress((function(t){if(44===t.charCode){var i=e(t.currentTarget).val(),r=t.originalEvent.originalTarget.selectionStart,a=t.originalEvent.originalTarget.selectionEnd,n=i.substring(0,r),s=i.substring(a);(i.length<e(t.currentTarget).attr("maxlength")||r!==a)&&(e(t.currentTarget).val(n+","+s),t.originalEvent.originalTarget.selectionStart=r+1,t.originalEvent.originalTarget.selectionEnd=r+1)}}))}else i.datetimepicker?(i.showSecond?this.attr("maxlength","19"):this.attr("maxlength","16"),i.timeText=e.rup.i18nParse(e.rup.i18n.base,"rup_time.timeText"),i.hourText=e.rup.i18nParse(e.rup.i18n.base,"rup_time.hourText"),i.minuteText=e.rup.i18nParse(e.rup.i18n.base,"rup_time.minuteText"),i.secondText=e.rup.i18nParse(e.rup.i18n.base,"rup_time.secondText"),i.millisecText=e.rup.i18nParse(e.rup.i18n.base,"rup_time.millisecText"),i.microsecText=e.rup.i18nParse(e.rup.i18n.base,"rup_time.microsecText"),e("#"+e.escapeSelector(i.id)).datetimepicker(i)):(this.attr("maxlength","10"),e("#"+e.escapeSelector(i.id)).datepicker(i));this._ADAPTER.postConfigure.bind(e(this))(i),e("#"+e.escapeSelector(i.id)).val()&&e("#"+e.escapeSelector(i.id)).rup_date("setRupValue",e("#"+e.escapeSelector(i.id)).val()),e.rup_utils.aplicatioInPortal()&&!e("#"+e.escapeSelector(i.id)).is("div")&&e(".r01gContainer").append(e(".ui-datepicker:not(.r01gContainer .ui-datepicker)")),e(this).parent().find("[title]").rup_tooltip({applyToPortal:!0}),i.disabled&&e("#"+e.escapeSelector(i.id)).rup_date("disable"),i.create&&i.create()}},_defineCorrectFormat:function(t){return/^\d{4}(-|\/)\d{2}(-|\/)\d{2}$/.test(t)||(t=e.rup_utils.formatoFecha("yyyy/mm/dd",t.replaceAll("-","/"))[0]),t},_splitDate:function(e){return e.includes("T")?e.split("T"):e.split(" ")}}),e.rup_date("extend",{_init:function(t){if(t.length>1)e.rup.errorGestor(e.rup.i18nParse(e.rup.i18n.base,"rup_global.initError")+e(this).attr("id"));else{var i=e.extend({},e.fn.rup_date.defaults,t[0]),r=e.extend(!0,{},i),a=e.extend(!0,{},i);r.onClose=function(t,r){var a,n,s=e("#"+e.escapeSelector(i.to)),o=r.input;""!=s.attr("value")?(a=o.data("datepicker"),n=s.data("datepicker"),(void 0!==a.settings.timepicker?new Date(a.selectedYear,a.selectedMonth,a.selectedDay,a.settings.hour,a.settings.minute,a.settings.second):new Date(a.selectedYear,a.selectedMonth,a.selectedDay))>(void 0!==n.settings.timepicker?new Date(n.selectedYear,n.selectedMonth,n.selectedDay,n.settings.hour,n.settings.minute,n.settings.second):new Date(n.selectedYear,n.selectedMonth,n.selectedDay))&&s.attr("value",t)):i.autoFillToField||s.attr("value",t),void 0!==i.onClose&&i.onClose(t,r)},r.onSelect=a.beforeShow=function(t){var r,a=e("#"+e.escapeSelector(i.from)).datetimepicker("getDate");r=null!==a?new Date(a.getTime()):null,e("#"+e.escapeSelector(i.to)).datetimepicker("option","minDate",r),i.datetimepicker&&e("#"+e.escapeSelector(i.to)).datetimepicker("option","minDateTime",r),void 0!==i.onSelect&&i.onSelect(t)},a.onClose=function(t,r){var a,n,s=e("#"+e.escapeSelector(i.from)),o=r.input;""!=s.attr("value")?(a=s.data("datepicker"),n=o.data("datepicker"),(void 0!==a.settings.timepicker?new Date(a.selectedYear,a.selectedMonth,a.selectedDay,a.settings.hour,a.settings.minute,a.settings.second):new Date(a.selectedYear,a.selectedMonth,a.selectedDay))>(void 0!==n.settings.timepicker?new Date(n.selectedYear,n.selectedMonth,n.selectedDay,n.settings.hour,n.settings.minute,n.settings.second):new Date(n.selectedYear,n.selectedMonth,n.selectedDay))&&s.attr("value",t)):i.autoFillFromField||s.attr("value",t),void 0!==i.onClose&&i.onClose(t,r)},a.onSelect=r.beforeShow=function(t){var r,a=e("#"+e.escapeSelector(i.to)).datetimepicker("getDate");r=null!==a?new Date(a.getTime()):null,e("#"+e.escapeSelector(i.from)).datetimepicker("option","maxDate",r),i.datetimepicker&&e("#"+e.escapeSelector(i.from)).datetimepicker("option","maxDateTime",r),void 0!==i.onSelect&&i.onSelect(t)},e("#"+e.escapeSelector(i.from)).rup_date(r),e("#"+e.escapeSelector(i.to)).rup_date(a)}}}),e.extend(e.datepicker,{_gotoToday:function(t){const i=this._getInst(e(t)[0]);this._base_gotoToday(t);const r=e.timepicker.timezoneOffsetNumber(i.settings.timezoneOffset),a=new Date;a.setMinutes(a.getMinutes()+a.getTimezoneOffset()+parseInt(r,10)),this._setTime(i,a),this._setDate(i,a),this._onSelectHandler(i)},_onSelectHandler:function(e){const t=e.settings.onSelect,i=e.input?e.input[0]:null;t&&i&&t.apply(i,[i.value,e])}}),e.fn.rup_date.defaults={adapter:"date_material",placeholderMask:!1,datetimepicker:!1,multiSelect:!1,changeMonth:!0,changeYear:!0,noWeekend:!1,showSecond:!0,autoFillToField:!0,autoFillFromField:!0,showMillisec:!1,showMicrosec:!1,timezoneOffset:60}}));