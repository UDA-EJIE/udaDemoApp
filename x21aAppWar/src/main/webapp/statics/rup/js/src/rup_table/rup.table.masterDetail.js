/*! For license information please see rup.table.masterDetail.js.LICENSE.txt */
!function(e){"function"==typeof define&&define.amd?define(["jquery","datatables.net"],(function(t){return e(t,window,document)})):"object"==typeof exports?module.exports=function(t,r){return t||(t=window),r&&r.fn.dataTable||(r=require("datatables.net")(t,r).$),e(r,0,t.document)}:e(jQuery,window,document)}((function(e,t,r,a){"use strict";var n=e.fn.dataTable;function i(t,r,a){a.val("-1"),e("#"+e.escapeSelector(r.sTableId)+" > tbody tr").remove();var i=t.columns().responsiveHidden().reduce((function(e,t){return!0===t?e+1:e}),0),l=e("<tr></tr>",{class:""}).append(e("<td></td>",{valign:"top",colSpan:i,class:r.oClasses.sRowEmpty}).html(r.oLanguage.sZeroRecords))[0];e("#"+e.escapeSelector(r.sTableId)+" > tbody").append(l),r.seeker.search.$searchRow.hide(),e("#"+e.escapeSelector(r.sTableId)+"addButton_1").prop("disabled",!0),n.Api().select.deselect(r)}n.masterDetail={},n.masterDetail.version="1.2.4",n.masterDetail.init=function(t){var r=t.settings()[0];let l="#"+r.sTableId+"_filter_masterPK";var o=e(l);if(0===o.length){const t=jQuery.rup.i18nTemplate(jQuery.rup.i18n.base,"rup_table.errors.noMasterPKField.msg",r.oInit.filter.$filterContainer.attr("id"),l);throw e.rup_messages("msgError",{title:jQuery.rup.i18nTemplate(jQuery.rup.i18n.base,"rup_table.errors.noMasterPKField.title"),message:t}),t}var s=e(r.oInit.masterDetail.master+" > tbody"),d=e(r.oInit.masterDetail.master).DataTable(),c=r.oInit;s.on("click.DT","tr:not(.dtrg-group)",(function(){var l=d.rows(".selected").indexes();if(l[0]!==a){var s=d.rows(l).data(),c=n.Api().rupTable.getIdPk(s[0],d.context[0].oInit);o.val(""+c),e("#"+e.escapeSelector(r.sTableId)+"_filter_filterButton").click()}else i(t,r,o)})),e("#"+e.escapeSelector(r.sTableId)).on("tableEditFormAfterData",(function(e,t){t.oInit.formEdit!=a&&(t.oInit.formEdit.data==a&&(t.oInit.formEdit.data={}),t.oInit.formEdit.data.pkValueIdPadre=d.context[0].multiselection.lastSelectedId)})),d.on("tableAfterReorderData",(function(){var a=d.context[0].multiselection;0===a.selectedIds.length?i(t,r,o):(o.val(""+a.selectedIds[0]),e("#"+e.escapeSelector(r.sTableId)+"_filter_filterButton").click())})),d.on("tableButtonsAddActionConfirmed",(function(t,r){e("#"+e.escapeSelector(r.sTableId)+"_filter_cleanButton").click(),c.filter.$filterSummary.html(" <i></i>")}))};var l=n.Api.register;return l("masterDetail()",(function(){return this.iterator("table",(function(e){n.masterDetail.init(new n.Api(e))}))})),l("masterDetail.getMasterTablePkObject()",(function(t){return function(t){var r=e("#"+e.escapeSelector(t.sTableId)+"_filter_masterPK").val(),n=t.oInit.masterDetail.masterPrimaryKey;function i(e,t){var r={},a=e.split(".");return 1===a.length?(r[e]=t,r):(r[a[0]]=i(e.substr(e.indexOf(".")+1),t),r)}if(Array.isArray(n)&&n.length>0&&r!==a){var l=t.oInit.masterDetail.multiplePkToken,o=r.split(l),s={};return o.length===n.length&&e.each(n,(function(e,t){jQuery.extend(!0,s,i(t,o[e]))})),s}return r!==a?i(n,r):r===a?null:void 0}(t)})),e(r).on("preInit.dt.dtSelect",(function(e,t){"dt"===e.namespace&&t.oInit.masterDetail!==a&&n.masterDetail.init(new n.Api(t))})),n.masterDetail}));