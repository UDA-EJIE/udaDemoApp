/*
* Copyright 2024 E.J.I.E., S.A.
*
* Licencia con arreglo a la EUPL, Versión 1.1 exclusivamente (la «Licencia»);
* Solo podrá usarse esta obra si se respeta la Licencia.
* Puede obtenerse una copia de la Licencia en
*
* http://ec.europa.eu/idabc/eupl.html
*
* Salvo cuando lo exija la legislación aplicable o se acuerde por escrito,
* el programa distribuido con arreglo a la Licencia se distribuye «TAL CUAL»,
* SIN GARANTÍAS NI CONDICIONES DE NINGÚN TIPO, ni expresas ni implícitas.
* Véase la Licencia en el idioma concreto que rige los permisos y limitaciones
* que establece la Licencia.
*/
package com.ejie.x21a.control;


import com.ejie.x38.control.bind.annotation.RequestJsonBody;
import com.ejie.x38.dto.TableRequestDto;
import com.ejie.x38.dto.TableResponseDto;
import com.ejie.x38.dto.TableRowDto;
import com.ejie.x38.util.DateTimeManager;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.propertyeditors.CustomDateEditor;
import org.springframework.context.i18n.LocaleContextHolder;
import org.springframework.http.HttpStatus;
import org.springframework.http.MediaType;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.ServletRequestDataBinder;
import org.springframework.web.bind.annotation.DeleteMapping;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.InitBinder;
import org.springframework.web.bind.annotation.ModelAttribute;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.PutMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.ResponseBody;
import org.springframework.web.bind.annotation.ResponseStatus;
import java.util.Date;
import java.util.List;
import java.util.ArrayList;
import org.springframework.web.multipart.support.ByteArrayMultipartFileEditor; 
import com.ejie.x21a.service.AplicacionService;

import com.ejie.x21a.model.Aplicacion;


/**
 * AplicacionController generated by UDA", 21-Nov-2024 10:58:36.
 * @author UDA
 */

@Controller
@RequestMapping(value = "/aplicacion")

public class AplicacionController  {
	private static final Logger logger = LoggerFactory.getLogger(AplicacionController.class);

	@Autowired
	private AplicacionService aplicacionService;

	@InitBinder
	protected void initBinder(HttpServletRequest request, ServletRequestDataBinder binder) throws ServletException {
		binder.registerCustomEditor(byte[].class,new ByteArrayMultipartFileEditor());
		binder.registerCustomEditor(Date.class, new CustomDateEditor(DateTimeManager.getDateTimeFormat(LocaleContextHolder.getLocale()), true));
	}
	
	/*
	 * OPERACIONES CRUD (Create, Read, Update, Delete)
	 */
	
	/**
	 * Operación CRUD Read. Devuelve el bean correspondiente al identificador indicado.
	 *  
	 * @param codigo String
	 *
	 * @return Aplicacion Objeto correspondiente al identificador indicado.
	 */

	@GetMapping(value = "/{codigo}")
	public @ResponseBody Aplicacion get(@PathVariable String codigo  ) {
        Aplicacion aplicacion = new Aplicacion();
		
		aplicacion.setCodigo(codigo);
		
        aplicacion = this.aplicacionService.find(aplicacion);
        AplicacionController.logger.info("[GET - findBy_PK] : Obtener Aplicacion por PK");
        return aplicacion;
	}

	/**
	 * Devuelve una lista de beans correspondientes a los valores de filtrados
	 * indicados en el objeto pasado como parametro.
	 *
	 * @param filterAplicacion Aplicacion
	 *            Objeto que contiene los parametros de filtrado utilizados en
	 *            la busqueda.
	 * @return List<Aplicacion> 
	 *            Lista de objetos correspondientes a la busqueda realizada.
	 */
	@GetMapping(value = "/all")
	public @ResponseBody List<Aplicacion> getAll(@ModelAttribute Aplicacion filterAplicacion) {
		AplicacionController.logger.info("[GET - find_ALL] : Obtener Aplicacion por filtro");
	    return this.aplicacionService.findAll(filterAplicacion, null);
	}

	/**
	 * Operacion CRUD Edit. Modificacion del bean indicado.
	 *
	 * @param aplicacion Aplicacion 
	 *            Bean que contiene la informacion a modificar.
	 * @return Aplicacion 
	 *            Bean resultante de la modificacion.
	 */
	@PutMapping(value = "/edit")
    public @ResponseBody Aplicacion edit(@RequestBody Aplicacion aplicacion) {		
        Aplicacion aplicacionAux = this.aplicacionService.update(aplicacion);
		AplicacionController.logger.info("[PUT] : Aplicacion actualizado correctamente");
        return aplicacionAux;
    }

	/**
	 * Operacion CRUD Create. Creacion de un nuevo registro a partir del bean
	 * indicado.
	 *
	 * @param aplicacion Aplicacion 
	 *            Bean que contiene la informacion con la que se va a crear el
	 *            nuevo registro.
	 * @return Aplicacion
	 *            Bean resultante del proceso de creacion.
	 */
	@PostMapping(value = "/add")
	public @ResponseBody Aplicacion add(@RequestBody Aplicacion aplicacion) {		
        Aplicacion aplicacionAux = this.aplicacionService.add(aplicacion);
        AplicacionController.logger.info("[POST] : Aplicacion insertado correctamente");
    	return aplicacionAux;
	}

	/**
	 * Operación CRUD Delete. Borrado del registro correspondiente al identificador indicado.
	 *  
	 * @param codigo String
	 *
	 * @return Aplicacion Objeto correspondiente al identificador indicado.
	 */

	@DeleteMapping(value = "/{codigo}")
	public @ResponseBody Aplicacion remove(@PathVariable String codigo  ) {
        Aplicacion aplicacion = new Aplicacion();
		
		aplicacion.setCodigo(codigo);
		
        this.aplicacionService.remove(aplicacion);
        AplicacionController.logger.info("[DELETE] : Obtener Aplicacion borrado correctamente");
        return aplicacion;
	}    
	
	/*
	 * MÉTODOS COMPONENTE RUP_TABLE
	 */

	 /**
	 * Metodo de presentacion del RUP_TABLE.
	 * 
	 * @param model Model
	 * @return String
	 */
	@GetMapping(value = "/maint")
	public String getFormEdit(Model model) {
		AplicacionController.logger.info("[GET - View] : aplicacion");
		model.addAttribute("aplicacion", new Aplicacion());
		return "aplicacion";
	}
	 
	 /**
	 * Operacion de filtrado del componente RUP_TABLE.
	 * 
	 * @param filterAplicacion Aplicacion
	 *            Bean que contiene los parametros de filtrado a emplear.
	 * @param tableRequestDto
	 *            Dto que contiene los parametros de configuracion propios del
	 *            RUP_TABLE a aplicar en el filtrado.
	 * @return TableResponseDto<Aplicacion>
	 *            Dto que contiene el resultado del filtrado realizado por el 
	 *            componente RUP_TABLE.
	 */
	@PostMapping(value = "/filter")
	public @ResponseBody TableResponseDto<Aplicacion> filter(
			@RequestJsonBody(param="filter") Aplicacion filterAplicacion,
			@RequestJsonBody TableRequestDto tableRequestDto) {
		AplicacionController.logger.info("[POST - filter] : Obtener Aplicacions");
		return this.aplicacionService.filter(filterAplicacion, tableRequestDto, false);
	}
	 
	/**
	 * Operacion de busqueda del componente RUP_TABLE.
	 * 
	 * @param filterAplicacion Aplicacion
	 *            Bean que contiene los parametros de filtrado a emplear.
	 * @param searchAplicacion Aplicacion
	 *            Bean que contiene los parametros de busqueda a emplear.
	 * @param tableRequestDto
	 *            Dto que contiene los parametros de configuracion propios del
	 *            RUP_TABLE a aplicar en la búsqueda.
	 * @return TableRowDto<Aplicacion> 
	 *            Dto que contiene el resultado de la busqueda realizada por el
	 *            componente RUP_TABLE. 
	 */
	@PostMapping(value = "/search")
	public @ResponseBody List<TableRowDto<Aplicacion>> search(
			@RequestJsonBody(param="filter") Aplicacion filterAplicacion,
			@RequestJsonBody(param="search") Aplicacion searchAplicacion,
			@RequestJsonBody TableRequestDto tableRequestDto) {
		AplicacionController.logger.info("[POST - search] : Buscar Aplicacions");
		return this.aplicacionService.search(filterAplicacion, searchAplicacion, tableRequestDto, false);
	}
	
	/**
	 * Borrado multiple de registros
	 * 
	 * @param filterAplicacion Aplicacion
	 *            Bean que contiene los parametros de filtrado a emplear.
	 * @param tableRequestDto
	 *            Dto que contiene los parametros de configuracion propios del
	 *            RUP_TABLE a aplicar en la busqueda.
	 * @return List<String>
	 *            Lista de los identificadores de los registros eliminados.
	 * 
	 */
	@PostMapping(value = "/deleteAll")
	@ResponseStatus(value = HttpStatus.OK)
	public @ResponseBody List<String> removeMultiple(
			@RequestJsonBody(param="filter") Aplicacion filterAplicacion,
			@RequestJsonBody TableRequestDto tableRequestDto) {
		AplicacionController.logger.info("[POST - removeMultiple] : Eliminar multiples Aplicacions");
		this.aplicacionService.removeMultiple(tableRequestDto);
		AplicacionController.logger.info("All entities correctly deleted!");
		
		return tableRequestDto.getMultiselection().getSelectedIds();
	}
	
	/**
 	 * EXPORTERS
 	 */
	
	/**
	 * Devuelve los datos exportados de la tabla y los copia al Portapapeles.
	 *
	 * @param filterAplicacion Aplicacion
	 * @param tableRequestDto TableRequestDto
	 */	 
	@PostMapping(value = "/clipboardReport")
	protected @ResponseBody List<Aplicacion> getClipboardReport(
			@RequestJsonBody(param="filter") Aplicacion  filterAplicacion ,
			@RequestJsonBody TableRequestDto  tableRequestDto) {
		AplicacionController.logger.info("[POST - clipboardReport] : : Copiar en Portapapeles");
		return this.aplicacionService.getDataForReports(filterAplicacion, tableRequestDto);
	}
	
	/**
	 * Devuelve un fichero excel que contiene los datos exportados de la tabla.
	 *
	 * @param filter          Aplicacion
	 * @param columns         String[]
	 * @param fileName        String
	 * @param sheetTitle      String
	 * @param tableRequestDto TableRequestDto
	 * @param request         HttpServletRequest
	 * @param response        HttpServletResponse
	 */
	@PostMapping(value = { "/xlsReport","/xlsxReport" }, produces = MediaType.APPLICATION_OCTET_STREAM_VALUE)
	protected @ResponseBody void generateExcelReport(@RequestJsonBody(param = "filter", required = false) Aplicacion filter,
			@RequestJsonBody(param = "columns", required = false) String[] columns,
			@RequestJsonBody(param = "columnsName", required = false) String[] columnsName,
			@RequestJsonBody(param = "fileName", required = false) String fileName,
			@RequestJsonBody(param = "sheetTitle", required = false) String sheetTitle,
			@RequestJsonBody(param = "reportsParams", required = false) ArrayList<?> reportsParams,
			@RequestJsonBody TableRequestDto tableRequestDto, HttpServletRequest request, HttpServletResponse response)
			throws ServletException {
		AplicacionController.logger.info("[POST - generateExcelReport] : Devuelve un fichero excel");

		this.aplicacionService.generateReport(filter, columns,columnsName, fileName, sheetTitle,reportsParams, tableRequestDto, request, response);
	}
	
		/**
	 * Devuelve un fichero pdf que contiene los datos exportados de la tabla.
	 *
	 * @param filter          Aplicacion
	 * @param columns         String[]
	 * @param fileName        String
	 * @param sheetTitle      String
	 * @param tableRequestDto TableRequestDto
	 * @param request         HttpServletRequest
	 * @param response        HttpServletResponse
	 */
	@PostMapping(value = "pdfReport", produces = MediaType.APPLICATION_OCTET_STREAM_VALUE)
	protected @ResponseBody void generatePDFReport(@RequestJsonBody(param = "filter", required = false) Aplicacion filter,
			@RequestJsonBody(param = "columns", required = false) String[] columns,
			@RequestJsonBody(param = "columnsName", required = false) String[] columnsName,
			@RequestJsonBody(param = "fileName", required = false) String fileName,
			@RequestJsonBody(param = "sheetTitle", required = false) String sheetTitle,
			@RequestJsonBody(param = "reportsParams", required = false) ArrayList<?> reportsParams,
			@RequestJsonBody TableRequestDto tableRequestDto, HttpServletRequest request,
			HttpServletResponse response) {
		AplicacionController.logger.info("[POST - generatePDFReport] : Devuelve un fichero pdf");

		this.aplicacionService.generateReport(filter, columns,columnsName, fileName, sheetTitle,reportsParams, tableRequestDto, request, response);
	}
	
		/**
	 * Devuelve un fichero ods que contiene los datos exportados de la tabla.
	 *
	 * @param filter          Aplicacion
	 * @param columns         String[]
	 * @param fileName        String
	 * @param sheetTitle      String
	 * @param tableRequestDto TableRequestDto
	 * @param request         HttpServletRequest
	 * @param response        HttpServletResponse
	 */
	@PostMapping(value = "odsReport", produces = MediaType.APPLICATION_OCTET_STREAM_VALUE)
	protected @ResponseBody void generateODSReport(@RequestJsonBody(param = "filter", required = false) Aplicacion filter,
			@RequestJsonBody(param = "columns", required = false) String[] columns,
			@RequestJsonBody(param = "columnsName", required = false) String[] columnsName,
			@RequestJsonBody(param = "fileName", required = false) String fileName,
			@RequestJsonBody(param = "sheetTitle", required = false) String sheetTitle,
			@RequestJsonBody(param = "reportsParams", required = false) ArrayList<?> reportsParams,
			@RequestJsonBody TableRequestDto tableRequestDto, HttpServletRequest request,
			HttpServletResponse response) {
		AplicacionController.logger.info("[POST - generateODSReport] : Devuelve un fichero ods");

		this.aplicacionService.generateReport(filter, columns,columnsName, fileName, sheetTitle,reportsParams, tableRequestDto, request, response);
	}

	/**
	 * Devuelve un fichero csv que contiene los datos exportados de la tabla.
	 *
	 * @param filter          Aplicacion
	 * @param columns         String[]
	 * @param fileName        String
	 * @param sheetTitle      String
	 * @param tableRequestDto TableRequestDto
	 * @param request         HttpServletRequest
	 * @param response        HttpServletResponse
	 */
	@PostMapping(value = "csvReport", produces = MediaType.APPLICATION_OCTET_STREAM_VALUE)
	protected @ResponseBody void generateCSVReport(@RequestJsonBody(param = "filter", required = false) Aplicacion filter,
			@RequestJsonBody(param = "columns", required = false) String[] columns,
			@RequestJsonBody(param = "columnsName", required = false) String[] columnsName,
			@RequestJsonBody(param = "fileName", required = false) String fileName,
			@RequestJsonBody(param = "sheetTitle", required = false) String sheetTitle,
			@RequestJsonBody(param = "reportsParams", required = false) ArrayList<?> reportsParams,
			@RequestJsonBody TableRequestDto tableRequestDto, HttpServletRequest request,
			HttpServletResponse response) {
		AplicacionController.logger.info("[POST - generateCSVReport] : Devuelve un fichero csv");

		this.aplicacionService.generateReport(filter, columns,columnsName, fileName, sheetTitle,reportsParams, tableRequestDto, request, response);
	}
	
	
	
}