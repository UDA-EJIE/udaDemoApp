/*
* Copyright 2012 E.J.I.E., S.A.
*
* Licencia con arreglo a la EUPL, Versión 1.1 exclusivamente (la «Licencia»);
* Solo podrá usarse esta obra si se respeta la Licencia.
* Puede obtenerse una copia de la Licencia en
*
* http://ec.europa.eu/idabc/eupl.html
*
* Salvo cuando lo exija la legislación aplicable o se acuerde por escrito,
* el programa distribuido con arreglo a la Licencia se distribuye «TAL CUAL»,
* SIN GARANTÍAS NI CONDICIONES DE NINGÚN TIPO, ni expresas ni implícitas.
* Véase la Licencia en el idioma concreto que rige los permisos y limitaciones
* que establece la Licencia.
*/

package com.ejie.x21a.dao;

import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.List;

import javax.annotation.Resource;
import javax.sql.DataSource;

import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.jdbc.core.PreparedStatementSetter;
import org.springframework.jdbc.core.RowMapper;
import org.springframework.jdbc.support.lob.DefaultLobHandler;
import org.springframework.stereotype.Repository;
import org.springframework.transaction.annotation.Transactional;

import com.ejie.x21a.model.Comarca;
import com.ejie.x21a.model.Localidad;
import com.ejie.x21a.model.PerfilUsuario;
import com.ejie.x21a.model.Provincia;
import com.ejie.x21a.model.Usuario;
import com.ejie.x38.dto.Pagination;
import com.ejie.x38.util.PaginationManager;

/**
 *  * PerfilUsuarioDaoImpl generated by UDA, 14-nov-2011 9:41:52.
 * @author UDA
 */
 
@Repository
@Transactional
public class PerfilUsuarioDaoImpl implements PerfilUsuarioDao {
	
    private JdbcTemplate jdbcTemplate;
    private DefaultLobHandler defaultLobHandler;
    
	private RowMapper<PerfilUsuario> rwMap = new RowMapper<PerfilUsuario>() {
		public PerfilUsuario mapRow(ResultSet resultSet, int rowNum) throws SQLException {
           PerfilUsuario perfilUsuario = new PerfilUsuario(
               resultSet.getBigDecimal("ID"), 
               resultSet.getString("USERID"), 
               resultSet.getString("PASS"), 
               resultSet.getString("ACTIVO"), 
               resultSet.getString("TIPO"), 
               resultSet.getString("DESCRIPCION"), 
               resultSet.getTimestamp("FECHAALTA"), 
               resultSet.getDate("FECHABAJA"), 
               resultSet.getTimestamp("HORAENTRADA"), 
               new Usuario(resultSet.getString("UsuarioID"), 
            		   resultSet.getString("UsuarioNOMBRE"), 
            		   resultSet.getString("UsuarioAPELLIDO1"), 
            		   resultSet.getString("UsuarioAPELLIDO2"), 
            		   resultSet.getString("UsuarioEJIE"), 
            		   resultSet.getDate("UsuarioFECHAALTA"), 
            		   resultSet.getDate("UsuarioFECHABAJA")
               ), 
               new Localidad(resultSet.getBigDecimal("LocalidadCODE"), 
            		   resultSet.getString("LocalidadDESCES"), 
            		   resultSet.getString("LocalidadDESCEU"), 
            		   resultSet.getString("LocalidadCSS"), 
            		   new Comarca(resultSet.getBigDecimal("LocalidadCODECOMARCA"), null, null, null, null, null, null)
               ), 
               new Comarca(resultSet.getBigDecimal("ComarcaCODE"), 
            		   resultSet.getString("ComarcaDESCES"), 
            		   resultSet.getString("ComarcaDESCEU"),
            		   resultSet.getString("ComarcaCSS"), 
            		   new Provincia(resultSet.getBigDecimal("ComarcaCODEPROVINCIA"), null, null, null, null, null)
               ), 
               new Provincia(resultSet.getBigDecimal("ProvinciaCODE"), 
            		   resultSet.getString("ProvinciaDESCES"), 
            		   resultSet.getString("ProvinciaDESCEU"), 
            		   resultSet.getString("ProvinciaCSS"))
           ); 
           
           
           perfilUsuario.setImagen(defaultLobHandler.getBlobAsBytes(resultSet, "IMAGEN_PERFIL"));
           return perfilUsuario;
		}
           
	} ;

	/**
     * Method use to set the datasource.
     *
     * @param dataSource DataSource
     * @return
     */
    @Resource
    public void setDataSource(DataSource dataSource) {
    	this.jdbcTemplate = new JdbcTemplate(dataSource);
    	this.defaultLobHandler = new DefaultLobHandler();
    }

    /**
     * Inserts a single row in the PerfilUsuario table.
     *
     * @param perfilusuario Pagination
     * @return PerfilUsuario
     */
	public PerfilUsuario add(PerfilUsuario perfilusuario) {

    	String query = "INSERT INTO PERFIL_USUARIO( ID,ID_USUARIO,CODE_LOCALIDAD,CODE_COMARCA,CODE_PROVINCIA,USER_ID,PASS,ACTIVO,TIPO,DESCRIPCION,FECHA_ALTA,FECHA_BAJA,HORA_ENTRADA)"
        + "VALUES (?,?,?,?,?,?,?,?,?,?,?,?,?)";

				   Object getUsuarioIdAux=null;
		     if (perfilusuario.getUsuario()!= null  && perfilusuario.getUsuario().getId()!=null ){
			     getUsuarioIdAux=perfilusuario.getUsuario().getId();
		   	  }
				   Object getLocalidadCodeAux=null;
		     if (perfilusuario.getLocalidad()!= null  && perfilusuario.getLocalidad().getCode()!=null ){
			     getLocalidadCodeAux=perfilusuario.getLocalidad().getCode();
		   	  }
				   Object getComarcaCodeAux=null;
		     if (perfilusuario.getComarca()!= null  && perfilusuario.getComarca().getCode()!=null ){
			     getComarcaCodeAux=perfilusuario.getComarca().getCode();
		   	  }
				   Object getProvinciaCodeAux=null;
		     if (perfilusuario.getProvincia()!= null  && perfilusuario.getProvincia().getCode()!=null ){
			     getProvinciaCodeAux=perfilusuario.getProvincia().getCode();
		   	  }
		this.jdbcTemplate.update(query, perfilusuario.getId(), getUsuarioIdAux, getLocalidadCodeAux, getComarcaCodeAux, getProvinciaCodeAux, perfilusuario.getUserId(), perfilusuario.getPass(), perfilusuario.getActivo(), perfilusuario.getTipo(), perfilusuario.getDescripcion(), perfilusuario.getFechaAlta(), perfilusuario.getFechaBaja(), perfilusuario.getHoraEntrada());
		return perfilusuario;
	}

    /**
     * Updates a single row in the PerfilUsuario table.
     *
     * @param perfilusuario Pagination
     * @return PerfilUsuario
     */
    public PerfilUsuario update(final PerfilUsuario perfilusuario) {
		String query = "UPDATE PERFIL_USUARIO SET " +
				"ID_USUARIO=?,CODE_LOCALIDAD=?,CODE_COMARCA=?,CODE_PROVINCIA=?,USER_ID=?,PASS=?,ACTIVO=?,TIPO=?,DESCRIPCION=?,FECHA_ALTA=?,FECHA_BAJA=?,HORA_ENTRADA=?,IMAGEN_PERFIL=? WHERE ID=?";
//				String getUsuarioIdAux=null;
//				if (perfilusuario.getUsuario()!= null   && perfilusuario.getUsuario().getId()!=null ){
//					getUsuarioIdAux=perfilusuario.getUsuario().getId();
//				}
//				BigDecimal getLocalidadCodeAux=null;
//				if (perfilusuario.getLocalidad()!= null   && perfilusuario.getLocalidad().getCode()!=null ){
//					getLocalidadCodeAux=perfilusuario.getLocalidad().getCode();
//				}
//				Object getComarcaCodeAux=null;
//				if (perfilusuario.getComarca()!= null   && perfilusuario.getComarca().getCode()!=null ){
//					getComarcaCodeAux=perfilusuario.getComarca().getCode();
//				}
//				Object getProvinciaCodeAux=null;
//				if (perfilusuario.getProvincia()!= null   && perfilusuario.getProvincia().getCode()!=null ){
//					getProvinciaCodeAux=perfilusuario.getProvincia().getCode();
//				}
//		this.jdbcTemplate.update(query, getUsuarioIdAux, getLocalidadCodeAux, getComarcaCodeAux, getProvinciaCodeAux, perfilusuario.getUserId(), perfilusuario.getPass(), perfilusuario.getActivo(), perfilusuario.getTipo(), perfilusuario.getDescripcion(), perfilusuario.getFechaAlta(), perfilusuario.getFechaBaja(), perfilusuario.getHoraEntrada(), perfilusuario.getId());
		
		this.jdbcTemplate.update(query, new PreparedStatementSetter() {
			public void setValues(PreparedStatement ps) throws SQLException {
				ps.setString(1, perfilusuario.getUsuario().getId());
				ps.setBigDecimal(2, perfilusuario.getLocalidad().getCode());
				ps.setBigDecimal(3, perfilusuario.getComarca().getCode());
				ps.setBigDecimal(4, perfilusuario.getProvincia().getCode());
				ps.setString(5, perfilusuario.getUserId());
				ps.setString(6, perfilusuario.getPass());
				ps.setString(7, perfilusuario.getActivo());
				ps.setString(8, perfilusuario.getTipo());
				defaultLobHandler.getLobCreator().setClobAsString(ps, 9,
						perfilusuario.getDescripcion());
//				ps.setDate(9, new Date(perfilusuario.getFechaAlta().getTime()));
//				ps.setDate(10, new Date(perfilusuario.getFechaBaja().getTime()));
//				ps.setDate(11, new Date(perfilusuario.getHoraEntrada().getTime()));
				
				ps.setDate(10, null);
				ps.setDate(11, null);
				ps.setDate(12, null);
				
//				ps.setObject(9, perfilusuario.getFechaAlta());
//				ps.setObject(10, perfilusuario.getFechaBaja());
//				ps.setObject(11, perfilusuario.getHoraEntrada());
				defaultLobHandler.getLobCreator().setBlobAsBytes(ps, 13,
							perfilusuario.getImagenPerfil());
				ps.setBigDecimal(14, perfilusuario.getId());
			}
		});
		
		return perfilusuario;
	}

    /**
     * Finds a single row in the PerfilUsuario table.
     *
     * @param perfilusuario Pagination
     * @return PerfilUsuario
     */
    @Transactional (readOnly = true)
    public PerfilUsuario find(PerfilUsuario perfilusuario) {
		String query = "SELECT t1.ID ID, t1.USER_ID USERID, t1.PASS PASS, t1.ACTIVO ACTIVO, t1.TIPO TIPO, t1.DESCRIPCION DESCRIPCION, t1.FECHA_ALTA FECHAALTA, t1.FECHA_BAJA FECHABAJA, t1.HORA_ENTRADA HORAENTRADA, t2.ID USUARIOID, t2.NOMBRE USUARIONOMBRE, t2.APELLIDO1 USUARIOAPELLIDO1, t2.APELLIDO2 USUARIOAPELLIDO2, t2.EJIE USUARIOEJIE, t2.FECHA_ALTA USUARIOFECHAALTA, t2.FECHA_BAJA USUARIOFECHABAJA, t3.CODE LOCALIDADCODE, t3.DESC_ES LOCALIDADDESCES, t3.DESC_EU LOCALIDADDESCEU, t3.CSS LOCALIDADCSS, t4.CODE COMARCACODE, t4.DESC_ES COMARCADESCES, t4.DESC_EU COMARCADESCEU, t4.CSS COMARCACSS, t5.CODE PROVINCIACODE, t5.DESC_ES PROVINCIADESCES, t5.DESC_EU PROVINCIADESCEU, t5.CSS PROVINCIACSS, t3.CODE_COMARCA LOCALIDADCODECOMARCA, t4.CODE_PROVINCIA COMARCACODEPROVINCIA, t1.IMAGEN_PERFIL IMAGEN_PERFIL " 
         + "FROM PERFIL_USUARIO t1 , USUARIO t2 , LOCALIDAD t3 , COMARCA t4 , PROVINCIA t5  " 
         + "WHERE t1.ID = ?   AND t1.ID_USUARIO= t2.ID(+) AND t1.CODE_LOCALIDAD= t3.CODE(+) AND t1.CODE_COMARCA= t4.CODE(+) AND t1.CODE_PROVINCIA= t5.CODE(+)  ";
		return (PerfilUsuario) this.jdbcTemplate.queryForObject(query, 
			rwMap , perfilusuario.getId());	 
    }

    /**
     * Removes a single row in the PerfilUsuario table.
     *
     * @param perfilusuario Pagination
     * @return
     */
    public void remove(PerfilUsuario perfilusuario) {
		String query = "DELETE  FROM PERFIL_USUARIO WHERE ID=?";
		this.jdbcTemplate.update(query, perfilusuario.getId());
    	}
    
   /**
    * Finds a List of rows in the PerfilUsuario table.
    * 
    * @param perfilusuario PerfilUsuario
    * @param pagination Pagination
    * @return List 
    */
	@Transactional (readOnly = true)
    public List<PerfilUsuario> findAll(PerfilUsuario perfilusuario, Pagination pagination) {
		StringBuffer where = new StringBuffer(3000);
		List<Object> params = new ArrayList<Object>();
		where.append(" WHERE 1=1 AND t1.ID_USUARIO= t2.ID(+) AND t1.CODE_LOCALIDAD= t3.CODE(+) AND t1.CODE_COMARCA= t4.CODE(+) AND t1.CODE_PROVINCIA= t5.CODE(+) 	");
		
		StringBuffer query = new StringBuffer("SELECT  t1.ID ID,t1.USER_ID USERID,t1.PASS PASS,t1.ACTIVO ACTIVO,t1.TIPO TIPO,t1.DESCRIPCION DESCRIPCION,t1.FECHA_ALTA FECHAALTA,t1.FECHA_BAJA FECHABAJA,t1.HORA_ENTRADA HORAENTRADA,t2.ID USUARIOID,t2.NOMBRE USUARIONOMBRE,t2.APELLIDO1 USUARIOAPELLIDO1,t2.APELLIDO2 USUARIOAPELLIDO2,t2.EJIE USUARIOEJIE,t2.FECHA_ALTA USUARIOFECHAALTA,t2.FECHA_BAJA USUARIOFECHABAJA,t3.CODE LOCALIDADCODE,t3.DESC_ES LOCALIDADDESCES,t3.DESC_EU LOCALIDADDESCEU,t3.CSS LOCALIDADCSS,t4.CODE COMARCACODE,t4.DESC_ES COMARCADESCES,t4.DESC_EU COMARCADESCEU,t4.CSS COMARCACSS,t5.CODE PROVINCIACODE,t5.DESC_ES PROVINCIADESCES,t5.DESC_EU PROVINCIADESCEU,t5.CSS PROVINCIACSS,t3.CODE_COMARCA LOCALIDADCODECOMARCA,t4.CODE_PROVINCIA COMARCACODEPROVINCIA, t1.IMAGEN_PERFIL IMAGEN_PERFIL " 
			+ "FROM PERFIL_USUARIO t1 ,USUARIO t2 ,LOCALIDAD t3 ,COMARCA t4 ,PROVINCIA t5 ");
		
		if (perfilusuario  != null  && perfilusuario.getId() != null ) {
			where.append(" AND t1.ID = ?");
			params.add(perfilusuario.getId());
		}
		if (perfilusuario!=null && perfilusuario.getUsuario() != null  && perfilusuario.getUsuario().getId() != null ) {
			where.append(" AND t2.ID = ?");
			params.add(perfilusuario.getUsuario().getId());
		}
		if (perfilusuario!=null && perfilusuario.getUsuario() != null  && perfilusuario.getUsuario().getNombre() != null ) {
			where.append(" AND t2.NOMBRE = ?");
			params.add(perfilusuario.getUsuario().getNombre());
		}
		if (perfilusuario!=null && perfilusuario.getUsuario() != null  && perfilusuario.getUsuario().getApellido1() != null ) {
			where.append(" AND t2.APELLIDO1 = ?");
			params.add(perfilusuario.getUsuario().getApellido1());
		}
		if (perfilusuario!=null && perfilusuario.getUsuario() != null  && perfilusuario.getUsuario().getApellido2() != null ) {
			where.append(" AND t2.APELLIDO2 = ?");
			params.add(perfilusuario.getUsuario().getApellido2());
		}
		if (perfilusuario!=null && perfilusuario.getUsuario() != null  && perfilusuario.getUsuario().getEjie() != null ) {
			where.append(" AND t2.EJIE = ?");
			params.add(perfilusuario.getUsuario().getEjie());
		}
		if (perfilusuario!=null && perfilusuario.getUsuario() != null  && perfilusuario.getUsuario().getFechaAlta() != null ) {
			where.append(" AND t2.FECHA_ALTA = ?");
			params.add(perfilusuario.getUsuario().getFechaAlta());
		}
		if (perfilusuario!=null && perfilusuario.getUsuario() != null  && perfilusuario.getUsuario().getFechaBaja() != null ) {
			where.append(" AND t2.FECHA_BAJA = ?");
			params.add(perfilusuario.getUsuario().getFechaBaja());
		}
		if (perfilusuario!=null && perfilusuario.getLocalidad() != null  && perfilusuario.getLocalidad().getCode() != null ) {
			where.append(" AND t3.CODE = ?");
			params.add(perfilusuario.getLocalidad().getCode());
		}
		if (perfilusuario!=null && perfilusuario.getLocalidad() != null && perfilusuario.getLocalidad().getComarca() != null && perfilusuario.getLocalidad().getComarca().getCode() != null ) {
			where.append(" AND t3.CODE_COMARCA = ?");
			params.add(perfilusuario.getLocalidad().getComarca().getCode());
		}
		if (perfilusuario!=null && perfilusuario.getLocalidad() != null  && perfilusuario.getLocalidad().getDescEs() != null ) {
			where.append(" AND t3.DESC_ES = ?");
			params.add(perfilusuario.getLocalidad().getDescEs());
		}
		if (perfilusuario!=null && perfilusuario.getLocalidad() != null  && perfilusuario.getLocalidad().getDescEu() != null ) {
			where.append(" AND t3.DESC_EU = ?");
			params.add(perfilusuario.getLocalidad().getDescEu());
		}
		if (perfilusuario!=null && perfilusuario.getLocalidad() != null  && perfilusuario.getLocalidad().getCss() != null ) {
			where.append(" AND t3.CSS = ?");
			params.add(perfilusuario.getLocalidad().getCss());
		}
		if (perfilusuario!=null && perfilusuario.getComarca() != null  && perfilusuario.getComarca().getCode() != null ) {
			where.append(" AND t4.CODE = ?");
			params.add(perfilusuario.getComarca().getCode());
		}
		if (perfilusuario!=null && perfilusuario.getComarca() != null && perfilusuario.getComarca().getProvincia() != null && perfilusuario.getComarca().getProvincia().getCode() != null ) {
			where.append(" AND t4.CODE_PROVINCIA = ?");
			params.add(perfilusuario.getComarca().getProvincia().getCode());
		}
		if (perfilusuario!=null && perfilusuario.getComarca() != null  && perfilusuario.getComarca().getDescEs() != null ) {
			where.append(" AND t4.DESC_ES = ?");
			params.add(perfilusuario.getComarca().getDescEs());
		}
		if (perfilusuario!=null && perfilusuario.getComarca() != null  && perfilusuario.getComarca().getDescEu() != null ) {
			where.append(" AND t4.DESC_EU = ?");
			params.add(perfilusuario.getComarca().getDescEu());
		}
		if (perfilusuario!=null && perfilusuario.getComarca() != null  && perfilusuario.getComarca().getCss() != null ) {
			where.append(" AND t4.CSS = ?");
			params.add(perfilusuario.getComarca().getCss());
		}
		if (perfilusuario!=null && perfilusuario.getProvincia() != null  && perfilusuario.getProvincia().getCode() != null ) {
			where.append(" AND t5.CODE = ?");
			params.add(perfilusuario.getProvincia().getCode());
		}
		if (perfilusuario!=null && perfilusuario.getProvincia() != null  && perfilusuario.getProvincia().getDescEs() != null ) {
			where.append(" AND t5.DESC_ES = ?");
			params.add(perfilusuario.getProvincia().getDescEs());
		}
		if (perfilusuario!=null && perfilusuario.getProvincia() != null  && perfilusuario.getProvincia().getDescEu() != null ) {
			where.append(" AND t5.DESC_EU = ?");
			params.add(perfilusuario.getProvincia().getDescEu());
		}
		if (perfilusuario!=null && perfilusuario.getProvincia() != null  && perfilusuario.getProvincia().getCss() != null ) {
			where.append(" AND t5.CSS = ?");
			params.add(perfilusuario.getProvincia().getCss());
		}
		if (perfilusuario  != null  && perfilusuario.getUserId() != null ) {
			where.append(" AND t1.USER_ID = ?");
			params.add(perfilusuario.getUserId());
		}
		if (perfilusuario  != null  && perfilusuario.getPass() != null ) {
			where.append(" AND t1.PASS = ?");
			params.add(perfilusuario.getPass());
		}
		if (perfilusuario  != null  && perfilusuario.getActivo() != null ) {
			where.append(" AND t1.ACTIVO = ?");
			params.add(perfilusuario.getActivo());
		}
		if (perfilusuario  != null  && perfilusuario.getTipo() != null ) {
			where.append(" AND t1.TIPO = ?");
			params.add(perfilusuario.getTipo());
		}
		if (perfilusuario  != null  && perfilusuario.getFechaAlta() != null ) {
			where.append(" AND t1.FECHA_ALTA = ?");
			params.add(perfilusuario.getFechaAlta());
		}
		if (perfilusuario  != null  && perfilusuario.getFechaBaja() != null ) {
			where.append(" AND t1.FECHA_BAJA = ?");
			params.add(perfilusuario.getFechaBaja());
		}
		if (perfilusuario  != null  && perfilusuario.getHoraEntrada() != null ) {
			where.append(" AND t1.HORA_ENTRADA = ?");
			params.add(perfilusuario.getHoraEntrada());
		}
		query.append(where);

		StringBuffer order = new StringBuffer(3000);
		if (pagination != null) {
			if (pagination.getSort() != null) {
				order.append(" ORDER BY " + pagination.getSort() + " " + pagination.getAscDsc());
				query.append(order);
			}
			query = new StringBuffer(PaginationManager.getQueryLimits(pagination,query.toString()));
		}
		return (List<PerfilUsuario>) this.jdbcTemplate.query(query.toString(),rwMap, params.toArray());
	}
	
    /**
     * Counts rows in the PerfilUsuario table.
     * 
     * @param perfilusuario PerfilUsuario
     * @return Long
     */
    @Transactional (readOnly = true)
    public Long findAllCount(PerfilUsuario perfilusuario) {

		StringBuffer where = new StringBuffer(3000);
		List<Object> params = new ArrayList<Object>();
		where.append(" WHERE 1=1  and t1.ID_USUARIO= t2.ID(+) and t1.CODE_LOCALIDAD= t3.CODE(+) and t1.CODE_COMARCA= t4.CODE(+) and t1.CODE_PROVINCIA= t5.CODE(+) ");

		StringBuffer query = new StringBuffer("SELECT COUNT(1) FROM  PERFIL_USUARIO t1   ,  USUARIO t2   ,  LOCALIDAD t3   ,  COMARCA t4   ,  PROVINCIA t5  ");
		if (perfilusuario  != null  && perfilusuario.getId() != null ) {
			where.append(" AND t1.ID = ?");
			params.add(perfilusuario.getId());
		}
		if (perfilusuario!=null && perfilusuario.getUsuario() != null  && perfilusuario.getUsuario().getId() != null ) {
			where.append(" AND t2.ID = ?");
			params.add(perfilusuario.getUsuario().getId());
		}
		if (perfilusuario!=null && perfilusuario.getUsuario() != null  && perfilusuario.getUsuario().getNombre() != null ) {
			where.append(" AND t2.NOMBRE = ?");
			params.add(perfilusuario.getUsuario().getNombre());
		}
		if (perfilusuario!=null && perfilusuario.getUsuario() != null  && perfilusuario.getUsuario().getApellido1() != null ) {
			where.append(" AND t2.APELLIDO1 = ?");
			params.add(perfilusuario.getUsuario().getApellido1());
		}
		if (perfilusuario!=null && perfilusuario.getUsuario() != null  && perfilusuario.getUsuario().getApellido2() != null ) {
			where.append(" AND t2.APELLIDO2 = ?");
			params.add(perfilusuario.getUsuario().getApellido2());
		}
		if (perfilusuario!=null && perfilusuario.getUsuario() != null  && perfilusuario.getUsuario().getEjie() != null ) {
			where.append(" AND t2.EJIE = ?");
			params.add(perfilusuario.getUsuario().getEjie());
		}
		if (perfilusuario!=null && perfilusuario.getUsuario() != null  && perfilusuario.getUsuario().getFechaAlta() != null ) {
			where.append(" AND t2.FECHA_ALTA = ?");
			params.add(perfilusuario.getUsuario().getFechaAlta());
		}
		if (perfilusuario!=null && perfilusuario.getUsuario() != null  && perfilusuario.getUsuario().getFechaBaja() != null ) {
			where.append(" AND t2.FECHA_BAJA = ?");
			params.add(perfilusuario.getUsuario().getFechaBaja());
		}
		if (perfilusuario!=null && perfilusuario.getLocalidad() != null  && perfilusuario.getLocalidad().getCode() != null ) {
			where.append(" AND t3.CODE = ?");
			params.add(perfilusuario.getLocalidad().getCode());
		}
		if (perfilusuario!=null && perfilusuario.getLocalidad() != null && perfilusuario.getLocalidad().getComarca() != null && perfilusuario.getLocalidad().getComarca().getCode() != null ) {
			where.append(" AND t3.CODE_COMARCA = ?");
			params.add(perfilusuario.getLocalidad().getComarca().getCode());
		}
		if (perfilusuario!=null && perfilusuario.getLocalidad() != null  && perfilusuario.getLocalidad().getDescEs() != null ) {
			where.append(" AND t3.DESC_ES = ?");
			params.add(perfilusuario.getLocalidad().getDescEs());
		}
		if (perfilusuario!=null && perfilusuario.getLocalidad() != null  && perfilusuario.getLocalidad().getDescEu() != null ) {
			where.append(" AND t3.DESC_EU = ?");
			params.add(perfilusuario.getLocalidad().getDescEu());
		}
		if (perfilusuario!=null && perfilusuario.getLocalidad() != null  && perfilusuario.getLocalidad().getCss() != null ) {
			where.append(" AND t3.CSS = ?");
			params.add(perfilusuario.getLocalidad().getCss());
		}
		if (perfilusuario!=null && perfilusuario.getComarca() != null  && perfilusuario.getComarca().getCode() != null ) {
			where.append(" AND t4.CODE = ?");
			params.add(perfilusuario.getComarca().getCode());
		}
		if (perfilusuario!=null && perfilusuario.getComarca() != null && perfilusuario.getComarca().getProvincia() != null && perfilusuario.getComarca().getProvincia().getCode() != null ) {
			where.append(" AND t4.CODE_PROVINCIA = ?");
			params.add(perfilusuario.getComarca().getProvincia().getCode());
		}
		if (perfilusuario!=null && perfilusuario.getComarca() != null  && perfilusuario.getComarca().getDescEs() != null ) {
			where.append(" AND t4.DESC_ES = ?");
			params.add(perfilusuario.getComarca().getDescEs());
		}
		if (perfilusuario!=null && perfilusuario.getComarca() != null  && perfilusuario.getComarca().getDescEu() != null ) {
			where.append(" AND t4.DESC_EU = ?");
			params.add(perfilusuario.getComarca().getDescEu());
		}
		if (perfilusuario!=null && perfilusuario.getComarca() != null  && perfilusuario.getComarca().getCss() != null ) {
			where.append(" AND t4.CSS = ?");
			params.add(perfilusuario.getComarca().getCss());
		}
		if (perfilusuario!=null && perfilusuario.getProvincia() != null  && perfilusuario.getProvincia().getCode() != null ) {
			where.append(" AND t5.CODE = ?");
			params.add(perfilusuario.getProvincia().getCode());
		}
		if (perfilusuario!=null && perfilusuario.getProvincia() != null  && perfilusuario.getProvincia().getDescEs() != null ) {
			where.append(" AND t5.DESC_ES = ?");
			params.add(perfilusuario.getProvincia().getDescEs());
		}
		if (perfilusuario!=null && perfilusuario.getProvincia() != null  && perfilusuario.getProvincia().getDescEu() != null ) {
			where.append(" AND t5.DESC_EU = ?");
			params.add(perfilusuario.getProvincia().getDescEu());
		}
		if (perfilusuario!=null && perfilusuario.getProvincia() != null  && perfilusuario.getProvincia().getCss() != null ) {
			where.append(" AND t5.CSS = ?");
			params.add(perfilusuario.getProvincia().getCss());
		}
		if (perfilusuario  != null  && perfilusuario.getUserId() != null ) {
			where.append(" AND t1.USER_ID = ?");
			params.add(perfilusuario.getUserId());
		}
		if (perfilusuario  != null  && perfilusuario.getPass() != null ) {
			where.append(" AND t1.PASS = ?");
			params.add(perfilusuario.getPass());
		}
		if (perfilusuario  != null  && perfilusuario.getActivo() != null ) {
			where.append(" AND t1.ACTIVO = ?");
			params.add(perfilusuario.getActivo());
		}
		if (perfilusuario  != null  && perfilusuario.getTipo() != null ) {
			where.append(" AND t1.TIPO = ?");
			params.add(perfilusuario.getTipo());
		}
		if (perfilusuario  != null  && perfilusuario.getFechaAlta() != null ) {
			where.append(" AND t1.FECHA_ALTA = ?");
			params.add(perfilusuario.getFechaAlta());
		}
		if (perfilusuario  != null  && perfilusuario.getFechaBaja() != null ) {
			where.append(" AND t1.FECHA_BAJA = ?");
			params.add(perfilusuario.getFechaBaja());
		}
		if (perfilusuario  != null  && perfilusuario.getHoraEntrada() != null ) {
			where.append(" AND t1.HORA_ENTRADA = ?");
			params.add(perfilusuario.getHoraEntrada());
		}
		query.append(where);
		return this.jdbcTemplate.queryForLong(query.toString(), params.toArray());
	}
	
	/**
	 * Finds rows in the PerfilUsuario table using like.
     * 
     * @param perfilusuario PerfilUsuario
     * @param pagination Pagination
     * @param startsWith Boolean
     * @return List 
     */
	@Transactional (readOnly = true)
    public List<PerfilUsuario> findAllLike(PerfilUsuario perfilusuario, Pagination pagination, Boolean startsWith) {
		StringBuffer where = new StringBuffer(3000);
		List<Object> params = new ArrayList<Object>();
		where.append(" WHERE 1=1 AND t1.ID_USUARIO= t2.ID(+) AND t1.CODE_LOCALIDAD= t3.CODE(+) AND t1.CODE_COMARCA= t4.CODE(+) AND t1.CODE_PROVINCIA= t5.CODE(+) 	");
		
		StringBuffer query = new StringBuffer("SELECT  t1.ID ID,t1.USER_ID USERID,t1.PASS PASS,t1.ACTIVO ACTIVO,t1.TIPO TIPO,t1.DESCRIPCION DESCRIPCION,t1.FECHA_ALTA FECHAALTA,t1.FECHA_BAJA FECHABAJA,t1.HORA_ENTRADA HORAENTRADA,t2.ID USUARIOID,t2.NOMBRE USUARIONOMBRE,t2.APELLIDO1 USUARIOAPELLIDO1,t2.APELLIDO2 USUARIOAPELLIDO2,t2.EJIE USUARIOEJIE,t2.FECHA_ALTA USUARIOFECHAALTA,t2.FECHA_BAJA USUARIOFECHABAJA,t3.CODE LOCALIDADCODE,t3.DESC_ES LOCALIDADDESCES,t3.DESC_EU LOCALIDADDESCEU,t3.CSS LOCALIDADCSS,t4.CODE COMARCACODE,t4.DESC_ES COMARCADESCES,t4.DESC_EU COMARCADESCEU,t4.CSS COMARCACSS,t5.CODE PROVINCIACODE,t5.DESC_ES PROVINCIADESCES,t5.DESC_EU PROVINCIADESCEU,t5.CSS PROVINCIACSS,t3.CODE_COMARCA LOCALIDADCODECOMARCA,t4.CODE_PROVINCIA COMARCACODEPROVINCIA " 
        	+ "FROM PERFIL_USUARIO t1 ,USUARIO t2 ,LOCALIDAD t3 ,COMARCA t4 ,PROVINCIA t5 ");
      	
		if (perfilusuario  != null  && perfilusuario.getId() != null ) {
			where.append(" AND t1.ID like ? ESCAPE  '\\'");
			if (startsWith){
				params.add(perfilusuario.getId()  +"%");
			}else{
				params.add("%"+perfilusuario.getId() +"%");
			}	
			where.append(" AND t1.ID IS NOT NULL");
        }
		if (perfilusuario!=null && perfilusuario.getUsuario() != null  && perfilusuario.getUsuario().getId() != null ) {
			where.append(" AND t2.ID like ? ESCAPE  '\\'");
			if (startsWith){
				params.add(perfilusuario.getUsuario().getId()  +"%");
			}else{
				params.add("%"+perfilusuario.getUsuario().getId() +"%");
			}	
			where.append(" AND t2.ID IS NOT NULL");
        }
		if (perfilusuario!=null && perfilusuario.getUsuario() != null  && perfilusuario.getUsuario().getNombre() != null ) {
			where.append(" AND UPPER(t2.NOMBRE) like ? ESCAPE  '\\'");
			if (startsWith){
				params.add(perfilusuario.getUsuario().getNombre().toUpperCase()  +"%");
			}else{
				params.add("%"+perfilusuario.getUsuario().getNombre().toUpperCase() +"%");
			}	
			where.append(" AND t2.NOMBRE IS NOT NULL");
        }
		if (perfilusuario!=null && perfilusuario.getUsuario() != null  && perfilusuario.getUsuario().getApellido1() != null ) {
			where.append(" AND UPPER(t2.APELLIDO1) like ? ESCAPE  '\\'");
			if (startsWith){
				params.add(perfilusuario.getUsuario().getApellido1().toUpperCase()  +"%");
			}else{
				params.add("%"+perfilusuario.getUsuario().getApellido1().toUpperCase() +"%");
			}	
			where.append(" AND t2.APELLIDO1 IS NOT NULL");
        }
		if (perfilusuario!=null && perfilusuario.getUsuario() != null  && perfilusuario.getUsuario().getApellido2() != null ) {
			where.append(" AND UPPER(t2.APELLIDO2) like ? ESCAPE  '\\'");
			if (startsWith){
				params.add(perfilusuario.getUsuario().getApellido2().toUpperCase()  +"%");
			}else{
				params.add("%"+perfilusuario.getUsuario().getApellido2().toUpperCase() +"%");
			}	
			where.append(" AND t2.APELLIDO2 IS NOT NULL");
        }
		if (perfilusuario!=null && perfilusuario.getUsuario() != null  && perfilusuario.getUsuario().getEjie() != null ) {
			where.append(" AND UPPER(t2.EJIE) like ? ESCAPE  '\\'");
			if (startsWith){
				params.add(perfilusuario.getUsuario().getEjie().toUpperCase()  +"%");
			}else{
				params.add("%"+perfilusuario.getUsuario().getEjie().toUpperCase() +"%");
			}	
			where.append(" AND t2.EJIE IS NOT NULL");
        }
		if (perfilusuario!=null && perfilusuario.getUsuario() != null  && perfilusuario.getUsuario().getFechaAlta() != null ) {
			where.append(" AND t2.FECHA_ALTA like ? ESCAPE  '\\'");
			if (startsWith){
				params.add(perfilusuario.getUsuario().getFechaAlta()  +"%");
			}else{
				params.add("%"+perfilusuario.getUsuario().getFechaAlta() +"%");
			}	
			where.append(" AND t2.FECHA_ALTA IS NOT NULL");
        }
		if (perfilusuario!=null && perfilusuario.getUsuario() != null  && perfilusuario.getUsuario().getFechaBaja() != null ) {
			where.append(" AND t2.FECHA_BAJA like ? ESCAPE  '\\'");
			if (startsWith){
				params.add(perfilusuario.getUsuario().getFechaBaja()  +"%");
			}else{
				params.add("%"+perfilusuario.getUsuario().getFechaBaja() +"%");
			}	
			where.append(" AND t2.FECHA_BAJA IS NOT NULL");
        }
		if (perfilusuario!=null && perfilusuario.getLocalidad() != null  && perfilusuario.getLocalidad().getCode() != null ) {
			where.append(" AND t3.CODE like ? ESCAPE  '\\'");
			if (startsWith){
				params.add(perfilusuario.getLocalidad().getCode()  +"%");
			}else{
				params.add("%"+perfilusuario.getLocalidad().getCode() +"%");
			}	
			where.append(" AND t3.CODE IS NOT NULL");
        }
		if (perfilusuario!=null && perfilusuario.getLocalidad() != null && perfilusuario.getLocalidad().getComarca() != null && perfilusuario.getLocalidad().getComarca().getCode() != null ) {
			where.append(" AND t3.CODE_COMARCA like ? ESCAPE  '\\'");
			if (startsWith){
				params.add(perfilusuario.getLocalidad().getComarca().getCode()  +"%");
			}else{
				params.add("%"+perfilusuario.getLocalidad().getComarca().getCode() +"%");
			}	
			where.append(" AND t3.CODE_COMARCA IS NOT NULL");
        }
		if (perfilusuario!=null && perfilusuario.getLocalidad() != null  && perfilusuario.getLocalidad().getDescEs() != null ) {
			where.append(" AND UPPER(t3.DESC_ES) like ? ESCAPE  '\\'");
			if (startsWith){
				params.add(perfilusuario.getLocalidad().getDescEs().toUpperCase()  +"%");
			}else{
				params.add("%"+perfilusuario.getLocalidad().getDescEs().toUpperCase() +"%");
			}	
			where.append(" AND t3.DESC_ES IS NOT NULL");
        }
		if (perfilusuario!=null && perfilusuario.getLocalidad() != null  && perfilusuario.getLocalidad().getDescEu() != null ) {
			where.append(" AND UPPER(t3.DESC_EU) like ? ESCAPE  '\\'");
			if (startsWith){
				params.add(perfilusuario.getLocalidad().getDescEu().toUpperCase()  +"%");
			}else{
				params.add("%"+perfilusuario.getLocalidad().getDescEu().toUpperCase() +"%");
			}	
			where.append(" AND t3.DESC_EU IS NOT NULL");
        }
		if (perfilusuario!=null && perfilusuario.getLocalidad() != null  && perfilusuario.getLocalidad().getCss() != null ) {
			where.append(" AND UPPER(t3.CSS) like ? ESCAPE  '\\'");
			if (startsWith){
				params.add(perfilusuario.getLocalidad().getCss().toUpperCase()  +"%");
			}else{
				params.add("%"+perfilusuario.getLocalidad().getCss().toUpperCase() +"%");
			}	
			where.append(" AND t3.CSS IS NOT NULL");
        }
		if (perfilusuario!=null && perfilusuario.getComarca() != null  && perfilusuario.getComarca().getCode() != null ) {
			where.append(" AND t4.CODE like ? ESCAPE  '\\'");
			if (startsWith){
				params.add(perfilusuario.getComarca().getCode()  +"%");
			}else{
				params.add("%"+perfilusuario.getComarca().getCode() +"%");
			}	
			where.append(" AND t4.CODE IS NOT NULL");
        }
		if (perfilusuario!=null && perfilusuario.getComarca() != null && perfilusuario.getComarca().getProvincia() != null && perfilusuario.getComarca().getProvincia().getCode() != null ) {
			where.append(" AND t4.CODE_PROVINCIA like ? ESCAPE  '\\'");
			if (startsWith){
				params.add(perfilusuario.getComarca().getProvincia().getCode()  +"%");
			}else{
				params.add("%"+perfilusuario.getComarca().getProvincia().getCode() +"%");
			}	
			where.append(" AND t4.CODE_PROVINCIA IS NOT NULL");
        }
		if (perfilusuario!=null && perfilusuario.getComarca() != null  && perfilusuario.getComarca().getDescEs() != null ) {
			where.append(" AND UPPER(t4.DESC_ES) like ? ESCAPE  '\\'");
			if (startsWith){
				params.add(perfilusuario.getComarca().getDescEs().toUpperCase()  +"%");
			}else{
				params.add("%"+perfilusuario.getComarca().getDescEs().toUpperCase() +"%");
			}	
			where.append(" AND t4.DESC_ES IS NOT NULL");
        }
		if (perfilusuario!=null && perfilusuario.getComarca() != null  && perfilusuario.getComarca().getDescEu() != null ) {
			where.append(" AND UPPER(t4.DESC_EU) like ? ESCAPE  '\\'");
			if (startsWith){
				params.add(perfilusuario.getComarca().getDescEu().toUpperCase()  +"%");
			}else{
				params.add("%"+perfilusuario.getComarca().getDescEu().toUpperCase() +"%");
			}	
			where.append(" AND t4.DESC_EU IS NOT NULL");
        }
		if (perfilusuario!=null && perfilusuario.getComarca() != null  && perfilusuario.getComarca().getCss() != null ) {
			where.append(" AND UPPER(t4.CSS) like ? ESCAPE  '\\'");
			if (startsWith){
				params.add(perfilusuario.getComarca().getCss().toUpperCase()  +"%");
			}else{
				params.add("%"+perfilusuario.getComarca().getCss().toUpperCase() +"%");
			}	
			where.append(" AND t4.CSS IS NOT NULL");
        }
		if (perfilusuario!=null && perfilusuario.getProvincia() != null  && perfilusuario.getProvincia().getCode() != null ) {
			where.append(" AND t5.CODE like ? ESCAPE  '\\'");
			if (startsWith){
				params.add(perfilusuario.getProvincia().getCode()  +"%");
			}else{
				params.add("%"+perfilusuario.getProvincia().getCode() +"%");
			}	
			where.append(" AND t5.CODE IS NOT NULL");
        }
		if (perfilusuario!=null && perfilusuario.getProvincia() != null  && perfilusuario.getProvincia().getDescEs() != null ) {
			where.append(" AND UPPER(t5.DESC_ES) like ? ESCAPE  '\\'");
			if (startsWith){
				params.add(perfilusuario.getProvincia().getDescEs().toUpperCase()  +"%");
			}else{
				params.add("%"+perfilusuario.getProvincia().getDescEs().toUpperCase() +"%");
			}	
			where.append(" AND t5.DESC_ES IS NOT NULL");
        }
		if (perfilusuario!=null && perfilusuario.getProvincia() != null  && perfilusuario.getProvincia().getDescEu() != null ) {
			where.append(" AND UPPER(t5.DESC_EU) like ? ESCAPE  '\\'");
			if (startsWith){
				params.add(perfilusuario.getProvincia().getDescEu().toUpperCase()  +"%");
			}else{
				params.add("%"+perfilusuario.getProvincia().getDescEu().toUpperCase() +"%");
			}	
			where.append(" AND t5.DESC_EU IS NOT NULL");
        }
		if (perfilusuario!=null && perfilusuario.getProvincia() != null  && perfilusuario.getProvincia().getCss() != null ) {
			where.append(" AND UPPER(t5.CSS) like ? ESCAPE  '\\'");
			if (startsWith){
				params.add(perfilusuario.getProvincia().getCss().toUpperCase()  +"%");
			}else{
				params.add("%"+perfilusuario.getProvincia().getCss().toUpperCase() +"%");
			}	
			where.append(" AND t5.CSS IS NOT NULL");
        }
		if (perfilusuario  != null  && perfilusuario.getUserId() != null ) {
			where.append(" AND UPPER(t1.USER_ID) like ? ESCAPE  '\\'");
			if (startsWith){
				params.add(perfilusuario.getUserId().toUpperCase()  +"%");
			}else{
				params.add("%"+perfilusuario.getUserId().toUpperCase() +"%");
			}	
			where.append(" AND t1.USER_ID IS NOT NULL");
        }
		if (perfilusuario  != null  && perfilusuario.getPass() != null ) {
			where.append(" AND UPPER(t1.PASS) like ? ESCAPE  '\\'");
			if (startsWith){
				params.add(perfilusuario.getPass().toUpperCase()  +"%");
			}else{
				params.add("%"+perfilusuario.getPass().toUpperCase() +"%");
			}	
			where.append(" AND t1.PASS IS NOT NULL");
        }
		if (perfilusuario  != null  && perfilusuario.getActivo() != null ) {
			where.append(" AND UPPER(t1.ACTIVO) like ? ESCAPE  '\\'");
			if (startsWith){
				params.add(perfilusuario.getActivo().toUpperCase()  +"%");
			}else{
				params.add("%"+perfilusuario.getActivo().toUpperCase() +"%");
			}	
			where.append(" AND t1.ACTIVO IS NOT NULL");
        }
		if (perfilusuario  != null  && perfilusuario.getTipo() != null ) {
			where.append(" AND UPPER(t1.TIPO) like ? ESCAPE  '\\'");
			if (startsWith){
				params.add(perfilusuario.getTipo().toUpperCase()  +"%");
			}else{
				params.add("%"+perfilusuario.getTipo().toUpperCase() +"%");
			}	
			where.append(" AND t1.TIPO IS NOT NULL");
        }
		if (perfilusuario  != null  && perfilusuario.getFechaAlta() != null ) {
			where.append(" AND t1.FECHA_ALTA like ? ESCAPE  '\\'");
			if (startsWith){
				params.add(perfilusuario.getFechaAlta()  +"%");
			}else{
				params.add("%"+perfilusuario.getFechaAlta() +"%");
			}	
			where.append(" AND t1.FECHA_ALTA IS NOT NULL");
        }
		if (perfilusuario  != null  && perfilusuario.getFechaBaja() != null ) {
			where.append(" AND t1.FECHA_BAJA like ? ESCAPE  '\\'");
			if (startsWith){
				params.add(perfilusuario.getFechaBaja()  +"%");
			}else{
				params.add("%"+perfilusuario.getFechaBaja() +"%");
			}	
			where.append(" AND t1.FECHA_BAJA IS NOT NULL");
        }
		if (perfilusuario  != null  && perfilusuario.getHoraEntrada() != null ) {
			where.append(" AND t1.HORA_ENTRADA like ? ESCAPE  '\\'");
			if (startsWith){
				params.add(perfilusuario.getHoraEntrada()  +"%");
			}else{
				params.add("%"+perfilusuario.getHoraEntrada() +"%");
			}	
			where.append(" AND t1.HORA_ENTRADA IS NOT NULL");
        }
        query.append(where);

		StringBuffer order = new StringBuffer(3000);
		if (pagination != null) {
			if (pagination.getSort() != null) {
				order.append(" ORDER BY " + pagination.getSort() + " " + pagination.getAscDsc());
				query.append(order);
			}
			query = new StringBuffer(PaginationManager.getQueryLimits(pagination,query.toString()));
		}
		return (List<PerfilUsuario>) this.jdbcTemplate.query(query.toString(),rwMap, params.toArray());
	}
}

