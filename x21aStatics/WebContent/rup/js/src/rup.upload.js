/*! For license information please see rup.upload.js.LICENSE.txt */
!function(e){"function"==typeof define&&define.amd?define(["jquery","./rup.base","./core/utils/jquery.iframe-transport","blueimp-file-upload/js/jquery.fileupload-ui.js"],e):e(jQuery)}((function(e){e.widget("blueimp.fileupload",e.blueimp.fileupload,{options:{errorMessages:{maxFileSize:e.rup.i18nParse(e.rup.i18n.base,"rup_upload.maxFileSizeError"),minFileSize:e.rup.i18nParse(e.rup.i18n.base,"rup_upload.minFileSizeError"),acceptFileTypes:e.rup.i18nParse(e.rup.i18n.base,"rup_upload.acceptFileTypesError"),maxNumberOfFiles:e.rup.i18nParse(e.rup.i18n.base,"rup_upload.maxNumberOfFilesError")},getFilesFromResponse:function(t){return t.result&&Array.isArray(t.result)?t.result.map((function(t){return e.extend(t,{deleteType:t.delete_type,deleteUrl:t.delete_url})})):[]}},_renderUploadTemplate:function(t){var i=this,a=e(),r=e.data(this.element[0],"settings");return e.each(t,(function(t,n){var l=e('<tr class="template-upload"><td><div class="formulario_columna_cnt"><span class="izq_float file_icon">&nbsp;</span><div class="izq_float name"><b></b></div><div class="formulario_columna_cnt"><div class="izq_float type"></div><div class="izq_float size"></div>'+(r.submitInForm?'<div class="izq_float cancel" style><button>'+e.rup.i18nParse(e.rup.i18n.base,"rup_upload.cancelUpload")+"</button></div>":"")+"</div>"+(r.submitInForm?'<div class="izq_float start fileupload-buttonbar ui-button" style="display:none"><button>'+e.rup.i18nParse(e.rup.i18n.base,"rup_upload.startUpload")+"</button></div>":'<div class="formulario_columna_cnt">'+(n.error?'<div class="izq_float error" ></div>':'<button><div class="izq_float progress"><div></div></div><div class="izq_float start fileupload-buttonbar ui-button">'+e.rup.i18nParse(e.rup.i18n.base,"rup_upload.startUpload")+"</button></div>")+'<div class="izq_float cancel"><button>'+e.rup.i18nParse(e.rup.i18n.base,"rup_upload.cancelUpload")+"</button></div></div>")+"</td></tr>");l.find(".name b").text(n.name),l.find(".size").text(n.sizef),l.find(".type").text(n.type),n.error&&(l.addClass("ui-state-error"),l.find(".error").text(i.options.errorMessages[n.error]||n.error)),a=a.add(l)})),a},_renderDownloadTemplate:function(t){var i=this,a=e();return e.each(t,(function(t,r){var n=e('<tr class="template-download"><td>'+(r.error?'<td class="file_icon"></td><td class="name"></td><td class="size"></td><td class="error" colspan="2"></td>':'<div class="formulario_columna_cnt"><span class="izq_float file_icon">&nbsp;</span><div class="izq_float name"><a></a></div></div><div class="formulario_columna_cnt"><div class="izq_float type"></div><div class="izq_float size"></div></div><div class="formulario_columna_cnt"><a><div class="izq_float"><div class="file_download" ><span class="file_download_icon">&nbsp;</span><span class="file_download_text">'+e.rup.i18nParse(e.rup.i18n.base,"rup_upload.openUploaded")+'</span></div></div></a><div class="izq_float delete"><button>'+e.rup.i18nParse(e.rup.i18n.base,"rup_upload.deleteUploaded")+"</button></div></div>")+"</td></tr>");n.find(".size").text(r.sizef),n.find(".type").text(r.type),r.error?(n.find(".name").text(r.name),n.addClass("ui-state-error"),n.find(".error").text(i.options.errorMessages[r.error]||r.error)):(n.find(".name a").text(r.name),r.thumbnail_url&&(n.find(".preview").append("<a><img></a>").find("img").prop("src",r.thumbnail_url),n.find("a").prop("target","_blank")),n.find("a").prop("href",e.rup_utils.setNoPortalParam(r.url)),n.find(".delete button").attr("data-type",r.delete_type).attr("data-url",e.rup_utils.setNoPortalParam(r.delete_url))),a=a.add(n)})),a},_initFileUploadButtonBar:function(){var t=this.element.find(".fileupload-buttonbar"),i=this.element.find(".files"),a=this.options.namespace;t.find(".start button").button({icons:{primary:"ui-icon-circle-arrow-e"}}).on("click."+a,(function(e){e.preventDefault(),i.find(".start button").click()})),t.find(".cancel").button({icons:{primary:"ui-icon-cancel"}}).on("click."+a,(function(e){e.preventDefault(),i.find(".cancel button").click()})),t.find(".delete").button({icons:{primary:"ui-icon-trash"}}).on("click."+a,(function(e){e.preventDefault(),i.find(".delete button").click()})),t.find(".toggle").on("change."+a,(function(){i.find(".delete input").prop("checked",e(this).is(":checked"))}))},_getAJAXSettings:function(t){var i=e.extend({},this.options,t);return this._initFormSettings(i),this._initDataSettings(i),i}}),e.extend(e.rup.iniRup,e.rup.rupSelectorObjectConstructor("rup_upload",{})),e.fn.rup_upload("extend",{option:function(t){e(this).fileupload("option",t)},destroy:function(){e(this).fileupload("destroy")},enable:function(){e(this).fileupload("enable")},disable:function(){e(this).fileupload("disable")},add:function(t){e(this).fileupload("add",t)},send:function(t){e(this).fileupload("send",t)}}),e.fn.rup_upload("extend",{_init:function(t){var i=e.extend({},e.fn.rup_upload.defaults,t[0]);if(this._ADAPTER=e.rup.adapter[i.adapter],i.self=this,null!==i.pif){var a=jQuery.extend(!0,e.fn.rup_upload.pif.defaults,i.pif);if(!0!==a.userFolder&&void 0===a.folderPath)return e.rup.errorGestor(e.rup.i18nParse(e.rup.i18n.base,"rup_upload.pifError")),-1;jQuery.extend(!0,i,{formData:{base_url:i.url,hadoop_folder_path:a.folderPath,hadoop_preserve_name:a.preserveName,y31_ttl:a.fileTtl,securityToken:a.securityToken}})}e.data(this[0],"settings",i),e(this).fileupload(i),i.submitInForm&&e(this).rup_upload("option",{singleFileUploads:!1,maxNumberOfFiles:1,replaceFileInput:!1}),e(this).on({fileuploadadd:function(){i.submitInForm&&(e(this).find(".template-upload").hide(),e(this).find(".template-upload .cancel button").off("click"),e(this).find(".template-upload .cancel button").click())},fileuploadsend:function(t,a){a.url=e.rup_utils.setNoPortalParam(a.url),e.rup.browser.xhrFileUploadSupport&&!0!==i.forceIframeTransport||(a.url=a.url+(null===a.url.match("\\?")?"?":"&")+"_emulate_iframe_http_status=true")},fileuploadprocessfail:function(e,t){t.context.addClass("error")}})},_private:function(){}}),e.fn.rup_upload.defaults={adapter:"upload_bootstrap",submitInForm:!1,submitFormButton:void 0,pif:null,uploadTemplateId:!1,downloadTemplateId:!1,uploadTemplate:function(e){return e.options.self._ADAPTER.uploadTemplate.bind(this)(e)},downloadTemplate:function(e){return e.options.self._ADAPTER.downloadTemplate.bind(this)(e)},replaceFileInput:!1},e.fn.rup_upload.pif={},e.fn.rup_upload.pif.defaults={fileTtl:129600,preserveName:!1,_JANO_PUT_SERVLET:"/y31ApiJSWAR/Y31JanoServicePutServlet",securityToken:"app"}}));