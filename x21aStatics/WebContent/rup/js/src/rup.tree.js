/*! For license information please see rup.tree.js.LICENSE.txt */
!function(e){"function"==typeof define&&define.amd?define(["jquery","./rup.base","jstree"],e):e(jQuery)}((function(e){jQuery.extend(e.rup.iniRup,e.rup.rupSelectorObjectConstructor("rup_tree",{})),jQuery.fn.rup_tree("extend",{getRupValue:function(){var e,t=this,r=t.data("settings"),n=void 0!==t.attr("name")?t.attr("name"):t.data("name");e=-1!==jQuery.inArray("checkbox",r.plugins)?t.rup_tree("getChecked",!1):t.rup_tree("getSelected",!1);var s=jQuery.map(e,(function(e){const n=jQuery("#"+e);return"function"==typeof r.core.getValue?r.core.getValue.bind(t)(n,n.data()):e||n.text()}));return r.core.submitAsJSON?jQuery.rup_utils.getRupValueAsJson(n,s):r.core.submitAsString?jQuery.rup_utils.getRupValueWrapped(n,s.toString()):jQuery.rup_utils.getRupValueWrapped(n,s)},setRupValue:function(t){var r,n,s,i,o,c=this,u=c.data("settings");if(jQuery.inArray("checkbox",u.plugins)>=0)c.rup_tree("uncheckAll"),r=c.jstree().get_container_ul().find("li"),o=!0===u.core.readAsString?t.split(","):t,jQuery.each(r,(function(e,t){n=jQuery(t),"function"==typeof u.core.getValue?s=u.core.getValue.bind(c)(n,n.data()):(i=n.attr("id"),s=i||n.text()),-1!==jQuery.inArray(s,o)&&c.rup_tree("checkNode",t)}));else if(Array.isArray(t))c.rup_tree("selectNode",t);else{if("string"!=typeof t)throw Error("Invalid Args (setRupValue)");1===e("li#"+t,c).length&&e("li#"+t+" > a",c).click()}e("input[name='"+c.data("name")+"']",c.parents("form")).val(c.rup_tree("getSelected"))},setFocus:function(){e(this).focus()},unsetFocus:function(){e(this).blur()},isFocused:function(){return e(this).is(":focus")},destroy:function(t){e(this).jstree("destroy",t)},createPrototypeNode:function(){return e(this).jstree("_create_prototype_node")},getContainer:function(){return e(this).jstree("get_container")},getNode:function(t,r){return e(this).jstree("get_node",t,r)},getPath:function(t,r,n){return e(this).jstree("get_path",t,r,n)},getNextDom:function(t,r){return e(this).jstree("get_next_dom",t,r)},getPrevDom:function(t,r){return e(this).jstree("get_prev_dom",t,r)},getParent:function(t){return e(this).jstree("get_parent",t)},getChildrenDom:function(t){return e(this).jstree("get_children_dom",t)},isParent:function(t){return e(this).jstree("is_parent",t)},isLoaded:function(t){return e(this).jstree("is_loaded",t)},isLoading:function(t){return e(this).jstree("is_loading",t)},isOpen:function(t){return e(this).jstree("is_open",t)},isClosed:function(t){return e(this).jstree("is_closed",t)},isLeaf:function(t){return e(this).jstree("is_leaf",t)},loadNode:function(t,r){return e(this).jstree("load_node",t,r)},loadAll:function(t,r){e(this).jstree("load_all",t,r)},redraw:function(t){e(this).jstree("redraw",t)},openNode:function(t,r,n){e(this).jstree("open_node",t,r,n)},closeNode:function(t,r){e(this).jstree("close_node",t,r)},toggleNode:function(t){e(this).jstree("toggle_node",t)},openAll:function(t,r,n){e(this).jstree("open_all",t,r,n)},closeAll:function(t,r){e(this).jstree("close_all",t,r)},isDisabled:function(t){return e(this).jstree("is_disabled",t)},enableNode:function(t){e(this).jstree("enable_node",t)},disableNode:function(t){e(this).jstree("disable_node",t)},isHidden:function(t){return e(this).jstree("is_hidden",t)},hideNode:function(t,r){e(this).jstree("hide_node",t,r)},showNode:function(t,r){e(this).jstree("show_node",t,r)},hideAll:function(){e(this).jstree("hide_all")},showAll:function(){e(this).jstree("show_all")},selectNode:function(t,r,n){e(this).jstree("select_node",t,r,n)},deselectNode:function(t,r){e(this).jstree("deselect_node",t,r)},selectAll:function(t){e(this).jstree("select_all",t)},deselectAll:function(t){e(this).jstree("deselect_all",t)},isSelected:function(t){return e(this).jstree("is_selected",t)},getSelected:function(t){return e(this).jstree("get_selected",t)},getTopSelected:function(t){return e(this).jstree("get_top_selected",t)},getBottomSelected:function(t){return e(this).jstree("get_bottom_selected",t)},refresh:function(t,r){e(this).jstree("refresh",t,r)},refreshNode:function(t){e(this).jstree("refresh_node",t)},setId:function(t,r){return e(this).jstree("set_id",t,r)},getText:function(t){return e(this).jstree("get_text",t)},getJson:function(t,r){return e(this).jstree("get_json",t,r)},createNode:function(t,r,n,s,i){return e(this).jstree("create_node",t,r,n,s,i)},renameNode:function(t,r){return e(this).jstree("rename_node",t,r)},deleteNode:function(t){return e(this).jstree("delete_node",t)},lastError:function(){return e(this).jstree("last_error")},moveNode:function(t,r,n,s,i,o,c){e(this).jstree("move_node",t,r,n,s,i,o,c)},copyNode:function(t,r,n,s,i,o,c){e(this).jstree("copy_node",t,r,n,s,i,o,c)},cut:function(t){e(this).jstree("cut",t)},copy:function(t){e(this).jstree("copy",t)},getBuffer:function(){return e(this).jstree("get_buffer")},canPaste:function(){return e(this).jstree("can_paste")},paste:function(t,r){e(this).jstree("paste",t,r)},clearBuffer:function(){e(this).jstree("clear_buffer")},edit:function(t,r,n){e(this).jstree("edit",t,r,n)},setTheme:function(t,r){e(this).jstree("set_theme",t,r)},getTheme:function(){return e(this).jstree("get_theme")},setThemeVariant:function(t){e(this).jstree("set_theme_variant",t)},getThemeVariant:function(){return e(this).jstree("get_theme_variant")},showStripes:function(){e(this).jstree("show_stripes")},hideStripes:function(){e(this).jstree("hide_stripes")},toggleStripes:function(){e(this).jstree("toggle_stripes")},showDots:function(){e(this).jstree("show_dots")},hideDots:function(){e(this).jstree("hide_dots")},toggleDots:function(){e(this).jstree("toggle_dots")},showIcons:function(){e(this).jstree("show_icons")},hideIcons:function(){e(this).jstree("hide_icons")},toggleIcons:function(){e(this).jstree("toggle_icons")},showEllipsis:function(){e(this).jstree("show_ellipsis")},hideEllipsis:function(){e(this).jstree("hide_ellipsis")},toggleEllipsis:function(){e(this).jstree("toggle_ellipsis")},setIcon:function(t,r){e(this).jstree("set_icon",t,r)},getIcon:function(t){return e(this).jstree("get_icon",t)},hideIcon:function(t){e(this).jstree("hide_icon",t)},showIcon:function(t){e(this).jstree("show_icon",t)},getUndetermined:function(t){return e(this).jstree("get_undetermined",t)},showCheckboxes:function(){e(this).jstree("show_checkboxes")},hideCheckboxes:function(){e(this).jstree("hide_checkboxes")},toggleCheckboxes:function(){e(this).jstree("toggle_checkboxes")},isUndetermined:function(t){return e(this).jstree("is_undetermined",t)},disableCheckbox:function(t){e(this).jstree("disable_checkbox",t)},enableCheckbox:function(t){e(this).jstree("enable_checkbox",t)},getCheckedDescendants:function(t){return e(this).jstree("get_checked_descendants",t)},checkNode:function(t){e(this).jstree("check_node",t)},uncheckNode:function(t){e(this).jstree("uncheck_node",t)},checkAll:function(){e(this).jstree("check_all")},uncheckAll:function(){e(this).jstree("uncheck_all")},isChecked:function(t){return e(this).jstree("is_checked",t)},getChecked:function(t){return e(this).jstree("get_checked",t)},getTopChecked:function(t){return e(this).jstree("get_top_checked",t)},getBottomChecked:function(t){return e(this).jstree("get_bottom_checked",t)},showContextmenu:function(t,r,n){e(this).jstree("show_contextmenu",t,r,n)},search:function(t,r,n,s,i){e(this).jstree("search",t,r,n,s,i)},clearSearch:function(){e(this).jstree("clear_search")},saveState:function(){e(this).jstree("save_state")},restoreState:function(){e(this).jstree("restore_state")},clearState:function(){e(this).jstree("clear_state")},getRules:function(t){return e(this).jstree("get_rules",t)},getType:function(t,r){return e(this).jstree("get_type",t,r)},setType:function(t,r){e(this).jstree("set_type",t,r)}}),jQuery.fn.rup_tree("extend",{_init:function(t){global.initRupI18nPromise.then((()=>{if(t.length>1)jQuery.rup.errorGestor(jQuery.rup.i18n.base.rup_global.initError+jQuery(this).attr("id"));else{t.length>0&&void 0!==t[0]&&(t[0].select&&(t[0].ui=t[0].select,delete t[0].select),t[0].jQueryUIStyles&&(t[0].themeroller=t[0].jQueryUIStyles,delete t[0].jQueryUIStyles));var r=jQuery.extend(!0,{},jQuery.fn.rup_tree.defaults,t[0]),n=this;r.$self=e(this),r.$self.attr("ruptype","tree"),e(this).data("settings",r),n.addClass("rup_tree"),n.data("settings",r),n.jstree(r),n.on("ready.jstree",(function(){e(this).parents("form")&&e('<input type="hidden" name="'+e(this).data("name")+'" data-tree-id="'+this.id+'"></input>').insertAfter(e(this)),e(this).removeClass("rup_tree")}))}})).catch((e=>{console.error("Error al inicializar el componente:\n",e)}))}}),jQuery.fn.rup_tree.defaults={plugins:[],core:{data:!1,strings:!1,check_callback:!0,animation:200,multiple:!1,themes:{name:!1,url:!1,dir:!1,dots:!1,icons:!0,ellipsis:!1,stripes:!1,variant:"default",responsive:!0},expand_selected_onload:!1,worker:!1,force_text:!1,dblclick_toggle:!0,loaded_state:!1,restore_focus:!0,compute_elements_positions:!1},checkbox:{visible:!0,three_state:!0,whole_node:!0,keep_selected_style:!0,cascade:"",tie_selection:!0,cascade_to_disabled:!0,cascade_to_hidden:!0},conditionalselect:!0,contextmenu:{select_node:!0,show_at_node:!0,items:function(t,r){return{create:{separator_before:!1,separator_after:!0,_disabled:!1,label:e.rup.i18nParse(e.rup.i18n.base,"rup_tree.create"),action:function(t){var r=e.jstree.reference(t.reference),n=r.get_node(t.reference);r.create_node(n,{},"last",(function(e){try{r.edit(e)}catch(t){setTimeout((function(){r.edit(e)}),0)}}))}},rename:{separator_before:!1,separator_after:!1,_disabled:!1,label:e.rup.i18nParse(e.rup.i18n.base,"rup_tree.rename"),action:function(t){var r=e.jstree.reference(t.reference),n=r.get_node(t.reference);r.edit(n)}},remove:{separator_before:!1,icon:!1,separator_after:!1,_disabled:!1,label:e.rup.i18nParse(e.rup.i18n.base,"rup_tree.remove"),action:function(t){var r=e.jstree.reference(t.reference),n=r.get_node(t.reference);r.is_selected(n)?r.delete_node(r.get_selected()):r.delete_node(n)}},ccp:{separator_before:!0,icon:!1,separator_after:!1,label:e.rup.i18nParse(e.rup.i18n.base,"rup_tree.ccp.label"),action:!1,submenu:{cut:{separator_before:!1,separator_after:!1,label:e.rup.i18nParse(e.rup.i18n.base,"rup_tree.ccp.cut"),action:function(t){var r=e.jstree.reference(t.reference),n=r.get_node(t.reference);r.is_selected(n)?r.cut(r.get_top_selected()):r.cut(n)}},copy:{separator_before:!1,icon:!1,separator_after:!1,label:e.rup.i18nParse(e.rup.i18n.base,"rup_tree.ccp.copy"),action:function(t){var r=e.jstree.reference(t.reference),n=r.get_node(t.reference);r.is_selected(n)?r.copy(r.get_top_selected()):r.copy(n)}},paste:{separator_before:!1,icon:!1,_disabled:function(t){return!e.jstree.reference(t.reference).can_paste()},separator_after:!1,label:e.rup.i18nParse(e.rup.i18n.base,"rup_tree.ccp.paste"),action:function(t){var r=e.jstree.reference(t.reference),n=r.get_node(t.reference);r.paste(n)}}}}}}},dnd:{copy:!0,open_timeout:500,is_draggable:!0,check_while_dragging:!0,always_copy:!1,inside_pos:0,drag_selection:!0,touch:!0,large_drop_target:!1,large_drag_target:!1,use_html5:!0},search:{ajax:!1,fuzzy:!1,case_sensitive:!1,show_only_matches:!1,show_only_matches_children:!1,close_opened_onclear:!0,search_leaves_only:!1,search_callback:!1},state:{key:"jstree",events:"changed.jstree open_node.jstree close_node.jstree check_node.jstree uncheck_node.jstree",ttl:!1,filter:!1,preserve_loaded:!1},unique:{case_sensitive:!1,trim_whitespace:!1}}}));