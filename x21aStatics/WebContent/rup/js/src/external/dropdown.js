import Util from"./util";const Dropdown=(e=>{const t="dropdown",r="bs.dropdown",n=`.${r}`,i=".data-api",a=e.fn[t],o={HIDE:`hide${n}`,HIDDEN:`hidden${n}`,SHOW:`show${n}`,SHOWN:`shown${n}`,CLICK:`click${n}`,CLICK_DATA_API:`click${n}${i}`,KEYDOWN_DATA_API:`keydown${n}${i}`},s="disabled",l="open",d='[data-toggle="dropdown"]';class h{constructor(e){this._element=e,this._addEventListeners()}static get VERSION(){return"4.0.0-alpha.5"}toggle(){if(this.disabled||e(this).hasClass(s))return!1;let t=h._getParentFromElement(this),r=e(t).hasClass(l);if(h._clearMenus(),r)return!1;if("ontouchstart"in document.documentElement&&!e(t).closest(".navbar-nav").length){let t=document.createElement("div");t.className="dropdown-backdrop",e(t).insertBefore(this),e(t).on("click",h._clearMenus)}let n={relatedTarget:this},i=e.Event(o.SHOW,n);return e(t).trigger(i),i.isDefaultPrevented()||(this.focus(),this.setAttribute("aria-expanded","true"),e(t).toggleClass(l),e(t).trigger(e.Event(o.SHOWN,n)),e(t).trigger("toggleEnd")),!1}dispose(){e.removeData(this._element,r),e(this._element).off(n),this._element=null}_addEventListeners(){e(this._element).on(o.CLICK,this.toggle)}static _jQueryInterface(t){return this.each((function(){let n=e(this).data(r);if(n||e(this).data(r,n=new h(this)),"string"==typeof t){if(void 0===n[t])throw new Error(`No method named "${t}"`);n[t].call(this)}}))}static _clearMenus(t){if(t&&3===t.which)return;let r=e(".dropdown-backdrop")[0];r&&r.parentNode.removeChild(r);let n=e.makeArray(e(d));for(let r=0;r<n.length;r++){let i=h._getParentFromElement(n[r]),a={relatedTarget:n[r]};if(!e(i).hasClass(l))continue;if(t&&"click"===t.type&&/input|textarea/i.test(t.target.tagName)&&e.contains(i,t.target))continue;let s=e.Event(o.HIDE,a);e(i).trigger(s),s.isDefaultPrevented()||(n[r].setAttribute("aria-expanded","false"),e(i).removeClass(l).trigger(e.Event(o.HIDDEN,a)).trigger("toggleEnd"))}}static _getParentFromElement(t){let r,n=Util.getSelectorFromElement(t);return n&&(r=e(n)[0]),r||t.parentNode}static _dataApiKeydownHandler(t){if(!/(38|40|27|32)/.test(t.which)||/input|textarea/i.test(t.target.tagName))return;if(t.preventDefault(),t.stopPropagation(),this.disabled||e(this).hasClass(s))return;let r=h._getParentFromElement(this),n=e(r).hasClass(l);if(!n&&27!==t.which||n&&27===t.which){if(27===t.which){let t=e(r).find(d)[0];e(t).trigger("focus")}return void e(this).trigger("click")}let i=e.makeArray(e('[role="menu"] li:not(.disabled) a, [role="listbox"] li:not(.disabled) a'));if(i=i.filter((e=>e.offsetWidth||e.offsetHeight)),!i.length)return;let a=i.indexOf(t.target);38===t.which&&a>0&&a--,40===t.which&&a<i.length-1&&a++,a<0&&(a=0),i[a].focus()}}return e(document).on(o.KEYDOWN_DATA_API,d,h._dataApiKeydownHandler).on(o.KEYDOWN_DATA_API,'[role="menu"]',h._dataApiKeydownHandler).on(o.KEYDOWN_DATA_API,'[role="listbox"]',h._dataApiKeydownHandler).on(o.CLICK_DATA_API,h._clearMenus).on(o.CLICK_DATA_API,d,h.prototype.toggle).on(o.CLICK_DATA_API,".dropdown form",(e=>{e.stopPropagation()})),e.fn[t]=h._jQueryInterface,e.fn[t].Constructor=h,e.fn[t].noConflict=function(){return e.fn[t]=a,h._jQueryInterface},h})(jQuery);export default Dropdown;