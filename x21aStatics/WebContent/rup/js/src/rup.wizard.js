/*! For license information please see rup.wizard.js.LICENSE.txt */
!function(e){"function"==typeof define&&define.amd?define(["jquery","./rup.base"],e):e(jQuery)}((function(e){e.extend(e.rup.iniRup,e.rup.rupSelectorObjectConstructor("rup_wizard",{})),e.fn.rup_wizard("extend",{step:function(t){if(e("#stepDesc"+t).hasClass("disabled"))return!1;var r=e("#steps li.current").attr("id");e("#steps li").removeClass("current"),e("#stepDesc"+t).addClass("current"),e("#steps li").removeClass("visited"),0!=t&&e("#stepDesc"+(t-1)).addClass("visited"),e("#step"+r.substring(8)).hide(),e("#step"+t).show(),this.rup_wizard("isCurrentStepLast")?(e(".rup-wizard_submitButton").show(),this.rup_wizard("isCurrentStepSummary")||e("#step"+t).find("p[id$='commands']").append(e(".rup-wizard_submitButton"))):e(".rup-wizard_submitButton").hide()},first:function(){this.rup_wizard("step",0)},last:function(){this.rup_wizard("step",e("#steps").children().length-1)},getCurrentStep:function(){return parseInt(e("#steps li.current").attr("id").substring(8))},isCurrentStep:function(e){return this.rup_wizard("getCurrentStep")===e},isCurrentStepFirst:function(){return this.rup_wizard("isCurrentStep",0)},isCurrentStepLast:function(){return e("#steps").children().length-1===this.rup_wizard("getCurrentStep")},isCurrentStepSummary:function(){return e("#stepDesc"+this.rup_wizard("getCurrentStep")).hasClass("rup-wizard_summary")},enableStep:function(t){e("#stepDesc"+t).removeClass("disabled")},disableStep:function(t){e("#stepDesc"+t).addClass("disabled")},isStepDisabled:function(t){return e("#stepDesc"+t).hasClass("disabled")}}),e.fn.rup_wizard("extend",{_init:function(t){if(t.length>1)e.rup.errorGestor(e.rup.i18nParse(e.rup.i18n.base,"rup_global.initError")+e(this).attr("id"));else{var r=e.extend({},e.fn.rup_wizard.defaults,t[0]),s=this;if(this.addClass("rup-wizard"),this._formToWizard(r),e("#steps").addClass("rup-wizard_stepsDescContainer"),e("#steps").children().each((function(t,i){e(i).addClass("rup-wizard_stepDesc").click((function(t){var i=e(this).attr("id").substring(8);if(!s.isStepDisabled(i)){if(void 0!==r.stepFnc[i]&&!1===r.stepFnc[i].call())return t.stopImmediatePropagation(),!1;e(this).rup_wizard("step",i)}}));var a=e(i).children();e(a).text(t+1+". "+e(a).text()),e(i).text("").append(a)})),e("p[id$='commands'] .prev").removeClass("prev").addClass("rup-wizard_prev").text(e.rup.i18nParse(e.rup.i18n.base,"rup_wizard.prev")).off("click").click((function(e){s._gotoPrevStep(s,r,e)})),e("p[id$='commands'] .next").removeClass("next").addClass("rup-wizard_next").text(e.rup.i18nParse(e.rup.i18n.base,"rup_wizard.next")).off("click").click((function(e){s._gotoNextStep(s,r,e)})),e("#"+e.escapeSelector(r.submitButton)).addClass("rup-wizard_submitButton"),r.submitFnc&&e("#"+e.escapeSelector(r.submitButton)).click(r.submitFnc),e("#steps li").first().addClass("rup-wizard_firstStepDesc"),e("#steps li").last().addClass("rup-wizard_lastStepDesc"),r.summary){e("#steps li").last().removeClass("rup-wizard_lastStepDesc");var i=e("#steps").children().length,a=e("<li>").attr("id","stepDesc"+i).addClass("rup-wizard_stepDesc rup-wizard_summary rup-wizard_lastStepDesc").append("<a>"+(i+1)+". "+e.rup.i18nParse(e.rup.i18n.base,"rup_wizard.summary")+"</a>").click((function(t){e(this).rup_wizard("step",e(this).attr("id").substring(8)),s._generateSummary(i,s,r),t.preventDefault()}));if(e("#steps").append(a),i>1){e("div[id='step"+(i-1)+"']").after("<div id='step"+i+"' style='display: none;'></div>");var n=e("<a>").attr("id","step"+(i-1)+"Next").html(e.rup.i18nParse(e.rup.i18n.base,"rup_wizard.next")).addClass("rup-wizard_next").off("click").click((function(e){s._gotoNextStep(s,r,e),s._generateSummary(i,s,r),e.preventDefault()}));e("#step"+(i-1)+"commands").append(n)}}void 0!==r.disabled&&e.each(r.disabled,(function(t,r){if("number"==typeof r)e(this).rup_wizard("disableStep",r);else if("string"==typeof r)for(var s=parseInt(r.substring(0,r.indexOf("-"))),i=parseInt(r.substring(r.indexOf("-")+1,r.length)),a=s;a<=i;a++)e(this).rup_wizard("disableStep",a)}))}this.rup_wizard("step",0)},_gotoNextStep:function(t,r,s){var i=parseInt(e("#steps li.current").attr("id").substring(8))+1;if(t.isStepDisabled(i)){if(void 0===(i=e("#stepDesc"+(i-1)).nextAll("li:not(.disabled)").first().attr("id")))return!1;i=parseInt(i.substring(8)),jQuery("#steps").children().length-1===i&&t._generateSummary(i,t,r)}if(void 0!==r.stepFnc[i]&&e("#stepDesc"+i).not(".rup-wizard_summary").length>0&&!1===r.stepFnc[i].call())return s.stopImmediatePropagation(),!1;e("#stepDesc"+i).rup_wizard("step",i)},_gotoPrevStep:function(t,r,s){var i=parseInt(e("#steps li.current").attr("id").substring(8))-1;if(t.isStepDisabled(i)){if(void 0===(i=e("#stepDesc"+(i+1)).prevAll("li:not(.disabled)").first().attr("id")))return!1;i=parseInt(i.substring(8))}if(void 0!==r.stepFnc[i]&&!1===r.stepFnc[i].call())return s.stopImmediatePropagation(),!1;e("#stepDesc"+i).rup_wizard("step",i)},_generateSummary:function(t,r,s){if(e("#stepDesc"+t).hasClass("disabled"))return!1;if(e("#step"+t).parent().append(e(".rup-wizard_submitButton")),s.summaryFnc_PRE&&!1===s.summaryFnc_PRE.call())return!1;e("#step"+t).remove(),e("div[id='step"+(t-1)+"']").after("<div id='step"+t+"' style='display: none;'></div>");for(var i=0;i<t;i++)r.isStepDisabled(i)||e("#step"+t).append(e("#step"+i).children().clone());e("#step"+t+" p[id$='commands']").remove(),e("div[id='step"+t+"'] fieldset").last().append("<p id='step"+t+"commands'></p>");var a=e("<a>").attr("id","step"+t+"Prev").html(e.rup.i18nParse(e.rup.i18n.base,"rup_wizard.prev")).addClass("rup-wizard_prev").off("click").click((function(e){r._gotoPrevStep(r,s,e)}));if(e("#step"+t+"commands").append(a),s.summaryFnc_INTER&&!1===s.summaryFnc_INTER.call())return!1;e("#step"+t+" .ui-multiselect").each((function(){var t=e("#"+e.escapeSelector(e(this).prev().attr("id")));if(void 0!==t.data("settings")){var r=t.rup_select("label");if(r.length>0)if(null==t.data("settings").summaryInline)for(var i=e("<div></div>").addClass("rup-wizard_summaryMultivalue").insertAfter(this),a=0;a<r.length;a++)e(s.labelElement,{text:"- "+r[a],class:"rup-wizard_summaryValue"}).appendTo(i),e("<br/>").appendTo(i);else e(s.labelElement,{text:r.toString().replace(/,/g,", "),class:"rup-wizard_summaryValue"}).insertAfter(this);else e(s.labelElement,{html:"&nbsp;",class:"rup-wizard_summaryValue"}).insertAfter(this);e(this).prev().remove(),e(this).remove()}})),e("#step"+t+" input").each((function(){"text"===this.type?e(s.labelElement,{text:this.value,class:"rup-wizard_summaryValue"}).insertAfter(this):"password"===this.type?e(s.labelElement,{text:r._hidePassword(this.value),class:"rup-wizard_summaryValue"}).insertAfter(this):"radio"===this.type?(this.checked&&(e(s.labelElement,{text:e("#step"+t+" label[for='"+this.id+"']").text(),class:"rup-wizard_summaryValue"}).insertAfter(this),e("#"+e.escapeSelector(this.id)).attr("checked","checked")),e("#step"+t+" label[for='"+this.id+"']").remove()):"checkbox"===this.type&&(this.checked?e(s.labelElement,{text:"[X] "+e("#step"+t+" label[for='"+this.id+"']").text(),class:"rup-wizard_summaryValue"}).insertAfter(this):e(s.labelElement,{text:"[ ] "+e("#step"+t+" label[for='"+this.id+"']").text(),class:"rup-wizard_summaryValue"}).insertAfter(this),e("#step"+t+" label[for='"+this.id+"']").remove()),e(this).remove()})),e("#step"+t+" textarea").each((function(){e(s.textareaElement,{text:e("#"+e.escapeSelector(e(this).attr("id"))).val(),class:"rup-wizard_summaryParagraph"}).insertAfter(this),e(this).remove()})),e("#step"+t+" select:not('.ui-pg-selbox')").each((function(){e(s.labelElement,{text:"&nbsp;"!==e("#"+e.escapeSelector(this.id)+" option:selected").text()?e("#"+e.escapeSelector(this.id)+" option:selected").text():"",class:"rup-wizard_summaryValue"}).insertAfter(this),e(this).remove()})),e("#step"+t+" label").each((function(){e(s.labelSeparatorElement,{html:s.labelSeparatorText,class:"rup-wizard_separator"}).insertAfter(this),e(s.labelElement,{text:this.innerHTML,class:"rup-wizard_summaryLabel"}).insertAfter(this),e(this).remove()})),e("#step"+t+" .ui-accordion").each((function(){e(this).attr("id",e(this).attr("id")+"_summary"),e(this).removeAttr("class"),e(this).children("h1").removeAttr("class"),e(this).children("h1").children("span.ui-icon").first().remove(),e(this).children("div").removeAttr("class"),e.isEmptyObject(s.rupAccordion)?e(this).rup_accordion(s.accordion):e(this).rup_accordion(s.rupAccordion)})),e("#step"+t+" .rup_select").each((function(){e(this).remove()})),e("#step"+t+" img.ui-datepicker-trigger").each((function(){e(this).remove()})),e("#step"+t+" img.ui-timepicker-trigger").each((function(){e(this).remove()}));var n=0;if(s.summaryTabs2Accordion&&(s.rupTabsElement="<a></a>"),e("#step"+t+" > fieldset").children(".rup-tabs_container").each((function(){var t=[],i=[],a=e(this).parent().attr("accordionable",!0),p=[];r._getRupTabs(r,e(this),t,i);for(var d=null,c=e(a),l=0;l<t.length;l++)if(d=e(s.rupTabsElement).text(t[l]),-1!==i[l].indexOf("rupRandomLayerId")){if(d=e(d).wrap("<div class='IE8_fix'>"),d=e(d).parent().append(e(this).find(i[l]).html()),e(d).children("div").addClass("rup-wizard_tabLevel-"+p.length),d=e(d).children().unwrap(),0===e("#"+e.escapeSelector(p[p.length-1])).find(i[l]).length){c=e(a);do{if(p.pop(),e("#"+e.escapeSelector(p[p.length-1])).find(i[l]).length>0){c=e("#subtab_"+p[p.length-1]);break}e(e(d).get(1)).removeAttr("class").addClass("rup-wizard_tabLevel-"+p.length)}while(p.length>0)}e(c).append(d)}else d=e(d).attr("tabContainer",!0),d=e(d).wrap("<div class='IE8_fix'>"),d=e(d).parent().append(e("<div>").attr("id","subtab_"+t[l]).attr("accordionable",!0).addClass("rup-wizard_tabContainerLevel-"+p.length)),d=e(d).children().unwrap(),p.push(t[l]),n++,e(c).append(d),c=e("#subtab_"+t[l]);s.summaryTabs2Accordion&&e(a).find("a").each((function(){e(this).hasClass("rup-wizard_prev")||e(this).hasClass("rup-wizard_next")||e(this).wrap("<h1>")})),e(this).remove()})),s.summaryWithAccordion&&(e("#step"+t).find("legend").each((function(t,r){e("<a></a>").text(r.innerHTML).insertBefore(e(r).parent()).wrap("<h1></h1>"),e(r).parent().replaceWith(e("<div></div>").attr("accordionable",void 0!==e(r).parent().attr("accordionable")).append(e(r).parent().children())),e(r).remove()})),e.isEmptyObject(s.summaryAccordion)?e("#step"+t).rup_accordion(s.accordion):e("#step"+t).rup_accordion(s.summaryAccordion),e("<fieldset></fieldset>").attr("id","commands_fieldset").addClass("commands-fieldset").append(e("#step"+t).find("p[id='step"+t+"commands']")).appendTo(e("#step"+t)),s.summaryWithAccordionSpaceBefore&&e("#step"+t).prepend("</br>"),s.summaryWithAccordionSpaceAfter&&e("#commands_fieldset").prepend("</br>")),s.summaryTabs2Accordion){for(let t=0;t<=n;t++)e(".rup-wizard_tabLevel-"+t).removeClass("rup-wizard_tabLevel-"+t),e(".rup-wizard_tabContainerLevel-"+t).removeClass("rup-wizard_tabContainerLevel-"+t);e("[accordionable=true]").each((function(r,i){if("FIELDSET"===i.nodeName){var a=e(i).find("legend")[0],n=e(i).find("p[id='step"+t+"commands']"),p=e("<div></div>").attr("accordionable",void 0!==e(i).attr("accordionable")).append(e(i).children());e(i).replaceWith(p),e(a).remove(),e(n).remove(),e.isEmptyObject(s.tabAccordion)?e(p).rup_accordion(s.accordion):e(p).rup_accordion(s.tabAccordion),e(p).prepend(a),e(p).append(e("<fieldset></fieldset>").append(n))}else e.isEmptyObject(s.tabAccordion)?e(i).rup_accordion(s.accordion):e(i).rup_accordion(s.tabAccordion)}))}e("[accordionable]").removeAttr("accordionable"),e("#step"+t).find("p[id$='commands']").append(e(".rup-wizard_submitButton")),e("#step"+t).show(),s.summaryFnc_POST&&s.summaryFnc_POST.call()},_getRupTabs:function(t,r,s,i){e(r).find(".rup-tabs_title").each((function(r,a){-1===e.inArray(a.innerHTML,s)&&(i.push(e(a).parent().attr("href")),s.push(a.innerHTML),i[i.length-1].substring(1)===s[s.length-1]&&t._getRupTabs(t,e("#"+e.escapeSelector(s[s.length-1])),s,i))}))},_hidePassword:function(e){for(var t="",r=0;r<e.length;r++)t+="*";return t},_formToWizard:function(t){t=e.extend({submitButton:""},t);var r=e(this).find("fieldset"),s=r.length,i="#"+t.submitButton;function a(t){var r=e.escapeSelector("step"+t);e("#"+r+"commands").append("<a id='"+r+"Prev' class='prev'>< Back</a>"),e("#"+r+"Prev").on("click",(function(s){e("#"+r).hide(),e("#step"+(t-1)).show(),e(i).hide(),p(t-1),s.preventDefault()}))}function n(t){var r=e.escapeSelector("step"+t);e("#"+r+"commands").append("<a id='"+r+"Next' class='next'>Next ></a>"),e("#"+r+"Next").on("click",(function(a){e("#"+r).hide(),e("#step"+(t+1)).show(),t+2==s&&e(i).show(),p(t+1),a.preventDefault()}))}function p(t){e("#steps li").removeClass("current"),e("#stepDesc"+t).addClass("current")}e(i).hide(),e(this).before("<ul id='steps'></ul>"),r.each((function(t){e(this).wrap("<div id='step"+t+"'></div>"),e(this).append("<p id='step"+t+"commands'></p>");var r=e(this).find("legend").html();e("#steps").append("<li id='stepDesc"+t+"'>Step "+(t+1)+"<a>"+r+"</a></li>"),0==t?(n(t),p(t)):t==s-1?(e("#step"+t).hide(),a(t)):(e("#step"+t).hide(),a(t),n(t))}))}}),e.fn.rup_wizard.defaults={summary:!0,summaryWithAccordion:!1,summaryWithAccordionSpaceBefore:!0,summaryWithAccordionSpaceAfter:!0,summaryTabs2Accordion:!1,stepFnc:{},accordion:{animated:"bounceslide",active:!1,autoHeight:!1,collapsible:!0,heightStyle:"content"},rupAccordion:{},summaryAccordion:{},tabAccordion:{},rupTabsElement:"<h4></h4>",labelElement:"<span></span>",labelSeparatorElement:"<span></span>",labelSeparatorText:"&nbsp;&nbsp;&nbsp;",textareaElement:"<p></p>"}}));