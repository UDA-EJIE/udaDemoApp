/*! For license information please see rup.table.js.LICENSE.txt */
!function(e){"function"==typeof define&&define.amd?define(["jquery","./rup.table.request","datatables.net","datatables.net-bs4","datatables.net-responsive","datatables.net-responsive-bs4","datatables.net-colreorder","datatables.net-colreorder-bs4","datatables.net-feature-inputpaging","./rup.table.multiSelect","./rup.table.seeker","./rup.table.inlineEdit","./rup.table.editForm","./rup.table.buttons","./rup.table.select","./rup.table.rowGroup","./rup.table.masterDetail","./rup.table.multiFilter","../core/utils/form2object"],e):e(jQuery)}((function(e,t){var i=e.fn.dataTable;e.extend(e.rup.iniRup,e.rup.rupSelectorObjectConstructor("rup_table",{})),e.fn.rup_table("extend",{getRupValue:function(){return console.warn(e.rup_utils.format(jQuery.rup.i18nParse(jQuery.rup.i18n.base,"rup_table.warnings.methodNotAvailable")))},setRupValue:function(){return console.warn(e.rup_utils.format(jQuery.rup.i18nParse(jQuery.rup.i18n.base,"rup_table.warnings.methodNotAvailable")))}}),e.fn.rup_table("extend",{foo:function(){return this},isInitialized:function(){return"table"===e(this).attr("ruptype")},createButton:function(t,i=0){const l=e(this).DataTable();void 0!==l.context[0].oInit.buttons&&void 0!==t?(void 0===t.custom&&(t.custom=!0),l.button().add(i,{text:()=>t.text,id:t.id,className:t.className,icon:t.icon,displayRegex:t.regex,insideContextMenu:t.insideContextMenu,action:t.action,custom:t.custom})):console.error(e.rup_utils.format(jQuery.rup.i18nParse(jQuery.rup.i18n.base,"rup_table.errors.wrongParams")))},removeButton:function(t){const i=e(this).DataTable();void 0!==i.context[0].oInit.buttons&&void 0!==t?i.buttons(t).remove():console.error(e.rup_utils.format(jQuery.rup.i18nParse(jQuery.rup.i18n.base,"rup_table.errors.wrongParam")))},disableButton:function(t,i){const l=e(this).DataTable();void 0!==l.context[0].oInit.buttons&&void 0!==t&&void 0!==i?l.buttons(t).disable(i):console.error(e.rup_utils.format(jQuery.rup.i18nParse(jQuery.rup.i18n.base,"rup_table.errors.wrongParams")))},enableButton:function(t,i,l){const r=e(this).DataTable();void 0!==r.context[0].oInit.buttons&&void 0!==t&&void 0!==i&&void 0!==l?r.buttons(t).enable(i,l):console.error(e.rup_utils.format(jQuery.rup.i18nParse(jQuery.rup.i18n.base,"rup_table.errors.wrongParams")))},getContext:function(){return e(this).DataTable().context[0]},getSelectedIds:function(){return e(this).DataTable().context[0].multiselection.selectedIds},getLastSelectedId:function(){return e(this).DataTable().context[0].multiselection.lastSelectedId},getSelectedRows:function(){const t=e(this).DataTable(),i=t.context[0],l=t.page()+1;let r=[];if(void 0!==i.json&&void 0!==i.json.rows&&i.json.rows.length>0){const t=e.grep(i.multiselection.selectedRowsPerPage,(function(e){return e.page===l}));1===t.length?r=i.json.rows[t[0].line]:t.length>1&&(r=[],e.each(t,(function(e){r.push(i.json.rows[t[e].line])})))}return r},getSelectedRowPerPage:function(){return e(this).DataTable().context[0].multiselection.selectedRowsPerPage},clear:function(){e("#"+e.escapeSelector(this[0].id)+" tbody").empty()},reload:function(){e(this).DataTable().ajax.reload()}}),e.fn.rup_table("extend",{_initOptions:function(t){var l=this;t.processing=!0,t.serverSide=!0,t.columns=t.columns||l._getColumns(t);var r=t.urlBase;t.urls={base:r,filter:r+"/filter"},t.ajax=this._ajaxOptions(t),e.extend(!0,void 0!==t.language?t.language:t.language={},{url:e.rup.RUP+"/resources/rup.i18n_"+e.rup.lang+".json"});var a=i.Api.register;return a("rupTable.selectPencil()",(function(t,i){if(e("#"+e.escapeSelector(t.sTableId)+" tbody tr td.select-checkbox i.selected-pencil").remove(),i>=0){var l=e("<i></i>").addClass("mdi mdi-pencil ui-icon-rupInfoCol selected-pencil");e(e("#"+e.escapeSelector(t.sTableId)+" tbody tr td.select-checkbox")[i]).append(l)}})),a("rupTable.reorderDataFromServer()",(function(t,l){void 0!==l.multiselection&&(l.multiselection.selectedIds=[],l.multiselection.selectedRowsPerPage=[]);let r="";e.each(t.reorderedSelection,(function(e,t){let a=i.Api().rupTable.getIdPk(t.pk,l.oInit);void 0!==l.oInit.formEdit&&(""!=l.multiselection.lastSelectedId&&""!=a&&(l.multiselection.lastSelectedId=a),0==e&&(r=a));var o={id:a,page:t.page,line:t.pageLine-1};l.multiselection.selectedIds.splice(e,0,o.id),l.multiselection.selectedRowsPerPage.splice(e,0,o)})),null!=t.reorderedSelection&&t.reorderedSelection.length>0&&""==l.multiselection.lastSelectedId&&(l.multiselection.lastSelectedId=r),void 0===l.multiselection||l.multiselection.selectedAll||(l.multiselection.numSelected=l.multiselection.selectedIds.length),void 0!==l.oInit.buttons&&void 0!==l._buttons&&(l._buttons[0].inst.s.disableAllButtons=void 0,i.Api().buttons.displayRegex(l)),e("#"+e.escapeSelector(l.sTableId)).triggerHandler("tableAfterReorderData",l)})),a("rupTable.getIdPk()",(function(i={},r){var a=t;void 0!==r&&(a=r);var o="";return e.each(a.primaryKey,(function(e,t){Object.prototype.hasOwnProperty.call(i,t)?o+=i[t]:-1!==t.indexOf(".")&&(o+=l._getDescendantProperty(i,t)),a.primaryKey.length>1&&e<a.primaryKey.length-1&&(o+=a.multiplePkToken)})),o})),a("rupTable.comparePKs()",(function(e,t){return i.Api().rupTable.getIdPk(e)===i.Api().rupTable.getIdPk(t)})),a("rupTable.blockPKEdit()",(function(t,i,l){var r,a=t.oInit.blockPKeditForm;r=void 0!==t.oInit.formEdit?t.oInit.formEdit.idForm:e("#"+e.escapeSelector(t.sTableId)+"_search_searchForm");var o=t.oInit.primaryKey;a&&o.length>0&&("PUT"===i?e.each(o,(function(t,i){var a=e(r[0]).find(":input[name='"+i+"']");if(void 0!==l&&(a=e(r[0]).find(":input[name='"+i+l+"']")),"date"!==a.attr("ruptype")||a.rup_date("isDisabled"))if("select"!==a.attr("ruptype")||a.rup_select("isDisabled"))if("time"!==a.attr("ruptype")||a.rup_time("isDisabled"))if("checkbox"===a.attr("type")){a.hasClass("checkboxPKBloqueado")||a.addClass("checkboxPKBloqueado");var o=a.is(":checked")?1:0,n=e("#"+e.escapeSelector(i)+"_bloqueado");n.attr("valor")!==o&&(void 0!==n.attr("valor")&&n.remove(),1===o?a.after(`\n                                            <i id="${i}_bloqueado" \n                                                class="mdi mdi-check sustitutoCheckboxPKBloqueadoGeneral" \n                                                valor="1" aria-hidden="true"></i>\n                                        `):a.after(`\n                                            <i id="${i}_bloqueado" \n                                                class="mdi mdi-close sustitutoCheckboxPKBloqueadoGeneral sustitutoCheckboxPKBloqueadoCross" \n                                                valor="0" aria-hidden="true"></i>\n                                        `))}else a.prop("readOnly",!0);else a.rup_time("disable");else a.rup_select("disable");else a.rup_date("disable");a.on("mousedown",(function(e){e.preventDefault()}))})):"POST"===i&&e.each(o,(function(t,i){var l=e(r[0]).find(":input[name='"+e.escapeSelector(i)+"']");"date"===l.attr("ruptype")&&l.rup_date("isDisabled")?l.rup_date("enable"):"select"===l.attr("ruptype")&&l.rup_select("isDisabled")?l.rup_select("enable"):"time"===l.attr("ruptype")&&l.rup_time("isDisabled")?l.rup_time("enable"):"checkbox"===l.attr("type")?(l.removeClass("checkboxPKBloqueado"),e("#"+e.escapeSelector(i)+"_bloqueado").remove()):l.prop("readOnly",!1),l.on("mousedown",(function(t){e(this).off(t.preventDefault()),l.focus()}))})))})),a("rupTable.getDescendantProperty()",(function(e,t){l._getDescendantProperty(e,t)})),void 0!==t.inlineEdit&&(t.responsive.details.renderer=function(t,l,r){var a=e.map(r,(function(e){return e.hidden?`\n                            <li data-dtr-index="${e.columnIndex}" data-dt-row="${e.rowIndex}" data-dt-column="${e.columnIndex}">\n                                <span class="dtr-title">${e.title}</span>\n                                <span class="dtr-data">${e.data}</span>\n                            </li>\n                            `:""})).join(""),o=!!a&&e('<ul data-dtr-index="'+l+'" class="dtr-details"></ul>').append(a),n=t.context[0],s=e("#"+e.escapeSelector(n.sTableId)+" tbody tr:not(.child)").eq(l);return s.hasClass("editable")&&(i.Api().inlineEdit.inResponsiveChangeInputsValues(n,s),void 0!==n.oInit.inlineEdit.rowDefault&&"cambioEstado"===n.oInit.inlineEdit.rowDefault&&(n.oInit.inlineEdit.rowDefault="estadoFinal")),o}),t},_getDescendantProperty(e,t){for(var i=t.split(".");i.length&&e;){var l=i.shift(),r=new RegExp("(.+)\\[([0-9]*)\\]").exec(l);if(null!==r&&3==r.length){var a={arrayName:r[1],arrayIndex:r[2]};e=null!=e[a.arrayName]?e[a.arrayName][a.arrayIndex]:void 0}else e=e[l]}return e},_getColumns(t){var i=this;if(void 0!==t.columnDefs&&t.columnDefs.length>0&&void 0!==t.columnDefs[0].className&&t.columnDefs[0].className.indexOf("select-checkbox")>-1&&void 0!==t.multiSelect){var l=e("<th></th>").attr("data-col-prop","");null!==i[0].tHead&&e(l).insertBefore(i[0].tHead.rows[0].cells[0]),t.columnDefs.length>0&&(t.columnDefs[0].orderable=!1),void 0!==t.multiSelect&&t.multiSelect.hideMultiselect&&(t.columnDefs[0].visible=!1)}e.each(t.colModel,(function(e,l){const r=i.find('th[data-col-prop="'+l.name+'"]').index();l.hidden?t.columnDefs.push({targets:r,visible:!1,className:"never"}):!1===l.orderable&&t.columnDefs.push({targets:r,orderable:!1})}));var r=e("<tfoot>").appendTo(i[0]),a=e("<tr>").appendTo(r),o=this.find("th[data-col-prop]").map(((i,l)=>(e("<th>").appendTo(a).text(e(l).text()),/^checkbox$/i.test(l.getAttribute("data-col-type"))&&t.columnDefs.push({targets:i,data:"",render:function(e){var t="mdi-close";return"1"==e&&(t="mdi-check"),`\n                                <div class="centerOnResponsiveContainer">\n                                    <i class="mdi ${t} mx-auto"></i>\n                                </div>`}}),{data:l.getAttribute("data-col-prop"),sidx:l.getAttribute("data-col-sidx"),editable:"false"!==l.getAttribute("data-col-edit")})));return o[0].sDefaultContent="",o},_doFilter(t){var i=this;let l=()=>{e("#"+e.escapeSelector(t.id)).trigger("tableFilterBeforeSearch",t),i.DataTable().ajax.reload((()=>{e("#"+e.escapeSelector(t.id)).trigger("tableFilterAfterSearch",t)}))};t.filter&&t.filter.$filterContainer?(i._showSearchCriteria(),t.filter.collapsableLayerHide&&t.filter.hideLayer(),t.filter.validFilter&&(t.filter.type="filter",l())):l()},_ajaxOptions(t){t.id=this[0].id,e("#"+e.escapeSelector(t.id)).triggerHandler("tableFilterInitialize",t);let l=this,r={url:t.urls.filter,dataSrc:function(l){let r={};e("#"+e.escapeSelector(t.id)).triggerHandler("tableFilterBeforeShow",t),l.recordsTotal=l.records,l.recordsFiltered=l.records,r.recordsTotal=l.records,r.recordsFiltered=l.records,r.data=l.rows;let a=e("#"+e.escapeSelector(t.id)).DataTable(),o=a.context[0];return void 0===t||void 0===t.multiSelect&&void 0===t.select||i.Api().rupTable.reorderDataFromServer(l,o),void 0!==o.seeker&&void 0!==o.seeker.search&&void 0!==l.reorderedSeeker&&(o.seeker.search.funcionParams=l.reorderedSeeker),void 0!==o.oInit.inlineEdit&&(o.oInit.inlineEdit.alta&&!e("#"+e.escapeSelector(o.sTableId)+" tbody tr").eq(0).hasClass("new")?r.data=i.Api().inlineEdit.createTr(a,o,r.data):o.oInit.inlineEdit.alta=void 0,i.Api().seeker.disabledButtons(o),void 0!==o.inlineEdit&&void 0!==o.inlineEdit.lastRow&&(o.inlineEdit.lastRow.idx=-1)),r.data},type:"POST",data:l._ajaxRequestData,contentType:"application/json",dataType:"json",beforeSend:function(){return l._validValidations(t.filter,t.id)}};return void 0!==t.customError&&(r.error=t.customError),r},_validValidations(t,i){if(!t||void 0===t.rules)return!0;const l={operation:"validOperation",order:"validOrder",init:"validInit",filter:"validFilter",clear:"validClear"}[t.type];return t.type="order",l&&!0===t[l]?!!t.$filterContainer.valid()||(e("#"+i+"_processing").hide(),!1):(e("#"+e.escapeSelector(i)+"_filter_form").rup_validate("resetElements"),!0)},_ajaxRequestData(l,r){if(r.oInit.ordering)for(var a=0;a<l.order.length;a++)null!=l.order[a]&&null!=l.order[a].column&&(l.columns[l.order[a].column].colSidx=r.aoColumns[l.order[a].column].colSidx);if(r.oInit.filter.$filterContainer&&(l.filter=window.form2object(r.oInit.filter.$filterContainer[0])),l.multiselection=void 0,void 0!==r.oInit.multiSelect?i.Api().multiSelect.defaultsIds(r):void 0!==r.oInit.select&&i.Api().select.defaultId(r),void 0!==r.multiselection&&r.multiselection.selectedIds.length>0&&(l.multiselection=e.rup_utils.deepCopy(r.multiselection,4)),void 0!==r.seeker&&void 0!==r.seeker.search&&void 0!==r.seeker.search.funcionParams&&r.seeker.search.funcionParams.length>0&&(l.seeker={},l.seeker.selectedIds=[],e.each(r.seeker.search.funcionParams,(function(e,t){l.seeker.selectedIds.splice(e,0,i.Api().rupTable.getIdPk(t.pk,r.oInit))}))),void 0!==r.oInit.filter.$filterContainer){const e=r.oInit.filter.$filterContainer.serializeArray();_.isEqual(r.oInit.filter.oldCriteria,e)||(r.oInit.filter.oldCriteria=e,r._iDisplayStart=0,l.start=0)}let o=new t(l),n=e.extend({},l,o.getData());n.core.pkNames=r.oInit.primaryKey,r.aBaseJson=n;let s=[],d=JSON.stringify(n,(function(e,t){if("object"==typeof t&&null!==t){if(-1!==s.indexOf(t))return;s.push(t)}return t}));return s=null,d},_clearFilter(t){e("#"+e.escapeSelector(t.sTableId)).triggerHandler("tableFilterBeforeReset",t);const l=e("#"+e.escapeSelector(t.sTableId)+"_filter_form");if(l.rup_validate("resetForm"),l.rup_validate("resetElements"),void 0!==t.masterDetail){const l=e(t.masterDetail.master).DataTable(),r=l.rows(".selected").indexes(),a=l.rows(r).data(),o=i.Api().rupTable.getIdPk(a[0],l.context[0].oInit);e("#"+e.escapeSelector(t.id)+"_filter_masterPK").val(""+o)}t.filter.$filterSummary.html(" <i></i>"),jQuery.each(e("select.rup_select",t.filter.$filterContainer),(function(e,t){jQuery(t).rup_select("refresh")})),e.rup_utils.populateForm([],t.filter.$filterContainer),t.filter.type="clear",e(this).DataTable().ajax.reload(),e("#"+e.escapeSelector(t.sTableId)).triggerHandler("tableFilterAfterReset",t)},_initFeedback(t){var i=this[0].id,l=t.feedback;l&&l.id&&e("#"+e.escapeSelector(l.id)).length>0?(l.$feedbackContainer=e("#"+e.escapeSelector(l.id)),l.$feedbackContainer.rup_feedback(l)):(l.id="rup_feedback_"+i,l.$feedbackContainer=e("<div></div>").attr("id",l.id).insertBefore("#"+i),l.$feedbackContainer.rup_feedback(t.feedback))},_initFilter(t){var i,l,r,a,o=this,n=this[0].id,s=t.filter;if(t.filterForm?s.id=e(t.filterForm).attr("id"):s.id||(s.id=n+"_filter_form"),s.$filterContainer=jQuery("#"+s.id),s.filterToolbarId=void 0!==s.filterToolbar?s.filterToolbar:n+"_filter_toolbar",s.$filterToolbar=jQuery("#"+s.filterToolbarId),0===s.$filterContainer.length)!0===t.filterMessage&&e.rup.errorGestor(e.rup.i18nParse(e.rup.i18n.base,"rup_table.plugins.filter.filterContainerError"));else if(0===s.$filterToolbar.length)e.rup.errorGestor(e.rup.i18nParse(e.rup.i18n.base,"rup_table.plugins.filter.filterToolbarError"));else if(s.collapsableLayerId=void 0!==s.collapsableLayerId?s.collapsableLayerId:n+"_filter_fieldset",s.toggleIcon1Id=void 0!==s.toggleIcon1?s.toggleIcon1:n+"_filter_toggle_icon1",s.toggleLabelId=void 0!==s.toggleLabelId?s.toggleLabelId:n+"_filter_toggle_label",s.filterSummaryId=void 0!==s.filterSummaryId?s.filterSummaryId:n+"_filter_summary",s.toggleIcon2Id=void 0!==s.toggleIcon2?s.toggleIcon2:n+"_filter_toggle_icon2",s.$filterButton=s.$filterContainer.find("#"+n+"_filter_filterButton"),s.$filterButton.on("click",(function(){let e=t.validarFiltrar;if("function"==typeof e&&e(t))return!1;o._doFilter(t)})),s.$clearButton=s.$filterContainer.find("#"+n+"_filter_cleanButton"),s.$clearButton.on("click",(function(){o._clearFilter(t)})),void 0!==s.showHidden&&"boolean"==typeof s.showHidden||(s.showHidden=!1),i=e(e.rup_utils.format("<span id='{0}' class='collapse_icon mdi mdi-arrow-down-drop-circle'></span>",s.toggleIcon1Id)),l=e(e.rup_utils.format("<a id='{0}' class='text-primary text-decoration-underline fw-bold' href='#0'>{1}:</a>",s.toggleLabelId,e.rup.i18n.base.rup_table.plugins.filter.filterCriteria)),r=e(e.rup_utils.format("<span id='{0}'></span>",s.filterSummaryId)),a=e(e.rup_utils.format("<span id='{0}' class='collapse_icon_right mdi mdi-arrow-up-drop-circle'></span>",s.toggleIcon2Id)),s.$filterToolbar.append(i).append(l).append(r).append(a),s.$filterContainer=jQuery("#"+s.id),s.$collapsableLayer=jQuery("#"+s.collapsableLayerId),s.$toggleIcon1=i,s.$toggleLabel=l,s.$filterSummary=r,s.$toggleIcon2=a,s.$collapsableLayer.on("keydown",(function(e){if("Enter"===e.code){e.preventDefault();let i=t.validarFiltrar;if("function"==typeof i&&i(t))return!1;o._doFilter(t)}})),s.showLayer=function(){s.$collapsableLayer.show(),s.$toggleIcon1.removeClass("mdi-chevron-right").addClass("mdi-chevron-down"),s.$toggleIcon2.removeClass("mdi-arrow-up-drop-circle").addClass("mdi-arrow-down-drop-circle"),s.$filterToolbar.addClass("formulario_opened"),s.showHidden=!1},s.hideLayer=function(){s.$collapsableLayer.hide(),s.$toggleIcon1.removeClass("mdi-chevron-down").addClass("mdi-chevron-right"),s.$toggleIcon2.removeClass("mdi-arrow-down-drop-circle").addClass("mdi-arrow-up-drop-circle"),s.$filterToolbar.removeClass("formulario_opened"),s.showHidden=!0},s.$filterToolbar.addClass("cursor_pointer").on({click:function(){!1===s.showHidden?s.hideLayer():s.showLayer()}}),!0===s.showHidden?s.hideLayer():s.showLayer(),s.rules){const{$feedbackContainer:e,...i}=t.feedback;s.$filterContainer.rup_validate({feedback:t.feedback.$feedbackContainer,feedbackOptions:i,rules:s.rules})}},_showSearchCriteria(){var t,i,l,r,a,o,n,s=this,d=e("#"+e.escapeSelector(s[0].id)).data("settings"+s[0].id),c=" ",u=d.filter.$filterContainer.serializeArray(),p=d.filter.$filterContainer,f=[];let m,b,v=0;var g=e(".jstree",d.filter.$filterContainer);e.each(g,(function(t,i){(n={}).name=e(i).attr("name"),n.value=e(i).rup_tree("getRupValue").length,n.type="rup_tree",u.push(n)}));let h=(e,t)=>{t.name===l.attr("id")?0!=t.value&&(o+=" = "+t.value):o=""};const I={};var y={};const _=u.reduce(((t,i)=>{const{name:l,value:r}=i;if(I[l]||(I[l]={value:r,count:0},y[l]=[]),""!=r)if(I[l].count++,1===I[l].count)t.push({name:l,value:r}),y[l].push(r);else if("hidden"!=e("[name='"+l+"']").prop("type")){var a=t.find((function(e){return e.name===l}));I[l].count<4?(y[l].push(r),a.value=y[l].join(", ")):a.value="Seleccionados "+I[l].count}return t}),[]);u=_;for(var x=0;x<u.length;x++)if(""!==u[x].value&&0!==e.inArray(u[x].name,d.filter.excludeSummary)){if(l=e("[name='"+u[x].name+"']",p),-1!==e.inArray(l.attr("id"),d.filter.filterExclude))continue;if(l.length>1)switch((l=e("[name='"+u[x].name+"']:checked",p)).prop("type")){case"radio":m=!0;break;case"checkbox":b=!0}if("hidden"===e(l).attr("type"))continue;if(r=e(l[v++]).attr("id"),0!=l.length&&v!==l.length||(v=0),t=e("label[for^='"+r+"']",p),m&&"table_material"===d.adapter)a=1==e('label[data-name="'+u[x].name+'"]').length?e('label[data-name="'+u[x].name+'"]').text():e("#"+e.escapeSelector(r)).attr("name"),m=!1;else if(b&&"table_material"===d.adapter)a=1==e('label[data-name="'+u[x].name+'"]').length?e('label[data-name="'+u[x].name+'"]').text():e("#"+e.escapeSelector(r)).attr("name"),""!==c&&void 0!==c&&new RegExp(a,"i").test(c)&&(c=c.replace(/.{2}$/,","),a=""),b=!1;else if(t.length>0)a=t.html();else if(a=e("[name='"+u[x].name+"']",p).prev("div").find("label").first().html(),void 0!==d.masterDetail&&d.masterDetail.masterPrimaryKey===u[x].name){let e=d.masterDetail;a=void 0!==e.masterPrimaryLabel?e.masterPrimaryLabel:e.masterPrimaryKey}switch(null==a&&(a=""),o=" = ",l.length>0&&e(l)[0].tagName){case"INPUT":if(null!=e(l)&&"checkbox"===e(l)[0].type&&e(l).length>1){o+=u[x].value;break}"checkbox"===e(l)[0].type||"radio"===e(l)[0].type?"function"==typeof d.criterianCheckRadio?o+=d.criterianCheckRadio(e(l)):null!=e(l).siblings("label").first().text()&&""!=e(l).siblings("label").first().text()?o+=e(l).siblings("label").first().text():null!=e(l).closest("label").text()&&""!=e(l).closest("label").text()?o+=e(l).closest("label").text():o+=u[x].value:o+=e(l).val();break;case"DIV":e.each(u,h),""===o&&(a="");break;case"SELECT":0===l.next(".ui-multiselect").length?null==e("option[value='"+u[x].value+"']",l).html()?o+=u[x].value:o+=e("option[value='"+u[x].value+"']",l).html():-1===e.inArray(e(l).attr("id"),f)?(0!==(i=l.rup_select("getRupValue").length)?o+=i:(a="",o=""),f.push(e(l).attr("id"))):(a="",o="")}for(var w=new Array(":","="),S=0;S<w.length;S++)if(""!==a&&-1!==a.indexOf(w[S])){a=a.substring(0,a.indexOf(w[S]));break}for(;-1!==o.indexOf("&amp;nbsp;");)o=o.replace("&amp;nbsp;","");if(""===a&&-1!==o.indexOf(" = ")&&(o=o.substring(2,o.length)),""===a&&""===o.trim())continue;c=c+a+o+"; "}void 0!==d.multiFilter&&"function"==typeof d.multiFilter.getName&&(c=d.multiFilter.getName.bind(s,c)()),d.filter.$filterSummary.html(" <i>"+c+"</i>")},_createEventSelect(t){t.on("draw.dtSelect.dt select.dtSelect.dt",(function(){var l=t.context[0];if(void 0!==l.oInit.formEdit&&void 0!==l.oInit.formEdit.$navigationBar&&void 0!==l.oInit.formEdit.$navigationBar.funcionParams&&l.oInit.formEdit.$navigationBar.funcionParams.length>0){var r=l.oInit.formEdit.$navigationBar.funcionParams;if(l.multiselection.selectedAll){var a=-1;void 0===r[3]||"prev"!==r[3]&&"last"!==r[3]?(void 0!==r[2]&&r[2]>0&&(a=r[2]-1),r[2]=i.Api().editForm.getLineByPageSelected(l,a)):(a=l.json.rows.length,r[2]=i.Api().editForm.getLineByPageSelectedReverse(l,a))}e.when(i.editForm.fnOpenSaveDialog(r[0],r[1],r[2],l.oInit.formEdit.customTitle)).then((function(){var e=l.json.rows[r[2]],t=l.multiselection,a=jQuery.inArray(i.Api().rupTable.getIdPk(e,l.oInit),t.selectedIds);l.multiselection.selectedAll&&(a=l.oInit.formEdit.$navigationBar.numPosition),void 0===a&&(a=0,l.oInit.formEdit.$navigationBar.numPosition=0);var o=t.numSelected;void 0===l.oInit.multiSelect&&(o=l.json.recordsTotal,a=(Number(l.json.page)-1)*l.aBaseJson.length,a+=r[2]),i.Api().editForm.updateDetailPagination(l,a+1,o)}))}}))},_initializeMultiselectionProps(t){var l={};void 0===l.multiselection&&(l.multiselection={}),l.multiselection.selectedAll=!1,l.multiselection.numSelected=0,l.multiselection.selectedRowsPerPage=[],l.multiselection.selectedIds=[],l.multiselection.lastSelectedId="",l.multiselection.deselectedRowsPerPage=[],l.multiselection.deselectedIds=[],l.multiselection.accion="",e("#contextMenu1 li.context-menu-icon-uncheck").addClass("disabledButtonsTable"),e("#contextMenu1 li.context-menu-icon-uncheck_all").addClass("disabledButtonsTable"),e("#inputSelectTableHead"+e.escapeSelector(t.sTableId)).prop("checked",!1),i.Api().rupTable.selectPencil(t,-1),void 0===t.multiselection&&(t.multiselection={}),t.multiselection=l.multiselection},_createTooltip(t){void 0!==t&&void 0!==t.text()&&""!==t.text()&&t.rup_tooltip({content:{text:t.text()},show:{event:"mouseover"},position:{viewport:e(window),adjust:{method:"flip"}}})}}),e.fn.rup_table("extend",{_init:function(t){global.initRupI18nPromise.then((()=>{var l=this;global.initTableMultiFilter=jQuery.Deferred(),null!=t[0].buttons&&void 0===t[0].buttons.contextMenu&&(t[0].buttons.contextMenu=!0),void 0!==t[0].masterDetail&&(e.fn.rup_table.defaults.feedback.gotoTop=!1);var r=e.extend(!0,{},e.fn.rup_table.defaults,l[0].dataset,t[0]);if(r.defaultOrder||(r.order=[]),l.triggerHandler("tableBeforeInit",r),l.attr("ruptype","table"),l.triggerHandler("tableInit",r),void 0!==t[0].primaryKey&&(r.primaryKey=t[0].primaryKey.split(";")),void 0!==r.columnDefs&&r.columnDefs.length>0&&e.each(r.columnDefs,(function(){!1===this.visible&&(this.className="never")})),void 0!==r.multiSelect){let e="select-checkbox";r.multiSelect.hideMultiselect&&(e="select-checkbox never"),r.columnDefs.unshift({orderable:!1,className:e,targets:0,render:function(){return'<div class="checkbox-material checkbox-material-inline"><input type="checkbox"><label></label></div>'}}),r.select=void 0}if(void 0!==r.formEdit&&(r.inlineEdit=void 0),void 0===r.filter&&(r.multiFilter=void 0),void 0!==r.multiFilter&&void 0===r.multiFilter.getDefault){r.multiFilter.userFilter||(r.multiFilter.userFilter=window.LOGGED_USER);var a={};a.oInit=r,a.sTableId=l[0].id,e.rup_ajax({url:r.urlBase+r.multiFilter.url+"/getDefault?selector="+r.multiFilter.idFilter+"&user="+r.multiFilter.userFilter,type:"GET",dataType:"json",showLoading:!1,contentType:"application/json",complete:function(){global.initTableMultiFilter.resolve(),e("#"+e.escapeSelector(a.sTableId)).triggerHandler("tableMultiFilterCompleteGetActiveFilter",a)},success:function(t){if(null!=t){a.oInit.multiFilter.defaultId=String(t.id);const o=JSON.parse(t.data);o&&(i.Api().multiFilter.fillForm(o,a),l._doFilter(t)),e(r.filter.$filterSummary,"i").prepend(" "+t.text+" "),e(r.filter.$filterSummary,"i").append(t.data?t.data:"{ }")}e("#"+e.escapeSelector(a.sTableId)).triggerHandler("tableMultiFilterSuccessGetActiveFilter",a)},error:function(){e("#"+e.escapeSelector(a.sTableId)).triggerHandler("tableMultiFilterErrorGetActiveFilter",a)}})}void 0===t[0].responsive&&(r.responsive=e.fn.rup_table.defaults.responsive);const o={block:"d-block",inline:"d-inline ms-1",none:"d-none",default:"d-block"},n=o[r.columnOrderArrows.display]||o.default;e.each(e("#"+e.escapeSelector(l[0].id)+" thead th"),(function(){const t=e(this),i=e("<span></span>").addClass("d-inline").text(t.text());r.columnOrderArrows.showOnlyActive&&t.addClass("sorting_active_only");const l=e("<span></span>").addClass("mdi mdi-arrow-down me-2 me-xl-0"),a=e("<span></span>").addClass("mdi mdi-arrow-up"),o=e("<div></div>").addClass(n).append(l,a);t.text(""),t.append(i),t.append(o)})),l._initOptions(r),l._initFeedback(r);let s=t[0].filter,d=!1;void 0!==s&&"noFilter"!==s&&(d=!0),e.fn.rup_table.defaults.filter={id:d?s.id:l[0].id+"_filter_form",filterToolbar:d?s.filterToolbar:l[0].id+"_filter_toolbar",collapsableLayerId:d?s.collapsableLayerId:l[0].id+"_filter_fieldset"},r.drawCallback=function(i){const l=e("#"+i.sTableId+"_wrapper .paginationContainer").find("ul.pagination"),r=l.find("a.page-link"),a=l.find("li.dt-paging-input");l.addClass("order-1 align-self-center col-sm-12 order-sm-1 col-xl-7 order-xl-2"),e(r[0]).attr("id",i.sTableId+"_first"),e(r[1]).attr("id",i.sTableId+"_previous"),e(r[2]).attr("id",i.sTableId+"_next"),e(r[3]).attr("id",i.sTableId+"_last"),r.parent().addClass("px-1 py-2 paginate_button"),r.addClass("btn-material btn-material-sm btn-material-primary-low-emphasis d-none d-sm-block"),a.addClass("align-self-center p-2"),a.find("input").addClass("text-center"),t[0].drawCallback?.()},"noFilter"!==s?(void 0===s&&(r.filter=e.fn.rup_table.defaults.filter),r.filter.type="init",null==r.filter.validFilter&&(r.filter.validFilter=!0),null==r.filter.validInit&&(r.filter.validInit=!1),null==r.filter.validOrder&&(r.filter.validOrder=!1),null==r.filter.validOperation&&(r.filter.validOperation=!1),null==r.filter.validClear&&(r.filter.validClear=!1),l._initFilter(r)):"noFilter"===s&&void 0!==r.filterForm?(r.filter={},r.filterForm?r.filter.id=e(r.filterForm).attr("id"):r.filter.id=l[0].id+"_filter_form",r.filter.$filterContainer=jQuery("#"+r.filter.id)):t[0].filter=void 0,void 0===r.loadOnStartUp||r.loadOnStartUp||(r.deferLoading=0);var c=l.DataTable(r);r.sTableId=l[0].id,r.seeker?.activate&&e("#"+e.escapeSelector(r.sTableId)+" tfoot").insertBefore("#"+r.sTableId+" tbody"),l._initializeMultiselectionProps(c.context[0]),!1!==r.createTooltipHead&&e.each(e("#"+e.escapeSelector(l[0].id)+" thead th"),(function(){l._createTooltip(e(this))})),c.on("draw",(function(t,a){var o=c.context[0];if("noFilter"!=s&&l._showSearchCriteria(),void 0!==r.select||void 0!==r.multiSelect){if(void 0!==r.select){if(void 0!==a.select&&void 0!==a.select.selectedRowsPerPage){var n=0;"prev"!==a.select.selectedRowsPerPage.cambio&&"last"!==a.select.selectedRowsPerPage.cambio||(n=o.json.rows.length-1),o.oInit.formEdit.$navigationBar.funcionParams=["PUT",c,n,a.select.selectedRowsPerPage.cambio],o.multiselection.selectedRowsPerPage=[];var d=o.json.rows[n],u=i.Api().rupTable.getIdPk(d,o.oInit);o.multiselection.selectedRowsPerPage.push({line:n,page:o.select.selectedRowsPerPage.page,id:u}),a.select.selectedRowsPerPage=void 0;var p=o.json.recordsTotal,f=(Number(o.json.page)-1)*o.aBaseJson.length;f=f+n+1,i.Api().editForm.updateDetailPagination(o,f,p)}1===o.multiselection.selectedRowsPerPage.length&&o.multiselection.selectedRowsPerPage[0].page==o.json.page&&i.Api().select.selectRowIndex(c,o.multiselection.selectedRowsPerPage[0].line,!1),void 0!==c.context[0].oInit.inlineEdit&&i.Api().inlineEdit.addchildIcons(c.context[0])}void 0!==a.seeker&&void 0!==a.seeker.search&&void 0!==a.seeker.search.funcionParams&&a.seeker.search.funcionParams.length>0&&o.json.page!==a.seeker.search.funcionParams[a.seeker.search.pos].page&&o.fnRecordsTotal()>0&&i.Api().seeker.selectSearch(c,o,a.seeker.search.funcionParams)}if(!1!==r.createTooltipBody&&e.each(e("#"+e.escapeSelector(a.sTableId)+" tbody td"),(function(){l._createTooltip(e(this))})),void 0!==a.inlineEdit)if(i.Api().inlineEdit.drawInlineEdit(c,o),void 0!==o.oInit.inlineEdit.rowDefault){"CLONE"===o.oInit.inlineEdit.rowDefault.actionType&&i.Api().inlineEdit.cloneLine(c,o,o.oInit.inlineEdit.rowDefault.line),i.Api().inlineEdit.editInline(c,o,o.oInit.inlineEdit.rowDefault.line,"CLONE"===o.oInit.inlineEdit.rowDefault.actionType?"POST":o.oInit.inlineEdit.rowDefault.actionType);var m=c.columns().responsiveHidden().reduce((function(e,t){return!1===t?e+1:e}),0);o.oInit.inlineEdit.rowDefault=m>0?"cambioEstado":void 0}else if(void 0!==o.oInit.select&&o.multiselection.selectedRowsPerPage.length>0){var b=e(o.nTBody),v=e("tr:nth-child(1)",b);i.Api().rupTable.getIdPk(o.json.rows[0],o.oInit)===o.multiselection.selectedRowsPerPage[0].id&&v.addClass("selected tr-highlight")}void 0!==a.oInit.formEdit&&void 0!==a.oInit.responsive&&void 0!==a.oInit.responsive.selectorResponsive&&i.Api().editForm.addchildIcons(a),void 0===r.inlineEdit&&void 0===r.formEdit&&i.Api().editForm.addchildIcons(a)})),c.on("responsive-resize.dt",(function(e,t){let l=t.context[0];void 0!==l.oInit.formEdit&&void 0!==l.oInit.responsive&&void 0!==l.oInit.responsive.selectorResponsive&&i.Api().editForm.addchildIcons(l),void 0===r.inlineEdit&&void 0===r.formEdit&&i.Api().editForm.addchildIcons(l)})),c.on("destroy",(function(t,i){r.filter&&r.filter.$filterToolbar&&r.filter.$filterToolbar.empty(),e("#"+e.escapeSelector(i.sTableId)+"_detail_navigation").empty()})),c.on("column-reorder",(function(e,t,l){void 0!==t._multiSelect&&t.multiselection.numSelected>0?c.ajax.reload():i.Api().editForm.addchildIcons(t)})),void 0!==r.inlineEdit&&i.Api().inlineEdit.onResponsiveResize(c),void 0===r.multiSelect&&void 0===r.select||l._createEventSelect(c),l.data("settings"+l[0].id,r),c.context[0].oInit.scrollX&&!c.context[0].oInit.showScrollFootInner&&c.on("init.dt",(function(){e("#"+e.escapeSelector(c.context[0].sTableId)+"_wrapper .dataTables_scrollFootInner").hide()})),l.triggerHandler("tableAfterInit",c.context[0]),void 0===r.inlineEdit&&void 0===r.formEdit&&void 0===r.multiselect&&void 0===r.select&&e(window).on("resize.dtr",i.util.throttle((function(){i.Api().editForm.addchildIcons(c.context[0])})))})).catch((e=>{console.error("Error al inicializar el componente:\n",e)}))}}),i.ext.classes.length.select="",i.ext.classes.length.container="dt-length col-12 order-2 text-center align-self-center col-sm-2 order-sm-3 col-xl-1 p-0",i.ext.classes.info.container="dt-info col-6 order-4 text-start align-self-center col-sm-5 order-sm-4 col-xl-2 text-xl-center",e.fn.rup_table.defaults={foobar:!1,headerContextMenu:{show:!0,selectAllPage:!0,deselectAllPage:!0,separator:!0,selectAll:!0,deselectAll:!0,items:{}},fixedHeader:{header:!1,footer:!0},feedback:{closeLink:!0,delay:2e3,block:!1},responsive:{details:{renderer:function(t,i,l){var r=e.map(l,(function(e){var t=e.className?'class="'+e.className+'"':"";return-1!==e.title.indexOf("d-block")&&(e.title=e.title.substring(e.title.indexOf('<div class="d-block'),e.title.lastIndexOf)),e.hidden?"<li "+t+' data-dtr-index="'+e.columnIndex+'" data-dt-row="'+e.rowIndex+'" data-dt-column="'+e.columnIndex+'"><span class="dtr-title">'+e.title+'</span> <span class="dtr-data">'+e.data+"</span></li>":""})).join("");return!!r&&e('<ul data-dtr-index="'+i+'" class="dtr-details"/>').append(r)},type:"column",target:"td span.openResponsive"},selectorResponsive:"td span.dtr-data"},layout:{top2Start:null,top2End:null,topStart:null,topEnd:null,top:null,bottom:{rowClass:"container-fluid paginationContainer",className:"row",features:[{div:{id:"select_info",className:"col-6 order-3 text-end align-self-center col-sm-5 order-sm-2 col-xl-2 order-xl-1 text-xl-start"},inputPaging:{},pageLength:{},info:{}}]},bottomStart:null,bottomEnd:null,bottom2Start:null,bottom2End:null},multiplePkToken:"~",primaryKey:["id"],blockPKeditForm:!0,enableDynamicForms:!1,contextMenuActivo:!0,selectFilaDer:!1,createdRow:function(t){var i=e("#"+e.escapeSelector(this[0].id)).rup_table("getContext");(null!=i.oInit.select||null!=i.oInit.multiSelect&&i.oInit.multiSelect.hideMultiselect)&&e(t).attr("tabindex","0")},columnDefs:[],columnOrderArrows:{showOnlyActive:!1,display:"block"},adapter:"table_material",order:[[1,"asc"]],ordering:!0,defaultOrder:!0,showMultiSelectedZero:!0,filterMessage:!0,noEdit:!1}}));