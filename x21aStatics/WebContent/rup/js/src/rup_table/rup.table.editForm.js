/*! For license information please see rup.table.editForm.js.LICENSE.txt */
!function(e){"function"==typeof define&&define.amd?define(["jquery","../core/utils/jquery.form","../rup.form","../rup.select","datatables.net"],(function(t){return e(t,window,document)})):"object"==typeof exports?module.exports=function(t,i){return t||(t=window),i&&i.fn.dataTable||(i=require("datatables.net")(t,i).$),e(i,t,t.document)}:e(jQuery,window,document)}((function(e,t,i,o){"use strict";var r=e.fn.dataTable;function a(e){e.oInit.formEdit.okCallBack=!1;var t=e.oInit.formEdit.detailForm.find("#"+e.sTableId+"_detail_feedback");if(e.oInit.formEdit.idForm.find(".error").length>0&&(e.oInit.formEdit.idForm.rup_validate("resetElements"),e.oInit.formEdit.idForm.find(".error").not("input").remove(),e.oInit.formEdit.idForm.find(".rup-validate-field-error").removeClass("rup-validate-field-error")),0===t.length){var i=t.prevObject[0];i.length>0&&""!==i[0].className&&i.rup_feedback("hide",0)}else""!==t[0].className&&t.rup_feedback("hide",0)}function n(t){let i,r=t.oInit.formEdit.detailForm.find("#"+t.sTableId+"_detail_feedback");t.oInit.formEdit.validate!==o&&(i=t.oInit.formEdit.validate.rules),0===r.length&&(r=e("<div></div>").attr("id",r.prevObject[0].id).insertBefore(r)),r.rup_feedback(t.oInit.feedback);let a=e.extend(!0,{},{liveCheckingErrors:!1,showFieldErrorAsDefault:!0,showErrorsInFeedback:!0,showFieldErrorsInFeedback:!0},t.oInit.formEdit.propertiesValidate);a.feedback=r,a.rules=i,t.oInit.formEdit.idForm.rup_validate(a)}function l(t,i,a){var l=t.oInit.formEdit!==o?t.oInit.formEdit.idForm:o;let d=t.oInit.formEdit.actionType,c=!1,m=t.oInit.formEdit.detailForm.find("#"+t.sTableId+"_detail_button_save_repeat");if("CLONE"===i?(c=!0,i="POST",m.hide()):m.show(),function(e,t,i,a){if(e.oInit.enableDynamicForms){let n=e.oInit.formEdit.lastSelectedIdUsed,l=r.Api().rupTable.getIdPk(a,e.oInit);if(e.oInit.formEdit.lastSelectedIdUsed=l,t!==i||n===o||l!==n)return!0}return!1}(t,d,i,a)){const m={actionType:"PUT"==i&&t.oInit.formEdit.usePostAsEditActionType?"POST":i,isMultipart:!0===t.oInit.formEdit.multipart,...!c&&""!=r.Api().rupTable.getIdPk(a,t.oInit)&&{pkValue:r.Api().rupTable.getIdPk(a,t.oInit)}};e("#"+e.escapeSelector(t.sTableId)).triggerHandler("tableEditFormAfterData",t);let f=t.oInit.formEdit.data!==o?e.extend({},m,t.oInit.formEdit.data):m;return e("#"+e.escapeSelector(t.sTableId)).triggerHandler("tableEditFormBeforeLoad",t),e.post(t.oInit.formEdit.url!==o?t.oInit.formEdit.url:t.oInit.urlBase+"/editForm",f,(function(r){let c=l!==o?l:o,m=e(r).find("form").addBack("form");c!==o&&1===c.length&&c.attr("id")===m.attr("id")&&c.remove();let f="#"+t.sTableId+"_detail_form_container";e(f).prepend(m),t.oInit.formEdit.actionType=i,t.oInit.formEdit.idForm=e(t.oInit.formEdit.detailForm).find("form").first(),d===o&&e("#"+e.escapeSelector(t.sTableId)).triggerHandler("tableEditFormInitialize",t),s(t,a,e(f+" #"+m.attr("id"))),n(t),e("#"+e.escapeSelector(t.sTableId)).triggerHandler("tableEditFormAfterLoad",t)}),"html")}if(t.oInit.enableDynamicForms||d!==o){let o=e.Deferred();return t.oInit.formEdit.actionType=i,e(t.oInit.formEdit.idForm).rup_form("clearForm",!0),o.resolve(),o.promise()}t.oInit.formEdit.actionType=i,e.when(e("#"+e.escapeSelector(t.sTableId)).triggerHandler("tableEditFormInitialize",t)).then((function(){let i=e.Deferred();return s(t,a,l),n(t),i.resolve(),i.promise()}))}function s(t,i,r){t.oInit.colModel===o||t.oInit.multiSelect===o&&t.oInit.select===o||e.each(t.oInit.colModel,(function(t,a){const n=a.editoptions?.rupType!==o?a.editoptions.rupType:a.rupType,l="tree"!==n?r.find('[name="'+a.name+'"]'):r.find('div[class*="rup_tree"]');a.hidden?(l.prop("hidden",!0),l.parent().is("div")&&1===l.parent().find("input,textarea,select").length?l.parent().addClass("d-none"):r.find('label[for="'+l.attr("id")+'"]').addClass("d-none")):a.editable&&n!==o?"select"===n?a.editoptions===o?console.error(e.rup_utils.format(jQuery.rup.i18nParse(jQuery.rup.i18n.base,"rup_table.errors.wrongColModel"),a.name,"editoptions")):(i!==o&&(a.editoptions.selected=a.name.includes(".")?e.fn.flattenJSON(i)[a.name]:i[a.name]),l["rup_"+n](a.editoptions)):l["rup_"+n](a.editoptions):a.editable||l.prop("readonly",!0)}))}function d(t,i,a,n,l,s,d,m){var f=i.settings()[0];let p=function(){e("#"+e.escapeSelector(f.sTableId)).triggerHandler("tableEditFormBeforeCallAjax",[f,t,d]);var p=s.find("#"+f.sTableId+"_detail_feedback"),u=e.rup.i18nParse(e.rup.i18n.base,"rup_table.modifyOK"),g=f.oInit.formEdit.validate;if("/deleteAll"!==d&&"DELETE"!==t||(u=e.rup.i18nParse(e.rup.i18n.base,"rup_table.deletedOK"),g!==o&&(g.rules={})),f.oInit.masterDetail!==o){var I=r.Api().masterDetail.getMasterTablePkObject(f);e("#"+e.escapeSelector(f.sTableId)+"_detail_masterPK").val(e("#"+e.escapeSelector(f.sTableId)+"_filter_masterPK").val()),a=jQuery.extend(!0,a,I)}var E={url:f.oInit.urlBase+d,accepts:{"*":"*/*",html:"text/html",json:"application/json, text/javascript",script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript",text:"text/plain",xml:"application/xml, text/xml"},type:f.oInit.formEdit.multipart||"PUT"==t&&f.oInit.formEdit.usePostAsEditActionType?"POST":t,data:a,dataType:"json",showLoading:!1,contentType:"application/json",async:!0,success:function(m){if(f.oInit.formEdit.okCallBack=!0,f.oInit.formEdit.lastValue=m,f.oInit.filter!=o&&(f.oInit.filter.type="operation"),"/deleteAll"!==d&&"DELETE"!==t){if(l){var g=s.find("#"+p[0].id+"_ok");0===g.length&&(g=e("<div></div>").attr("id",p[0].id+"_ok").insertBefore(p)).rup_feedback(f.oInit.feedback),c(f,g,u,"ok")}else f.oInit.formEdit.detailForm.rup_dialog("close"),c(f,f.oInit.feedback.$feedbackContainer,u,"ok");if(a=e.extend({},a,m),"PUT"===t){i.row(n).data(a),f.json.rows[n]=a;var I=0;e.each(f.multiselection.selectedRowsPerPage,(function(e,t){t.id!=f.multiselection.lastSelectedId||(I=e)})),f.seeker!==o&&f.seeker.ajaxOption.data!==o&&f.seeker.ajaxOption.data.search!==o&&f.seeker.search.funcionParams!==o&&f.seeker.search.funcionParams.length>0&&function(t,i,o){var a=!0;e.each(i.seeker.ajaxOption.data.search,(function(e,i){if(-1===t[e].indexOf(i))return a=!1,!1})),a||(i.seeker.search.funcionParams=jQuery.grep(i.seeker.search.funcionParams,(function(e){return e.page!==Number(i.json.page)||e.pageLine!==o+1})),e("#"+e.escapeSelector(i.sTableId)+" tbody tr").eq(o).find("td.select-checkbox i.filtered-row").remove(),e("#"+e.escapeSelector(i.sTableId)+" tbody tr").eq(o).find("td i.filtered-row").remove(),r.Api().seeker.updateDetailSeekPagination(1,i.seeker.search.funcionParams.length,i))}(a,f,n),f.multiselection.lastSelectedId=r.Api().rupTable.getIdPk(a,f.oInit),f.multiselection.selectedRowsPerPage[I].id=r.Api().rupTable.getIdPk(a,f.oInit),f.oInit.feedback.type=o}else{e.each(f.oInit.primaryKey,(function(e,t){let i=a[t];-1!==t.indexOf(".")?a[t]=r.Api().rupTable.getDescendantProperty(m,t):a[t]=m[t],a[t]===o&&(a[t]=i)})),f.oInit.select!==o&&r.Api().select.deselect(f);var E=a;if(f.json!==o?(e.each(f.json.rows,(function(e,t){var o=t;i.row(e).data(E),E=o})),f.json.rows.pop(),f.json.rows.splice(0,0,a)):(i.row.add(E).draw(!1),f.json={},f.json.rows=[],f.json.rows.push(E)),f.oInit.formEdit.saveContinueEdit?(f.oInit.formEdit.detailForm.buttonSaveContinue.actionType="PUT",r.Api().rupTable.blockPKEdit(f,"PUT")):f.oInit.formEdit.idForm.resetForm(),f.oInit.formEdit.serializerSplitter?f.oInit.formEdit.dataOrigin=e.rup_utils.editFormSerialize(f.oInit.formEdit.idForm,f.oInit.formEdit.serializerSplitter):f.oInit.formEdit.dataOrigin=e.rup_utils.formDataToQueryString(f.oInit.formEdit.idForm,f.oInit.formEdit.formDataToQueryStringOptions),f.oInit.multiSelect!==o&&(f.oInit.feedback.type="noBorrar",i.row().multiSelect()),null!==f.json.reorderedSelection&&f.json.reorderedSelection!==o)try{f.multiselection.selectedRowsPerPage[0].line=f.json.reorderedSelection[0].pageLine}catch(e){console.log(e.message)}i.ajax.reload((function(){e("#"+e.escapeSelector(f.sTableId)).trigger("tableEditFormAfterInsertRow",[f,t])}),!1)}if("PUT"===t)i.ajax.reload((function(){e("#"+e.escapeSelector(f.sTableId)).trigger("tableEditFormSuccessCallSaveAjax",[f,t])}),!1);else{if(f.oInit.multiSelect===o){let e={id:r.Api().rupTable.getIdPk(a,f.oInit),page:Number(f.json.page),line:0};f.multiselection.selectedRowsPerPage[0]=e,r.Api().select.drawSelectId(f)}e("#"+e.escapeSelector(f.sTableId)).trigger("tableAddFormSuccessCallSaveAjax",[f,t])}}else f.oInit.feedback.type="eliminar",f.oInit.feedback.msgFeedBack=u,f.oInit.multiSelect!==o?i.ajax.reload((function(){e("#"+e.escapeSelector(f.sTableId)).trigger("tableEditFormSuccessCallSaveAjax",[f,t]),r.Api().multiSelect.deselectAll(i)}),!1):f.oInit.select!==o&&i.ajax.reload((function(){e("#"+e.escapeSelector(f.sTableId)).trigger("tableEditFormSuccessCallSaveAjax",[f,t]),r.Api().select.deselect(f)}),!1),c(f,f.oInit.feedback.$feedbackContainer,u,"ok")},complete:function(){f.oInit.formEdit.buttonsForm!=o&&e.each(f.oInit.formEdit.buttonsForm,(function(t,i){e(i).prop("disabled",!1)})),e("#"+e.escapeSelector(f.sTableId)).triggerHandler("tableEditFormCompleteCallSaveAjax",[f,t])},error:function(i){let r;if(r="DELETE"===t||p[0]==o?f.oInit.feedback.$feedbackContainer:s.find("#"+p[0].id+"_ok"),0===r.length&&(r=e("<div></div>").attr("id",p[0].id+"_ok").insertBefore(p),r.rup_feedback(f.oInit.feedback)),406===i.status&&""!==i.responseText)try{let t=JSON.parse(i.responseText);if(t.rupErrorFields)if(t.rupErrorFields!==o||t.rupFeedback!==o){let i=f.oInit.formEdit.idForm;i.validate().submitted=e.extend(!0,i.validate().submitted,t.rupErrorFields),i.validate().invalid=t.rupErrorFields,i.validate().showErrors(t.rupErrorFields)}else if(errors.rupFeedback!==o){let i=e.rup_utils.printMsg(t.rupFeedback.message);c(f,r,i,"error")}}catch(e){c(f,r,i.responseText,"error")}else c(f,r,i.responseText,"error");e("#"+e.escapeSelector(f.sTableId)).triggerHandler("tableEditFormErrorCallSaveAjax",[f,t])},validate:g,feedback:p.rup_feedback({type:"error",block:!1})};if(""==E.data)delete E.data,e.rup_ajax(E);else if(m||f.oInit.formEdit.idForm.valid()){if(-1===d.indexOf("deleteAll")&&!0===f.oInit.formEdit.multipart){E.enctype="multipart/form-data",E.processData=!1,E.contentType=!1;let t=new FormData;e.each(E.data,(function(i,o){const r=f.oInit.formEdit.idForm.find('input[type="file"][name="'+i+'"]');0!=r.length&&r.prop("files").length>0?e.each(r.prop("files"),(function(e,o){t.append(i,o)})):t.append(i,o)})),E.data=t}"multipart/form-data"!=E.enctype&&(E.data=JSON.stringify(E.data)),f.oInit.formEdit.buttonsForm=e("#"+e.escapeSelector(f.sTableId)+"_detail_div").find("button:enabled"),e.each(f.oInit.formEdit.buttonsForm,(function(t,i){e(i).prop("disabled",!0)})),e.rup_ajax(E)}};f.oInit.formEdit.detailForm.settings.saveDialog&&!m?e.rup_messages("msgConfirm",{title:"POST"==t?f.oInit.formEdit.detailForm.settings.saveDialogMessages.titleOnAddAction:f.oInit.formEdit.detailForm.settings.saveDialogMessages.titleOnEditAction,message:"POST"==t?f.oInit.formEdit.detailForm.settings.saveDialogMessages.messageOnAddAction:f.oInit.formEdit.detailForm.settings.saveDialogMessages.messageOnEditAction,OKFunction:function(){p(),e("#"+e.escapeSelector(f.sTableId)).triggerHandler("tableMessageOk",f)},CANCELFunction:function(){e("#"+e.escapeSelector(f.sTableId)).triggerHandler("tableMessageCancel",f)},CLOSEFunction:function(){e("#"+e.escapeSelector(f.sTableId)).triggerHandler("tableMessageClose",f)}}):p()}function c(t,i,o,r){if(t.oInit.formEdit.disabledFeedback)return!1;e("#"+e.escapeSelector(t.sTableId)).triggerHandler("tableEditFormFeedbackShow",t),i.rup_feedback("set",o,r),i.rup_feedback("show")}function m(t,i){return e.each(t.find("[data-lista]"),(function(){let t=this.dataset.lista,r="",a=this.name.split(".");a!==o&&2===a.length&&(r=a[1]),i[t]!==o&&Array.isArray(i[t])||(i[t]=[]);let n={};if(r!==o){let a=this.dataset.clave;if(a!==o){var l=this.dataset.valor;n[a]=l,n[r]=e(this).is(":checked")}else n=e(this).is(":checked");i[t].push(n)}})),e.each(i,(function(t){this!==o&&"[object Object]"===this.toString()&&e.rup_utils.isNumeric(Object.keys(this)[0])&&(i[t]=Object.values(this))})),i}function f(t,o,r){var a=t.oInit.formEdit.$navigationBar[0].id;if(1===o||o===r){let o=i.activeElement;e(t.oInit.formEdit.detailForm).find(o).length>0&&o.blur()}1===o?e("#first_"+e.escapeSelector(a)+", #back_"+e.escapeSelector(a),t.oInit.formEdit.detailForm).prop("disabled",!0):e("#first_"+e.escapeSelector(a)+", #back_"+e.escapeSelector(a),t.oInit.formEdit.detailForm).prop("disabled",!1),o===r?e("#forward_"+e.escapeSelector(a)+", #last_"+e.escapeSelector(a),t.oInit.formEdit.detailForm).prop("disabled",!0):e("#forward_"+e.escapeSelector(a)+", #last_"+e.escapeSelector(a),t.oInit.formEdit.detailForm).prop("disabled",!1),e("#rup_table_selectedElements_"+e.escapeSelector(a)).text(e.rup_utils.format(jQuery.rup.i18nParse(jQuery.rup.i18n.base,"rup_table.defaults.detailForm_pager"),o,r))}function p(t,i){const o=t.settings()[0],r="prev"===i||"first"===i?"left":"right",a=e("#"+e.escapeSelector(o.sTableId)+"_detail_div .dialog-content-material");e("#"+e.escapeSelector(o.sTableId)+"_detail_div_loading").remove(),a.show("slide",{direction:r},100,(()=>{a.parent().css("overflow-x","auto")}))}function u(t,i){var r=t.settings()[0],a={id:0,page:1,line:0},n=r.multiselection.lastSelectedId;if(r.multiselection.selectedAll){if(r.oInit.formEdit!==o&&(r.oInit.formEdit.$navigationBar.numPosition=0),n===o||""===n)a.page=g(r,1,"next"),a.line=E(r,-1);else{var l=e.grep(r.multiselection.selectedRowsPerPage,(function(e){return e.id==r.multiselection.lastSelectedId}));a.page=l[0].page,a.line=l[0].line;var s=r._iDisplayLength*(Number(a.page)-1);s=s+1+a.line,l=e.grep(r.multiselection.deselectedRowsPerPage,(function(e){return Number(e.page)<Number(a.page)||Number(a.page)===Number(e.page)&&Number(e.line)<Number(a.line)})),a.indexSelected=s-l.length,r.oInit.formEdit!==o&&(r.oInit.formEdit.$navigationBar.numPosition=a.indexSelected-1)}r.oInit.formEdit!==o&&(r.oInit.formEdit.$navigationBar.currentPos=a)}else e.each(r.multiselection.selectedRowsPerPage,(function(e,t){if(t.id==r.multiselection.lastSelectedId)return a.id=t.id,a.page=t.page,a.line=t.line,a.indexSelected=e,r.oInit.formEdit!==o&&(r.oInit.formEdit.$navigationBar.currentPos=a),!1}));if(t.page()+1!==Number(a.page)){var d=t.page()+1;e("#"+e.escapeSelector(r.sTableId)).DataTable().page(a.page-1).draw("page"),r.oInit.formEdit!==o&&(r.oInit.formEdit.$navigationBar.funcionParams=[i,t,a.line,o,d])}return a}function g(t,i,o){var r=i,a=t.json.total;if("prev"===o&&(a=1),t.multiselection.deselectedRowsPerPage.length>0)for(var n=t.json.rows.length,l=0,s=i;s<a;)e.each(t.multiselection.deselectedRowsPerPage,(function(e,t){if(s===Number(t.page)&&l++,l===n)return!1})),l<n&&(r=s,s=t.json.total),l=0,"next"===o?s++:"prev"===o&&s--;return r}function I(t,i){var o=i,r=1;if(t.multiselection.deselectedRowsPerPage.length>0){var a=t.json.rows.length;t.json.total===o&&(a=t.json.records%t._iDisplayLength);for(var n=0,l=i;r<=l;)e.each(t.multiselection.deselectedRowsPerPage,(function(e,t){if(Number(l)===Number(t.page)&&n++,n===a)return!1})),n<a&&(o=l,r=t.json.total),n=0,l--}return o}function E(t,i){var a=-1,n=t.json.rows;return e.each(n,(function(e,n){if(e>i&&-1===jQuery.inArray(r.Api().rupTable.getIdPk(n,t.oInit),t.multiselection.deselectedIds)){a=e;var l={id:r.Api().rupTable.getIdPk(n,t.oInit),page:t.json.page,line:e};return t.oInit.formEdit!==o&&(t.oInit.formEdit.$navigationBar.currentPos=l),!1}})),a}function b(e,t){for(var i=-1,o=e.json.rows,a=o.length-1;a>=0;a--){var n=o[a];if(a<t&&-1===jQuery.inArray(r.Api().rupTable.getIdPk(n,e.oInit),e.multiselection.deselectedIds)){i=a;var l={id:r.Api().rupTable.getIdPk(n,e.oInit),page:e.json.page,line:a};e.oInit.formEdit.$navigationBar.currentPos=l,a=-1}}return i}function v(t){try{let i=!1,o=t.responsive._columnsVisiblity();for(let e=0;e<o.length;e++)o[e]||(!t.aoColumns[e].className||t.aoColumns[e].className.indexOf("never")<0)&&(i=!0);"td span.openResponsive"===t.responsive.c.details.target&&(e("#"+e.escapeSelector(t.sTableId)).find("tbody td:first-child span.openResponsive").remove(),i&&e.each(e("#"+e.escapeSelector(t.sTableId)).find("tbody td:first-child:not(.child):not(.dataTables_empty)"),(function(){var t=e("<span></span>");0===e(this).find("span.openResponsive").length?e(this).prepend(t.addClass("openResponsive")):t=e(this).find("span.openResponsive"),e(this).parent().next().hasClass("child")&&t.addClass("closeResponsive");var i=e(this).parent();t.click((function(e){i.hasClass("editable")&&i.find(".closeResponsive").length?e.stopPropagation():t.hasClass("closeResponsive")?t.removeClass("closeResponsive"):t.addClass("closeResponsive")}))}))),e("#"+e.escapeSelector(t.sTableId)).triggerHandler("tableEditFormAddChildIcons",t)}catch(e){}}r.editForm={},r.editForm.version="1.2.4",r.editForm.preConfigure=function(i){var n,l=i.settings()[0],s=l.oInit.multiSelect,d=r.defaults.multiSelect;s===o&&(s=d),l.oInit.formEdit.detailForm=e(l.oInit.formEdit.detailForm),l.oInit.formEdit.idForm=l.oInit.formEdit.detailForm.find("form").first(),l.oInit.formEdit.id=l.oInit.formEdit.detailForm[0].id.replace("_detail_div",""),l.oInit.formEdit.detailForm!==o&&e("body").find("[aria-describedby='"+l.oInit.formEdit.detailForm[0].id+"']").length>0&&e("body").find("[aria-describedby='"+l.oInit.formEdit.detailForm[0].id+"']").remove(),l.oInit.multiSelect===o?function(t){var i=t.settings()[0];i.oInit._ADAPTER=e.rup.adapter[jQuery.fn.rup_table.defaults.adapter],i.oInit.formEdit.$navigationBar=i.oInit.formEdit.detailForm.find("#"+i.sTableId+"_detail_navigation");var a={fncGetNavigationParams:function(a){var n=i.oInit.formEdit.$navigationBar.currentPos,l=t.page()+1,s=l,d=i.json.total,c=l;switch(a){case"first":c=1,i.multiselection.selectedRowsPerPage[0].line=0;break;case"prev":i.multiselection.selectedRowsPerPage[0].line=i.multiselection.selectedRowsPerPage[0].line-1,i.json.rows[i.multiselection.selectedRowsPerPage[0].line]===o&&(c-=1);break;case"next":i.multiselection.selectedRowsPerPage[0].line=i.multiselection.selectedRowsPerPage[0].line+1,i.json.rows[i.multiselection.selectedRowsPerPage[0].line]===o&&(c+=1);break;case"last":c=d,i.multiselection.selectedRowsPerPage[0].line=i.json.rows.length-1}if(Number(c)!==l){var m=e("#"+e.escapeSelector(i.sTableId)).DataTable();i.select.selectedRowsPerPage={},i.select.selectedRowsPerPage.cambio=a,i.select.selectedRowsPerPage.page=c,m.page(c-1).draw("page")}else{r.editForm.fnOpenSaveDialog("PUT",t,i.multiselection.selectedRowsPerPage[0].line,i.oInit.formEdit.customTitle);var f=i.json.rows[i.multiselection.selectedRowsPerPage[0].line];i.multiselection.selectedRowsPerPage[0].id=r.Api().rupTable.getIdPk(f,i.oInit),r.Api().select.selectRowIndex(t,i.multiselection.selectedRowsPerPage[0].line,!1)}let p=i.sTableId;return e("#first_"+e.escapeSelector(p)+"_detail_navigation, #back_"+e.escapeSelector(p)+"_detail_navigation, #forward_"+e.escapeSelector(p)+"_detail_navigation, #last_"+e.escapeSelector(p)+"_detail_navigation",i.oInit.formEdit.detailForm).prop("disabled",!0),[a,!1,!1,-1,n,s,-1]}};i.oInit.formEdit.$navigationBar.data("settings",a);var n=i.oInit._ADAPTER.createDetailNavigation.bind(i.oInit.formEdit.$navigationBar);i.oInit.formEdit.$navigationBar.append(n)}(i):function(t){var i=t.settings()[0];i.oInit._ADAPTER=e.rup.adapter[jQuery.fn.rup_table.defaults.adapter],i.oInit.formEdit.$navigationBar=i.oInit.formEdit.detailForm.find("#"+i.sTableId+"_detail_navigation");var o={fncGetNavigationParams:function(o){var a,n=i.oInit.formEdit.$navigationBar.currentPos,l=t.page()+1,s=l,d=i.json.total,c=i.multiselection;switch(o){case"first":c.selectedAll?(i.oInit.formEdit.$navigationBar.numPosition=0,(a=i.oInit.formEdit.$navigationBar.currentPos).page=g(i,1,"next"),Number(a.page)===l?a.line=E(i,-1):a.line=0):(a=c.selectedRowsPerPage[0]).indexSelected=0;break;case"prev":if(c.selectedAll)i.oInit.formEdit.$navigationBar.numPosition--,-1===b(i,i.oInit.formEdit.$navigationBar.currentPos.line)?(a=i.oInit.formEdit.$navigationBar.currentPos).page=I(i,l-1):a=i.oInit.formEdit.$navigationBar.currentPos;else{var m=i.oInit.formEdit.$navigationBar.currentPos.indexSelected-1;(a=c.selectedRowsPerPage[m]).indexSelected=m}break;case"next":if(c.selectedAll)i.oInit.formEdit.$navigationBar.numPosition++,-1===E(i,i.oInit.formEdit.$navigationBar.currentPos.line)?((a=i.oInit.formEdit.$navigationBar.currentPos).page=g(i,l+1,"next"),a.line=0):a=i.oInit.formEdit.$navigationBar.currentPos;else{var f=i.oInit.formEdit.$navigationBar.currentPos.indexSelected+1;(a=c.selectedRowsPerPage[f]).indexSelected=f}break;case"last":if(c.selectedAll)i.oInit.formEdit.$navigationBar.numPosition=i.multiselection.numSelected-1,(a=i.oInit.formEdit.$navigationBar.currentPos).page=I(i,d),Number(a.page)===l&&(a.line=b(i,i.aBaseJson.length));else{var u=c.selectedRowsPerPage.length-1;(a=c.selectedRowsPerPage[u]).indexSelected=u}}return function(t,i,o){const r=t.settings()[0],a="prev"===i||"first"===i?"right":"left",n=e("#"+e.escapeSelector(r.sTableId)+"_detail_div .dialog-content-material");n.parent().css("overflow-x","hidden"),n.hide("slide",{direction:a},100,(()=>{n.after('<span id="'+r.sTableId+'_detail_div_loading" class="d-flex font-size-5rem"><i class="mx-auto mdi mdi-spin mdi-loading" aria-hidden="true"></i></span>'),o()}))}(t,o,(function(){const n=i.sTableId;Number(a.page)!==l?(e("#"+e.escapeSelector(n)).DataTable().page(a.page-1).draw("page"),i.oInit.formEdit.$navigationBar.funcionParams=["PUT",t,a.line,o]):e.when(r.editForm.fnOpenSaveDialog("PUT",t,a.line,i.oInit.formEdit.customTitle)).then((function(){p(t,o)})),e("#first_"+e.escapeSelector(n)+"_detail_navigation, #back_"+e.escapeSelector(n)+"_detail_navigation, #forward_"+e.escapeSelector(n)+"_detail_navigation, #last_"+e.escapeSelector(n)+"_detail_navigation",i.oInit.formEdit.detailForm).prop("disabled",!0)})),i.oInit.formEdit.$navigationBar.currentPos=a,[o,!1,!1,-1,n,s,-1]}};i.oInit.formEdit.$navigationBar.data("settings",o);var a=i.oInit._ADAPTER.createDetailNavigation.bind(i.oInit.formEdit.$navigationBar);i.oInit.formEdit.$navigationBar.append(a)}(i),f(l,1,1),l.oInit.formEdit.buttoCancel=l.oInit.formEdit.detailForm.find("#"+l.sTableId+"_detail_button_cancel"),l.oInit.formEdit.buttoCancel.on("click",(function(){a(l),l.oInit.formEdit.detailForm.rup_dialog("close")}));var c=e(l.nTBody);if(l.oInit.multiSelect!==o||l.oInit.select!==o){var m=l.oInit.multiSelect;m===o&&(m=l.oInit.select),m.deleteDoubleClick||c.on("dblclick.DT keypress","tr:not(.dtrg-group)",(function(t){("keypress"==t.type&&13==t.which||"dblclick"===t.type)&&(n=this._DT_RowIndex,l.oInit.multiSelect!==o?i.row(n).multiSelect():(e("tr",c).removeClass("selected tr-highlight"),r.Api().select.selectRowIndex(i,n,!0)),u(i,"PUT"),r.editForm.fnOpenSaveDialog("PUT",i,n,l.oInit.formEdit.customTitle),e("#"+e.escapeSelector(l.sTableId)).triggerHandler("tableEditFormClickRow",l))}))}l.oInit.formEdit.loadSpinner="boolean"!=typeof l.oInit.formEdit.loadSpinner||l.oInit.formEdit.loadSpinner,l.oInit.formEdit.detailForm.settings={type:l.oInit.formEdit.type!==o?l.oInit.formEdit.type:e.rup.dialog.DIV,width:l.oInit.formEdit.width!==o?l.oInit.formEdit.width:569,saveDialog:l.oInit.formEdit.confirmDialogs===o||l.oInit.formEdit.confirmDialogs.saveDialog===o||l.oInit.formEdit.confirmDialogs.saveDialog,saveDialogMessages:{titleOnAddAction:l.oInit.formEdit.confirmDialogs?.saveDialogMessages?.titleOnAddAction?e.rup.i18nParse(e.rup.i18n.app,l.oInit.formEdit.confirmDialogs.saveDialogMessages.titleOnAddAction):e.rup.i18nParse(e.rup.i18n.base,"rup_table.add.save"),messageOnAddAction:l.oInit.formEdit.confirmDialogs?.saveDialogMessages?.messageOnAddAction?e.rup.i18nParse(e.rup.i18n.app,l.oInit.formEdit.confirmDialogs.saveDialogMessages.messageOnAddAction):e.rup.i18nParse(e.rup.i18n.base,"rup_table.add.saveData"),titleOnEditAction:l.oInit.formEdit.confirmDialogs?.saveDialogMessages?.titleOnEditAction?e.rup.i18nParse(e.rup.i18n.app,l.oInit.formEdit.confirmDialogs.saveDialogMessages.titleOnEditAction):e.rup.i18nParse(e.rup.i18n.base,"rup_table.edit.save"),messageOnEditAction:l.oInit.formEdit.confirmDialogs?.saveDialogMessages?.messageOnEditAction?e.rup.i18nParse(e.rup.i18n.app,l.oInit.formEdit.confirmDialogs.saveDialogMessages.messageOnEditAction):e.rup.i18nParse(e.rup.i18n.base,"rup_table.edit.saveData")},cancelDialog:l.oInit.formEdit.confirmDialogs===o||l.oInit.formEdit.confirmDialogs.cancelDialog===o||l.oInit.formEdit.confirmDialogs.cancelDialog,cancelDialogMessages:{title:l.oInit.formEdit.confirmDialogs?.cancelDialogMessages?.title?e.rup.i18nParse(e.rup.i18n.app,l.oInit.formEdit.confirmDialogs.cancelDialogMessages.title):e.rup.i18nParse(e.rup.i18n.base,"rup_table.changes"),message:l.oInit.formEdit.confirmDialogs?.cancelDialogMessages?.message?e.rup.i18nParse(e.rup.i18n.app,l.oInit.formEdit.confirmDialogs.cancelDialogMessages.message):e.rup.i18nParse(e.rup.i18n.base,"rup_table.saveAndContinue")},deleteDialog:l.oInit.formEdit.confirmDialogs===o||l.oInit.formEdit.confirmDialogs.deleteDialog===o||l.oInit.formEdit.confirmDialogs.deleteDialog,deleteDialogMessages:{title:l.oInit.formEdit.confirmDialogs?.deleteDialogMessages?.title?e.rup.i18nParse(e.rup.i18n.app,l.oInit.formEdit.confirmDialogs.deleteDialogMessages.title):e.rup.i18nParse(e.rup.i18n.base,"rup_table.delete"),message:l.oInit.formEdit.confirmDialogs?.deleteDialogMessages?.message?e.rup.i18nParse(e.rup.i18n.app,l.oInit.formEdit.confirmDialogs.deleteDialogMessages.message):e.rup.i18nParse(e.rup.i18n.base,"rup_table.deleteAll")}},e(t).on("resize.dtr",r.util.throttle((function(){v(l)})))},r.editForm.init=function(t){t.oInit.formEdit.detailForm.on("dialogbeforeclose",(function(i){i.originalEvent!==o&&(t.oInit.formEdit.okCallBack=!1);var r=t.oInit.formEdit.serializerSplitter?e.rup_utils.editFormSerialize(t.oInit.formEdit.idForm,t.oInit.formEdit.serializerSplitter):e.rup_utils.formDataToQueryString(t.oInit.formEdit.idForm,t.oInit.formEdit.formDataToQueryStringOptions);return t.oInit.formEdit.dataOrigin!==r&&t.oInit.formEdit.detailForm.settings.cancelDialog?(t.oInit.formEdit.dataOrigin===r||t.oInit.formEdit.okCallBack||e.rup_messages("msgConfirm",{title:t.oInit.formEdit.detailForm.settings.cancelDialogMessages.title,message:t.oInit.formEdit.detailForm.settings.cancelDialogMessages.message,OKFunction:function(){a(t),t.oInit.formEdit.okCallBack=!0,t.oInit.formEdit.detailForm.rup_dialog("close"),e("#"+e.escapeSelector(t.sTableId)).triggerHandler("tableMessageOk",t)},CANCELFunction:function(){t.oInit.formEdit.okCallBack=!1,e("#"+e.escapeSelector(t.sTableId)).triggerHandler("tableMessageCancel",t)},CLOSEFunction:function(){t.oInit.formEdit.okCallBack=!1,e("#"+e.escapeSelector(t.sTableId)).triggerHandler("tableMessageClose",t)}}),!(!t.oInit.formEdit.okCallBack||t.oInit.formEdit.okCallBack===o)&&void 0):(a(t),!0)}))},r.editForm.fnOpenSaveDialog=function(t,a,n,s){var u=a.settings()[0];let g;u.oInit.formEdit.loadSpinner&&0==e("#"+e.escapeSelector(u.sTableId)+"_detail_div_loading").length&&e("body").append('<div id="'+u.sTableId+'_formEdit_dialog_loading" class="formEdit_dialog_loading_container"><div></div><span><i class="mx-auto mdi mdi-spin mdi-loading" aria-hidden="true"></i></span></div>'),(null==n||n==o||n<0)&&(n=1),u.json!==o&&"POST"!==t&&(g=u.json.rows[n]),e.when(l(u,t,g)).then((function(){let l=e.Deferred();var I=u.oInit.formEdit.idForm,E=u.oInit.formEdit.detailForm.find("#"+u.sTableId+"_detail_feedback"),b=u.oInit.formEdit.detailForm.find("#"+E.prevObject[0].id);b.length>0&&b.hide(),I.find(".error").length>0&&I.rup_validate("resetElements");var S=u.oInit.formEdit.detailForm.find("#"+u.sTableId+"_detail_button_save"),P=u.oInit.formEdit.detailForm.find("#"+u.sTableId+"_detail_button_save_repeat");e("#"+e.escapeSelector(u.sTableId)).triggerHandler("tableEditFormAddEditBeforeInitData",u);let _=s!=(o&&null)?s:"";if("PUT"===(t=u.oInit.formEdit.actionType)){if(!u.oInit.formEdit.direct){var T=r.Api().rupTable.getIdPk(g,u.oInit),F=new RegExp("/","g");T=T.replace(F,"-");var h=new RegExp(u.oInit.multiplePkToken,"g");T=T.replace(h,"/");var k={url:u.oInit.urlBase+"/"+T,accepts:{"*":"*/*",html:"text/html",json:"application/json, text/javascript",script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript",text:"text/plain",xml:"application/xml, text/xml"},type:"GET",data:[],dataType:"json",showLoading:!1,contentType:"application/json",async:!1,success:function(e){g=e},error:function(t){var i=E;0===i.length&&(i=e("<div></div>").attr("id",E[0].id+"_ok").insertBefore(E)).rup_feedback(u.oInit.feedback),c(u,i,t.responseText,"error"),e("#"+e.escapeSelector(u.sTableId)).triggerHandler("tableEditFormErrorCallSaveAjaxGet",u)},complete:()=>{u.oInit.formEdit.$navigationBar.funcionParams&&u.oInit.formEdit.$navigationBar.funcionParams.length>=4&&p(a,u.oInit.formEdit.$navigationBar.funcionParams[3]),u.oInit.formEdit.$navigationBar.funcionParams={}}};u.oInit.formEdit.loadFromModel||(l=e.rup_ajax(k)),u.oInit.formEdit.noRefreshAfterEdit||(a.row(n).data(g),u.json.rows[n]=g),v(u),e("#"+e.escapeSelector(u.sTableId)+" > tbody > tr:not(.dtrg-group)").eq(n).find('td.select-checkbox input[type="checkbox"]').prop("checked",!0)}void 0!==g&&(e("#"+e.escapeSelector(u.sTableId)).triggerHandler("tableEditFormBeforePopulate",[u,I,g]),e.when(e.rup_utils.populateForm(e.fn.flattenObject(g,{safe:!0}),I)).then((function(){e("#"+e.escapeSelector(u.sTableId)).triggerHandler("tableEditFormAfterPopulate",[u,I,g])})));var D=u.multiselection,y=jQuery.inArray(r.Api().rupTable.getIdPk(g,u.oInit),D.selectedIds);u.multiselection.selectedAll&&(y=u.oInit.formEdit.$navigationBar.numPosition),y===o&&(y=0,u.oInit.formEdit.$navigationBar.numPosition=0);var A=D.numSelected;u.oInit.multiSelect===o&&(A=u.json.recordsTotal,y=(Number(u.json.page)-1)*u.aBaseJson.length,y+=n),e("#"+e.escapeSelector(u.sTableId)).triggerHandler("tableEditFormAfterFillData",u),u.oInit.formEdit.$navigationBar.funcionParams!=o&&u.oInit.formEdit.$navigationBar.funcionParams.length!=o||f(u,y+1,A),r.Api().rupTable.selectPencil(u,n),u.multiselection.lastSelectedId=r.Api().rupTable.getIdPk(g,u.oInit),u.oInit.formEdit.$navigationBar.show(),s==(o||null)&&(_=e.rup.i18nParse(e.rup.i18n.base,"rup_table.edit.editCaption")),r.Api().rupTable.blockPKEdit(u,t)}else"POST"===t&&(jQuery.each(e("select.rup_select",I),(function(e,t){jQuery(t).rup_select("setRupValue","")})),void 0!==g&&(e("#"+e.escapeSelector(u.sTableId)).triggerHandler("tableEditFormBeforePopulate",[u,I,g]),e.when(e.rup_utils.populateForm(e.fn.flattenObject(g,{safe:!0}),I)).then((function(){e("#"+e.escapeSelector(u.sTableId)).triggerHandler("tableEditFormAfterPopulate",[u,I,g])}))),u.oInit.formEdit.$navigationBar.hide(),s==(o||null)&&(_=e.rup.i18nParse(e.rup.i18n.base,"rup_table.edit.addCaption")),r.Api().rupTable.blockPKEdit(u,t));return e("#"+e.escapeSelector(u.sTableId)).triggerHandler("tableEditFormAddEditBeforeShowForm",u),u.oInit.formEdit.detailForm.rup_dialog(u.oInit.formEdit.detailForm.settings),u.oInit.formEdit.detailForm.rup_dialog("setOption","title",_),u.oInit.formEdit.detailForm.rup_dialog("open"),(w=u.oInit.colModel)!=o&&null!=w&&w.some((e=>"select"===e.rupType&&!0===e.editoptions?.multiple&&!0===e.editoptions?.autocomplete))&&e(i).off("focusin"),e("#"+e.escapeSelector(u.sTableId)+"_formEdit_dialog_loading").length>0&&e("#"+e.escapeSelector(u.sTableId)+"_formEdit_dialog_loading").remove(),e.each(e('select[ruptype="select"]',I),(function(t,o){e(this).rup_select("close",!0);const r=e("#"+e.escapeSelector(o.id)+" + span");r.hasClass("select2-container--focus")&&e(i.activeElement)!=e(o)&&r.removeClass("select2-container--focus")})),e(I).find("input,textarea,select").filter(":not([readonly],[type=hidden])").first().focus(),u.oInit.formEdit.serializerSplitter?u.oInit.formEdit.dataOrigin=e.rup_utils.editFormSerialize(I,u.oInit.formEdit.serializerSplitter):u.oInit.formEdit.dataOrigin=e.rup_utils.formDataToQueryString(I,u.oInit.formEdit.formDataToQueryStringOptions),u.oInit.formEdit.okCallBack=!1,S.off("click"),S.on("click",(function(){if("PUT"===t){let e=u.oInit.validarModificar;if("function"==typeof e&&e(u))return!1}else if("POST"===t){let e=u.oInit.validarAlta;if("function"==typeof e&&e(u))return!1}g=u.oInit.formEdit.serializerSplitter?e.rup_utils.editFormSerialize(I,u.oInit.formEdit.serializerSplitter):e.rup_utils.formDataToQueryString(I,u.oInit.formEdit.formDataToQueryStringOptions),g=u.oInit.formEdit.serializerSplitter||u.oInit.formEdit.allowAllCharacters?e.rup_utils.queryStringToJson(g,u.oInit.formEdit.serializerSplitter,u.oInit.formEdit.allowAllCharacters):e.rup_utils.queryStringToObject(g,u.oInit.formEdit.queryStringToObjectOptions,e(I)),g=m(I,g),"PUT"===t&&e.each(u.oInit.primaryKey,(function(e,t){g[t]=u.json.rows[n][t]}));let i=u.oInit.formEdit.detailForm;if(g){let e="POST"==t?"/add":"/edit";const o=e.substring(1)+"Url";u.oInit.formEdit[o]&&(e=u.oInit.formEdit[o]),d(t,a,g,n,!1,i,e,!1)}else{u.oInit.formEdit.okCallBack=!1;let t=i.find("#"+u.sTableId+"_detail_feedback"),o=t;0===o.length&&(o=e("<div></div>").attr("id",t[0].id+"_ok").insertBefore(t),o.rup_feedback(u.oInit.feedback)),c(u,o,e.rup.i18nParse(e.rup.i18n.base,"rup_global.charError"),"error"),e("#"+e.escapeSelector(u.sTableId)).triggerHandler("tableEditFormErrorCallSaveAjaxNotRow",u)}e("#"+e.escapeSelector(u.sTableId)).triggerHandler("tableButtonSave",u)})),u.oInit.formEdit.detailForm.buttonSaveContinue=P,u.oInit.formEdit.detailForm.buttonSaveContinue.actionType=t,P.off("click"),P.on("click",(function(){if("PUT"===t){let e=u.oInit.validarModificarContinuar;if("function"==typeof e&&e(u))return!1}else if("POST"===t){let e=u.oInit.validarAltaContinuar;if("function"==typeof e&&e(u))return!1}var i=u.oInit.formEdit.detailForm.buttonSaveContinue.actionType;g=u.oInit.formEdit.serializerSplitter?e.rup_utils.editFormSerialize(I,u.oInit.formEdit.serializerSplitter):e.rup_utils.formDataToQueryString(I,u.oInit.formEdit.formDataToQueryStringOptions),g=u.oInit.formEdit.serializerSplitter||u.oInit.formEdit.allowAllCharacters?e.rup_utils.queryStringToJson(g,u.oInit.formEdit.serializerSplitter,u.oInit.formEdit.allowAllCharacters):e.rup_utils.queryStringToObject(g,u.oInit.formEdit.queryStringToObjectOptions),g=m(I,g),"PUT"===t&&e.each(u.oInit.primaryKey,(function(e,t){g[t]=u.json.rows[n][t]}));let o=u.oInit.formEdit.detailForm;if(g){let e="POST"==t?"/add":"/edit";const r=e.substring(1)+"Url";u.oInit.formEdit[r]&&(e=u.oInit.formEdit[r]),d(i,a,g,n,!0,o,e,!1)}else{u.oInit.formEdit.okCallBack=!1;let t=o.find("#"+u.sTableId+"_detail_feedback"),i=t;0===i.length&&(i=e("<div></div>").attr("id",t[0].id+"_ok").insertBefore(t),i.rup_feedback(u.oInit.feedback)),c(u,i,e.rup.i18nParse(e.rup.i18n.base,"rup_global.charError"),"error"),e("#"+e.escapeSelector(u.sTableId)).triggerHandler("tableEditFormErrorCallSaveAjaxNotRow",u)}e("#"+e.escapeSelector(u.sTableId)).triggerHandler("tableButtonSaveContinue",u)})),e("#"+e.escapeSelector(u.sTableId)).triggerHandler("tableEditFormAddEditAfterShowForm",u),l;var w}))};var S=r.Api.register;return S("editForm.openSaveDialog()",(function(e,t,i,o){r.editForm.fnOpenSaveDialog(e,t,i,o)})),S("editForm.updateDetailPagination()",(function(e,t,i){f(e,t,i)})),S("editForm.loadSaveDialogForm()",(function(e,t,i){return l(e,t,i)})),S("editForm.getRowSelected()",(function(e,t){return u(e,t)})),S("editForm.deleteAllSelects()",(function(i){return function(i){var o=i.settings()[0];let r=new RegExp(o.oInit.multiplePkToken,"g"),a=o.multiselection.selectedIds.length>1?"POST":"DELETE",n=function(){let e={};e.filter=t.form2object(o.oInit.filter.$filterContainer[0]),o.multiselection.selectedIds.length>1?(e.core={pkToken:o.oInit.multiplePkToken,pkNames:o.oInit.primaryKey},e.multiselection={},e.multiselection.selectedAll=o.multiselection.selectedAll,e.multiselection.selectedAll?e.multiselection.selectedIds=o.multiselection.deselectedIds:e.multiselection.selectedIds=o.multiselection.selectedIds,d(a,i,e,0,!1,o.oInit.formEdit.detailForm,"/deleteAll",!0)):(e=o.multiselection.selectedIds[0],e=e.replace(r,"/"),d(a,i,"",0,!1,o.oInit.formEdit.detailForm,"/"+e,!0))};o.oInit.formEdit.detailForm.settings.deleteDialog?e.rup_messages("msgConfirm",{title:o.oInit.formEdit.detailForm.settings.deleteDialogMessages.title,message:o.oInit.formEdit.detailForm.settings.deleteDialogMessages.message,OKFunction:function(){n(),e("#"+e.escapeSelector(o.sTableId)).triggerHandler("tableMessageOk",o)},CANCELFunction:o.oInit.formEdit.cancelDeleteFunction}):n()}(i)})),S("editForm.getLineByPageSelected()",(function(e,t){return E(e,t)})),S("editForm.getLineByPageSelectedReverse()",(function(e,t){return b(e,t)})),S("editForm.addchildIcons()",(function(e){v(e)})),e(i).on("plugin-init.dt",(function(t,i){"dt"===t.namespace&&(i.oInit.noEdit||i.oInit.formEdit===o||!1===i.oInit.formEdit.activate||(r.editForm.preConfigure(new r.Api(i)),e("#"+e.escapeSelector(i.sTableId)).on("tableEditFormInitialize",(function(t,i){let a=e.Deferred();return r.editForm.init(i),e(i.oInit.formEdit.detailForm).rup_dialog(e.extend({},{type:e.rup.dialog.DIV,autoOpen:!1,modal:!0,resizable:"",width:i.oInit.formEdit.detailForm.settings.width,create:function(){e("#"+e.escapeSelector(i.sTableId)+"_detail_div.rup-table-formEdit-detail").removeClass("d-none")}},i.oInit.formEdit.detailForm.customDialog)),i.oInit.formEdit.cancelDeleteFunction===o&&(i.oInit.formEdit.cancelDeleteFunction=function(){}),a.resolve(),a.promise()}))))})),r.editForm}));