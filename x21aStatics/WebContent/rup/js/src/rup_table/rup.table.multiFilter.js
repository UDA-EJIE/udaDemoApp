/*! For license information please see rup.table.multiFilter.js.LICENSE.txt */
!function(e){"function"==typeof define&&define.amd?define(["jquery","datatables.net"],(function(t){return e(t,window,document)})):"object"==typeof exports?module.exports=function(t,l){return t||(t=window),l&&l.fn.dataTable||(l=require("datatables.net")(t,l).$),e(l,0,t.document)}:e(jQuery,window,document)}((function(e,t,l,r){"use strict";var i=e.fn.dataTable;function a(t){var l,r=t.oInit,i=form2object(r.filter.$filterContainer[0]),a={selector:t.sTableId,text:r.multiFilter.$selectLabel.val(),active:r.multiFilter.$defaultCheck.is(":checked")};e.each(e("[ruptype='date']",r.filter.$filterContainer),(function(t,r){null!=(l=e(r).datepicker("getDate"))&&(i[r.name]=l.getTime().toString())})),a.data=e.toJSON(i);var u=JSON.parse(a.data),o=""+Object.keys(u).map((function(e){return e+":"+u[e]})).join(", ");return a.data=o,null!=r.multiFilter.userFilter?a.user=r.multiFilter.userFilter:a.user=LOGGED_USER,a}function u(t){var l=t.oInit;return""===l.multiFilter.$selectLabel.val().trim()?(l.multiFilter.$feedback.rup_feedback("set",e.rup.i18n.base.rup_table.plugins.multifilter.emptyName,"error"),!1):!(l.multiFilter.$selectLabel.val().length>l.multiFilter.labelSize&&(l.multiFilter.$feedback.rup_feedback("set",e.rup.i18n.base.rup_table.plugins.multifilter.tooLong,"error"),1))}function o(t,l){var i=l.oInit;e("#"+e.escapeSelector(l.sTableId)).triggerHandler("tableMultiFilterFillForm",l),e("[ruptype='date']",i.filter.$filterContainer).each((function(l,i){var a,u=jQuery(i),o=t[i.name];if(o!==r&&-1==o.search("/")){var n=new Date(parseInt(o)),s=u.data("datepicker").settings.dateFormat;if(u.data("datepicker").settings.datetimepicker){var c={hour:n.getHours(),minute:n.getMinutes(),second:n.getSeconds()};a=e.datepicker.formatDate(s,n)+" "+e.timepicker._formatTime(c,"hh:mm:ss")}else a=e.datepicker.formatDate(s,n);t[i.name]=a}}));var a=e.rup_utils.jsontoarray(t);e.rup_utils.populateForm(a,e("#"+e.escapeSelector(l.sTableId)+"_filter_form"))}function n(t){var l=t.oInit;l.filter.$filterContainer.resetForm(),l.filter.$filterSummary.html(" <i></i>"),jQuery("input,textarea",l.filter.$filterContainer).val(""),jQuery(".ui-selectmenu-status",".rup-table-filter-fieldset").text("--"),e.rup_utils.populateForm([],l.filter.$filterContainer)}function s(t){var l=t.oInit,i=l.multiFilter.$selectLabel.val(),a=l.multiFilter.$selectLabel.data("tmp.data");if(e.isEmptyObject(a)){var u=l.multiFilter.idFilter,o=l.multiFilter.userFilter;e.rup_ajax({url:l.urlBase+l.multiFilter.url+"/getAll?selector="+u+"&user="+o,type:"GET",async:!1,success:function(e){a=e}})}var n=e.grep(a,(function(e,t){if(e.text===i)return e}));if(0!==n.length){l.multiFilter.$defaultCheck.attr("checked",n[0].data);var s=n[0].data?JSON.parse(n[0].data):{}}return s===r&&l.multiFilter.$savedText!==r&&l.multiFilter.$savedText===i&&(s=JSON.parse(l.multiFilter.$savedValue)),s}i.multiFilter={},i.multiFilter.version="1.2.4",i.multiFilter.init=function(t){var l=t.settings()[0],i=l.oInit;i.multiFilter!=r&&i.multiFilter.url==r&&(i.multiFilter.url="/multiFilter"),i.multiFilter.$dropdownDialog=e("#"+e.escapeSelector(l.sTableId)+"_multifilter_dropdownDialog"),i.multiFilter.dropdownDialogId=l.sTableId+"_multifilter_dropdownDialog",e.when(function(t){let l={tableID:t.sTableId,containerClass:e.rup.adapter[e.fn.rup_table.defaults.adapter].multifilter.classes.container,labelClass:e.rup.adapter[e.fn.rup_table.defaults.adapter].multifilter.classes.label,defaultContainerClass:e.rup.adapter[e.fn.rup_table.defaults.adapter].multifilter.classes.activeFilter.container,defaultCheckboxClass:e.rup.adapter[e.fn.rup_table.defaults.adapter].multifilter.classes.activeFilter.checkBox},i=t.oInit.multiFilter.data!==r?e.extend({},l,t.oInit.multiFilter.data):l;return e.post(t.oInit.multiFilter.formURL!==r?t.oInit.multiFilter.formURL:t.oInit.urlBase+t.oInit.multiFilter.url,i,(function(l){t.oInit.filter.$filterContainer.after(l),t.oInit.multiFilter.$dropdownDialogForm=e("#"+e.escapeSelector(e(l).find("form").attr("id")))}),"html")}(l)).then((function(){e("#"+e.escapeSelector(l.sTableId)).triggerHandler("tableMultiFilterBeforeConfigureMultifilter",l),function(t){var l,r,i=t.oInit;i.multiFilter.$filterForm=e("#"+e.escapeSelector(i.sTableId)+"_filter_form"),l=null!=i.multiFilter.idFilter?i.multiFilter.idFilter:t.sTableId,r=null!=i.multiFilter.userFilter?i.multiFilter.userFilter:LOGGED_USER,null==i.multiFilter.getDefault||i.multiFilter.getDefault,i.multiFilter.sourceParam={text:"text",id:"id",data:"data",category:"filter"},global.initTableMultiFilter.then((()=>{e("#"+e.escapeSelector(t.sTableId)+"_multifilter_select").rup_select({url:i.urlBase+i.multiFilter.url+"/getAll?selector="+l+"&user="+r,sourceParam:i.multiFilter.sourceParam,contains:!1,allowClear:!0,autocomplete:!0,combo:!0,selected:t.oInit.multiFilter.defaultId,placeholder:e.rup.i18n.base.rup_table.plugins.multifilter.input,onLoadSuccess:function(){i.multiFilter.$selectLabel=e("#"+e.escapeSelector(t.sTableId)+"_multifilter_select + span input.border-0")},select:function(){i.multiFilter.defaultId!=e("#"+e.escapeSelector(t.sTableId)+"_multifilter_select").rup_select("getRupValue")?e("#"+e.escapeSelector(t.sTableId)+"_multifilter_activeFilter").prop("checked",!1):e("#"+e.escapeSelector(t.sTableId)+"_multifilter_activeFilter").prop("checked",!0),i.multiFilter.$selectLabel=e("#"+e.escapeSelector(t.sTableId)+"_multifilter_select + span input.border-0");var l=s(t);e("#"+e.escapeSelector(t.sTableId)).triggerHandler("tableMultiFilterBeforeCleanFilterForm",t),n(t),e("#"+e.escapeSelector(t.sTableId)).triggerHandler("tableMultiFilterAfterCleanFilterForm",t),o(l,t)}}),e("#"+e.escapeSelector(t.sTableId)+"_multifilter_select").on("selectAjaxSuccess",(function(){i.multiFilter.defaultId==e("#"+e.escapeSelector(t.sTableId)+"_multifilter_select").rup_select("getRupValue")&&e("#"+e.escapeSelector(t.sTableId)+"_multifilter_activeFilter").prop("checked",!0),e(this).off("selectAjaxSuccess")})),e("#"+e.escapeSelector(t.sTableId)+"_filter_cleanButton").on("click",(function(){i.multiFilter.$select.rup_select("setRupValue",""),i.filter.$filterSummary.html("<i></i>")}))})),e(".jstree").on("rup_filter_treeLoaded",(function(t,l){e(this).rup_tree("setRupValue",l)}))}(l),e("#"+e.escapeSelector(l.sTableId)).triggerHandler("tableMultiFilterAfterConfigureMultifilter",l),i.multiFilter.getName=function(e){return""!==i.multiFilter.$selectLabel.val()&&i.multiFilter.$filterWithName&&(i.multiFilter.$filterWithName=!1,e=i.multiFilter.$selectLabel.val()+"  {"+e+"}   "),e};var t=e.rup.adapter[jQuery.fn.rup_table.defaults.adapter].multifilter.dropdown;e("#"+e.escapeSelector(l.sTableId)+"_filter_filterButton").rup_button({dropdown:{dropdownIcon:t.dropdownIcon,dropdownDialog:i.multiFilter.dropdownDialogId,dropdownDialogConfig:{title:t.dropdownDialogConfig.title+e.rup.i18n.base.rup_table.plugins.multifilter.tittle,width:"450px",buttons:[{id:l.sTableId+"_multifilter_BtnSave",text:e.rup.i18n.base.rup_table.plugins.multifilter.save,click:function(){if(u(l)){i.multiFilter.$dropdownDialogForm=e("#"+e.escapeSelector(l.sTableId)+"_add_multiFilter_form");var t=a(l),o=function(e){var t=e.oInit;return t.multiFilter!==r&&t.$firstStartUp?null:t.filter.$filterContainer.valid()}(l);if(!1===o||"stop"===o)return void i.multiFilter.$feedback.rup_feedback("set",e.rup.i18n.base.rup_table.plugins.multifilter.errorValidate,"error");e("#"+e.escapeSelector(l.sTableId)).triggerHandler("tableMultiFilterBeforeAddFilter",l),function(t,l){var r=l.oInit;null!=r.multiFilter.idFilter&&(t.selector=r.multiFilter.idFilter),e.rup_ajax({url:r.urlBase+r.multiFilter.url+"/add",type:"POST",data:e.toJSON(t),dataType:"json",showLoading:!1,contentType:"application/json",async:!1,beforeSend:function(t,r){return e("#"+e.escapeSelector(l.sTableId)).triggerHandler("rupTable_multifilter_beforeAdd",[t,r])},success:function(t,i,a){r.multiFilter.$savedText=t.text,r.multiFilter.$savedValue=t.data,r.multiFilter.$feedback.rup_feedback("set",e.rup.i18n.base.rup_table.plugins.multifilter.ok,"ok"),r.multiFilter.$selectLabel.data("tmp.loadObjects.term",null),r.multiFilter.$selectLabel.data("loadObjects",{}),r.multiFilter.$selectLabel.data("tmp.data",{}),r.multiFilter.$select.rup_select("reload"),t.active&&(t.id?l.oInit.multiFilter.defaultId=String(t.id):function(t){e.rup_ajax({url:t.oInit.urlBase+t.oInit.multiFilter.url+"/getDefault?selector="+t.oInit.multiFilter.idFilter+"&user="+t.oInit.multiFilter.userFilter,type:"GET",dataType:"json",showLoading:!1,contentType:"application/json",complete:function(e){t.oInit.multiFilter.defaultId=e.responseJSON?.id?e.responseJSON.id:""}})}(l)),e("#"+e.escapeSelector(l.sTableId)).triggerHandler("tableMultiFilterSuccessAddFilter",l)},complete:function(){e("#"+e.escapeSelector(l.sTableId)).triggerHandler("tableMultiFilterCompleteAddFilter",l)},error:function(t,i,a){r.multiFilter.$feedback.rup_feedback("set",e.rup.i18n.base.rup_table.plugins.multifilter.error,"error"),e("#"+e.escapeSelector(l.sTableId)).triggerHandler("tableMultiFilterErrorAddFilter",l)}})}(t,l),e("#"+e.escapeSelector(l.sTableId)).triggerHandler("tableMultiFilterAfterAddFilter",l)}}},{id:l.sTableId+"_multifilter_BtnApply",text:e.rup.i18n.base.rup_table.plugins.multifilter.apply,click:function(){if(i.$firstStartUp&&(i.$firstStartUp=!1),u(l)){i.multiFilter.$filterWithName=!0;var t=s(l);t!==r?(e("#"+e.escapeSelector(l.sTableId)).triggerHandler("tableMultiFilterBeforeCleanFilterForm",l),n(l),e("#"+e.escapeSelector(l.sTableId)).triggerHandler("tableMultiFilterAfterCleanFilterForm",l),o(t,l),e("#"+e.escapeSelector(l.sTableId)+"_filter_filterButton").click(),i.multiFilter.$closeDialog.click()):i.multiFilter.$feedback.rup_feedback("set",e.rup.i18n.base.rup_table.plugins.multifilter.errorNoexiste,"error")}}},{id:l.sTableId+"_multifilter_BtnRemove",text:e.rup.i18n.base.rup_table.plugins.multifilter.remove,click:function(){if(u(l)){i.multiFilter.$dropdownDialogForm=e("#"+e.escapeSelector(l.sTableId)+"_delete_multiFilter_form");var t=a(l);e("#"+e.escapeSelector(l.sTableId)).triggerHandler("tableMultiFilterBeforeDeleteFilter",l),function(t,l){var i=l.oInit;i.multiFilter.$savedText=r,i.multiFilter.$savedValue=r,null!=i.multiFilter.idFilter&&(t.selector=i.multiFilter.idFilter),e.rup_ajax({url:i.urlBase+i.multiFilter.url+"/delete",type:"DELETE",data:e.toJSON(t),dataType:"json",showLoading:!1,contentType:"application/json",async:!1,success:function(t,r,a){i.multiFilter.$feedback.rup_feedback("set",e.rup.i18n.base.rup_table.plugins.multifilter.ok,"ok"),i.multiFilter.$selectLabel.data("tmp.loadObjects.term",null),i.multiFilter.$selectLabel.data("loadObjects",{}),i.multiFilter.$selectLabel.data("tmp.data",{}),i.multiFilter.$select.rup_select("setRupValue",""),"no_records"==t.feedback&&i.multiFilter.$feedback.rup_feedback("set",e.rup.i18n.base.rup_table.plugins.multifilter.noRecords,"error"),t.active&&(l.oInit.multiFilter.defaultId=""),e("#"+e.escapeSelector(l.sTableId)).triggerHandler("tableMultiFilterSuccessDeleteFilter",l)},complete:function(){e("#"+e.escapeSelector(l.sTableId)).triggerHandler("tableMultiFilterCompleteDeleteFilter",l)},error:function(t,r,a){i.multiFilter.$feedback.rup_feedback("set",e.rup.i18n.base.rup_table.plugins.multifilter.error,"error"),e("#"+e.escapeSelector(l.sTableId)).triggerHandler("tableMultiFilterErrorDeleteFilter",l)}})}(t,l),e("#"+e.escapeSelector(l.sTableId)).triggerHandler("tableMultiFilterAfterDeleteFilter",l)}}},{text:e.rup.i18n.base.rup_table.plugins.multifilter.cancel,click:function(){var e=i.multiFilter.filtroAnterior;null!==e&&o(e,l),i.multiFilter.$selectLabel.val(""),i.multiFilter.$closeDialog.click()},btnType:e.rup.dialog.LINK}]}}}),i.multiFilter.$dropdownButton=e("#"+e.escapeSelector(l.sTableId)+"_filter_filterButton_dropdown"),i.multiFilter.$select=e("#"+e.escapeSelector(l.sTableId)+"_multifilter_select"),i.multiFilter.$selectLabel=e("#"+e.escapeSelector(l.sTableId)+"_multifilter_combo_label"),i.multiFilter.$defaultCheck=e("#"+e.escapeSelector(l.sTableId)+"_multifilter_activeFilter"),i.multiFilter.$feedback=e("#"+e.escapeSelector(l.sTableId)+"_multifilter_dropdownDialog_feedback"),i.multiFilter.$closeDialog=e("#"+e.escapeSelector(l.sTableId)+"_multifilter_dropdownDialog_close"),e("#"+e.escapeSelector(i.multiFilter.dropdownDialogId)).rup_dialog("setOption","modal",!0),e("#"+e.escapeSelector(i.multiFilter.dropdownDialogId)).rup_dialog("setOption","draggable",!1),e("#"+e.escapeSelector(i.multiFilter.dropdownDialogId)).rup_dialog("setOption","resizable",!1),e("#"+e.escapeSelector(i.multiFilter.dropdownDialogId)).parent().css("width","500px"),i.multiFilter.$dropdownButton.on("click",(function(){var e=form2object(i.filter.$filterContainer[0]);i.multiFilter.filtroAnterior=e})),i.multiFilter.$feedback.rup_feedback({block:!1,delay:2e3});var c=form2object(i.filter.$filterContainer[0]);i.multiFilter.filtroAnterior=c}))};var c=i.Api.register;return c("multiFilter()",(function(){return this.iterator("table",(function(e){i.multiFilter.init(new i.Api(e))}))})),c("multiFilter.fillForm()",(function(e,t){return o(e,t)})),e(l).on("preInit.dt.dtSelect",(function(e,t){"dt"===e.namespace&&t.oInit.multiFilter!==r&&!1!==t.oInit.multiFilter.activate&&i.multiFilter.init(new i.Api(t))})),i.multiFilter}));