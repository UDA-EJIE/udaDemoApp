/*! For license information please see rup.list.js.LICENSE.txt */
import Printd from"printd";!function(e){"function"==typeof define&&define.amd?define(["jquery","rup.base","rup.button","rup.dialog"],e):e(jQuery)}((function(e){e.widget("$.rup_list",{isFiltering:e.Deferred(),options:{filterForm:null,action:null,feedback:null,key:null,colNames:{source:[],value:null},rowNum:{source:[{value:"5",i18nCaption:e.rup.i18nTemplate(e.rup.i18n.base,"rup_list.rowPerPage.5")},{value:"10",i18nCaption:e.rup.i18nTemplate(e.rup.i18n.base,"rup_list.rowPerPage.10")},{value:"20",i18nCaption:e.rup.i18nTemplate(e.rup.i18n.base,"rup_list.rowPerPage.20")},{value:"30",i18nCaption:e.rup.i18nTemplate(e.rup.i18n.base,"rup_list.rowPerPage.30")}],value:"5"},page:1,sidx:{source:[],value:null},sord:"asc",visiblePages:5,createFooter:!0,loader:()=>{},modElement:()=>{},beforeLoad:function(){},load:function(){}},_changeOption:function(e,t){var l=this.options;switch(e){case"rowNum":l.rowNum.value=t,l.page=1,this.reload();break;case"page":l.page=t,this.reload();break;case"sidx":l.sidx.value=t,l.page=1,this.reload();break;case"sord":l.sord=t,l.page=1,this.reload()}},_validateSkeleton:function(){var t=this.element.attr("id");return this.options.selectable&&this.options.selectable.multi?e("#"+e.escapeSelector(t)+"-header-selectables").length:e("#"+e.escapeSelector(t)+"-content").length&&e("#"+e.escapeSelector(t)+"-header").length&&e("select").filter((function(){return this.id==t+"-header-rowNum"})).length&&e("select").filter((function(){return this.id==t+"-header-sidx"})).length&&e("button, a").filter((function(){return this.id==t+"-header-sord"})).length&&e("nav, div").filter((function(){return this.id==t+"-header-nav"})).length&&e("#"+e.escapeSelector(t)+"-itemTemplate").length},_create:function(){global.initRupI18nPromise.then((()=>{const t=this,l=t.element.attr("id");if(!t._validateSkeleton())return e.rup_messages("msgAlert",{title:e.rup.i18n.base.rup_list.errors.validateSkeletonDialog.title,message:e.rup.i18n.base.rup_list.errors.validateSkeletonDialog.msg}),void console.error(e.rup.i18n.base.rup_list.errors.validateSkeletonDialog.msg);var i=t.options;e(t.element).addClass("rup_list"),e(t.element).attr("role","listbox"),e(t.element).attr("aria-live","polite"),i.selectable&&i.selectable.multi?e(t.element).attr("aria-multiselectable","true"):e(t.element).attr("aria-multiselectable","false"),i.visiblePages=i.visiblePages<3?3:i.visiblePages,i._idContent=l+"-content",i._content=e("#"+e.escapeSelector(i._idContent)),i._content.addClass("rup_list-content"),i._content.hide(),t._loader.apply(t),i.feedback=e("#"+e.escapeSelector(i.feedback)).rup_feedback({gotoTop:!1}),i.feedback.addClass("rup_list-feedback"),i._idItemTemplate=l+"-itemTemplate",i._itemTemplate=e("#"+e.escapeSelector(i._idItemTemplate)),i._itemTemplate.addClass("rup_list-itemTemplate"),i._itemTemplate.hide(),i._itemTemplate.attr("aria-hidden","true");var r=t=>{let r=t?"_idListFooter":"_idListHeader",a=t?"_footer":"_header",s=t?"-footer":"-header";i[r]={},i[r].multiSort={},i[r].header=l+s,i[r].pagenav=l+s+"-nav",i[r].pagePrev=l+s+"-page-prev",i[r].pageNext=l+s+"-page-next",i[r].pagenav=l+s+"-nav",i[r].rowNum=l+s+"-rowNum",i[r].sidx=l+s+"-sidx",i[r].sord=l+s+"-sord",i[r].selectables=l+s+"-selectables",i[a]={},i[a].obj=e("#"+e.escapeSelector(i[r].header)),i[a].multiSort={},i[a].pagenav=e("#"+e.escapeSelector(i[r].pagenav)),i[a].pagePrev=e("#"+e.escapeSelector(i[r].pagePrev)),i[a].pageNext=e("#"+e.escapeSelector(i[r].pageNext)),i[a].rowNum=e("#"+e.escapeSelector(i[r].rowNum)),i[a].sidx=e("#"+e.escapeSelector(i[r].sidx)),i[a].sord=e("#"+e.escapeSelector(i[r].sord)),i[a].selectables=e("#"+e.escapeSelector(i[r].selectables)),i[a].obj.addClass("rup_list"+s),i[a].pagenav.addClass("rup_list"+s+"-nav"),i[a].pagePrev.addClass("rup_list"+s+"-page-prev"),i[a].pageNext.addClass("rup_list"+s+"-page-next"),i[a].rowNum.addClass("rup_list"+s+"-rowNum"),i[a].sidx.addClass("rup_list"+s+"-sidx"),i[a].sord.addClass("rup_list"+s+"-sord"),i[a].selectables.addClass("rup_list"+s+"-selectables")};if(r(),i.createFooter){var a=e("<div>").append(i._header.obj.clone()).html().replace(/header/g,"footer");e("#"+e.escapeSelector(l)).after(a)}r(!0),i._idMultiSortDialog=l+"-mord-dialog",t._rownumInit.apply(t),i.isMultiSort?t._multisortInit.apply(t):(t._sidxSelectInit.apply(t),t._sordButtonInit(t)),e("#"+e.escapeSelector(t.element[0].id)).on("beforeLoad",i.beforeLoad),e("#"+e.escapeSelector(t.element[0].id)).on("load",i.load),e("#"+e.escapeSelector(t.element[0].id)).on("modElement",((e,l,r)=>{i.modElement(e,l,r),t.element.append(l)})),t._pagenavInit.apply(t),i.selectable?(i._header.selectables.show(),i.createFooter&&i._footer.selectables.show(),t._selectablesInit.apply(t)):(i._header.selectables.hide(),i.createFooter&&i._footer.selectables.hide()),i.isScrollList&&t._scrollListInit.apply(t),i.print&&t._print.apply(t),i.isMultiFilter&&t._multiFilter.apply(t),t.isFiltering.resolve(),i.isMultisort?e("#"+e.escapeSelector(t.element[0].id)).on("rup_list-mord-inited",(()=>{e("#"+e.escapeSelector(t.element[0].id)).trigger("initComplete")})):e("#"+e.escapeSelector(t.element[0].id)).trigger("initComplete")})).catch((e=>{console.error("Error al inicializar el componente:\n",e)}))},_selectablesInit:function(){var t=this,l=t.options;e("#"+e.escapeSelector(t.element[0].id)+"-content").find(l.selectable.selector).attr("rup-list-selector","enabled"),l.multiselection={selectedIds:null,selectedAll:!1,selectedRowsPerPage:null},l.selectable.multi&&t._generateSelectablesBtnGroup();var i,r=!1,a=!1;l.isSuperSelect&&(e(document).on("keydown",(e=>{"17"==e.key?r=!0:"16"==e.key&&(a=!0)})),e(document).on("keyup",(e=>{"17"==e.key?r=!1:"16"==e.key&&(a=!1)}))),l._content.find(l.selectable.selector).on("click keyup",(t=>{const p=e(t.currentTarget);if("click"===t.type||"keyup"===t.type&&("13"==t.key||"32"==t.key)){let e=p.data("pk");if(null==l.multiselection.selectedIds&&(l.multiselection.selectedIds=[]),null==l.multiselection.selectedRowsPerPage&&(l.multiselection.selectedRowsPerPage=[]),i=!!l.multiselection.selectedAll,l.isSuperSelect)if(a&&r)if(l.multiselection.selectedIds[l.multiselection.selectedIds.length-1]){let t=c(l.multiselection.selectedIds[l.multiselection.selectedIds.length-1],e),r=l.multiselection.selectedIds[l.multiselection.selectedIds.length-1];t[0]>t[1]?(o(p,r,i),d(r,e,i)):d(r,e,i)}else s(p,i);else if(!a&&r)l.multiselection.selectedIds.includes(e)?o(p,i):s(p,i);else if(a&&!r)if(l.multiselection.selectedIds[l.multiselection.selectedIds.length-1]){let t=l.multiselection.selectedIds[0];n(i),d(t,e,i)}else s(p,i);else a||r||(l.multiselection.selectedIds.includes(e)?o(p,i):(n(i),s(p,i)));else l.multiselection.selectedIds.includes(e)?o(p,i):s(p,i)}}));let s=(i,r)=>{let a=i.data("pk");l.selectable.multi||(l.multiselection.selectedAll=!1,l.multiselection.selectedIds=[],l.multiselection.selectedRowsPerPage=[],t.element.find(".rup_list-item-selected").each(((t,l)=>{e(l).removeClass("rup_list-item-selected"),e(l).attr("aria-selected","false")}))),l.multiselection.selectedRowsPerPage.push({id:a,line:function(){let e=0,l=0;return t.element.children().toArray().forEach((t=>{t.id==i.attr("id")&&(l=e),e++})),l}(),page:l.isScrollList?1:l.page}),l.multiselection.selectedIds.push(a),r?(i.removeClass("rup_list-item-selected"),i.removeClass("aria-selected","false")):(i.addClass("rup_list-item-selected"),i.attr("aria-selected","true"))},o=(e,t)=>{let i=e.data("pk"),r=l.multiselection.selectedIds.indexOf(i);l.multiselection.selectedIds.splice(r,1),l.multiselection.selectedRowsPerPage=l.multiselection.selectedRowsPerPage.filter((e=>e.id!=i)),t?(e.addClass("rup_list-item-selected"),e.attr("aria-selected","true")):(e.removeClass("rup_list-item-selected"),e.attr("aria-selected","false"))},n=i=>{let r=r=>{const a=String(l.content[r][l.key]),s=t.element.find(".rup_list-item").filter(((t,l)=>e(l).data("pk")==a));i?(s.addClass("rup_list-item-selected"),s.attr("aria-selected","true")):(s.removeClass("rup_list-item-selected"),s.attr("aria-selected","false"))};l.multiselection.selectedAll=!!i,l.multiselection.selectedIds=[],l.multiselection.selectedRowsPerPage=[];for(let e=0;e<l.content.length;e++)r(e)},d=(t,i,r)=>{let a=t=>{const i=String(l.content[t][l.key]);if(!l.multiselection.selectedIds.includes(i)){let t=e(".rup_list-item").filter(((t,l)=>e(l).data("pk")==i));s(t,r)}};var o=c(t,i);if(o[0]>o[1])for(let e=o[1];e<=o[0];e++)a(e);else for(let e=o[1];e>=o[0];e--)a(e)},c=(e,t)=>{var i={};for(let r=0;r<l.content.length;r++)l.content[r][l.key]==t?i[0]=r:l.content[r][l.key]==e&&(i[1]=r);return i}},_scrollListInit:function(){var t=this;t.options.stepLoad=t.element.children().length/t.options.rowNum.value,t.options.stepOnLoad=!1,t.options.stepCounter=0,e(t.element).on("scrollListPageNext",(function(){return t.options.page++})),e(t.element).on("scrollListPagePrev",(function(){return t.options.page--})),e(window).on("scroll",(function(){var l=document.documentElement.clientHeight,i=t.element[0].getBoundingClientRect(),r=i.height+i.top+150;t.options.stepLoad=t.element.children().length/t.options.rowNum.value,t.options.stepLoad==t.options.page&&r<l&&(t.options.stepCounter++,1==t.options.stepCounter&&t.element.children().length<=t.options.rowNum.value*t.options.page&&(t.options.stepOnLoad||(t.options.stepOnLoad=!0,t._lock(),e(t.element).trigger("scrollListPageNext"),e.when(t.isFiltering).done((()=>{delete t.isFiltering,t.isFiltering=e.Deferred(),t._doFilter()})))))}))},_headerSticky:function(){const t=this,l=t.options;e(window).on("resize",(function(){l._header.obj.css("width",t.element.css("width"))})),e(window).on("scroll",(function(){e(".rup-navbar.navbar").hasClass("rup-navbar-sticky")?window.scrollHeight=e(".rup-navbar").height():window.scrollHeight=0;var i=l._header.obj[0].getBoundingClientRect(),r=i.top;l._header.obj.hasClass("rup_list-sticky")&&(r=(i=t.element[0].getBoundingClientRect()).top),l._header.obj.css("width",t.element.css("width")),r<window.scrollHeight?(l._header.obj.addClass("rup_list-sticky"),t.element.css({"padding-top":l._header.obj[0].offsetHeight}),l._header.obj.css({top:window.scrollHeight})):r>=window.scrollHeight&&l._header.obj.hasClass("rup_list-sticky")&&(l._header.obj.removeClass("rup_list-sticky"),t.element.css({"padding-top":0}),l._header.obj.css({top:0}))}))},_loader:function(){const e=this.options,t=this.element.attr("id");e._overlay||(e._idOverlay=t+"-overlay",e._overlay=jQuery('<div id="'+e._idOverlay+'" class="rup_list-overlay"></div>'),e._overlay.append('<div class="rup_list-overlay-layer"></div>').append('<div class="rup_list-overlay-loader"></div>')),e.loader(e._overlay)},_print:function(){const t=this.options;0==e("#"+e.escapeSelector(t.filterForm)).find("#listPrint").length&&(t.btnPrint=e('<button id="listPrint">Imprimir</button>'),t.btnPrint.appendTo(e("#"+e.escapeSelector(t.filterForm))),t.btnPrint[0].disabled=!0,t.btnPrint.on("click",(function(l){l.preventDefault();var i=new Printd,r=e('<div id="print-doc"></div>'),a=e("<link>",{id:"rup-list-link-print",rel:"stylesheet",href:t.print}),s="",o="";t.isMultiSort?(s=t.multiorder.sidx,o=t.multiorder.sord):(s=t.sidx.value,o=t.sord);let n={};1==e(`form[id="${t.filterForm}"]`).length&&(n=e("#"+e.escapeSelector(t.filterForm)).rup_form("formToJson"));var d={filter:n,page:1,rows:t.records,sidx:s,sord:o,multiselection:t.multiselection,core:{pkNames:[t.key],pkToken:"~"}};r.append(a),jQuery.rup_ajax({url:t.action,type:"POST",dataType:"json",data:JSON.stringify(d),contentType:"application/json",success:function(l){if(t.multiselection.selectedIds&&0!=t.multiselection.selectedIds.length)for(var a=0;a<l.rows.length;a++)for(var s=0;s<l.reorderedSelection.length;s++)l.rows[a][t.key]==l.reorderedSelection[s].pk[t.key]&&r.append(e("<p>"+l.rows[a][t.key]+"</p>"));else for(var o=0;o<l.rows.length;o++)r.append(e("<p>"+l.rows[o][t.key]+"</p>"));i.print(r[0])}})})))},_multiFilter:function(){const t=this,l=t.options;l.multiFilter={},l.multiFilter._selector="generated",l.multiFilter._user="udaPruebas",l.multiFilter._dialogId=t.element[0].id+"_dropdownDialog",l.multiFilter.$btn=e("#"+e.escapeSelector(l.filterForm)).find("button").eq(0),l.multiFilter.$dialog=e('<div id="'+l.multiFilter._dialogId+'" class="dialog-content-material"><div id="'+l.multiFilter._dialogId+'_feedback" role="alert"></div><form><div class="row"><div class="form-groupMaterial col-12"><label for="'+l.multiFilter._dialogId+'_select">Filtros</label><select id="'+l.multiFilter._dialogId+'_select"></select></div><div class="row"><div class="checkbox-material col-12"><input type="checkbox" id="'+l.multiFilter._dialogId+'-activeFilter" /><label for="'+l.multiFilter._dialogId+'-activeFilter">Filtro por defecto</label></div></div></form></div>'),l.multiFilter.$btn.after(l.multiFilter.$dialog),l.multiFilter.$select=e("#"+e.escapeSelector(l.multiFilter._dialogId)+"_select"),l.multiFilter.$feedback=e("#"+e.escapeSelector(l.multiFilter._dialogId)+"_feedback"),l.multiFilter.$feedback.rup_feedback({block:!1,delay:2e3}),l.multiFilter.$btn.rup_button({dropdown:{dropdownDialog:l.multiFilter._dialogId,dropdownDialogConfig:{autoOpen:!1,modal:!0,resizable:!0,title:"<i class='mdi mdi-filter' aria-hidden='true'></i>AdministraciÃ³n de filtros",width:"380px",buttons:[{id:l.multiFilter._dialogId+"_btn_save",text:"Guardar",click:function(){if(0!=e("#"+e.escapeSelector(l.filterForm)).rup_form("formToJson").length){var t={filtro:{selector:l.multiFilter._selector,text:l.multiFilter.$label.val(),data:JSON.stringify(e("#"+e.escapeSelector(l.filterForm)).rup_form("formToJson")),active:l.multiFilter.$dialog.find("#"+l.multiFilter._dialogId+"-activeFilter")[0].checked,user:l.multiFilter._user}};e.rup_ajax({url:l.action+"/./multiFilter/add",type:"POST",dataType:"json",data:JSON.stringify(t),contentType:"application/json",success:()=>{l.multiFilter.$feedback.rup_feedback("set",e.rup.i18n.base.rup_table.plugins.multifilter.ok,"ok")},error:()=>{l.multiFilter.$feedback.rup_feedback("set",e.rup.i18n.base.rup_table.plugins.multifilter.error,"error")}})}}},{id:l.multiFilter._dialogId+"_btn_apply",text:"Aplicar",click:function(){l.multiFilter.selected&&(l.multiFilter.$dialog.dialog("close"),t.element.rup_list("filter"))}},{id:l.multiFilter._dialogId+"_btn_delete",text:"Eliminar",click:function(){if(l.multiFilter.selected){var t={filtro:{selector:l.multiFilter.selected.selector,text:l.multiFilter.selected.text,data:JSON.stringify(l.multiFilter.selected.value),active:l.multiFilter.selected.default,user:l.multiFilter.selected.user}};e.rup_ajax({url:l.action+"/./multiFilter/delete",type:"DELETE",dataType:"json",data:JSON.stringify(t),contentType:"application/json",success:()=>{l.multiFilter.$select.rup_select("set","",""),l.multiFilter.$feedback.rup_feedback("set",e.rup.i18n.base.rup_table.plugins.multifilter.ok,"ok"),l.multiFilter.$label.data("tmp.loadObjects.term",null),l.multiFilter.$label.data("loadObjects",{}),l.multiFilter.$label.data("tmp.data",{})},error:()=>{l.multiFilter.$feedback.rup_feedback("set",e.rup.i18n.base.rup_table.plugins.multifilter.error,"error")}})}}},{id:l.multiFilter._dialogId+"_btn_cancel",text:"Cancelar",click:function(){l.multiFilter.$dialog.dialog("close")},btnType:e.rup.dialog.LINK}]}}}),l.multiFilter.$select.rup_select({url:l.action+"/./multiFilter/getAll?selector="+l.multiFilter._selector+"&user="+l.multiFilter._user,sourceParam:{text:"text",id:"id",data:"data",category:"filter"},method:"GET",combo:!0,autocomplete:!0,allowClear:!0,contains:!0,select:function(){l.multiFilter.$select.rup_select("getRupValue")&&(l.multiFilter.selected={selector:l.multiFilter._selector,id:l.multiFilter.$select.rup_select("getRupValue"),active:l.multiFilter.$dialog.find("#"+l.multiFilter._dialogId+"-activeFilter")[0].checked,user:l.multiFilter._user},e.rup_ajax({url:l.action+"/./multiFilter/getAll?selector="+l.multiFilter._selector+"&user="+l.multiFilter._user,type:"GET",dataType:"json",contentType:"application/json",success:function(t){if(l.multiFilter.selected.id){for(let e=0;e<t.length;e++)l.multiFilter.selected.id==t[e].id&&(l.multiFilter.selected.data=JSON.parse(t[e].data),l.multiFilter.selected.active=t[e].active);l.multiFilter.selected.active?l.multiFilter.$dialog.find("#"+l.multiFilter._dialogId+"-activeFilter")[0].checked=!0:l.multiFilter.$dialog.find("#"+l.multiFilter._dialogId+"-activeFilter")[0].checked=!1,e("#"+e.escapeSelector(l.filterForm)).find("input").val("");for(let t=0;t<e("#"+e.escapeSelector(l.filterForm)).find("input").length;t++)null!=l.multiFilter.selected.data[e("#"+e.escapeSelector(l.filterForm)).find("input").eq(t).attr("name")]&&e("#"+e.escapeSelector(l.filterForm)).find("input").eq(t).val(l.multiFilter.selected.data[e("#"+e.escapeSelector(l.filterForm)).find("input").eq(t).attr("name")])}},error:()=>{l.multiFilter.$feedback.rup_feedback("set",e.rup.i18n.base.rup_table.plugins.multifilter.error,"error")}}))}}),l.multiFilter.$label=e('label[for="'+l.multiFilter._dialogId+'_select"]'),e.rup_ajax({url:l.action+"/./multiFilter/getDefault?selector="+l.multiFilter._selector+"&user="+l.multiFilter._user,type:"GET",dataType:"json",contentType:"application/json",success:function(t){l.multiFilter.$label.val(t.text),t.data=JSON.parse(t.data),t.active?l.multiFilter.$dialog.find("#"+l.multiFilter._dialogId+"-activeFilter")[0].checked=!0:l.multiFilter.$dialog.find("#"+l.multiFilter._dialogId+"-activeFilter")[0].checked=!1;for(let i=0;i<e("#"+e.escapeSelector(l.filterForm)).find("input").length;i++)null!=t.data[e("#"+e.escapeSelector(l.filterForm)).find("input").eq(i).attr("name")]&&e("#"+e.escapeSelector(l.filterForm)).find("input").eq(i).val(t.data[e("#"+e.escapeSelector(l.filterForm)).find("input").eq(i).attr("name")])}}),l.multiFilter.$label.off("blur click")},_sordButtonInit:function(){const t=this,l=t.options;var i=l._header.sord,r=l._footer.sord;i.attr("aria-controls",t.element.attr("id")),l.createFooter&&r.attr("aria-controls",t.element.attr("id")),"asc"===l.sord?(i.addClass("asc"),i.removeClass("desc"),i.attr("aria-label",e.rup.i18n.base.rup_list.sort.asc),l.createFooter&&(r.addClass("asc"),r.removeClass("desc"),r.attr("aria-label",e.rup.i18n.base.rup_list.sort.asc))):(i.addClass("desc"),i.removeClass("asc"),i.attr("aria-label",e.rup.i18n.base.rup_list.sort.desc),l.createFooter&&(r.addClass("desc"),r.removeClass("asc"),r.attr("aria-label",e.rup.i18n.base.rup_list.sort.desc))),e("#"+e.escapeSelector(l._idListHeader.sord)+", #"+e.escapeSelector(l._idListFooter.sord)).on("click",(function(){i.toggleClass("asc"),i.toggleClass("desc"),l.createFooter&&(r.toggleClass("asc"),r.toggleClass("desc"));let a=i.hasClass("asc")?e.rup.i18n.base.rup_list.sort.asc:e.rup.i18n.base.rup_list.sort.desc;i.attr("aria-label",a),l.createFooter&&r.attr("aria-label",a),t._changeOption("sord",i.hasClass("asc")?"asc":"desc")}))},_sidxSelectInit:function(){const t=this,l=t.options;let i=function(i,r){if(!e("#"+e.escapeSelector(i.id)).rup_select("isDisabled")&&i.selected!=l.sidx.value){l.sidx.value=i.selected;let a=l._header.sidx[0].id;e("#"+e.escapeSelector(a)).rup_select("setRupValue",e("#"+e.escapeSelector(i.id)).rup_select("getRupValue")),l.createFooter&&(a=l._footer.sidx[0].id,e("#"+e.escapeSelector(a)).rup_select("setRupValue",e("#"+e.escapeSelector(i.id)).rup_select("getRupValue"))),r&&t._changeOption("sidx",e("#"+e.escapeSelector(i.id)).rup_select("getRupValue"))}},r=function(){i(this,!0)};l.sidx.source.filter((e=>e.id=e.value));var a={data:l.sidx.source,selected:l.sidx.value,rowStriping:!0,ordered:!1,change:function(){i(this,!0)}};if(l._header.sidx.rup_select(a),l._header.sidx=e("#"+e.escapeSelector(l._idListHeader.sidx)),l.createFooter){var s={data:l.sidx.source,selected:l.sidx.value,rowStriping:!0,ordered:!1,change:r};l._footer.sidx.rup_select(s),l._footer.sidx=e("#"+e.escapeSelector(l._idListFooter.sidx))}},_multisortInit:function(){const t=this,l=t.options,i=t.element.attr("id");l.multiorder={sidx:l.sidx.value,sord:(()=>{if(!l.sord){let e=[];for(let t=0;t<l.sidx.value.split(",").length;t++)e.push("asc");return e.join(",")}{let e=l.sord.split(","),t=l.sidx.value.split(",");if(e.length==t.length)return l.sord;if(e.length>t.length)return e.splice(0,t.length).join(",");if(e.length<t.length){let l=t.length-e.length;for(let t=0;t<l;t++)e.push("asc");return e.join(",")}}})()};let r=r=>{let a=r?"_idListFooter":"_idListHeader",s=r?"_footer":"_header",o=r?"-footer-":"-header-";l[a].multiSort.dialog=i+o+"mord-dialog",l[a].multiSort.summary=i+o+"mord-summary",l[a].multiSort.edit=i+o+"mord-edit";let n=e('<ul id="'+l[a].multiSort.summary+'" class="rup_list-mord-summary p-0"></ul>'),d=e('<div class="tmp-orderchange"/>');l[s].sidx.wrap(d),d=l[s].sidx.parent(),d.children().remove(),d.append(n),n.unwrap(),l[s].multiSort.summary=e("#"+e.escapeSelector(l[a].multiSort.summary)),l.multiorder.sidx.split(",").map((e=>e.trim())).forEach(((t,i)=>{if(""!==t){let r=e('<li class="rup_list-mord-summary-badge badge badge-pill badge-primary rounded-0 me-1"></li>'),a=e=>l.sidx.source.filter((t=>t.value==e))[0].i18nCaption,s=e('<span class="rup_list-mord-summary-badge-sord"></span>');s.text(" ");let o=l.multiorder.sord.split(",").map((e=>e.trim()));"asc"==o[i]?(s.addClass("asc mdi mdi-chevron-up"),s.attr("aria-label",e.rup.i18n.base.rup_list.sort.asc)):(s.addClass("desc mdi mdi-chevron-down"),s.attr("aria-label",e.rup.i18n.base.rup_list.sort.desc)),r.append(a(t)).append(s.clone()),n.append(r.clone())}}));var c=e(`<button id="${l[a].multiSort.edit}" class="rup_list-mord-dialogbtn mdi mdi-pencil"></button>`);c.attr("aria-haspopup","true"),c.attr("aria-expanded","false"),c.attr("aria-label",e.rup.i18n.base.rup_list.openMordDialog);let p=e('<div class="tmp-orderchange"></div>');l[s].sord.wrap(p),p=l[s].sord.parent(),p.children().remove(),p.append(c),c.unwrap(),l[s].multiSort.edit=e("#"+e.escapeSelector(l[a].multiSort.edit)),l[s].multiSort.edit.on("click keyup",(e=>{("click"===e.type||"keyup"===e.type&&"13"==e.key)&&l._multiSortDialog.rup_dialog("open")}));let u=l.multiorder.sidx.split(",").map((e=>e.trim())),m=l.multiorder.sord.split(",").map((e=>e.trim()));if(u.length>0){let l=0;e(t.element).on("rup_list-mord-changed",(()=>{l++,l==u.length&&e(t.element).trigger("rup_list-mord-inited")})),u.forEach(((t,l)=>{e('button[data-ordValue="'+t+'"]').trigger("click",[m[l],!0])}))}else e(t.element).trigger("rup_list-mord-inited")};e('<div id="'+l._idMultiSortDialog+'" class="rup_list-mord-dialog" style="display:none"></div>').append(`\n                    <div class="card">\n                        <div class="card-body">\n                            <h4 class="card-title">${e.rup.i18n.base.rup_list.multiSortDialog.msg1}</h5>\n                            <h5 class="card-subtitle mb-4 text-muted">${e.rup.i18n.base.rup_list.multiSortDialog.msg2}</h5>\n                            <div id="${l._idMultiSortDialog}-orderfields" class="rup_list-mord-orderfields" aria-live="polite"></div>\n                        </div>\n                    </div>\n                    <div class="card">\n                        <div class="card-body">\n                            <h4 class="card-title">${e.rup.i18n.base.rup_list.multiSortDialog.msg3}</h4>\n                            <h5 class="card-subtitle mb-4 text-muted">${e.rup.i18n.base.rup_list.multiSortDialog.msg4}</h5>\n                            <div id="${l._idMultiSortDialog}-ordersort" class="rup_list-mord-ordersort" aria-live="polite"></div>\n                        </div>\n                    </div>\n                `).appendTo("body"),l._multiSortDialog=e("#"+e.escapeSelector(l._idMultiSortDialog)),l.sidx.source.forEach((t=>{let i=e(`\n                    <button class="rup_list-mord-field" data-ordValue="${t.value}">\n                        ${t.i18nCaption}\n                        <i class="mdi mdi-plus"></i>\n                    </button>\n                `);i.attr("aria-controls",`${l._idMultiSortDialog}-orderfields ${l._idMultiSortDialog}-ordersort`),e(".rup_list-mord-orderfields").append(i.clone())})),e(".rup_list-mord-orderfields").children().on("click",(function(e,l,i){t._actualizarOrdenMulti.apply(t,[e,l,i])})),l._multiSortDialog.rup_dialog({type:e.rup.dialog.DIV,autoOpen:!1,modal:!0,resizable:!1,width:"auto",title:e.rup.i18n.base.rup_list.multiSortDialog.title,buttons:[{text:"cerrar",click:()=>{l._multiSortDialog.rup_dialog("close")}}],open:()=>{e(t.element).trigger("rup_list-mord-dialogOpen"),l._header.multiSort.edit.attr("aria-expanded",!0),l.createFooter&&l._footer.multiSort.edit.attr("aria-expanded",!0)},onBeforeClose:()=>{e(t.element).trigger("rup_list-mord-dialogClose"),l._header.multiSort.edit.attr("aria-expanded",!1),l.createFooter&&l._footer.multiSort.edit.attr("aria-expanded",!1)}}),r(),l.createFooter&&r(!0)},_rownumInit:function(){const t=this,l=t.options;let i=function(i,r){if(!e("#"+e.escapeSelector(i.id)).rup_select("isDisabled")&&i.selected!=l.rowNum.value){l.rowNum.value=i.selected;let a=l._header.rowNum[0].id;e("#"+e.escapeSelector(a)).rup_select("setRupValue",e("#"+e.escapeSelector(i.id)).rup_select("getRupValue")),l.createFooter&&(a=l._footer.rowNum[0].id,e("#"+e.escapeSelector(a)).rup_select("setRupValue",e("#"+e.escapeSelector(i.id)).rup_select("getRupValue"))),r&&t._changeOption("rowNum",e("#"+e.escapeSelector(i.id)).rup_select("getRupValue"))}},r=function(){i(this,!0)};l.rowNum.source.filter((e=>e.id=e.value));var a={data:l.rowNum.source,selected:l.rowNum.value,rowStriping:!0,ordered:!1,change:function(){i(this,!0)}};let s=l._header.rowNum[0].id;if(e("#"+e.escapeSelector(s)).rup_select(a),l._header.rowNum=e("#"+e.escapeSelector(l._idListHeader.rowNum)),l.createFooter){var o={data:l.rowNum.source,selected:l.rowNum.value,rowStriping:!0,ordered:!1,change:r};let t=l._footer.rowNum[0].id;e("#"+e.escapeSelector(t)).rup_select(o),l._footer.rowNum=e("#"+e.escapeSelector(l._idListFooter.rowNum))}},_disableNavItem:function(e){e.addClass("disabled"),e.attr("aria-disabled","true"),e.attr("tabindex","-1")},_enableNavItem:function(e){e.removeClass("disabled"),e.attr("aria-disabled","false"),e.attr("tabindex","0")},_pagenavInit:function(){const t=this,l=t.options;e(".page-separator").hide().attr("aria-hidden","true"),l._header.pagenav.attr("aria-label",e.rup.i18n.base.rup_list.paginacion),l._header.pagenav.attr("aria-controls",t.element.attr("id")),l._header.pagePrev.attr("role","button").attr("aria-controls",t.element.attr("id")).attr("aria-label",e.rup.i18n.base.rup_list.paginaAnterior),l._header.pageNext.attr("role","button").attr("aria-controls",t.element.attr("id")).attr("aria-label",e.rup.i18n.base.rup_list.paginaSiguiente),l.createFooter&&(l._footer.pagenav.attr("aria-label",e.rup.i18n.base.rup_list.paginacion),l._footer.pagenav.attr("aria-controls",t.element.attr("id")),l._footer.pagePrev.attr("role","button").attr("aria-controls",t.element.attr("id")).attr("aria-label",e.rup.i18n.base.rup_list.paginaAnterior),l._footer.pageNext.attr("role","button").attr("aria-controls",t.element.attr("id")).attr("aria-label",e.rup.i18n.base.rup_list.paginaSiguiente));var i=i=>{if(e(i).is(".disabled"))return!1;let r=e(".page").eq(-1).attr("data-page"),a=l._header.pagenav.find(".rup_list-page-item.page.active").attr("data-page");return 1==a?(t._disableNavItem(l._header.pagePrev),t._enableNavItem(l._header.pageNext),l.createFooter&&(t._disableNavItem(l._footer.pagePrev),t._enableNavItem(l._footer.pageNext)),!0):a==r?(t._enableNavItem(l._header.pagePrev),t._disableNavItem(l._header.pageNext),l.createFooter&&(t._enableNavItem(l._footer.pagePrev),t._disableNavItem(l._footer.pageNext)),!0):(t._enableNavItem(l._header.pagePrev),t._enableNavItem(l._header.pageNext),l.createFooter&&(t._enableNavItem(l._footer.pagePrev),t._enableNavItem(l._footer.pageNext)),!0)};l._header.pagePrev.on("click",(function(){i(this)&&t._changeOption("page",l._header.pagenav.find(".rup_list-page-item.page.active").prev("[data-page]").data("page"))})),l._header.pageNext.on("click",(function(){i(this)&&t._changeOption("page",l._header.pagenav.find(".rup_list-page-item.page.active").next("[data-page]").data("page"))})),l.createFooter&&(l._footer.pagePrev.on("click",(function(){i(this)&&t._changeOption("page",l._header.pagenav.find(".rup_list-page-item.page.active").prev("[data-page]").data("page"))})),l._footer.pageNext.on("click",(function(){i(this)&&t._changeOption("page",l._header.pagenav.find(".rup_list-page-item.page.active").next("[data-page]").data("page"))})))},_actualizarOrdenMulti:function(t,l="asc",i="false"){const r=this,a=r.options;var s=e(".rup_list-mord-ordersort");if(a.multiorder.sidx.length){let i=a.multiorder.sidx.split(",").map((e=>e.trim())),r=a.multiorder.sord.split(",").map((e=>e.trim()));-1==i.indexOf(e(t.currentTarget).attr("data-ordValue"))&&(i.push(e(t.currentTarget).attr("data-ordValue")),r.push(l)),a.multiorder.sidx=i.join(","),a.multiorder.sord=r.join(",")}let o=e(`\n                <div id="${a._idMultiSortDialog}-ord-line-${e(t.currentTarget).attr("data-ordValue")}" \n                    class="rup_list-ord-line btn-group mb-3" \n                    data-ordValue="${e(t.currentTarget).attr("data-ordValue")}"\n                    role="toolbar" \n                    aria-controls="${r.element[0].id}"\n                    aria-label="${e(t.currentTarget).text().trim()}, ${e.rup.i18n.base.rup_list.sort[l]}">\n                    <div class="rup_list-apord input-group-text"></div>\n                    <button class="rup_list-mord-up btn btn-secondary p-1 mdi mdi-arrow-up"\n                        aria-label="${e.rup.i18n.base.rup_list.mordSubir}"\n                        aria-controls="${r.element[0].id} ${a._idMultiSortDialog}-ord-line-${e(t.currentTarget).attr("data-ordValue")}"></button>\n                    <button class="rup_list-mord-down btn btn-secondary p-1 mdi mdi-arrow-down"\n                        aria-label="${e.rup.i18n.base.rup_list.mordBajar}"\n                        aria-controls="${r.element[0].id} ${a._idMultiSortDialog}-ord-line-${e(t.currentTarget).attr("data-ordValue")}"></button>\n                    <div class="rup_list-mord-label input-group-text rounded-0 w-50" aria-hidden="true">${e(t.currentTarget).text()}</div>\n                    <button aria-controls="${r.element[0].id}"\n                        class="rup_list-mord btn btn-secondary mdi" \n                        data-direction="${l}"\n                        aria-label="${e.rup.i18n.base.rup_list.sort[l]}"></button>\n                    <button aria-controls="${r.element[0].id}"\n                        aria-label="${e.rup.i18n.base.rup_list.quitarCampoOrden}"\n                        class="rup_list-mord-remove btn btn-danger mdi mdi-close-circle"></button>\n                </div>\n            `);o.find("button").rup_button(),e(t.currentTarget).remove(),s.append(o),r._fnOrderOfOrderFields.apply(r,[e('[data-ordValue="'+e(t.currentTarget).attr("data-ordValue")+'"]',s),i])},_fnOrderOfOrderFields:function(t,l){const i=this,r=i.options;var a=()=>{r.multiorder.sidx="",r.multiorder.sord="";var t=e(".rup_list-mord-ordersort");let a=[],s=[];t.children().toArray().forEach((t=>{-1==a.indexOf(e(t).attr("data-ordValue"))&&(a.push(e(t).attr("data-ordValue")),s.push(e(".rup_list-mord",e(t)).attr("data-direction")))})),a.length>0&&(r.multiorder.sidx=a.join(","),r.multiorder.sord=s.join(",")),r._content.find(".rup_list-mord-summary").empty(),null!=r.multiorder.sidx&&r.multiorder.sidx.length>0&&r.multiorder.sidx.split(",").map((e=>e.trim())).forEach(((t,l)=>{let i=e("<span></span>").text(" "),a=r.multiorder.sord.split(",").map((e=>e.trim()));var s;"asc"==a[l]?i.addClass("mdi mdi-chevron-up"):i.addClass("mdi mdi-chevron-down"),e('<li class="rup_list-mord-summary-badge badge badge-pill badge-primary rounded-0 me-1"></li>').append((s=t,r.sidx.source.filter((e=>e.value==s))[0].i18nCaption)).append(i.clone()).appendTo(r._content.find(".rup_list-mord-summary"))})),r._multiSortDialog.find(".rup_list-mord-up, .rup_list-mord-down").button("enable"),r._multiSortDialog.find(".rup_list-mord-up, .rup_list-mord-down").attr("aria-disabled","false"),r._multiSortDialog.find(".rup_list-mord-up, .rup_list-mord-down").attr("tabindex","0"),r._multiSortDialog.find(".rup_list-mord-up").first().button("disable"),r._multiSortDialog.find(".rup_list-mord-down").last().button("disable"),r._multiSortDialog.find(".rup_list-mord-up").first().attr("aria-disabled","true"),r._multiSortDialog.find(".rup_list-mord-down").last().attr("aria-disabled","true"),r._multiSortDialog.find(".rup_list-mord-up").first().attr("tabindex","-1"),r._multiSortDialog.find(".rup_list-mord-down").last().attr("tabindex","-1");let o=e(".rup_list-ord-line").toArray().map((t=>e(t).attr("aria-label")+"; ")).reduce(((e,t)=>e+t),"");t.attr("aria-label",o?e.rup.i18n.base.rup_list.ariaSummary+o:e.rup.i18n.base.rup_list.ariaSummaryEmpty),e(i.element).trigger("rup_list-mord-changed"),1!=l?(l=!1,this.reload()):l=!1};e(".rup_list-mord-up",t).click((function(){e(t).is(":first-child")||(e(t).prev().before(t),e(this).focus(),a())})),e(".rup_list-mord-down",t).click((function(){e(t).is(":last-child")||(e(t).next().after(t),e(this).focus(),a())})),"asc"==e(".rup_list-mord",t).attr("data-direction")?e(".rup_list-mord",t).addClass("mdi-chevron-up"):e(".rup_list-mord",t).addClass("mdi-chevron-down"),e(".rup_list-mord").text(" "),e(".rup_list-mord",t).off("click"),e(".rup_list-mord",t).click((()=>{"asc"==e(".rup_list-mord",t).attr("data-direction")?(e(".rup_list-mord",t).attr("data-direction","desc"),e(".rup_list-mord",t).attr("aria-label",e.rup.i18n.base.rup_list.sort.desc),e(".rup_list-mord",t).addClass("mdi-chevron-down"),e(".rup_list-mord",t).removeClass("mdi-chevron-up"),e(".rup_list-mord",t).parent().attr("aria-label",`${e(".rup_list-mord",t).parent().text().trim()}, ${e.rup.i18n.base.rup_list.sort.desc}`)):(e(".rup_list-mord",t).attr("data-direction","asc"),e(".rup_list-mord",t).attr("aria-label",e.rup.i18n.base.rup_list.sort.asc),e(".rup_list-mord",t).addClass("mdi-chevron-up"),e(".rup_list-mord",t).removeClass("mdi-chevron-down"),e(".rup_list-mord",t).parent().attr("aria-label",`${e(".rup_list-mord",t).parent().text().trim()}, ${e.rup.i18n.base.rup_list.sort.asc}`)),a()})),e(".rup_list-mord-remove",t).click((()=>{let l=e(`\n                    <button class="rup_list-mord-field btn btn-material btn-material-sm btn-material-primary-low-emphasis"\n                        data-ordValue="${e(t).attr("data-ordValue")}">\n                        ${r.sidx.source.filter((l=>l.value==e(t).attr("data-ordValue")))[0].i18nCaption}\n                        <i class="mdi mdi-plus"></i>\n                    </button>\n                `);e(".rup_list-mord-orderfields").append(l.clone()),e(".rup_list-mord-orderfields").children().off("click"),e(".rup_list-mord-orderfields").children().on("click",(function(e){i._actualizarOrdenMulti.apply(i,[e])})),e(t).remove(),a()})),a()},_selectAll:function(){const t=this,l=t.options;l.multiselection.selectedAll=!0,l.multiselection.selectedIds=[],l.multiselection.selectedRowsPerPage=[],t._getPageElementsIds().forEach((t=>{e("#"+e.escapeSelector(t)).addClass("rup_list-item-selected"),e("#"+e.escapeSelector(t)).attr("aria-selected","true")})),e("#"+e.escapeSelector(t.element[0].id)).trigger("listAfterMultiselection")},_deselectAll:function(){const t=this,l=t.options;l.multiselection.selectedAll=!1,l.multiselection.selectedIds=null,l.multiselection.selectedRowsPerPage=null,t._getPageElementsIds().forEach((t=>{e("#"+e.escapeSelector(t)).removeClass("rup_list-item-selected"),e("#"+e.escapeSelector(t)).attr("aria-selected","false")})),e("#"+e.escapeSelector(t.element[0].id)).trigger("listAfterMultiselection")},_selectPage:function(){const t=this,l=t.options;null==l.multiselection.selectedIds&&(l.multiselection.selectedIds=[]),null==l.multiselection.selectedRowsPerPage&&(l.multiselection.selectedRowsPerPage=[]),0==l.multiselection.selectedAll?t._getPageIds().forEach((i=>{if(0==l.multiselection.selectedRowsPerPage.filter((e=>e.id==i)).length){let r=i.split("_").pop();l.multiselection.selectedIds.push(r),l.multiselection.selectedRowsPerPage.push({id:i,line:function(){let e=0,l=0;return t.element.children().toArray().forEach((t=>{t.id==i&&(l=e),e++})),l}(),page:l.page}),e("#"+e.escapeSelector(t.options._idItemTemplate+"_"+i)).addClass("rup_list-item-selected"),e("#"+e.escapeSelector(t.options._idItemTemplate+"_"+i)).attr("aria-selected","true")}})):t._getPageIds().forEach((i=>{if(l.multiselection.selectedRowsPerPage.filter((e=>e.id==i)).length>0){let r=i.split("_").pop();l.multiselection.selectedIds=l.multiselection.selectedIds.filter((e=>e!=r)),l.multiselection.selectedRowsPerPage=l.multiselection.selectedRowsPerPage.filter((e=>e.id!=i)),e("#"+e.escapeSelector(t.options._idItemTemplate+"_"+i)).addClass("rup_list-item-selected"),e("#"+e.escapeSelector(t.options._idItemTemplate+"_"+i)).attr("aria-selected","true")}})),0==l.multiselection.selectedIds.length&&(l.multiselection.selectedIds=null),0==l.multiselection.selectedRowsPerPage.length&&(l.multiselection.selectedRowsPerPage=null),e("#"+e.escapeSelector(t.element[0].id)).trigger("listAfterMultiselection")},_deselectPage:function(){const t=this,l=t.options;null==l.multiselection.selectedIds&&(l.multiselection.selectedIds=[]),null==l.multiselection.selectedRowsPerPage&&(l.multiselection.selectedRowsPerPage=[]),0==l.multiselection.selectedAll?t._getPageIds().forEach((i=>{if(l.multiselection.selectedRowsPerPage.filter((e=>e.id==i)).length>0){let r=i.split("_").pop();l.multiselection.selectedIds=l.multiselection.selectedIds.filter((e=>e!=r)),l.multiselection.selectedRowsPerPage=l.multiselection.selectedRowsPerPage.filter((e=>e.id!=i)),e("#"+e.escapeSelector(t.options._idItemTemplate+"_"+i)).removeClass("rup_list-item-selected"),e("#"+e.escapeSelector(t.options._idItemTemplate+"_"+i)).attr("aria-selected","false")}})):t._getPageIds().forEach((i=>{if(0==l.multiselection.selectedRowsPerPage.filter((e=>e.id==i)).length){let e=i.split("_").pop();l.multiselection.selectedIds.push(e),l.multiselection.selectedRowsPerPage.push({id:i,line:function(){let e=0,l=0;return t.element.children().toArray().forEach((t=>{t.id==i&&(l=e),e++})),l}(),page:l.page})}e("#"+e.escapeSelector(t.options._idItemTemplate+"_"+i)).removeClass("rup_list-item-selected"),e("#"+e.escapeSelector(t.options._idItemTemplate+"_"+i)).attr("aria-selected","false")})),0==l.multiselection.selectedIds.length&&(l.multiselection.selectedIds=null),0==l.multiselection.selectedRowsPerPage.length&&(l.multiselection.selectedRowsPerPage=null),e("#"+e.escapeSelector(t.element[0].id)).trigger("listAfterMultiselection")},_generateSelectablesBtnGroup:function(){const t=this,l=t.element.attr("id"),i=t.options;let r=e(`\n                <div class="btn-group h-100" role="group">\n                    <button id="${l+"-display-selectables"}"\n                        class="btn btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown"\n                        aria-haspopup="true" aria-expanded="false">\n                        ${i._header.selectables.text()}\n                    </button>\n                    <div class="dropdown-menu" aria-labelledby="${l+"-display-selectables"}">\n                        <button class="dropdown-item selectable-selectPage">\n                            ${e.rup.i18n.base.rup_list.multiselection.selectAllPage}\n                        </button>\n                        <button class="dropdown-item selectable-deselectPage">\n                            ${e.rup.i18n.base.rup_list.multiselection.deselectAllPage}\n                        </button>\n                        <button class="dropdown-item selectable-selectAll">\n                            ${e.rup.i18n.base.rup_list.multiselection.selectAll}\n                        </button>\n                        <button class="dropdown-item selectable-deselectAll">\n                            ${e.rup.i18n.base.rup_list.multiselection.deselectAll}\n                        </button>\n                    </div>\n                </div>\n            `);i._header.selectables.text(""),i._header.selectables.append(r.clone()),i.createFooter&&(i._footer.selectables.text(""),i._footer.selectables.append(r.clone())),e(".selectable-selectAll").on("click",(()=>{t._selectAll.apply(t)})),e(".selectable-deselectAll").on("click",(()=>{t._deselectAll.apply(t)})),e(".selectable-selectPage").on("click",(()=>{t._selectPage.apply(t)})),e(".selectable-deselectPage").on("click",(()=>{t._deselectPage.apply(t)}))},_getPageElementsIds:function(){var t=[];return e("#"+e.escapeSelector(this.element[0].id)).children().toArray().forEach((l=>{t.push(String(e(l)[0].id))})),t},_getPageIds:function(){var t=[];return e("#"+e.escapeSelector(this.element[0].id)).children().toArray().forEach((l=>{t.push(String(e(l).data("pk")))})),t},_pagenavManagement:function(t){var l=this,i=this.options,r=i._header.pagenav,a=i._header.pagePrev,s=i._header.pageNext,o=i._footer.pagenav,n=i._footer.pagePrev,d=i._footer.pageNext;if(t>i.visiblePages+1){var c,p=1;if(i.page>=i.visiblePages){p=i.page+i.visiblePages-1>t?t-i.visiblePages+1:i.page-1;var u=e('<li data-page="1"><div class="page-link" href="javascript:void(0)">1</div></li>');u.addClass("rup_list-page-item page-item page"),u.attr("tabindex","0"),u.attr("role","button"),u.attr("aria-controls",l.element.attr("id")),u.attr("aria-label",e.rup.i18nTemplate(e.rup.i18n.base.rup_list,"paginaLabel",1,t)),r.find(".page-separator").first().before(u),o.find(".page-separator").first().before(u.clone()),i.page-i.visiblePages>0&&(r.find(".page-separator").first().show(),r.find(".page-separator").first().attr("aria-hidden","false"),o.find(".page-separator").first().show(),o.find(".page-separator").first().attr("aria-hidden","false"))}c=p+i.visiblePages<t?p+i.visiblePages:t+1;for(var m=p;m<c;m++){let i=e('<li data-page="'+m+'"><div class="page-link" href="javascript:void(0)">'+m+"</div></li>");i.addClass("rup_list-page-item page-item page"),i.attr("tabindex","0"),i.attr("role","button"),i.attr("aria-controls",l.element.attr("id")),i.attr("aria-label",e.rup.i18nTemplate(e.rup.i18n.base.rup_list,"paginaLabel",m,t)),r.find(".page-separator").last().before(i),o.find(".page-separator").last().before(i.clone())}if(i.page+i.visiblePages-1<t&&(r.find(".page-separator").last().show(),r.find(".page-separator").last().attr("aria-hidden","false"),o.find(".page-separator").last().show(),o.find(".page-separator").last().attr("aria-hidden","false")),c<t){let i=e('<li data-page="'+t+'"><div class="page-link" href="javascript:void(0)">'+t+"</div></li>");i.addClass("rup_list-page-item page-item page"),i.attr("tabindex","0"),i.attr("role","button"),i.attr("aria-controls",l.element.attr("id")),i.attr("aria-label",e.rup.i18nTemplate(e.rup.i18n.base.rup_list,"paginaLabel",t,t)),r.find(".page-separator").last().after(i),o.find(".page-separator").last().after(i.clone())}}else for(let i=t;i>0;i--){let r=e('<li data-page="'+i+'"><div class="page-link" href="javascript:void(0)">'+i+"</div></li>");r.addClass("rup_list-page-item page-item page"),r.attr("tabindex","0"),r.attr("role","button"),r.attr("aria-controls",l.element.attr("id")),r.attr("aria-label",e.rup.i18nTemplate(e.rup.i18n.base.rup_list,"paginaLabel",i,t)),a.after(r),n.after(r.clone())}t>1?(i._header.pagenav.show(),i.createFooter&&i._footer.pagenav.show()):(i._header.pagenav.hide(),i.createFooter&&i._footer.pagenav.hide());const g=e("#"+e.escapeSelector(i._idListHeader.pagenav)+' .page[data-page="'+i.page+'"]'),_=e("#"+e.escapeSelector(i._idListFooter.pagenav)+' .page[data-page="'+i.page+'"]');g.toggleClass("active"),g.attr("aria-current","true"),_.toggleClass("active"),_.attr("aria-current","true"),e("#"+e.escapeSelector(i._idListHeader.pagenav)+" .rup_list-page-item.page, #"+e.escapeSelector(i._idListFooter.pagenav)+" .rup_list-page-item.page").on("click",(function(){const t=e("#"+e.escapeSelector(i._idListHeader.pagenav)+" .rup_list-page-item.page.active"),r=e("#"+e.escapeSelector(i._idListFooter.pagenav)+" .rup_list-page-item.page.active");t.toggleClass("active"),t.attr("aria-current","false"),r.toggleClass("active"),r.attr("aria-current","false"),e(this).toggleClass("active"),e(this).attr("aria-current","true"),l._changeOption("page",e(this).data("page"))})),i.page>1?(l._enableNavItem(a),l._enableNavItem(n)):(l._disableNavItem(a),l._disableNavItem(n)),i.page<t?(l._enableNavItem(s),l._enableNavItem(d)):(l._disableNavItem(s),l._disableNavItem(d))},_reorderDataFromServer:function(t,l,i){let r=i.reorderedSelection;null!==r&&r.length>0&&i.records!=r.length&&(l.multiselection.selectedIds=[],l.multiselection.selectedRowsPerPage=[],e.each(r,(function(e,t){var i={id:t.pk[l.key],page:t.page,line:t.pageLine-1};l.multiselection.selectedIds.splice(e,0,i.id),l.multiselection.selectedRowsPerPage.splice(e,0,i)})),e("#"+e.escapeSelector(t.element[0].id)).triggerHandler("listAfterReorderData",l))},_lock:function(){const t=this,l=t.options;l.isScrollList&&l.stepOnLoad?(e("#"+e.escapeSelector(l._idOverlay)).remove(),l._overlay.css({position:"relative",height:"auto"}),t.element.after(l._overlay)):(l._header.obj.css("opacity","0.3"),t.element.css("opacity","0.3"),l.createFooter&&l._footer.obj.css("opacity","0.3"),e("#"+e.escapeSelector(l._idOverlay)).remove(),l._overlay.css({position:"absolute"}),l._content.prepend(l._overlay),l._overlay.height(l._content.height()))},_unlock:function(){const t=this.options;t._header.obj.css("opacity","1"),this.element.css("opacity","1"),t.createFooter&&t._footer.obj.css("opacity","1"),e("#"+e.escapeSelector(t._idOverlay)).remove()},destroy:function(){const t=this.options;e(this.element).empty(),t.createFooter&&t._footer.obj.remove(),t.feedback.rup_feedback("destroy"),e.Widget.prototype.destroy.apply(this,arguments)},_doFilter:function(){const t=this,l=this.options,i=l._itemTemplate,r=l._header.pagenav,a=l._footer.pagenav;var s="",o="";l.isMultiSort?(s=l.multiorder.sidx,o=l.multiorder.sord):(s=l.sidx.value,o=l.sord);var n={filter:e("#"+e.escapeSelector(l.filterForm)).rup_form("formToJson"),page:l.page,rows:l.rowNum.value,sidx:s,sord:o,multiselection:l.multiselection,core:{pkNames:[l.key],pkToken:"~"}};l.show?l.show.constructor==Object&&(l.show=l.show):0==l.show?(l.show={},l.animation=!1):(l.show={},l.show.animation="drop",l.show.delay=200),l.hide?l.hide.constructor==Object&&(l.hide=l.hide):0==l.hide?(l.hide={},l.animation=!1):(l.hide={},l.hide.animation="drop",l.hide.delay=200),l.btnPrint&&l.btnPrint[0].disabled&&(l.btnPrint[0].disabled=!1);let d=!0;1==e(`form[id="${l.filterForm}"]`).length&&(d=e("#"+e.escapeSelector(l.filterForm)).rup_form("valid")),d?jQuery.rup_ajax({url:l.action,type:"POST",dataType:"json",data:JSON.stringify(n),contentType:"application/json",beforeSend:function(){t.element.trigger("beforeLoad",n)},success:function(s){if(r.find(".page").remove(),r.find(".page-separator").hide(),r.find(".page-separator").attr("aria-hidden","true"),a.find(".page").remove(),a.find(".page-separator").hide(),a.find(".page-separator").attr("aria-hidden","true"),null===s||0===s.length)l._header.obj.hide(),t.element.hide(),l.createFooter&&l._footer.obj.hide(),l.records=0,l.feedback.rup_feedback("set",e.rup.i18n.base.rup_table.errors.errorOnGet,"error"),l._content.slideDown(),t.element.trigger("load"),e(t.element).attr("aria-live","polite"),t.isFiltering.resolve(),t._unlock();else if(s.rows&&s.rows.length>0){t._reorderDataFromServer(t,l,s);var o=(l.page-1)*parseInt(l.rowNum.value)+1,n=o+s.rows.length-1,d=0==parseInt(s.records)?s.rows.length:s.records;l.records=d;var c=e.rup.i18nTemplate(e.rup.i18n.base.rup_table.defaults,"recordtext",o,n,d);if(l.feedback.rup_feedback({}),l.feedback.rup_feedback("set",c,"ok"),t._pagenavManagement(Math.ceil(s.records/l.rowNum.value)),e.each(s.rows,(function(r,a){var o=i.clone(!0,!0);o.removeClass("rup_list-itemTemplate"),o.addClass("rup_list-item"),o.attr("id",o.attr("id")+"_"+a[l.key]),o.data("all",a),o.data("pk",a[l.key]);var n=e.rup_utils.jsontoarray(a),d=Object.keys(e.rup_utils.jsontoarray(a));if(l.selectable){let t=e(l.selectable.selector,o);t.attr("id",t.attr("id")+"_"+a[l.key])}if(s.reorderedSelection){let e=s.reorderedSelection.filter((e=>e.pk[l.key]==a[l.key]));(e.length>0&&!s.selectedAll||0==e.length&&s.selectedAll||s.records==s.reorderedSelection.length)&&(o.addClass("rup_list-item-selected"),o.attr("aria-selected","true"))}for(var c=0;c<d.length;++c)o.find('[id="'+d[c]+'_label"]').text(l.colNames[d[c]]?l.colNames[d[c]]:d[c]).attr("id",d[c]+"_label_"+a[l.key]),o.find('[id="'+d[c]+'_value"]').text(n[d[c]]).attr("id",d[c]+"_value_"+a[l.key]);e("#"+e.escapeSelector(t.element[0].id)).trigger("modElement",[o,a])})),l._header.obj.show(),t.element.show(),l.createFooter&&l._footer.obj.show(),l._content.slideDown(),l.content||(l.content={}),0==l.content.length||null==l.content.length)l.content=s.rows;else if(l.isScrollList){var p=l.content.length;for(let e=0;e<s.rows.length;e++)l.content[p+e]=s.rows[e]}else l.content=s.rows;e(".rup_list-item").attr("role","listitem"),l.selectable&&(e(l.selectable.selector+".rup_list-item").attr("tabindex","0"),e(l.selectable.selector+".rup_list-item").attr("role","option"))}else l._header.obj.hide(),t.element.hide(),l.createFooter&&l._footer.obj.hide(),l.records=0,l.feedback.rup_feedback("set",e.rup.i18n.base.rup_table.defaults.emptyrecords,"alert"),l._content.slideDown(),t.element.trigger("load"),t.isFiltering.resolve(),t._unlock();l.isScrollList&&(r.hide(),a.hide()),l.isHeaderSticky&&t._headerSticky.apply(t),t.element.children().each((function(i,r){setTimeout((function(){e(r).show(l.show.animation,{},l.show.delay,(function(){0==e(r).next().length&&(t.element.css("height","auto"),t.element.trigger("load"),l.isScrollList&&l.stepOnLoad&&(t.isFiltering.resolve(),t._unlock()),l.isScrollList&&(t.options.stepLoad=t.element.children().length/t.options.rowNum.value,t.options.stepOnLoad=!1,t.options.stepCounter=0)),i!==t.element.children().length-1||l.stepOnLoad||(e(".rup_list-item").removeAttr("aria-hidden"),t.isFiltering.resolve(),t._unlock())})),l.show.animation||0==e(r).next().length&&(t.element.css("height","auto"),t.element.trigger("load"),l.isScrollList&&l.stepOnLoad&&(t.isFiltering.resolve(),t._unlock()),l.isScrollList&&(t.options.stepLoad=t.element.children().length/t.options.rowNum.value,t.options.stepOnLoad=!1,t.options.stepCounter=0))}),50+50*i)}))},error:function(e){l.feedback.rup_feedback("set",e.responseText,"error"),l._header.obj.hide(),t.element.hide(),l.createFooter&&l._footer.obj.hide(),l._content.slideDown(),t.element.trigger("load"),t.isFiltering.resolve(),t._unlock()}}):(t.element.trigger("load"),t.isFiltering.resolve(),t._unlock())},reload:function(){var t=this,l=t.options;e.when(t.isFiltering).done((()=>{delete t.isFiltering,t.isFiltering=e.Deferred(),t._lock(),t.element.children().length>0?t.element.css("height",t.element.outerHeight()+16).children().each((function(i,r){setTimeout((function(){e(r).hide(l.hide.animation,{},l.hide.delay,(function(){e(this).attr("aria-hidden","true"),e(this).remove(),0==t.element.children().length&&t._doFilter()}))}),50+50*i)})):t._doFilter()}))},filter:function(){var t=this,l=this.options;l.page=1,e.when(t.isFiltering).done((()=>{delete t.isFiltering,t.isFiltering=e.Deferred(),t._lock(),t.element.children().length>0?t.element.css("height",t.element.outerHeight()+16).children().each((function(i,r){setTimeout((function(){e(r).hide(l.hide.animation,{},l.hide.delay,(function(){e(this).remove(),e(this).attr("aria-hidden","true"),l.isScrollList&&t._deselectAll(),0==t.element.children().length&&t._doFilter()}))}),50+50*i)})):t._doFilter()}))},page:function(e){this._changeOption("page",e)},getSelectedIds:function(){var e=this.options.multiselection;return{selectedIds:e.selectedIds,selectedAll:e.selectedAll}}})}));