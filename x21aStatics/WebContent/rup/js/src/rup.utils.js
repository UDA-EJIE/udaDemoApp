/*! For license information please see rup.utils.js.LICENSE.txt */
!function(r){"function"==typeof define&&define.amd?define(["jquery","jqueryUI","./core/utils/jquery.json-2.2"],r):r(jQuery)}((function(r){r.rup_utils={},r.rup_utils.arr=[],r.rup_utils.autoGenerateIdNum=0,r.rup_utils.swinging=!1,r.extend(r.rup_utils,{capitalizedLang:function(){return null==r.rup.lang?"":r.rup.lang.charAt(0).toUpperCase()+r.rup.lang.slice(1)},getJson:function(e,t){var n=r.extend({},e),i=t.split(".");if(1===i.length)return e[i[0]];for(var a=0;a<i.length;a++)n=n[i[a]];return n},setJson:function(r,e,t){var n=r,i=e.split(".");if(1===i.length)r[i[0]]=t;else{for(var a=0;a<i.length-1;a++)n=n[i[a]];n[i[i.length-1]]=t}},jsontoarray:function(r){var e=[];return function r(t,n){if(n=n||"",null==t)r("",n);else if(t.constructor==Object)for(var i in t){var a=n+(""==n?i:"."+i);r(t[i],a)}else if(t.constructor==Array)if(0==t.length)r("[]",n);else for(var o=0;o<t.length;o++){let e=n+"["+o+"]";r(t[o],e)}else null==e[n]?e[n]=t:e[n].constructor!=Array?e[n]=[e[n],t]:e[n].push(t)}(r),e},unnestjson:function(e){var t=r.rup_utils.jsontoarray(e),n={};for(var i in t)"function"!=typeof t[i]&&(n[i]=t[i]);return n},formatoFecha:function(r,e){var t=e.split(" "),n=r.split(" "),i=t[0],a=/^\d{2}\/\d{2}\/\d{4}$/.test(i);if("dd/mm/yyyy"===n[0]&&a)return void 0!==n[1]?[t[0],t[1]]:[t[0]];if("dd/mm/yyyy"!==n[0]||a){if("yyyy/mm/dd"!==n[0]||a){if("(dd/mm/aaaa)"===n[0]&&a)return void 0!==n[1]?[t[0],t[1]]:[t[0]];if("(dd/mm/aaaa)"!==n[0]||a)return"(aaaa/mm/dd)"===n[0]&&a||"(aaaa/mm/dd)"!==n[0]||a?(o=(u=i.split("/"))[2]+"/"+u[1]+"/"+u[0],void 0!==n[1]?[o,t[1]]:[o]):void 0!==n[1]?[t[0],t[1]]:[t[0]];var o=(u=i.split("/"))[2]+"/"+u[1]+"/"+u[0];return void 0!==n[1]?[o,t[1]]:[o]}return void 0!==n[1]?[t[0],t[1]]:[t[0]]}var u;o=(u=i.split("/"))[2]+"/"+u[1]+"/"+u[0];return void 0!==n[1]?[o,t[1]]:[o]},elementFromPoint:function(e,t,n){var i,a=!0,o=n||!0;return document.elementFromPoint?(o||((i=r(document).scrollTop())>0?a=null==document.elementFromPoint(0,i+r(window).height()-1):(i=r(document).scrollLeft())>0&&(a=null==document.elementFromPoint(i+r(window).width()-1,0)),o=i>0),a||(e+=r(document).scrollLeft(),t+=r(document).scrollTop()),document.elementFromPoint(e,t)):null},firstCharToLowerCase:function(r){return r.substring(0,1).toLowerCase()+r.substring(1)},getJQueryId:function(r,e){var t;return"string"==typeof r?(t=r,!0===e&&(t=String(t).replace(/[!"#$%&'()*+,./:; <=>?@[\\\]^`{|}~]/g,"\\$&")),"#"===t[0]?t:"#"+t):null},queryStringToJson:function(e,t="&",n=!1){function i(r,e,t){if(e.length>1){var n=e.shift();void 0===r[n]&&(r[n]=""==e[0]?[]:{}),arguments.callee(r[n],e,t)}else if(r instanceof Array)r.push(t);else if(-1!=e[0].indexOf(".")){var i=e[0].slice(0,e[0].indexOf(".")),a=e[0].slice(e[0].indexOf(".")+1,e[0].length);null!=r[i]?r[i][a]=t:r[i]={[a]:t}}else r[e]=t}for(var a,o,u,l,s,c=[],p=e.split(t),f={},d=0;d<p.length;d++)(a=p[d].split("=")).length>=2?c.push(p[d]):1==a.length&&(c[d-1]=c[d-1]+t+p[d]);for(d=0;d<c.length;d++){if((a=c[d].split("=")).length>2){for(var h="",m=1;m<a.length;m++)h=1==m?a[m]:h+"="+a[m];a[a.length-1]=h}o=decodeURIComponent(a[0]),a[a.length-1].includes("%")&&(n&&!a[a.length-1].includes("%25")?a[a.length-1]=encodeURIComponent(a[a.length-1]):n||r.rup.errorGestor(r.rup.i18nParse(r.rup.i18n.base,"rup_utils.illegalChar"))),u=decodeURIComponent(a[a.length-1]),s=(l=o.match(/(^[^[]+)(\[.*\]$)?/))[1],(l=l[2]?l[2].match(/(?=\[(.*)\]$)/)[1].split("]["):[]).unshift(s),i(f,l,u)}return f},queryStringToObject:function(e,t,n){let i=r.fn.unflattenObject(queryString.parse(e,t));return null!=n&&Object.keys(i).forEach((r=>{let e=n.find(`[name="${r}"]`);(e.is("select[multiple]")||"select"===e.attr("ruptype")&&void 0!==e.attr("multiple"))&&!Array.isArray(i[r])&&(i[r]=[i[r]])})),i},normalize:function(r){for(var e={á:"a",é:"e",í:"i",ó:"o",ú:"u",Á:"A",É:"E",Í:"I",Ó:"O",Ú:"U"},t="",n=0;n<r.length;n++)t+=e[r.charAt(n)]||r.charAt(n);return t},populateForm:function(e,t){var n;let i=r.Deferred();function a(){var e=this.id;r(this).trigger("rup_filter_treeLoaded",$arbol[e])}function o(){r(this).val()==e[u]?r(this).prop("checked",!0):r(this).prop("checked",!1)}if(e)for(var u in e){const i=(n=r("[name='"+u+"']",t)).data("tree-id");void 0!==i&&(n=r("div[id='"+i+'\'][class*="jstree"]',t)),n.is("[ruptype]")?n.hasClass("jstree")?(n["rup_"+n.attr("ruptype")]("setRupValue",e[u]),n.on("loaded.jstree",a)):"select"===n.attr("ruptype")?n["rup_"+n.attr("ruptype")]("setRupValue",e[u]):n["rup_"+n.attr("ruptype")]("setRupValue",e[u]??""):n.is("input:radio")||n.is("input:checkbox")?n.each(o):n.is("select")?n.val(e[u]).click():n.is(":not(img)")&&n.val(e[u])}i.resolve()},editFormSerialize(e,t="&"){const n=e.formToArray();let i="",a="",o=0;return r.each(n,(function(n,u){a!=u.name&&(o=0);let l="";r(e).find('[name="'+u.name+'"]').prop("multiple")?l="["+o+++"]":a===u.name&&(i=i.replace(a+"=",a+"["+o+++"]="),l="["+o+++"]"),i+=u.name+l+"="+u.value,i+=t,a=u.name})),i=i.substring(0,i.length-t.length),i},formDataToQueryString(e,t){let n="";return r.each(e.formToArray(),(function(r,e){n+=queryString.stringify({[e.name]:e.value},t)+"&"})),n=n.substring(0,n.length-1),n},createDate:function(e,t,n){return r.datepicker.formatDate(r.rup.i18n.base.rup_date.dateFormat,new Date(n,t-1,e))},createTime:function(r,e,t){return new Date(null,null,null,r,e,t)},setCookie:function(e,t,n){if(void 0===e||void 0===t||null===e||null===t)return r.rup.errorGestor("["+r.rup.i18nParse(r.rup.i18n.base,"rup_global.metodError")+"setCookie] - "+r.rup.i18nParse(r.rup.i18n.base,"rup_utils.paramsError")),!1;var i=e+"="+encodeURIComponent(t);if(null!=n){if(n.domain&&(i+="; domain="+n.domain),n.path&&(i+="; path="+n.path),n.duration){var a=new Date;a.setTime(a.getTime()+24*n.duration*60*60*1e3),i+="; expires="+a.toGMTString()}n.secure&&(i+="; secure")}return document.cookie=i},delCookie:function(e){return null==e?(r.rup.errorGestor("["+r.rup.i18nParse(r.rup.i18n.base,"rup_global.metodError")+"delCookie] - "+r.rup.i18nParse(r.rup.i18n.base,"rup_utils.paramsError")),!1):r.rup_utils.setCookie(e,"",{duration:-1})},readCookie:function(e){if(null==e)return r.rup.errorGestor("["+r.rup.i18nParse(r.rup.i18n.base,"rup_global.metodError")+"readCookie] - "+r.rup.i18nParse(r.rup.i18n.base,"rup_utils.paramsError")),!1;var t=document.cookie.match("(?:^|;)\\s*"+e.replace(/([-.*+?^${}()|[\]/\\])/g,"\\$1")+"=([^;]*)");return t?decodeURIComponent(t[1]):null},get:function(e,t){var n=null;if(document.cookie&&""!=document.cookie)for(var i=document.cookie.split(";"),a=0;a<i.length;a++){var o=i[a].trim();if(o.substring(0,e.length+1)==e+"="){n=t?r.JSON.decode(decodeURIComponent(o.substring(e.length+1))):decodeURIComponent(o.substring(e.length+1));break}}return n},set:function(e,t,n){n=r.extend({},n),null===t&&(t="",n.expires=-1);var i,a="";n.expires&&("number"==typeof n.expires||n.expires.toUTCString)&&("number"==typeof n.expires?(i=new Date).setTime(i.getTime()+24*n.expires*60*60*1e3):i=n.expires,a="; expires="+i.toUTCString()),t=n.json?encodeURIComponent(r.JSON.encode(t)):encodeURIComponent(t);var o=n.path?"; path="+n.path:"",u=n.domain?"; domain="+n.domain:"",l=n.secure?"; secure":"";document.cookie=[e,"=",t,a,o,u,l].join("")},compareObjects:function(r,e){var t=!0;if(Object.keys(r).length!==Object.keys(e).length)return!1;for(var n in r)if("object"==typeof r[n]&&"object"==typeof e[n]){if(!(t=this.compareObjects(r[n],e[n])))break}else if(r[n]!==e[n]){t=!1;break}return t},escapeId:function(r){return r?r.replace(/([ #;&,.+*~':"!^$[\]()=>|/@])/g,"\\$1"):""},selectorId:function(r){return"string"==typeof r&&"#"!==r.substring(0,1)?"#"+r:r},randomIdGenerator:function(e){var t="rupRandomLayerId-"+r.rup_utils.autoGenerateIdNum;return e.attr("id",t).addClass("rupRandomLayerId"),r.rup_utils.autoGenerateIdNum=r.rup_utils.autoGenerateIdNum+1,t},setNoPortalParam:function(e){return null!=e&&(null!==r.rup_utils.readCookie("r01PortalInfo")&&null===e.match("R01HNoPortal")&&r("div.r01gContainer").length>0||r("div.r01gApplication").length>0)?e+(null===e.match("\\?")?"?":"&")+"R01HNoPortal=true":e},aplicatioInPortal:function(){return null!==r.rup_utils.readCookie("r01PortalInfo")&&r("div.r01gContainer").length>0},relToAbsUrl:function(e){var t=r(location);if("string"==typeof e){var n=e.substring(0,1),i=e.substring(1,2);if(void 0===r.url(e).attr("protocol")||""===r.url(e).attr("protocol")){if("/"===n)return void 0===i||"/"!==i?t.attr("protocol")+"//"+t.attr("host")+e:t.attr("protocol")+e;if("."===n){if(void 0===i)return void r.rup.errorGestor(r.rup.i18nParse(r.rup.i18n.base,"rup_utils.relToAbsUrlParamError")+e+r.rup.i18nParse(r.rup.i18n.base,"rup_utils.relToAbsUrlParamErrorEnd"));if("/"===i){let n=r.url(t.attr("href"),!0);return n.attr("base")+n.attr("directory")+e.substring(2,e.length)}if("."===i){var a=t.attr("pathname").split("/"),o=a.length-2;if(void 0!==e.substring(2,3)&&"/"===e.substring(2,3)){let r=e.split("../"),n=r.length-1;if(n>=o)return t.attr("protocol")+"//"+t.attr("host")+"/"+r[r.length-1];{let e="";for(let r=o-n;r>0;r--)e=a[r]+"/"+e;return t.attr("protocol")+"//"+t.attr("host")+"/"+e+r[r.length-1]}}{let r=e.split(".."),n=r.length-1;if(n>=o)return t.attr("protocol")+"//"+t.attr("host")+r[r.length-1];{let e="";for(let r=o-n;r>0;r--)e=a[r]+"/"+e;return t.attr("protocol")+"//"+t.attr("host")+"/"+e+r[r.length-1]}}}return void r.rup.errorGestor(r.rup.i18nParse(r.rup.i18n.base,"rup_utils.relToAbsUrlParamError")+e+r.rup.i18nParse(r.rup.i18n.base,"rup_utils.relToAbsUrlParamErrorEnd"))}{let n=r.url(t.attr("href"),!0);return n.attr("base")+n.attr("directory")+e}}return e}r.rup.errorGestor(r.rup.i18nParse(r.rup.i18n.base,"rup_utils.relToAbsUrlParamFormatError"))},printMsg:function(e){var t="";if("string"==typeof e)return e+"<br/>";if("object"==typeof e){if(Array.isArray(e)){for(var n=0;n<e.length;n++)t+=r.rup_utils.printMsgAux(e[n],1);return t}t+=r.rup_utils.printMsgAux(e,1)}return t},printMsgAux:function(e,t){if("string"==typeof e)return r("<span>").append(e)[0].outerHTML+"<br/>";if("object"==typeof e){if(Array.isArray(e)){for(var n=r("<ul>").addClass("rup-maint_feedbackUL"),i=0;i<e.length;i++)1===t?n.append(r("<li>").append(r.rup_utils.printMsgAux(e[i],t+1))):n.append(r.rup_utils.printMsgAux(e[i],t+1));return""+n[0].outerHTML}var a=r("<span>");return void 0!==e.style&&a.addClass(e.style),void 0!==e.label&&a.append(e.label),a[0].outerHTML+"<br/>"}},getUrlVars:function(){if(void 0===r.rup.getParams){for(var e,t={},n=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),i=0;i<n.length;i++)t[(e=decodeURIComponent(n[i]).split("="))[0]]=e[1];r.rup.getParams=t}return r.rup.getParams},getUrlVar:function(e){return r.rup_utils.getUrlVars()[e]},sortArray:function(r,e){Array.isArray(r)&&function(r,e){var t;do{t=!1;for(var n=0;n<r.length-1;n++)if(e(r[n],r[n+1])<0){var i=r[n];r[n]=r[n+1],r[n+1]=i,t=!0}}while(t)}(r,"function"==typeof e?e:function(r,e){return r-e})},insertSorted:function(e,t,n){if(Array.isArray(e))return e.push(t),"function"==typeof n?r.rup_utils.sortArray(e,n):r.rup_utils.sortArray(e,(function(r,e){return e-r})),r.inArray(t,e)},getRupValueAsJson:function(r,e){var t,n,i,a=[];if(r){if(n=(t=r.split(".")).length>1?t[t.length-1]:t[0],!Array.isArray(e))return(i={})[n]=e,i;if(0!==e.length){for(var o=0;o<e.length;o++)(i={})[n]=e[o],a.push(i);return a}}return null},getRupValueWrapped:function(r,e){var t,n={};return r?(t=r.split(".")).length>1?(n[t[t.length-1]]=e,n):e:null},swing2Top:function(){r.rup_utils.swinging||(r.rup_utils.swinging=!0,r("html, body").animate({scrollTop:0},"1000","swing",(function(){r.rup_utils.swinging=!1})))},format:function(e){var t=r.makeArray(arguments).slice(1);return null==e&&(e=""),e.replace(/\{(\d+)\}/g,(function(r,e){return t[e]}))},deepCopy:function(e,t){var n=0,i=[];return function(e){var a;return a=e instanceof Array?[]:{},null==e?{}:(Object.keys(e).forEach((function(o){["string","number","boolean","function"].includes(typeof e[o])?a[o]=e[o]:!i.includes(e[o])&&n<=t?(i.push(e[o]),n++,a[o]=r.rup_utils.deepCopy(e[o],0)):a[o]=n>t?e[o]:"__ciclico__"})),a)}(e)},isNumeric:function(r){return!isNaN(parseFloat(r))&&isFinite(r)}}),r.fn.serializeToObject=function(){var e={},t=this.serializeArrayWithoutNulls();return r.each(t,(function(){e[this.name]?(e[this.name].push||(e[this.name]=[e[this.name]]),e[this.name].push(this.value||"")):e[this.name]=this.value})),e},r.fn.serializeArrayWithoutNulls=function(){return this.map((function(){return this.elements?jQuery.makeArray(this.elements):this})).filter((function(){return this.name&&!this.disabled&&(this.checked||/select|textarea/i.test(this.nodeName)||/color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week/i.test(this.type))})).map((function(r,e){var t=jQuery(this).val();return jQuery(this).hasClass("numeric")||jQuery(this).hasClass("datepicker")?{name:e.name,value:null}:null===t||""===t?null:Array.isArray(t)?jQuery.map(t,(function(r){return{name:e.name,value:r}})):{name:e.name,value:t}})).get()},r.fn.serializeObject=function(){var e={},t=this.serializeArrayNull();return r.each(t,(function(){e[this.name]?(e[this.name].push||(e[this.name]=[e[this.name]]),e[this.name].push(this.value||"")):e[this.name]=this.value})),e},r.fn.serializeArrayNull=function(){return this.map((function(){return this.elements?jQuery.makeArray(this.elements):this})).filter((function(){return this.name&&!this.disabled&&(this.checked||/select|textarea/i.test(this.nodeName)||/color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week/i.test(this.type))})).map((function(r,e){var t=jQuery(this).val();return(jQuery(this).hasClass("numeric")||jQuery(this).hasClass("datepicker"))&&""===t?{name:e.name,value:null}:null===t?null:Array.isArray(t)?jQuery.map(t,(function(r){return{name:e.name,value:r}})):{name:e.name,value:t}})).get()},r.fn.flattenJSON=function(e,t={},n=""){for(let i in e)"object"!=typeof e[i]?t[n+i]=e[i]:r.fn.flattenJSON(e[i],t,`${n}${i}.`);return t},r.fn.flattenObject=function(r,e){return flatten(r,e)},r.fn.unflattenObject=function(r,e){return unflatten(r,e)},jQuery.rup_utils.base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(r){var e,t,n,i,a,o,u,l="",s=0;for(r=jQuery.rup_utils.base64._utf8_encode(r);s<r.length;)i=(e=r.charCodeAt(s++))>>2,a=(3&e)<<4|(t=r.charCodeAt(s++))>>4,o=(15&t)<<2|(n=r.charCodeAt(s++))>>6,u=63&n,isNaN(t)?o=u=64:isNaN(n)&&(u=64),l=l+this._keyStr.charAt(i)+this._keyStr.charAt(a)+this._keyStr.charAt(o)+this._keyStr.charAt(u);return l},decode:function(r){var e,t,n,i,a,o,u="",l=0;for(r=r.replace(/[^A-Za-z0-9+/=]/g,"");l<r.length;)e=this._keyStr.indexOf(r.charAt(l++))<<2|(i=this._keyStr.indexOf(r.charAt(l++)))>>4,t=(15&i)<<4|(a=this._keyStr.indexOf(r.charAt(l++)))>>2,n=(3&a)<<6|(o=this._keyStr.indexOf(r.charAt(l++))),u+=String.fromCharCode(e),64!=a&&(u+=String.fromCharCode(t)),64!=o&&(u+=String.fromCharCode(n));return jQuery.rup_utils.base64._utf8_decode(u)},_utf8_encode:function(r){r=r.replace(/\r\n/g,"\n");for(var e="",t=0;t<r.length;t++){var n=r.charCodeAt(t);n<128?e+=String.fromCharCode(n):n>127&&n<2048?(e+=String.fromCharCode(n>>6|192),e+=String.fromCharCode(63&n|128)):(e+=String.fromCharCode(n>>12|224),e+=String.fromCharCode(n>>6&63|128),e+=String.fromCharCode(63&n|128))}return e},_utf8_decode:function(r){for(var e="",t=0,n=0,i=0,a=0;t<r.length;)(n=r.charCodeAt(t))<128?(e+=String.fromCharCode(n),t++):n>191&&n<224?(i=r.charCodeAt(t+1),e+=String.fromCharCode((31&n)<<6|63&i),t+=2):(i=r.charCodeAt(t+1),a=r.charCodeAt(t+2),e+=String.fromCharCode((15&n)<<12|(63&i)<<6|63&a),t+=3);return e}}}));