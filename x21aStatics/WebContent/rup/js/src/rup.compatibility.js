/*! For license information please see rup.compatibility.js.LICENSE.txt */
!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)}((function(e,t){e.rup.compatibility=e.rup.compatibility||{},e.extend(e.rup.compatibility,{menu:{delay:7,outDelay:7,focus:function(t,i){var s,a,n,r,u,o,c;this.blur(t),this._hasScroll()&&(a=parseFloat(e.css(this.activeMenu[0],"borderTopWidth"))||0,n=parseFloat(e.css(this.activeMenu[0],"paddingTop"))||0,r=i.offset().top-this.activeMenu.offset().top-a-n,u=this.activeMenu.scrollTop(),o=this.activeMenu.height(),c=i.height(),r<0?this.activeMenu.scrollTop(u+r):r+c>o&&this.activeMenu.scrollTop(u+r-o+c));var l=this.activeMenu;this.active=i.first(),this.active.hasClass("rup_menu_horizontal_children")?(this.element.attr("aria-activedescendant",this.active.children("a").attr("id")),this.active.addClass("ui-state-focus")):this.element.attr("aria-activedescendant",this.active.children("a").addClass("ui-state-focus").attr("id")),this.active.parent().closest(".ui-menu-item").children("a").first().addClass("ui-state-active"),this.active.children("a").hasClass("ui-state-active")?(this.active.children("a").removeClass("ui-state-active"),this.active.find("[aria-expanded = 'true']").length>1&&this._close(l)):(this._close(),((s=e("> .ui-menu",i)).length&&/^focus/.test(t.type)&&"true"!==i.attr("rupMenu_firsLevel")||s.length&&/^click/.test(t.type)&&"true"===i.attr("rupMenu_firsLevel"))&&this._startOpening(s)),this.activeMenu=i.parent()},_getWidgetMenu:function(){return void 0!==window.widgetMenu?window.widgetMenu:t},_create:function(){this.activeMenu=this.element,this.menuId=this.element.attr("id")||"ui-menu-"+window.idIncrement++,this.element.find(".ui-icon").length&&this.element.addClass("ui-menu-icons"),this.element.addClass("ui-menu ui-widget ui-widget-content ui-corner-all").attr({id:this.menuId,role:"menu",tabIndex:0}).on("click.menu",function(e){this.options.disabled&&e.preventDefault()}.bind(this)),this.options.disabled&&this.element.addClass("ui-state-disabled"),this._bind({"mousedown .ui-menu-item > a":function(e){e.preventDefault()},"click .ui-state-disabled > a":function(e){e.preventDefault()},"click .ui-menu-item:has(a)":function(t){t.stopImmediatePropagation();var i=e(t.currentTarget);"true"===i.attr("rupMenu_firsLevel")&&(i.children("[aria-expanded = 'true']").length>0?this._close(i):this.focus(t,i))},"focus .ui-menu-item a":function(t){var i=e(t.currentTarget).parent();this.focus(t,i)},focus:function(t){void 0===e(t.currentTarget).attr("rup_shift_nofocus")?void 0===e("#"+e.escapeSelector(this.menuId)).attr("rup_menu_nofocus")&&e(t.currentTarget).find(".ui-menu-item a").first().focus():e(t.currentTarget).removeAttr("rup_shift_nofocus")},blur:function(t){this._delay((function(){e.contains(this.element[0],this.document[0].activeElement)||this.collapseAll(t)}))},keydown:"_keydown"}),this.restoreScrollEvents(),this._bind(this.document,{click:function(t){e(t.target).closest(".ui-menu").length||this.collapseAll(t)}})},_open:function(t){clearTimeout(this.timer),this.element.find(".ui-menu").not(t.parents()).hide().attr("aria-hidden","true");var i=e.extend({},{of:this.active},"function"==typeof this.options.position?this.options.position(this.active):this.options.position);"true"===t.parent().attr("rupMenu_firsLevel")&&(i.my="left top",i.at="left bottom"),this._getWidgetMenu()(t).show().removeAttr("aria-hidden").attr("aria-expanded","true").position(i)},expand:function(){var e=this.active&&this.active.children(".ui-menu ").children(".ui-menu-item").not(".ui-state-disabled").first();if(e&&e.length)return this._open(e.parent()),this._delay((function(){e.children("a").focus()}),this.delay),!0},collapseAll:function(t,i){clearTimeout(this.timer),this.timer=this._delay((function(){var s;(s=i?this.element:e(t&&t.target).closest(this.element.find(".ui-menu"))).length||(s=this.element),this._close(s),this.blur(t),this.activeMenu=s}),this.outDelay)},blur:function(e){clearTimeout(this.timer),this.active&&(this.active.hasClass("ui-state-focus")?this.active.removeClass("ui-state-focus"):this.active.find(".ui-state-focus").removeClass("ui-state-focus"),this.active=null,this._trigger("blur",e,{item:this.active}))},_keydown:function(t){e(t.currentTarget).attr("rup_menu_click","true"),t.stopPropagation();var i=e(t.currentTarget).hasClass("rup_menu_horizontal")&&0===e(t.currentTarget).find(".ui-state-focus").length||e(t.currentTarget).find(".ui-state-focus").children().hasClass("rup_menu_horizontal_children_entry");function s(e){return e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}switch(t.code){case"PageUp":this.previousPage(t),t.preventDefault(),t.stopImmediatePropagation(),e.merge(e(t.currentTarget).find(".ui-state-focus").children("a"),e(t.currentTarget).find(".ui-state-focus").not("li")).focus();break;case"PageDown":this.nextPage(t),t.preventDefault(),t.stopImmediatePropagation(),e.merge(e(t.currentTarget).find(".ui-state-focus").children("a"),e(t.currentTarget).find(".ui-state-focus").not("li")).focus();break;case"Home":this._move("first","first",t),t.preventDefault(),t.stopImmediatePropagation(),e.merge(e(t.currentTarget).find(".ui-state-focus").children("a"),e(t.currentTarget).find(".ui-state-focus").not("li")).focus();break;case"End":this._move("last","last",t),t.preventDefault(),t.stopImmediatePropagation(),e.merge(e(t.currentTarget).find(".ui-state-focus").children("a"),e(t.currentTarget).find(".ui-state-focus").not("li")).focus();break;case"ArrowUp":t.preventDefault(),t.stopImmediatePropagation(),i?(this.collapse(t),e.merge(e(t.currentTarget).find(".ui-state-focus").children("a"),e(t.currentTarget).find(".ui-state-focus").not("li")).focus()):(this.previous(t),e.merge(e(t.currentTarget).find(".ui-state-focus").children("a"),e(t.currentTarget).find(".ui-state-focus").not("li")).focus());break;case"ArrowDown":t.preventDefault(),t.stopImmediatePropagation(),i?(this.expand(t),e.merge(e(t.currentTarget).find(".ui-state-focus").children("a"),e(t.currentTarget).find(".ui-state-focus").not("li")).focus()):(this.next(t),e.merge(e(t.currentTarget).find(".ui-state-focus").children("a"),e(t.currentTarget).find(".ui-state-focus").not("li")).focus());break;case"Left":i?(this.previous(t),t.stopImmediatePropagation(),e.merge(e(t.currentTarget).find(".ui-state-focus").children("a"),e(t.currentTarget).find(".ui-state-focus").not("li")).focus()):(e(t.target).parent().parent().parent().children("a").focus(),t.stopImmediatePropagation(),t.preventDefault(),e.merge(e(t.currentTarget).find(".ui-state-focus").children("a"),e(t.currentTarget).find(".ui-state-focus").not("li")).focus());break;case"Right":i?(this.next(t),t.stopImmediatePropagation(),e.merge(e(t.currentTarget).find(".ui-state-focus").children("a"),e(t.currentTarget).find(".ui-state-focus").not("li")).focus()):(this.expand(t)&&t.stopImmediatePropagation(),t.preventDefault(),e.merge(e(t.currentTarget).find(".ui-state-focus").children("a"),e(t.currentTarget).find(".ui-state-focus").not("li")).focus());break;case"Enter":t.stopImmediatePropagation(),t.preventDefault(),null===this.active&&(this.active=e(t.currentTarget).find(".ui-state-focus")),this.active.children("a[aria-haspopup='true']").length?this.expand(t)&&t.stopImmediatePropagation():(this.select(t),t.stopImmediatePropagation()),t.preventDefault();break;case"Escape":this.collapse(t)&&t.stopImmediatePropagation(),t.preventDefault(),e.merge(e(t.currentTarget).find(".ui-state-focus").children("a"),e(t.currentTarget).find(".ui-state-focus").not("li")).focus();break;case"Tab":if(this.collapseAll(t,!0),!t.shiftKey){var a=e(t.target).parent().parent();if(a.children().find("a").last().html()!==e(t.target).html())t.stopImmediatePropagation(),t.preventDefault(),null===this.active&&(this.active=e(t.currentTarget).find(".ui-state-focus")),this.active.children("a[aria-haspopup='true']").length?this.expand(t):(this.next(t),e.merge(e(t.currentTarget).find(".ui-state-focus").children("a"),e(t.currentTarget).find(".ui-state-focus").not("li")).focus());else if(a.children().find("a").last().html()!==e(t.currentTarget).find("a").last().html()){t.stopImmediatePropagation(),t.preventDefault();for(var n=a.parent(),r=n.nextAll("[role='presentation']:not(.ui-state-disabled)").first();0===r.length;)r=(n=n.parent()).parent().nextAll("[role='presentation']:not(.ui-state-disabled)").first();r.children("a").focus()}break}e(t.currentTarget).attr("rup_shift_nofocus","true"),e(t.currentTarget).focus();break;default:clearTimeout(this.filterTimer);var u,o=this.previousFilter||"",c=String.fromCharCode(t.keyCode),l=!1;c===o?l=!0:c=o+c,u=this.activeMenu.children(".ui-menu-item").filter((function(){return new RegExp("^"+s(c),"i").test(e(this).children("a").text())})),(u=l&&-1!==u.index(this.active.next())?this.active.nextAll(".ui-menu-item"):u).length||(c=String.fromCharCode(t.keyCode),u=this.activeMenu.children(".ui-menu-item").filter((function(){return new RegExp("^"+s(c),"i").test(e(this).children("a").text())}))),u.length?(this.focus(t,u),u.length>1?(this.previousFilter=c,this.filterTimer=this._delay((function(){delete this.previousFilter}),1e3)):delete this.previousFilter):delete this.previousFilter}},_move:function(e,t,i){var s,a=this;this.active&&(s="first"===e||"last"===e?this.active["first"===e?"prevAll":"nextAll"](".ui-menu-item").not(".ui-state-disabled").eq(-1):this.active[e+"All"](".ui-menu-item").not(".ui-state-disabled").eq(0)),s&&s.length&&this.active||(s=this.activeMenu.children(".ui-menu-item")[t]()),this.element.off("mouseleave"),this.element.off("mouseover"),this.element.one("mousemove",(function(e){var t=a._getWidgetMenu();t(e.currentTarget).rupMenu("restoreScrollEvents"),t(e.currentTarget).off("mousemove")})),this.focus(i,s),s.is(".ui-state-disabled")&&this._move(e,t,i)},restoreScrollEvents:function(){this._bind({mouseover:function(){e("#"+e.escapeSelector(this.menuId)).attr("rup_menu_nofocus","true")},"mouseover .rup_menu_horizontal_children":function(t){var i=e(t.currentTarget);e(".ui-state-focus").removeClass("ui-state-focus"),i.addClass("ui-state-focus"),e(i).focus()},"mouseover .ui-menu-item":function(t){e("#"+e.escapeSelector(this.menuId)).attr("rup_menu_nofocus","true"),t.stopImmediatePropagation();var i=e(t.currentTarget);i.siblings().children(".ui-state-active").removeClass("ui-state-active"),i.offset().left+i.width()>t.pageX&&(i.offset().top+e("#"+e.escapeSelector(this.menuId)).height()>t.pageY||i.offset().top+i.height()>t.pageY)&&(e("#"+e.escapeSelector(i.children("a").attr("id"))+":focus").length<=0?(e("#"+e.escapeSelector(i.children("a").attr("id"))).focus(),e("#"+e.escapeSelector(i.children("a").attr("id"))).focus()):i.hasClass("rup_menu_horizontal_children")||e("#"+e.escapeSelector(i.children("a").attr("id"))).hasClass("ui-state-focus")||(e("#"+e.escapeSelector(i.children("a").attr("id"))).addClass("ui-state-focus"),"menuitem"===e("#"+e.escapeSelector(i.children("a").attr("id"))).attr("role")&&this._startOpening(e(i).children("[role = 'menu']"))))},mouseleave:function(t){this.collapseAll(t,!0),e(".ui-state-focus").removeClass("ui-state-focus"),e("#"+e.escapeSelector(this.menuId)).removeAttr("rup_menu_nofocus")},"mouseleave .ui-menu-item":function(t){var i=e(t.currentTarget);(void 0===i.attr("rupmenu_firslevel")||i.offset().top-1<t.pageY&&i.offset().top+e("#"+e.escapeSelector(this.menuId)).height()+1<t.pageY)&&(this._close(),e(".ui-state-focus").removeClass("ui-state-focus"))},"mouseleave .rup_menu_horizontal_children_last":function(t){this.collapseAll(t,!0),e(".ui-state-focus").removeClass("ui-state-focus")}}),this.refresh()}},jstree:{hotkeys:{"ctrl+space":function(e){return delete e.target,e.type="click",this.data.ui.hovered&&this.data.ui.hovered.children("a").eq(0).trigger(e),!1},"shift+space":function(e){return delete e.target,e.type="click",this.data.ui.hovered&&this.data.ui.hovered.children("a").eq(0).trigger(e),!1}},rup_extend:{_fn:{cleanCut:function(){this.data.crrm.ct_nodes=!1},set_contextmenu_items:function(e){var t=this.get_settings();t.contextmenu.items=e,this._set_settings(t)},set_theme_data:function(e){this.data.themes.theme=e},types_portal_css:function(){var t=this._get_settings().types,i=t.types,s=t.type_attr,a="",n=this;e.each(i,(function(t,i){if(e.each(i,(function(e){/^(max_depth|max_children|icon|valid_children)$/.test(e)||n.data.types.attach_to.push(e)})),!i.icon)return!0;(i.icon.image||i.icon.position)&&(a+="div.r01gContainer ",a+="default"==t?".jstree-"+n.get_index()+" a > .jstree-icon { ":".jstree-"+n.get_index()+" li["+s+'="'+t+'"] > a > .jstree-icon { ',i.icon.image&&(a+=" background-image:url("+i.icon.image+"); "),i.icon.position?a+=" background-position:"+i.icon.position+"; ":a+=" background-position:0 0; ",a+="} ")}));var r=e("#jstree-types-stylesheet");void 0!==r&&r.remove(),""!==a&&e.vakata.css.add_sheet({str:a,title:"jstree-porta-types"})}}}}})}));