import"jquery";import"handlebars";import queryString from"query-string";import{flatten,unflatten}from"flat";import"rup.utils";global.queryString=queryString,global.flatten=flatten,global.unflatten=unflatten,describe("RUP Utils Tests",(function(){beforeAll((function(){$.rup||($.rup={lang:"es",i18n:{base:{"rup_global.metodError":"Error en método","rup_utils.paramsError":"Parámetros incorrectos","rup_utils.illegalChar":"Carácter ilegal detectado","rup_utils.relToAbsUrlParamError":"Error en parámetro URL: ","rup_utils.relToAbsUrlParamErrorEnd":" no es válida","rup_utils.relToAbsUrlParamFormatError":"Formato de parámetro incorrecto"}}}),$.rup.errorGestor||($.rup.errorGestor=jasmine.createSpy("errorGestor")),$.rup.i18nParse||($.rup.i18nParse=function(e,t){return e[t]||t})})),afterEach((function(){document.cookie.split(";").forEach((function(e){document.cookie=e.replace(/^ +/,"").replace(/=.*/,"=;expires="+(new Date).toUTCString()+";path=/")})),$.rup.errorGestor&&$.rup.errorGestor.calls&&$.rup.errorGestor.calls.reset()})),describe("Tests del método capitalizedLang",(function(){beforeEach((function(){this.originalLang=$.rup.lang})),afterEach((function(){$.rup.lang=this.originalLang})),it("debería devolver el idioma capitalizado",(function(){$.rup.lang="es";var e=$.rup_utils.capitalizedLang();expect(e).toEqual("Es")})),it("debería manejar idioma null",(function(){$.rup.lang=null,expect($.rup_utils.capitalizedLang()).toBe("")})),it("debería manejar idioma undefined",(function(){$.rup.lang=void 0,expect($.rup_utils.capitalizedLang()).toBe("")})),it("debería manejar idiomas de múltiples caracteres",(function(){$.rup.lang="en",expect($.rup_utils.capitalizedLang()).toBe("En"),$.rup.lang="fr",expect($.rup_utils.capitalizedLang()).toBe("Fr")}))})),describe("Tests del método firstCharToLowerCase",(function(){it("debería transformar a minúsculas el primer caracter de un string",(function(){var e=$.rup_utils.firstCharToLowerCase("AbcDeF");expect(e).toEqual("abcDeF")})),it("debería manejar un solo caracter",(function(){expect($.rup_utils.firstCharToLowerCase("A")).toBe("a")})),it("debería manejar string vacío",(function(){expect($.rup_utils.firstCharToLowerCase("")).toBe("")})),it("debería manejar string que ya empieza en minúscula",(function(){expect($.rup_utils.firstCharToLowerCase("abcDef")).toBe("abcDef")}))})),describe("Tests del método getJQueryId",(function(){it("debería agregar prefijo # al id",(function(){expect($.rup_utils.getJQueryId("myId")).toBe("#myId")})),it("no debería duplicar el prefijo #",(function(){expect($.rup_utils.getJQueryId("#myId")).toBe("#myId")})),it("debería retornar null para entrada no-string",(function(){expect($.rup_utils.getJQueryId(123)).toBe(null),expect($.rup_utils.getJQueryId(null)).toBe(null),expect($.rup_utils.getJQueryId(void 0)).toBe(null)})),it("debería escapar caracteres especiales cuando se solicite",(function(){expect($.rup_utils.getJQueryId("my.id",!0)).toBe("#my\\.id"),expect($.rup_utils.getJQueryId("my:id",!0)).toBe("#my\\:id")}))})),describe("Tests del método jsontoarray",(function(){it("debería transformar un json obj={'prop':'value'} en un array arr['prop'] -> 'value'",(function(){var e,t,r;e={prop:"value"},(r=[]).prop="value",t=$.rup_utils.jsontoarray(e),expect(t).toEqual(r)})),it("debería transformar un json obj={'propA':{'propAA':'value'}} en un array arr['propA.propAA'] -> 'value'",(function(){var e,t,r;e={propA:{propAA:"value"}},(r=[])["propA.propAA"]="value",t=$.rup_utils.jsontoarray(e),expect(t).toEqual(r)})),it("debería transformar un json obj={'propA:'valueA', 'propB':{'propBA':'valueBA'}} en un array arr['propA'] -> 'valueA', arr['propB.propBA'] -> 'valueBA', ",(function(){var e,t,r;e={propA:"valueA",propB:{propBA:"valueBA"}},(r=[]).propA="valueA",r["propB.propBA"]="valueBA",t=$.rup_utils.jsontoarray(e),expect(t).toEqual(r)})),it("debería transformar un json obj={'propA':{'propAA':['a','b','c','d']}} en un array arr['propA.propAA[0]'] -> 'a' ",(function(){var e,t,r;e={propA:{propAA:["a","b","c","d"]}},(r=[])["propA.propAA[0]"]="a",r["propA.propAA[1]"]="b",r["propA.propAA[2]"]="c",r["propA.propAA[3]"]="d",t=$.rup_utils.jsontoarray(e),expect(t).toEqual(r)})),it("debería transformar un json obj={'propA':{'propAA':[{'propAAA': 'a'},{'propAAB':'b'},{'propAAC':'c'}]}, 'propB':'d'",(function(){var e,t,r;e={propA:{propAA:[{propAAA:"a"},{propAAB:"b"},{propAAC:"c"}]},propB:"d"},(r=[])["propA.propAA[0].propAAA"]="a",r["propA.propAA[1].propAAB"]="b",r["propA.propAA[2].propAAC"]="c",r.propB="d",t=$.rup_utils.jsontoarray(e),expect(t).toEqual(r)})),it("debería manejar arrays vacíos",(function(){var e=$.rup_utils.jsontoarray({propA:[]});expect(e.propA).toBe("[]")})),it("debería manejar valores null y undefined",(function(){var e=$.rup_utils.jsontoarray({propA:null,propB:void 0});expect(e.propA).toBe(""),expect(e.propB).toBe("")}))})),describe("Tests del método getJson",(function(){it("debería obtener propiedad simple",(function(){expect($.rup_utils.getJson({prop:"value"},"prop")).toBe("value")})),it("debería obtener propiedad anidada",(function(){expect($.rup_utils.getJson({level1:{level2:"value"}},"level1.level2")).toBe("value")})),it("debería manejar anidación profunda",(function(){expect($.rup_utils.getJson({a:{b:{c:{d:"deep"}}}},"a.b.c.d")).toBe("deep")}))})),describe("Tests del método setJson",(function(){it("debería establecer propiedad simple",(function(){var e={};$.rup_utils.setJson(e,"prop","value"),expect(e.prop).toBe("value")})),it("debería establecer propiedad anidada",(function(){var e={level1:{}};$.rup_utils.setJson(e,"level1.level2","value"),expect(e.level1.level2).toBe("value")}))})),describe("Tests del método unnestjson",(function(){it("debería desanidar un objeto JSON",(function(){var e=$.rup_utils.unnestjson({propA:{propAA:"valueAA"}});expect(e["propA.propAA"]).toBe("valueAA")})),it("debería manejar múltiples niveles",(function(){var e=$.rup_utils.unnestjson({level1:{level2:{level3:"value"}}});expect(e["level1.level2.level3"]).toBe("value")}))})),describe("Tests del método isNumeric",(function(){it("debería retornar true para números",(function(){expect($.rup_utils.isNumeric(6)).toBe(!0),expect($.rup_utils.isNumeric(6.5)).toBe(!0),expect($.rup_utils.isNumeric(-6)).toBe(!0),expect($.rup_utils.isNumeric(0)).toBe(!0)})),it("debería retornar true para strings numéricos",(function(){expect($.rup_utils.isNumeric("6")).toBe(!0),expect($.rup_utils.isNumeric("6.5")).toBe(!0),expect($.rup_utils.isNumeric("-6")).toBe(!0),expect($.rup_utils.isNumeric("0")).toBe(!0)})),it("debería retornar false para valores no numéricos",(function(){expect($.rup_utils.isNumeric("abc")).toBe(!1),expect($.rup_utils.isNumeric(null)).toBe(!1),expect($.rup_utils.isNumeric(void 0)).toBe(!1),expect($.rup_utils.isNumeric({})).toBe(!1),expect($.rup_utils.isNumeric([])).toBe(!1),expect($.rup_utils.isNumeric("")).toBe(!1)}))})),describe("Tests del método normalize",(function(){it("debería remover acentos del texto",(function(){expect($.rup_utils.normalize("áéíóú")).toBe("aeiou"),expect($.rup_utils.normalize("ÁÉÍÓÚ")).toBe("AEIOU")})),it("debería preservar caracteres sin acentos",(function(){expect($.rup_utils.normalize("hello world")).toBe("hello world"),expect($.rup_utils.normalize("123!@#")).toBe("123!@#")})),it("debería manejar texto mixto",(function(){expect($.rup_utils.normalize("Hóla Múndo")).toBe("Hola Mundo")})),it("debería manejar string vacío",(function(){expect($.rup_utils.normalize("")).toBe("")}))})),describe("Tests de métodos de cookies",(function(){beforeEach((function(){document.cookie="testCookie=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;"})),describe("setCookie y readCookie",(function(){it("debería establecer y leer cookie simple",(function(){$.rup_utils.setCookie("testCookie","testValue"),expect($.rup_utils.readCookie("testCookie")).toBe("testValue")})),it("debería manejar caracteres especiales",(function(){$.rup_utils.setCookie("testCookie","value with spaces & symbols!"),expect($.rup_utils.readCookie("testCookie")).toBe("value with spaces & symbols!")})),it("debería retornar null para cookie inexistente",(function(){expect($.rup_utils.readCookie("nonExistentCookie")).toBe(null)})),it("debería manejar parámetros null y llamar errorGestor",(function(){$.rup.errorGestor.calls||spyOn($.rup,"errorGestor"),expect($.rup_utils.setCookie(null,"value")).toBe(!1),expect($.rup_utils.setCookie("name",null)).toBe(!1),expect($.rup_utils.readCookie(null)).toBe(!1),expect($.rup.errorGestor).toHaveBeenCalled()})),it("debería establecer cookie con opciones",(function(){var e=$.rup_utils.setCookie("testCookie","testValue",{path:"/",domain:"localhost"});expect(e).toContain("testCookie=testValue"),expect(e).toContain("path=/")}))})),describe("delCookie",(function(){it("debería eliminar cookie existente",(function(){$.rup_utils.setCookie("testCookie","testValue"),expect($.rup_utils.readCookie("testCookie")).toBe("testValue"),$.rup_utils.delCookie("testCookie"),expect($.rup_utils.readCookie("testCookie")).toBe(null)})),it("debería manejar parámetro null y llamar errorGestor",(function(){$.rup.errorGestor.calls||spyOn($.rup,"errorGestor"),expect($.rup_utils.delCookie(null)).toBe(!1),expect($.rup.errorGestor).toHaveBeenCalled()}))})),describe("Tests de Base64",(function(){describe("encode y decode",(function(){it("debería codificar y decodificar texto simple",(function(){var e="Hello World",t=$.rup_utils.base64.encode(e),r=$.rup_utils.base64.decode(t);expect(r).toBe(e)})),it("debería manejar caracteres especiales",(function(){var e="áéíóú ñÑ ¡¿",t=$.rup_utils.base64.encode(e),r=$.rup_utils.base64.decode(t);expect(r).toBe(e)})),it("debería manejar string vacío",(function(){var e=$.rup_utils.base64.encode(""),t=$.rup_utils.base64.decode(e);expect(t).toBe("")})),it("debería producir salida base64 esperada",(function(){expect($.rup_utils.base64.encode("Hello")).toBe("SGVsbG8="),expect($.rup_utils.base64.encode("Hello World")).toBe("SGVsbG8gV29ybGQ=")})),it("debería manejar texto largo",(function(){var e="Este es un texto muy largo que contiene múltiples palabras y caracteres especiales como áéíóú y números 12345",t=$.rup_utils.base64.encode(e),r=$.rup_utils.base64.decode(t);expect(r).toBe(e)}))}))})),describe("Tests del método formatoFecha",(function(){it("debería formatear fecha dd/mm/yyyy a dd/mm/yyyy sin hora",(function(){var e=$.rup_utils.formatoFecha("dd/mm/yyyy","20/02/2023");expect(e).toEqual(["20/02/2023"])})),it("debería formatear fecha yyyy/mm/dd a dd/mm/yyyy sin hora",(function(){var e=$.rup_utils.formatoFecha("dd/mm/yyyy","2023/02/20");expect(e).toEqual(["20/02/2023"])})),it("debería formatear fecha dd/mm/yyyy a yyyy/mm/dd sin hora",(function(){var e=$.rup_utils.formatoFecha("yyyy/mm/dd","20/02/2023");expect(e).toEqual(["2023/02/20"])})),it("debería manejar fecha con hora",(function(){var e=$.rup_utils.formatoFecha("dd/mm/yyyy hh:mm:ss","20/02/2023 15:23:21");expect(e).toEqual(["20/02/2023","15:23:21"])})),it("debería manejar formato (dd/mm/aaaa) sin hora",(function(){var e=$.rup_utils.formatoFecha("(dd/mm/aaaa)","20/02/2023");expect(e).toEqual(["20/02/2023"])})),it("debería manejar formato (aaaa/mm/dd) sin hora",(function(){var e=$.rup_utils.formatoFecha("(aaaa/mm/dd)","20/02/2023");expect(e).toEqual(["2023/02/20"])}))})),describe("Tests de createDate y createTime",(function(){beforeEach((function(){$.rup||($.rup={}),$.rup.i18n||($.rup.i18n={}),$.rup.i18n.base||($.rup.i18n.base={}),$.rup.i18n.base.rup_date||($.rup.i18n.base.rup_date={dateFormat:"dd/mm/yy"}),$.datepicker||($.datepicker={formatDate:function(e,t){return String(t.getDate()).padStart(2,"0")+"/"+String(t.getMonth()+1).padStart(2,"0")+"/"+t.getFullYear()}})})),it("debería crear fecha correctamente",(function(){var e=$.rup_utils.createDate(20,2,2023);expect(e).toBe("20/02/2023")})),it("debería crear tiempo correctamente",(function(){var e=$.rup_utils.createTime(15,30,45);expect(e).toEqual(jasmine.any(Date)),expect(e.getHours()).toBe(15),expect(e.getMinutes()).toBe(30),expect(e.getSeconds()).toBe(45)}))})),describe("Tests del método queryStringToJson",(function(){it("debería de crear un objeto JSON a partir de un query string",(function(){var e=$.rup_utils.queryStringToJson("keyA=valueA&keyB=valueB&keyC=valueC");expect({keyA:"valueA",keyB:"valueB",keyC:"valueC"}).toEqual(e)})),it("debería manejar valores simples sin caracteres especiales",(function(){var e=$.rup_utils.queryStringToJson("key1=value1&key2=value2");expect(e.key1).toBe("value1"),expect(e.key2).toBe("value2")})),it("debería manejar arrays como objetos indexados",(function(){var e=$.rup_utils.queryStringToJson("items[0]=first&items[1]=second&items[2]=third");expect(e.items[0]).toBe("first"),expect(e.items[1]).toBe("second"),expect(e.items[2]).toBe("third")})),it("debería manejar objetos anidados",(function(){var e=$.rup_utils.queryStringToJson("user.name=John&user.age=30&user.active=true");expect(e.user.name).toBe("John"),expect(e.user.age).toBe("30"),expect(e.user.active).toBe("true")}))})),describe("Tests del método queryStringToObject",(function(){it("debería de crear un objeto JavaScript a partir de un query string",(function(){var e=$.rup_utils.queryStringToObject("keyA=valueA&keyB=valueB&keyC=valueC&keyD.A=valueDA&keyD.B=valueDB");expect({keyA:"valueA",keyB:"valueB",keyC:"valueC",keyD:{A:"valueDA",B:"valueDB"}}).toEqual(e)})),it("debería manejar arrays correctamente",(function(){var e=$.rup_utils.queryStringToObject("items=first&items=second&items=third");expect(e.items).toEqual(["first","second","third"])}))})),describe("Tests de utilidades varias",(function(){describe("compareObjects",(function(){it("debería comparar objetos simples correctamente",(function(){var e={a:1,b:2};expect($.rup_utils.compareObjects(e,{a:1,b:2})).toBe(!0),expect($.rup_utils.compareObjects(e,{a:1,b:3})).toBe(!1)})),it("debería comparar objetos anidados",(function(){var e={a:{b:{c:1}}};expect($.rup_utils.compareObjects(e,{a:{b:{c:1}}})).toBe(!0),expect($.rup_utils.compareObjects(e,{a:{b:{c:2}}})).toBe(!1)})),it("debería retornar false para objetos con diferentes números de propiedades",(function(){expect($.rup_utils.compareObjects({a:1,b:2},{a:1,b:2,c:3})).toBe(!1)}))})),describe("format",(function(){it("debería formatear string con parámetros",(function(){var e=$.rup_utils.format("Hello {0}, you are {1} years old","John",25);expect(e).toBe("Hello John, you are 25 years old")})),it("debería manejar template null",(function(){var e=$.rup_utils.format(null,"John",25);expect(e).toBe("")})),it("debería manejar múltiples parámetros",(function(){var e=$.rup_utils.format("{0} + {1} = {2}",2,3,5);expect(e).toBe("2 + 3 = 5")}))})),describe("deepCopy",(function(){it("debería crear copia profunda de objeto simple",(function(){var e={a:1,b:"test"},t=$.rup_utils.deepCopy(e,5);expect(t).toEqual(e),expect(t).not.toBe(e)})),it("debería crear copia profunda de objeto anidado",(function(){var e={a:{b:{c:"deep"}}},t=$.rup_utils.deepCopy(e,5);expect(t).toEqual(e),expect(t.a).not.toBe(e.a),expect(t.a.b).not.toBe(e.a.b)})),it("debería manejar arrays",(function(){var e={items:[1,2,3]},t=$.rup_utils.deepCopy(e,5);expect(t.items).toEqual([1,2,3]),expect(t.items).not.toBe(e.items)}))}))})),describe("Tests de getRupValueAsJson",(function(){it("debería crear JSON con valor simple",(function(){var e=$.rup_utils.getRupValueAsJson("name","John");expect(e).toEqual({name:"John"})})),it("debería crear JSON con notación dot",(function(){var e=$.rup_utils.getRupValueAsJson("user.name","John");expect(e).toEqual({name:"John"})})),it("debería manejar arrays",(function(){var e=$.rup_utils.getRupValueAsJson("items",["a","b","c"]);expect(e).toEqual([{items:"a"},{items:"b"},{items:"c"}])})),it("debería manejar arrays vacíos",(function(){var e=$.rup_utils.getRupValueAsJson("items",[]);expect(e).toBe(null)})),it("debería retornar null para name null",(function(){var e=$.rup_utils.getRupValueAsJson(null,"value");expect(e).toBe(null)}))})),describe("Tests de elementFromPoint",(function(){it("debería retornar null si document.elementFromPoint no existe",(function(){var e=document.elementFromPoint;document.elementFromPoint=null;var t=$.rup_utils.elementFromPoint(100,100);expect(t).toBe(null),document.elementFromPoint=e}))})),describe("Tests adicionales para mejorar cobertura",(function(){describe("Funciones de array y sorting",(function(){it("debería ordenar array con función por defecto",(function(){var e=[3,1,4,1,5];$.rup_utils.sortArray(e),expect(e).toEqual([5,4,3,1,1])})),it("debería ordenar array con función personalizada",(function(){var e=[5,2,4,1,3];$.rup_utils.sortArray(e,(function(e,t){return t-e})),expect(e).toEqual([1,2,3,4,5])})),it("debería retornar undefined para entrada no-array",(function(){var e=$.rup_utils.sortArray("not an array");expect(e).toBeUndefined()})),it("debería insertar elemento ordenado",(function(){var e=[1,3,5],t=$.rup_utils.insertSorted(e,4);expect(e).toContain(4),expect(t).toBeGreaterThanOrEqual(0)})),it("debería retornar undefined para insertSorted con entrada no-array",(function(){var e=$.rup_utils.insertSorted("not an array",5);expect(e).toBeUndefined()}))})),describe("getRupValueWrapped",(function(){it("debería envolver valor con notación dot",(function(){var e=$.rup_utils.getRupValueWrapped("user.name","John");expect(e).toEqual({name:"John"})})),it("debería retornar valor sin envolver para propiedad simple",(function(){var e=$.rup_utils.getRupValueWrapped("name","John");expect(e).toBe("John")})),it("debería retornar null para name null",(function(){var e=$.rup_utils.getRupValueWrapped(null,"value");expect(e).toBe(null)}))})),describe("swing2Top",(function(){it("debería llamar animate cuando no está swinging",(function(){spyOn($.fn,"animate").and.returnValue($("html, body")),$.rup_utils.swinging=!1,$.rup_utils.swing2Top(),expect($.fn.animate).toHaveBeenCalledWith({scrollTop:0},"1000","swing",jasmine.any(Function))})),it("no debería llamar animate cuando ya está swinging",(function(){spyOn($.fn,"animate"),$.rup_utils.swinging=!0,$.rup_utils.swing2Top(),expect($.fn.animate).not.toHaveBeenCalled(),$.rup_utils.swinging=!1}))})),describe("randomIdGenerator",(function(){it("debería generar id aleatorio y agregarlo al objeto",(function(){var e={attr:jasmine.createSpy("attr"),addClass:jasmine.createSpy("addClass")};e.attr.and.returnValue(e),e.addClass.and.returnValue(e);var t=$.rup_utils.autoGenerateIdNum,r=$.rup_utils.randomIdGenerator(e);expect(r).toBe("rupRandomLayerId-"+t),expect(e.attr).toHaveBeenCalledWith("id",r),expect(e.addClass).toHaveBeenCalledWith("rupRandomLayerId"),expect($.rup_utils.autoGenerateIdNum).toBe(t+1)}))})),describe("printMsg y printMsgAux",(function(){it("debería imprimir mensaje string simple",(function(){var e=$.rup_utils.printMsg("Hello World");expect(e).toBe("Hello World<br/>")})),it("debería imprimir array de strings correctamente",(function(){var e=$.rup_utils.printMsg(["msg1","msg2"]);expect(e).toContain("msg1"),expect(e).toContain("msg2"),expect(e).toContain("<span>")})),it("debería imprimir objeto con label y style",(function(){var e=$.rup_utils.printMsg({label:"Test Message",style:"error-style"});expect(e).toContain("Test Message"),expect(e).toContain("error-style")})),it("debería manejar array de objetos correctamente",(function(){var e=$.rup_utils.printMsg([{label:"Error 1",style:"error"},{label:"Warning 1",style:"warning"}]);expect(e).toContain("Error 1"),expect(e).toContain("Warning 1"),expect(e).toContain("<span")}))})),describe("getUrlVars y getUrlVar",(function(){beforeEach((function(){this.originalRupGetParams=$.rup.getParams,this.originalHref=window.location.href})),afterEach((function(){$.rup.getParams=this.originalRupGetParams})),it("debería parsear variables de URL",(function(){$.rup.getParams={param1:"value1",param2:"value2"};var e=$.rup_utils.getUrlVars();expect(e.param1).toBe("value1"),expect(e.param2).toBe("value2")})),it("debería obtener variable específica de URL",(function(){$.rup.getParams={test:"value"};var e=$.rup_utils.getUrlVar("test");expect(e).toBe("value")})),it("debería parsear URL real cuando no hay cache",(function(){delete $.rup.getParams;var e=Object.getOwnPropertyDescriptor(window.location,"href");try{if(e&&e.configurable){Object.defineProperty(window.location,"href",{value:"http://example.com?test=value&foo=bar",configurable:!0});var t=$.rup_utils.getUrlVars();expect(t).toBeDefined(),expect(typeof t).toBe("object")}else t=$.rup_utils.getUrlVars(),expect(t).toBeDefined(),expect(typeof t).toBe("object")}finally{e&&Object.defineProperty(window.location,"href",e)}}))})),describe("aplicatioInPortal y setNoPortalParam",(function(){it("debería detectar si la aplicación está en portal",(function(){spyOn($.rup_utils,"readCookie").and.returnValue(null);var e=$.rup_utils.aplicatioInPortal();expect(e).toBe(!1)})),it("debería agregar parámetro NoPortal a URL",(function(){spyOn($.rup_utils,"readCookie").and.returnValue(null);var e="http://example.com/page",t=$.rup_utils.setNoPortalParam(e);expect(t).toBe(e)})),it("debería manejar URL undefined",(function(){var e=$.rup_utils.setNoPortalParam(void 0);expect(e).toBeUndefined()}))})),describe("escapeId y selectorId (deprecated)",(function(){it("debería escapar caracteres especiales en ID",(function(){var e=$.rup_utils.escapeId("my.special#id");expect(e).toBe("my\\.special\\#id")})),it("debería manejar ID null",(function(){var e=$.rup_utils.escapeId(null);expect(e).toBe("")})),it("debería agregar # a selector si no lo tiene",(function(){var e=$.rup_utils.selectorId("myId");expect(e).toBe("#myId")})),it("no debería duplicar # en selector",(function(){var e=$.rup_utils.selectorId("#myId");expect(e).toBe("#myId")}))})),describe("Métodos de cookies adicionales (get y set)",(function(){it("debería establecer y obtener cookie con método set/get",(function(){$.rup_utils.set("testCookie","testValue");var e=$.rup_utils.get("testCookie");expect(e).toBe("testValue")})),it("debería manejar cookie con JSON",(function(){$.JSON||($.JSON={encode:function(e){return JSON.stringify(e)},decode:function(e){return JSON.parse(e)}});var e={name:"test",value:123};$.rup_utils.set("jsonCookie",e,{json:!0});var t=$.rup_utils.get("jsonCookie",!0);expect(t).toEqual(e)})),it("debería retornar null para cookie inexistente con get",(function(){var e=$.rup_utils.get("nonExistentCookie");expect(e).toBe(null)}))})),describe("formDataToQueryString",(function(){it("debería convertir datos de formulario a query string",(function(){var e=$.rup_utils.formDataToQueryString({formToArray:function(){return[{name:"field1",value:"value1"},{name:"field2",value:"value2"}]}});expect(e).toContain("field1=value1"),expect(e).toContain("field2=value2")}))})),describe("editFormSerialize (deprecated)",(function(){it("debería serializar formulario",(function(){var e=$.rup_utils.editFormSerialize({formToArray:function(){return[{name:"field1",value:"value1"},{name:"field2",value:"value2"}]},find:function(){return{prop:function(){return!1}}}});expect(e).toContain("field1=value1"),expect(e).toContain("field2=value2")})),it("debería manejar campos múltiples",(function(){var e=$.rup_utils.editFormSerialize({formToArray:function(){return[{name:"field1",value:"value1"},{name:"field1",value:"value2"}]},find:function(){return{prop:function(){return!0}}}});expect(e).toContain("field1")}))})),describe("populateForm",(function(){it("debería poblar formulario con datos",(function(){var e={field1:"value1",field2:"value2"};expect((function(){$.rup_utils.populateForm(e,"#testForm")})).not.toThrow(),expect(e).toEqual({field1:"value1",field2:"value2"})})),it("debería manejar datos null",(function(){expect((function(){$.rup_utils.populateForm(null,"#form")})).not.toThrow()})),it("debería manejar datos undefined",(function(){expect((function(){$.rup_utils.populateForm(void 0,"#form")})).not.toThrow()})),it("debería manejar datos vacíos",(function(){expect((function(){$.rup_utils.populateForm({},"#form")})).not.toThrow()})),it("debería procesar datos con diferentes tipos de valores",(function(){var e={stringField:"test",numberField:123,booleanField:!0,nullField:null,undefinedField:void 0};expect((function(){$.rup_utils.populateForm(e,"#form")})).not.toThrow()})),it("debería manejar formulario con id null",(function(){var e={field1:"value1"};expect((function(){$.rup_utils.populateForm(e,null)})).not.toThrow()})),it("debería completar la promesa deferred",(function(e){var t={field1:"value1"};setTimeout((function(){expect((function(){$.rup_utils.populateForm(t,"#form")})).not.toThrow(),e()}),10)}))})),describe("Métodos de formulario jQuery",(function(){describe("serializeToObject",(function(){it("debería serializar formulario a objeto",(function(){var e=[{name:"field1",value:"value1"},{name:"field2",value:"value2"}],t={serializeArrayWithoutNulls:function(){return e}},r=$.fn.serializeToObject.call(t);expect(r.field1).toBe("value1"),expect(r.field2).toBe("value2")})),it("debería manejar campos con múltiples valores",(function(){var e=[{name:"field1",value:"value1"},{name:"field1",value:"value2"}],t={serializeArrayWithoutNulls:function(){return e}},r=$.fn.serializeToObject.call(t);expect(r.field1).toEqual(["value1","value2"])}))})),describe("flattenObject y unflattenObject",(function(){it("debería aplanar objeto",(function(){var e=$.fn.flattenObject({a:{b:{c:"value"}}});expect(e["a.b.c"]).toBe("value")})),it("debería desaplanar objeto",(function(){var e=$.fn.unflattenObject({"a.b.c":"value"});expect(e.a.b.c).toBe("value")}))})),describe("flattenJSON (deprecated)",(function(){it("debería aplanar JSON",(function(){var e=$.fn.flattenJSON({a:{b:"value"}});expect(e["a.b"]).toBe("value")})),it("debería manejar objetos anidados profundos",(function(){var e=$.fn.flattenJSON({level1:{level2:{level3:{level4:"deep"}}}});expect(e["level1.level2.level3.level4"]).toBe("deep")}))}))})),describe("Casos edge adicionales",(function(){it("debería manejar queryStringToJson con separador personalizado",(function(){var e=$.rup_utils.queryStringToJson("key1=value1|key2=value2","|");expect(e.key1).toBe("value1"),expect(e.key2).toBe("value2")})),it("debería manejar queryStringToJson con allowAllCharacters",(function(){var e=$.rup_utils.queryStringToJson("key1=value%2520with%2520spaces","&",!0);expect(e.key1).toBe("value%20with%20spaces")})),it("debería manejar queryStringToJson con caracteres válidos",(function(){$.rup.errorGestor.calls||spyOn($.rup,"errorGestor"),$.rup_utils.queryStringToJson("key1=value%20test","&",!1),expect($.rup.errorGestor).toHaveBeenCalled()})),it("debería manejar elementFromPoint con diferentes parámetros",(function(){if(document.elementFromPoint){var e=$.rup_utils.elementFromPoint(100,100,!1);expect(e).toBeDefined()}})),it("debería manejar deepCopy con límite de profundidad",(function(){var e=$.rup_utils.deepCopy({a:{b:{c:{d:"deep"}}}},2);expect(e.a.b).toBeDefined(),expect(typeof e.a.b.c).toBe("object")})),it("debería manejar deepCopy con objetos simples",(function(){var e={a:1,b:"test"},t=$.rup_utils.deepCopy(e,5);expect(t).toEqual(e),expect(t).not.toBe(e)}))})),describe("Métodos adicionales de cobertura",(function(){it("debería manejar compareObjects correctamente",(function(){var e={a:1,b:{c:2}};expect($.rup_utils.compareObjects(e,{a:1,b:{c:2}})).toBe(!0),expect($.rup_utils.compareObjects(e,{a:1,b:{c:3}})).toBe(!1)})),it("debería manejar format correctamente",(function(){var e=$.rup_utils.format("Hello {0}, you have {1} messages","John",5);expect(e).toBe("Hello John, you have 5 messages")})),it("debería manejar format con parámetro null",(function(){var e=$.rup_utils.format(null,"test");expect(e).toBe("")})),it("debería manejar isNumeric correctamente",(function(){expect($.rup_utils.isNumeric(123)).toBe(!0),expect($.rup_utils.isNumeric("123")).toBe(!0),expect($.rup_utils.isNumeric("abc")).toBe(!1),expect($.rup_utils.isNumeric(null)).toBe(!1)})),it("debería manejar normalize correctamente",(function(){var e=$.rup_utils.normalize("áéíóú");expect(e).toBe("aeiou");var t=$.rup_utils.normalize("ÁÉÍÓÚ");expect(t).toBe("AEIOU")}))}))}))}))}));