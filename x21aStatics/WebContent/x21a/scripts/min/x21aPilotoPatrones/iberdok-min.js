/*
 * Copyright 2011 E.J.I.E., S.A.
 *
 * Licencia con arreglo a la EUPL, Versión 1.1 exclusivamente (la «Licencia»);
 * Solo podrá usarse esta obra si se respeta la Licencia.
 * Puede obtenerse una copia de la Licencia en
 *
 *      http://ec.europa.eu/idabc/eupl.html
 *
 * Salvo cuando lo exija la legislación aplicable o se acuerde por escrito, 
 * el programa distribuido con arreglo a la Licencia se distribuye «TAL CUAL»,
 * SIN GARANTÍAS NI CONDICIONES DE NINGÚN TIPO, ni expresas ni implícitas.
 * Véase la Licencia en el idioma concreto que rige los permisos y limitaciones
 * que establece la Licencia.
 */
jQuery(document).ready(function(){addTableIberdok();formularioEditorDocumentos();addCombosForm()});function addTableIberdok(){$("#iberdokTable").rup_table({url:"../iberdok",colNames:[$.rup.i18n.app.iberdokTable.id,$.rup.i18n.app.iberdokTable.nombre,$.rup.i18n.app.iberdokTable.idModelo,$.rup.i18n.app.iberdokTable.idDocumento,$.rup.i18n.app.iberdokTable.estado],colModel:[{name:"id",label:$.rup.i18n.app.iberdokTable.id},{name:"nombre",label:$.rup.i18n.app.iberdokTable.nombre},{name:"idModelo",label:$.rup.i18n.app.iberdokTable.idModelo},{name:"idDocumento",label:$.rup.i18n.app.iberdokTable.idDocumento},{name:"estado",label:$.rup.i18n.app.iberdokTable.estado,unformat:unformatterEstado,formatter:formatterEstado},],model:"IberdokFile",usePlugins:["formEdit","feedback","toolbar","contextMenu","fluid","search"],primaryKey:"id",onSelectRow:function(b){var a=$("#iberdokTable").rup_table("getRowData",b);if(a.estado==1){$("#iberdokTable_toolbar\\#\\#Visualizar").hide()}else{$("#iberdokTable_toolbar\\#\\#Visualizar").show()}},toolbar:{createDefaultToolButtons:false,buttons:[{obj:{i18nCaption:$.rup.i18n.app.iberdokTable.nuevo,css:"nuevo",index:4},json_i18n:"nuevoDocumento",click:fnNuevoDocumento},{obj:{i18nCaption:$.rup.i18n.app.iberdokTable.editar,css:"editar",index:4},json_i18n:"editarEnIberdok",click:fnEditarIberdok},{obj:{i18nCaption:$.rup.i18n.app.iberdokTable.ver,css:"buscar",index:4},json_i18n:"abrirDocumento",click:fnAbrirDocumento,id:"visualizar"},{obj:{i18nCaption:$.rup.i18n.app.iberdokTable.copiar,css:"clonar",index:4},json_i18n:"copiarDocumento",click:fnCopiarDocumento,id:"copiar"}],}})}function unformatterEstado(a,b,c){if(a==$.rup.i18n.app.iberdokTable.finalizado){return"2"}else{return"1"}}function formatterEstado(a,b,c){if(a=="1"){return $.rup.i18n.app.iberdokTable.elaboracion}else{return $.rup.i18n.app.iberdokTable.finalizado}}function formularioEditorDocumentos(){$("#lanzarEditor").on("click",function(){var d=$("#modo").val();validarFormulario(d);if(d=="1"){var b=$("#urlFinalizacion").val();if(b!=""){var a=$("#idModelo").val();var c=$("#nombre").val();$("#urlFinalizacion").val(b+"?idModelo="+a+"&idCorrelacion="+c+"&")}}})}function validarFormulario(b){if(b=="1"){var a={rules:{nombre:{required:true},idModelo:{required:true},urlFinalizacion:{required:true},lang:{required:true}},}}else{var a={rules:{urlFinalizacion:{required:true},lang:{required:true}},}}$("#editorDocumentosForm").rup_validate(a)}function addCombosForm(){$("#lang").rup_combo({source:[{i18nCaption:$.rup.i18n.app.iberdokTable.es,value:"es"},{i18nCaption:$.rup.i18n.app.iberdokTable.eu,value:"eu"},{i18nCaption:$.rup.i18n.app.iberdokTable.en,value:"en"},],width:150,blank:"",rowStriping:true,inputText:true});$("#modo").rup_combo({source:[{i18nCaption:$.rup.i18n.app.iberdokTable.modo1,value:"1"},{i18nCaption:$.rup.i18n.app.iberdokTable.modo2,value:"2"},{i18nCaption:$.rup.i18n.app.iberdokTable.modo7,value:"7"},{i18nCaption:$.rup.i18n.app.iberdokTable.modo8,value:"8"},],width:250,blank:"0",rowStriping:true,inputText:true,disabled:true})}function fnCopiarDocumento(){var b=$("#iberdokTable").rup_table("getSelectedRows");var c=$("#iberdokTable").rup_table("getRowData",b);var a=c.idDocumento;var d="8";abridEditorIberdok(d,a)}function fnEditarIberdok(){var b=$("#iberdokTable").rup_table("getSelectedRows");var c=$("#iberdokTable").rup_table("getRowData",b);var a=c.idDocumento;var d;if(c.estado=="1"){d="7"}else{d="2"}abridEditorIberdok(d,a)}function fnNuevoDocumento(){abridEditorIberdok("1")}function fnAbrirDocumento(){var b=$("#iberdokTable").rup_table("getSelectedRows");var c=$("#iberdokTable").rup_table("getRowData",b);var a=c.idDocumento;window.open("getPdf?idDocumento="+c.idDocumento,"_blank")}function abridEditorIberdok(b,a){gestionarVisibilidadDivs(b);$("#divFormEditorIberdok").rup_dialog({type:$.rup.dialog.DIV,autoOpen:false,modal:true,resizable:true,title:$.rup.i18n.app.iberdokTable.dialog,width:900,height:500});$("#divFormEditorIberdok").rup_dialog("open");gestionarDatosDivs(b,a)}function ocultarDivsModos(){$("#datosNecesarios").hide();$("#divModo1").hide();$("#divModo2").hide();$("#divModo3").hide();$("#divModo7").hide();$("#semillas").hide()}function gestionarDatosDivs(b,a){$("#modo").rup_combo("select",b);$("#lang").rup_combo("select",IBERDOK.lang);$("#token").val(IBERDOK.token);$("#idUsuario").val(IBERDOK.idUsuario);$("#idModelo").val(IBERDOK.idModelo);$("#urlRetornoEjemplo").text(IBERDOK.urlRetorno);$("#urlFinalizacion").val(IBERDOK.urlFinalizacion);switch(parseInt(b)){case 1:$("#datosNecesarios").show();$("#divModo1").show();$("#editorDocumentosForm").attr("action",IBERDOK.urlEditorDocumentos);break;case 2:$.ajax({url:"getXhtml?idDocumento="+a,async:false,success:function(c){$("#xhtml64").val(c)},dataType:"json"});break;case 7:case 8:$("#idDocumento").val(a);$("#editorDocumentosForm").attr("action",IBERDOK.urlEditorDocumentos);break}}function gestionarVisibilidadDivs(a){ocultarDivsModos();$("#datosNecesarios").show();switch(parseInt(a)){case 1:$("#divModo1").show();$("#semillas").show();break;case 2:$("#divModo2").show();$("#semillas").show();break;case 7:$("#semillas").show();case 8:$("#divModo7").show();break}};