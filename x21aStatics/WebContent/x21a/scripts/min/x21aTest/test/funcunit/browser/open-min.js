(function($){var confirms=[],prompts=[],currentDocument,currentHref,lookingForNewDocument=false,urlWithoutHash=function(url){return url.replace(/\#.*$/,"")},absolutize=function(url){var f=steal.File(url);return f.protocol()?f.path:f.joinFrom(steal.pageUrl().dir(),true)},isCurrentPage=function(url){var pathname=urlWithoutHash(FuncUnit.win.location.pathname),href=urlWithoutHash(FuncUnit.win.location.href),url=urlWithoutHash(url);if(pathname===url||href===url){return true}return false};$.extend(FuncUnit,{open:function(path,success,timeout){var fullPath=FuncUnit.getAbsolutePath(path),temp;if(typeof success!="function"){timeout=success;success=undefined}FuncUnit.add({method:function(success,error){steal.dev.log("Opening "+path);FuncUnit._open(fullPath,error);FuncUnit._onload(function(){success()},error)},success:success,error:"Page "+path+" not loaded in time!",timeout:timeout||30000})},_open:function(url){hasSteal=false;FuncUnit.frame=$("#funcunit_app").length?$("#funcunit_app")[0]:null;if(newPage){if(FuncUnit.frame){FuncUnit.win=FuncUnit.frame.contentWindow;FuncUnit.win.location=url}else{var width=$(window).width();FuncUnit.win=window.open(url,"funcunit","height=1000,toolbar=yes,status=yes,width="+width/2+",left="+width/2);if(FuncUnit.win.___FUNCUNIT_OPENED){FuncUnit.win.close();FuncUnit.win=window.open(url,"funcunit","height=1000,toolbar=yes,status=yes,left="+width/2)}if(!FuncUnit.win){throw"Could not open a popup window.  Your popup blocker is probably on.  Please turn it off and try again"}}}else{lookingForNewDocument=true;if(isCurrentPage(url)){FuncUnit.win.location.hash=url.split("#")[1]||"";FuncUnit.win.location.reload(true)}else{FuncUnit.win.location=url}currentDocument=null}lookingForNewDocument=true},confirm:function(answer){confirms.push(!!answer)},prompt:function(answer){prompts.push(answer)},_opened:function(){if(!this._isOverridden("alert")){FuncUnit.win.alert=function(){}}if(!this._isOverridden("confirm")){FuncUnit.win.confirm=function(){var res=confirms.shift();return res}}if(!this._isOverridden("prompt")){FuncUnit.win.prompt=function(){return prompts.shift()}}},_isOverridden:function(type){return !(/(native code)|(source code not available)/.test(FuncUnit.win[type]))},_onload:function(success,error){loadSuccess=function(){if(FuncUnit.win.steal){hasSteal=true}if((FuncUnit.win.steal&&FuncUnit.win.steal.isReady)||!hasSteal){success()}else{setTimeout(arguments.callee,200)}};if(!newPage){return}newPage=false;if(FuncUnit.support.readystate){poller()}else{unloadLoader()}},getAbsolutePath:function(path){if(/^\/\//.test(path)){return steal.File(absolutize(steal.root.path)).join(path.substr(2))+""}else{return absolutize(path)}},win:null,support:{readystate:"readyState" in document},eval:function(str){return FuncUnit.win.eval(str)},documentLoaded:function(){var loaded=FuncUnit.win.document.readyState==="complete"&&FuncUnit.win.location.href!="about:blank";return loaded},checkForNewDocument:function(){var documentFound=((FuncUnit.win.document!==currentDocument&&!FuncUnit.win.___FUNCUNIT_OPENED)||(currentHref!=FuncUnit.win.location.href))&&FuncUnit.documentLoaded();if(documentFound){lookingForNewDocument=false;currentDocument=FuncUnit.win.document;currentHref=FuncUnit.win.location.href;FuncUnit.win.___FUNCUNIT_OPENED=true;FuncUnit._opened()}return documentFound}});if(navigator.userAgent.match(/Rhino/)){return}FuncUnit.win=null;var newPage=true,hasSteal=false,unloadLoader,loadSuccess,firstLoad=true,onload=function(){FuncUnit.win.document.documentElement.tabIndex=0;setTimeout(function(){FuncUnit.win.focus();var ls=loadSuccess;loadSuccess=null;if(ls){ls()}},0);Syn.unbind(FuncUnit.win,"load",onload)},onunload=function(){FuncUnit.stop=true;removeListeners();setTimeout(unloadLoader,0)},removeListeners=function(){Syn.unbind(FuncUnit.win,"unload",onunload);Syn.unbind(FuncUnit.win,"load",onload)};unloadLoader=function(){if(!firstLoad){removeListeners()}Syn.bind(FuncUnit.win,"load",onload);Syn.bind(FuncUnit.win,"unload",onunload)};var newDocument=false,poller=function(){var ls;try{if(FuncUnit.win&&FuncUnit.win.document==null){return}}catch(e){setTimeout(arguments.callee,500);return}if(lookingForNewDocument&&FuncUnit.checkForNewDocument()){ls=loadSuccess;loadSuccess=null;if(ls){FuncUnit.win.focus();FuncUnit.win.document.documentElement.tabIndex=0;ls()}}setTimeout(arguments.callee,500)};$(window).unload(function(){FuncUnit.win&&FuncUnit.win.close()})})(window.jQuery||window.FuncUnit.jQuery);