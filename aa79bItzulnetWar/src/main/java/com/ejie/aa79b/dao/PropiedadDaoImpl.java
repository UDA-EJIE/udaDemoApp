package com.ejie.aa79b.dao;

import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.List;

import org.springframework.jdbc.core.RowMapper;
import org.springframework.stereotype.Repository;
import org.springframework.transaction.annotation.Transactional;

import com.ejie.aa79b.common.PropertiesConstants;
import com.ejie.aa79b.common.SqlUtils;
import com.ejie.aa79b.model.Propiedad;

/**
 * BloqueoDaoImpl generated by UDA, 31-ene-2018 14:32:55.
 *
 * @author UDA
 */

@Repository
@Transactional
public class PropiedadDaoImpl extends GenericoDaoImpl<Propiedad> implements PropiedadDao {

    protected static final String ID000 = "ID000";
    protected static final String ID_000 = "ID_000";
    public static final String[] ORDER_BY_WHITE_LIST = new String[] { "ID000", "BLOQUEO000" };

    private RowMapper<Propiedad> rwMap = new RowMapper<Propiedad>() {
        @Override
        public Propiedad mapRow(ResultSet resultSet, int rowNum) throws SQLException {
            final Propiedad bloqueo = new Propiedad();
            bloqueo.setId(resultSet.getInt(ID000));
            bloqueo.setValor(resultSet.getString("VALOR000"));
            return bloqueo;
        }
    };

    private RowMapper<Propiedad> rwMapPK = new RowMapper<Propiedad>() {
        @Override
        public Propiedad mapRow(ResultSet resultSet, int rowNum) throws SQLException {
            final Propiedad bloqueo = new Propiedad();
            bloqueo.setId(resultSet.getInt(ID000));
            return bloqueo;
        }
    };

    /**
     * Constructor
     */
    public PropiedadDaoImpl() {

        super(Propiedad.class);
    }

    /*
     * OPERACIONES CRUD
     */

    @Override
    public Propiedad add(Propiedad bloqueo) {
        String query = "INSERT INTO AA79B00S01 (ID_000, VALOR_000) VALUES (?,?)";
        this.getJdbcTemplate().update(query, bloqueo.getId(), bloqueo.getValor());
        return bloqueo;
    }

    @Override
    public Propiedad update(Propiedad bloqueo) {
        String query = "UPDATE AA79B00S01 SET VALOR_000=? WHERE ID_000=?";
        this.getJdbcTemplate().update(query, bloqueo.getValor(), bloqueo.getId());
        return bloqueo;
    }

    @Override
    public void remove(Propiedad bloqueo) {
        String query = "DELETE FROM AA79B00S01 WHERE ID_000=?";
        this.getJdbcTemplate().update(query, bloqueo.getId());
    }

    @Override()
    protected String getSelect() {
        StringBuilder sb = new StringBuilder();

        sb.append("SELECT t1.ID_000 ID000, t1.VALOR_000 VALOR000 ");
        return sb.toString();
    }

    @Override()
    protected String getFrom() {
        return "  FROM AA79B00S01 t1   ";
    }

    @Override()
    protected RowMapper<Propiedad> getRwMap() {
        return this.rwMap;
    }

    @Override()
    protected String[] getOrderBy() {
        return PropiedadDaoImpl.ORDER_BY_WHITE_LIST;
    }

    @Override()
    protected String getPK() {
        return ID_000;
    }

    @Override()
    protected RowMapper<Propiedad> getRwMapPK() {
        return this.rwMapPK;
    }

    @Override()
    protected String getWherePK(Propiedad bean, List<Object> params) {
        params.add(bean.getId());
        return "  WHERE t1.ID_000 = ? ";
    }

    @Override()
    protected String getWhere(Propiedad bean, List<Object> params) {

        StringBuilder where = new StringBuilder(PropiedadDaoImpl.STRING_BUILDER_INIT);

        where.append(SqlUtils.generarWhereIgual(ID_000, bean.getId(), params));
        where.append(SqlUtils.generarWhereIgual("VALOR_000", bean.getValor(), params));

        return where.toString();
    }

    @Override()
    protected String getWhereLike(Propiedad bean, Boolean startsWith, List<Object> params, Boolean search) {
        StringBuilder where = new StringBuilder(PropiedadDaoImpl.STRING_BUILDER_INIT);

        where.append(SqlUtils.generarWhereIgual(ID_000, bean.getId(), params));
        where.append(SqlUtils.generarWhereIgual("VALOR_000", bean.getValor(), params));

        return where.toString();
    }

	@Override
	public Boolean esAplicacionBOPV(String codAplic) {
		Boolean esBOPV = false;
		String aplicacionesBOPV = this.getJdbcTemplate().queryForObject("SELECT VALOR_000 FROM AA79B00S01 WHERE ID_000 = ?", String.class, PropertiesConstants.APLICACIONES_BOPV);
		for(String aplic: aplicacionesBOPV.split(";")) {
			if (aplic.equalsIgnoreCase(codAplic)) {
				esBOPV = true;
			}
		}
		return esBOPV;
	}
	@Override
	public Boolean esAplicacionComunicaciones(String codAplic) {
		Boolean esAplicComunicaciones = false;
		String aplicacionesBOPV = this.getJdbcTemplate().queryForObject("SELECT VALOR_000 FROM AA79B00S01 WHERE ID_000 = ?", String.class, PropertiesConstants.APLICACIONES_COMUNICACIONES);
		for(String aplic: aplicacionesBOPV.split(";")) {
			if (aplic.equalsIgnoreCase(codAplic)) {
				esAplicComunicaciones = true;
			}
		}
		return esAplicComunicaciones;
	}

}
