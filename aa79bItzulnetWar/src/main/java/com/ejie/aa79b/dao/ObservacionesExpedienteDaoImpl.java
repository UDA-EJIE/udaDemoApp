package com.ejie.aa79b.dao;

import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.List;

import org.springframework.dao.support.DataAccessUtils;
import org.springframework.jdbc.core.RowMapper;
import org.springframework.stereotype.Repository;
import org.springframework.transaction.annotation.Transactional;

import com.ejie.aa79b.common.DBConstants;
import com.ejie.aa79b.common.SqlUtils;
import com.ejie.aa79b.model.Expediente;
import com.ejie.aa79b.model.ObservacionesExpediente;
import com.ejie.aa79b.model.enums.TipoExpedienteEnum;

/**
 * ObservacionesExpedienteDaoImpl generated by UDA, 06-feb-2018 8:28:55.
 * 
 * @author UDA
 */

@Repository()
@Transactional()
public class ObservacionesExpedienteDaoImpl extends GenericoDaoImpl<Expediente> implements ObservacionesExpedienteDao {

	protected static final String OBSERVACIONES = "OBSERVACIONES";
	protected static final String EXTENSIONDOC = "EXTENSIONDOC";
	protected static final String CONTENTTYPE = "CONTENTTYPE";
	protected static final String NOMBREFICHERO = "NOMBREFICHERO";
	protected static final String ANYO_055 = "ANYO_055";
	protected static final String NUM_EXP_055 = "NUM_EXP_055";
	protected static final String OBSERVACIONES_055 = "OBSERVACIONES_055";
	protected static final String OID_FICHERO_055 = "OID_FICHERO_055";
	protected static final String EXTENSION_DOC_055 = "EXTENSION_DOC_055";
	protected static final String CONTENT_TYPE_055 = "CONTENT_TYPE_055";
	protected static final String NOMBRE_FICHERO_055 = "NOMBRE_FICHERO_055";
	protected static final String TAMANODOC = "TAMANODOC";
	protected static final String[] ORDER_BY_WHITE_LIST = new String[] { DBConstants.ANYO, DBConstants.NUMEXP,
			OBSERVACIONES, DBConstants.OIDFICHERO };

	/*
	 * ROW_MAPPERS
	 */
	private RowMapper<Expediente> rwMap = new RowMapper<Expediente>() {
		@Override()
		public Expediente mapRow(ResultSet resultSet, int rowNum) throws SQLException {
			Expediente expediente = new Expediente();
			ObservacionesExpediente bean = new ObservacionesExpediente();
			bean.setObservaciones(resultSet.getString(OBSERVACIONES));
			bean.setOidFichero(resultSet.getString(DBConstants.OIDFICHERO));
			bean.setExtension(resultSet.getString(EXTENSIONDOC));
			bean.setContentType(resultSet.getString(CONTENTTYPE));
			bean.setNombre(resultSet.getString(NOMBREFICHERO));
			return expediente;
		}
	};

	private RowMapper<Expediente> rwMapPK = new RowMapper<Expediente>() {
		@Override()
		public Expediente mapRow(ResultSet resultSet, int rowNum) throws SQLException {
			Expediente expediente = new Expediente();
			expediente.setAnyo(resultSet.getLong(DBConstants.ANYO));
			expediente.setNumExp(resultSet.getInt(DBConstants.NUMEXP));

			return expediente;
		}
	};

	private RowMapper<ObservacionesExpediente> rwMapFindOne = new RowMapper<ObservacionesExpediente>() {
		@Override()
		public ObservacionesExpediente mapRow(ResultSet resultSet, int rowNum) throws SQLException {
			ObservacionesExpediente bean = new ObservacionesExpediente();
			bean.setObservaciones(resultSet.getString(OBSERVACIONES));
			bean.setOidFichero(resultSet.getString(DBConstants.OIDFICHERO));
			bean.setExtension(resultSet.getString(EXTENSIONDOC));
			bean.setContentType(resultSet.getString(CONTENTTYPE));
			bean.setNombre(resultSet.getString(NOMBREFICHERO));
			bean.setTamano(resultSet.getLong(TAMANODOC));
			return bean;
		}
	};

	/**
	 * Constructor
	 */
	public ObservacionesExpedienteDaoImpl() {
		super(Expediente.class);
	}

	/*
	 * OPERACIONES CRUD
	 */

	@Override
	public ObservacionesExpediente observacionesAdd(Expediente expediente) {
		ObservacionesExpediente observaciones = this.getObservaciones(expediente);

		String query = "INSERT INTO AA79B55S01 (ANYO_055, NUM_EXP_055, OBSERVACIONES_055, OID_FICHERO_055,EXTENSION_DOC_055,CONTENT_TYPE_055,NOMBRE_FICHERO_055,TAMANO_DOC_055) VALUES (?,?,?,?,?,?,?,?)";
		this.getJdbcTemplate().update(query, expediente.getAnyo(), expediente.getNumExp(),
				observaciones.getObservaciones(), observaciones.getOidFichero(), observaciones.getExtension(),
				observaciones.getContentType(), observaciones.getNombre(), observaciones.getTamano());
		return observaciones;
	}

	@Override
	public ObservacionesExpediente observacionesUpdate(Expediente expediente) {
		ObservacionesExpediente observaciones = this.getObservaciones(expediente);

		String query = "UPDATE AA79B55S01 SET OBSERVACIONES_055=?, OID_FICHERO_055=?, EXTENSION_DOC_055=?, CONTENT_TYPE_055=?, NOMBRE_FICHERO_055=?,TAMANO_DOC_055=? WHERE ANYO_055=? AND NUM_EXP_055=?";
		this.getJdbcTemplate().update(query, observaciones.getObservaciones(), observaciones.getOidFichero(),
				observaciones.getExtension(), observaciones.getContentType(), observaciones.getNombre(),
				observaciones.getTamano(), expediente.getAnyo(), expediente.getNumExp());
		return observaciones;
	}

	@Override
	public ObservacionesExpediente observacionesFind(Expediente expediente) {
		List<Object> params = new ArrayList<Object>();
		StringBuilder query = new StringBuilder(this.getSelect());
		query.append(this.getFrom(expediente, params));
		query.append(this.getWherePK(expediente, params));

		List<ObservacionesExpediente> beanList = this.getJdbcTemplate().query(query.toString(), this.getRwMapFindOne(),
				params.toArray());
		return DataAccessUtils.uniqueResult(beanList);
	}

	@Override()
	public void remove(Expediente expediente) {
		String query = "DELETE FROM AA79B55S01 WHERE ANYO_055=? AND NUM_EXP_055=?";
		this.getJdbcTemplate().update(query, expediente.getAnyo(), expediente.getNumExp());
	}

	@Override()
	protected String getSelect() {
		StringBuilder query = new StringBuilder();

		query.append("SELECT t1.ANYO_055 ANYO");
		query.append(", t1.NUM_EXP_055 NUMEXP");
		query.append(", t1.OBSERVACIONES_055 OBSERVACIONES");
		query.append(", t1.OID_FICHERO_055 OIDFICHERO");
		query.append(", t1.EXTENSION_DOC_055 EXTENSIONDOC");
		query.append(", t1.CONTENT_TYPE_055 CONTENTTYPE");
		query.append(", t1.NOMBRE_FICHERO_055 NOMBREFICHERO");
		query.append(", t1.TAMANO_DOC_055 TAMANODOC");

		return query.toString();
	}

	@Override()
	protected String getFrom() {
		StringBuilder query = new StringBuilder();

		query.append(" FROM AA79B55S01 t1 ");

		return query.toString();
	}

	@Override()
	protected RowMapper<Expediente> getRwMap() {
		return this.rwMap;
	}

	@Override()
	protected String[] getOrderBy() {
		return ObservacionesExpedienteDaoImpl.ORDER_BY_WHITE_LIST;
	}

	@Override()
	protected String getPK() {
		return "ANYO_055, NUM_EXP_055";
	}

	@Override()
	protected RowMapper<Expediente> getRwMapPK() {
		return this.rwMapPK;
	}

	@Override()
	protected String getWherePK(Expediente bean, List<Object> params) {
		params.add(bean.getAnyo());
		params.add(bean.getNumExp());
		return " WHERE t1.ANYO_055 = ? AND t1.NUM_EXP_055 = ?";
	}

	@Override()
	protected String getWhere(Expediente bean, List<Object> params) {

		return this.getWhereClause(bean, params);

	}

	/**
	 * @param bean
	 * @param params
	 * @return
	 */
	private String getWhereClause(Expediente bean, List<Object> params) {
		StringBuilder where = new StringBuilder(ObservacionesExpedienteDaoImpl.STRING_BUILDER_INIT);

		if (bean != null) {
			where.append(SqlUtils.generarWhereIgual(ANYO_055, bean.getAnyo(), params));
			where.append(SqlUtils.generarWhereIgual(NUM_EXP_055, bean.getNumExp(), params));
			where.append(this.getWhereObservaciones(bean, params));
		}

		return where.toString();
	}

	/**
	 * @param bean,
	 *            tipo Expediente
	 * @param params
	 * @return String
	 */
	private String getWhereObservaciones(Expediente bean, List<Object> params) {
		StringBuilder where = new StringBuilder(ObservacionesExpedienteDaoImpl.STRING_BUILDER_INIT);

		ObservacionesExpediente observaciones = this.getObservaciones(bean);

		if (observaciones != null) {
			where.append(SqlUtils.generarWhereIgual(OBSERVACIONES_055, observaciones.getObservaciones(), params));
			where.append(SqlUtils.generarWhereIgual(OID_FICHERO_055, observaciones.getOidFichero(), params));
			where.append(SqlUtils.generarWhereIgual(EXTENSION_DOC_055, observaciones.getExtension(), params));
			where.append(SqlUtils.generarWhereIgual(CONTENT_TYPE_055, observaciones.getContentType(), params));
			where.append(SqlUtils.generarWhereIgual(NOMBRE_FICHERO_055, observaciones.getNombre(), params));
		}

		return where.toString();
	}

	/**
	 * @param bean,
	 *            tipo Expediente
	 * @return ObservacionesExpediente
	 */
	private ObservacionesExpediente getObservaciones(Expediente bean) {
		ObservacionesExpediente observaciones;
		if (TipoExpedienteEnum.INTERPRETACION.getValue().equals(bean.getIdTipoExpediente())) {
			observaciones = bean.getExpedienteInterpretacion().getObservaciones();
		} else {
			observaciones = bean.getExpedienteTradRev().getObservaciones();
		}
		return observaciones;
	}

	@Override()
	protected String getWhereLike(Expediente bean, Boolean startsWith, List<Object> params, Boolean search) {

		return this.getWhereClause(bean, params);
	}

	protected RowMapper<ObservacionesExpediente> getRwMapFindOne() {
		return this.rwMapFindOne;
	}

}
