package com.ejie.aa79b.dao;

import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.List;

import org.springframework.jdbc.core.RowMapper;
import org.springframework.stereotype.Repository;
import org.springframework.transaction.annotation.Transactional;

import com.ejie.aa79b.common.SqlUtils;
import com.ejie.aa79b.model.Expediente;
import com.ejie.aa79b.model.ExpedientesRelacionados;

/**
 * ExpedientesRelacionadosDaoImpl generated by UDA, 01-mar-2018 13:29:03.
 * @author UDA
 */

@Repository()
@Transactional()
public class ExpedientesRelacionadosDaoImpl extends GenericoDaoImpl<ExpedientesRelacionados> implements ExpedientesRelacionadosDao {

	protected static final String ANYO057 = "ANYO057";
	protected static final String NUMEXP057 = "NUMEXP057";
	protected static final String ANYOEXPREL057 = "ANYOEXPREL057";
	protected static final String NUMEXPREL057 = "NUMEXPREL057";
	protected static final String ANYO_057 = "ANYO_057";
	protected static final String NUM_EXP_057 = "NUM_EXP_057";
	protected static final String ANYO_EXP_REL_057 = "ANYO_EXP_REL_057";
	protected static final String NUM_EXP_REL_057 = "NUM_EXP_REL_057";
	protected static final String[] ORDER_BY_WHITE_LIST = new String[] {ANYO057, NUMEXP057, ANYOEXPREL057, NUMEXPREL057};

	/*
	 * ROW_MAPPERS
	 */
	private RowMapper<ExpedientesRelacionados> rwMap = new RowMapper<ExpedientesRelacionados>() {
		@Override
		public ExpedientesRelacionados mapRow(ResultSet resultSet, int rowNum) throws SQLException {
			ExpedientesRelacionados expedientesRelacionados = new ExpedientesRelacionados();
			expedientesRelacionados.setAnyo(resultSet.getLong(ANYO057));
			expedientesRelacionados.setNumExp(resultSet.getInt(NUMEXP057));
			expedientesRelacionados.setAnyoExpRel(resultSet.getLong(ANYOEXPREL057));
			expedientesRelacionados.setNumExpRel(resultSet.getInt(NUMEXPREL057));
			return expedientesRelacionados;
		}
	};

	private RowMapper<ExpedientesRelacionados> rwMapPK = new RowMapper<ExpedientesRelacionados>() {
		@Override
		public ExpedientesRelacionados mapRow(ResultSet resultSet, int rowNum) throws SQLException {
			ExpedientesRelacionados expedientesRelacionados = new ExpedientesRelacionados();
			expedientesRelacionados.setAnyo(resultSet.getLong(ANYO057));
			expedientesRelacionados.setNumExp(resultSet.getInt(NUMEXP057));
			expedientesRelacionados.setAnyoExpRel(resultSet.getLong(ANYOEXPREL057));
			expedientesRelacionados.setNumExpRel(resultSet.getInt(NUMEXPREL057));
			return expedientesRelacionados;
		}
	};

	private RowMapper<ExpedientesRelacionados> rwMapSelectExpRelacionadosList = new RowMapper<ExpedientesRelacionados>() {
		@Override
		public ExpedientesRelacionados mapRow(ResultSet resultSet, int rowNum) throws SQLException {
			ExpedientesRelacionados expedientesRelacionados = new ExpedientesRelacionados();
			expedientesRelacionados.setAnyo(resultSet.getLong(ANYO057));
			expedientesRelacionados.setNumExp(resultSet.getInt(NUMEXP057));
			expedientesRelacionados.setAnyoExpRel(resultSet.getLong(ANYOEXPREL057));
			expedientesRelacionados.setNumExpRel(resultSet.getInt(NUMEXPREL057));
			expedientesRelacionados.setTituloRel(resultSet.getString("TITULO051"));
			expedientesRelacionados.setFechaAltaRel(resultSet.getDate("FECHAALTA051"));


			return expedientesRelacionados;
		}
	};

	/**
	 * Constructor
	 */
	public ExpedientesRelacionadosDaoImpl() {
		super(ExpedientesRelacionados.class);
	}


	/*
	 * OPERACIONES CRUD
	 */

	@Override()
	public ExpedientesRelacionados add(ExpedientesRelacionados expedientesrelacionados) {
    	String query = "INSERT INTO AA79B57S01 (ANYO_057, NUM_EXP_057, ANYO_EXP_REL_057, NUM_EXP_REL_057) VALUES (?,?,?,?)";
		this.getJdbcTemplate().update(query, expedientesrelacionados.getAnyo(), expedientesrelacionados.getNumExp(), expedientesrelacionados.getAnyoExpRel(), expedientesrelacionados.getNumExpRel());
		return expedientesrelacionados;
	}

    @Override()
	public ExpedientesRelacionados update(ExpedientesRelacionados expedientesrelacionados) {
		String query = "UPDATE AA79B57S01 SET ANYO_EXP_REL_057=?, NUM_EXP_REL_057=? WHERE ANYO_057=? AND NUM_EXP_057=?";
		this.getJdbcTemplate().update(query, expedientesrelacionados.getAnyoExpRel(), expedientesrelacionados.getNumExpRel(), expedientesrelacionados.getAnyo(), expedientesrelacionados.getNumExp());
		return expedientesrelacionados;
	}

    @Override()
	public void remove(ExpedientesRelacionados expedientesrelacionados) {
		String query = "DELETE FROM AA79B57S01 WHERE ANYO_057=? AND NUM_EXP_057=? AND ANYO_EXP_REL_057=? AND NUM_EXP_REL_057=?";
		this.getJdbcTemplate().update(query, expedientesrelacionados.getAnyo() , expedientesrelacionados.getNumExp(), expedientesrelacionados.getAnyoExpRel(), expedientesrelacionados.getNumExpRel());
    }

    @Override()
	protected String getSelect() {
		StringBuilder query = new StringBuilder();

		query.append("SELECT t1.ANYO_057 ANYO057");
		query.append(", t1.NUM_EXP_057 NUMEXP057");
		query.append(", t1.ANYO_EXP_REL_057 ANYOEXPREL057");
		query.append(", t1.NUM_EXP_REL_057 NUMEXPREL057");

		return query.toString();
	}

	@Override()
	protected String getFrom() {
		StringBuilder query = new StringBuilder();

		query.append(" FROM AA79B57S01 t1 ");

		return query.toString();
	}

	@Override()
	protected RowMapper<ExpedientesRelacionados> getRwMap() {
		return this.rwMap;
	}

	@Override()
	protected String[] getOrderBy() {
		return ExpedientesRelacionadosDaoImpl.ORDER_BY_WHITE_LIST;
	}

	@Override()
	protected String getPK() {
		return "ANYO_057,NUM_EXP_057,ANYO_EXP_REL_057,NUM_EXP_REL_057";
	}

	@Override()
	protected RowMapper<ExpedientesRelacionados> getRwMapPK() {
		return this.rwMapPK;
	}

	@Override()
	protected String getWherePK(ExpedientesRelacionados bean, List<Object> params) {
		params.add(bean.getAnyo());
		params.add(bean.getNumExp());
		params.add(bean.getAnyoExpRel());
		params.add(bean.getNumExpRel());
		return " WHERE t1.ANYO_057 = ? AND t1.NUM_EXP_057 = ? AND ANYO_EXP_REL_057=? AND NUM_EXP_REL_057=?";
	}

	@Override()
	protected String getWhere(ExpedientesRelacionados bean, List<Object> params) {

		StringBuilder where = new StringBuilder(ExpedientesRelacionadosDaoImpl.STRING_BUILDER_INIT);

		if (bean != null) {
			where.append(SqlUtils.generarWhereIgual(ANYO_057, bean.getAnyo(), params));
			where.append(SqlUtils.generarWhereIgual(NUM_EXP_057, bean.getNumExp(), params));
			where.append(SqlUtils.generarWhereIgual(ANYO_EXP_REL_057, bean.getAnyoExpRel(), params));
			where.append(SqlUtils.generarWhereIgual(NUM_EXP_REL_057, bean.getNumExpRel(), params));
		}

		return where.toString();
	}

	@Override()
	protected String getWhereLike(ExpedientesRelacionados bean, Boolean startsWith, List<Object> params, Boolean search) {

		StringBuilder where = new StringBuilder(ExpedientesRelacionadosDaoImpl.STRING_BUILDER_INIT);

		if (bean != null) {
			where.append(SqlUtils.generarWhereIgual(ANYO_057, bean.getAnyo(), params));
			where.append(SqlUtils.generarWhereIgual(NUM_EXP_057, bean.getNumExp(), params));
			where.append(SqlUtils.generarWhereIgual(ANYO_EXP_REL_057, bean.getAnyoExpRel(), params));
			where.append(SqlUtils.generarWhereIgual(NUM_EXP_REL_057, bean.getNumExpRel(), params));
		}

		return where.toString();
	}


	@Override()
	public void removeExpedienteRelacionado(Expediente expediente) {
		String query = "DELETE FROM AA79B57S01 WHERE ANYO_057=? AND NUM_EXP_057=? AND ANYO_EXP_REL_057=? AND NUM_EXP_REL_057=?";
		this.getJdbcTemplate().update(query, expediente.getAnyo() , expediente.getNumExp(), expediente.getExpedienteRelacionado().getAnyoExpRel(), expediente.getExpedienteRelacionado().getNumExpRel());
	}

	@Override()
	public List<ExpedientesRelacionados> selectExpRelacionadosList(Expediente expediente) {
		StringBuilder query = new StringBuilder();
        List<Object> params = new ArrayList<Object>();
        query.append(this.getSelect());
        query.append(", e1.TITULO_051 TITULO051");
        query.append(", e1.FECHA_ALTA_051 FECHAALTA051");
        query.append(this.getFrom() + "LEFT JOIN AA79B51S01 e1 ");
        query.append("ON t1.ANYO_EXP_REL_057 = e1.ANYO_051 AND ");
        query.append("t1.NUM_EXP_REL_057 = e1.NUM_EXP_051 ");
        query.append("WHERE t1.ANYO_057 = ? AND ");
        query.append("t1.NUM_EXP_057 = ? ");
        params.add(expediente.getAnyo());
        params.add(expediente.getNumExp());

        return this.getJdbcTemplate().query(query.toString(), this.rwMapSelectExpRelacionadosList, params.toArray());
	}

	@Override()
	public void addLista(List<Expediente> listExp, Expediente expediente) {
		String query = "INSERT INTO AA79B57S01 (ANYO_057, NUM_EXP_057, ANYO_EXP_REL_057, NUM_EXP_REL_057) VALUES (?,?,?,?)";
		final List<Object[]> params = new ArrayList<Object[]>();
		final List<Object> aux = new ArrayList<Object>();
		for (Expediente exp : listExp) {
			if (!exp.getAnyo().equals(expediente.getAnyo()) || !exp.getNumExp().equals(expediente.getNumExp())) {
				aux.clear();
				aux.add(expediente.getAnyo());
				aux.add(expediente.getNumExp());
				aux.add(exp.getAnyo());
				aux.add(exp.getNumExp());
				params.add(aux.toArray());
				aux.clear();
				aux.add(exp.getAnyo());
				aux.add(exp.getNumExp());
				aux.add(expediente.getAnyo());
				aux.add(expediente.getNumExp());
				params.add(aux.toArray());
			}
		}
		this.getJdbcTemplate().batchUpdate(query, params);
	}

}

