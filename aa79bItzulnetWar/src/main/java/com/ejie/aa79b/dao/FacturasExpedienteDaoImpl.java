package com.ejie.aa79b.dao;

import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.List;

import org.springframework.jdbc.core.RowMapper;
import org.springframework.stereotype.Repository;
import org.springframework.transaction.annotation.Transactional;

import com.ejie.aa79b.common.DBConstants;
import com.ejie.aa79b.common.DaoConstants;
import com.ejie.aa79b.common.SqlUtils;
import com.ejie.aa79b.model.FacturasExpediente;

/**
 * FacturasExpedienteDaoImpl generated by UDA, 30-oct-2018 11:14:46.
 * 
 * @author UDA
 */

@Repository()
@Transactional()
public class FacturasExpedienteDaoImpl extends GenericoDaoImpl<FacturasExpediente> implements FacturasExpedienteDao {

	public static final String[] ORDER_BY_WHITE_LIST = new String[] { DBConstants.IDFACTURA, DBConstants.ANYO,
			DBConstants.NUMEXP };

	private RowMapper<FacturasExpediente> rwMap = new RowMapper<FacturasExpediente>() {
		public FacturasExpediente mapRow(ResultSet resultSet, int rowNum) throws SQLException {
			FacturasExpediente facturasExpediente = new FacturasExpediente();
			facturasExpediente.setIdFactura(resultSet.getLong(DBConstants.IDFACTURA));
			facturasExpediente.setAnyo(resultSet.getLong(DBConstants.ANYO));
			facturasExpediente.setNumExp(resultSet.getInt(DBConstants.NUMEXP));
			return facturasExpediente;
		}
	};

	private RowMapper<FacturasExpediente> rwMapPK = new RowMapper<FacturasExpediente>() {
		public FacturasExpediente mapRow(ResultSet resultSet, int rowNum) throws SQLException {
			FacturasExpediente facturasExpediente = new FacturasExpediente();
			facturasExpediente.setIdFactura(resultSet.getLong(DBConstants.IDFACTURA));
			return facturasExpediente;
		}
	};

	/**
	 * Constructor
	 */
	public FacturasExpedienteDaoImpl() {
		super(FacturasExpediente.class);
	}

	@Override()
	public FacturasExpediente add(FacturasExpediente facturasexpediente) {
		String query = "INSERT INTO AA79BA5S01 (ID_FACTURA_0A5, ANYO_0A5, NUM_EXP_0A5) VALUES (?,?,?)";
		this.getJdbcTemplate().update(query, facturasexpediente.getIdFactura(), facturasexpediente.getAnyo(),
				facturasexpediente.getNumExp());
		return facturasexpediente;
	}

	@Override()
	public FacturasExpediente update(FacturasExpediente facturasexpediente) {
		String query = "UPDATE AA79BA5S01 SET  WHERE ID_FACTURA_0A5=? AND ANYO_0A5=? AND NUM_EXP_0A5=?";
		this.getJdbcTemplate().update(query, facturasexpediente.getIdFactura(), facturasexpediente.getAnyo(),
				facturasexpediente.getNumExp());
		return facturasexpediente;
	}

	@Override()
	public void remove(FacturasExpediente facturasexpediente) {
		String query = "DELETE FROM AA79BA5S01 WHERE ID_FACTURA_0A5=? AND ANYO_0A5=? AND NUM_EXP_0A5=?";
		this.getJdbcTemplate().update(query, facturasexpediente.getIdFactura(), facturasexpediente.getAnyo(),
				facturasexpediente.getNumExp());
	}

	@Override()
	protected String getSelect() {
		StringBuilder query = new StringBuilder();

		query.append(DaoConstants.SELECT);
		query.append(DaoConstants.T1_MINUSCULA);
		query.append(DaoConstants.SIGNO_PUNTO);
		query.append(DBConstants.ID_FACTURA_0A5);
		query.append(DaoConstants.BLANK);
		query.append(DBConstants.IDFACTURA);
		query.append(DaoConstants.SIGNO_COMA);
		query.append(DaoConstants.T1_MINUSCULA);
		query.append(DaoConstants.SIGNO_PUNTO);
		query.append(DBConstants.ANYO_0A5);
		query.append(DaoConstants.BLANK);
		query.append(DBConstants.ANYO);
		query.append(DaoConstants.SIGNO_COMA);
		query.append(DaoConstants.T1_MINUSCULA);
		query.append(DaoConstants.SIGNO_PUNTO);
		query.append(DBConstants.NUM_EXP_0A5);
		query.append(DaoConstants.BLANK);
		query.append(DBConstants.NUMEXP);

		return query.toString();
	}

	@Override()
	protected String getFrom() {
		StringBuilder query = new StringBuilder();

		query.append(DaoConstants.FROM);
		query.append(DBConstants.TABLA_A5);
		query.append(DaoConstants.BLANK);
		query.append(DaoConstants.T1_MINUSCULA);

		return query.toString();
	}

	@Override()
	protected RowMapper<FacturasExpediente> getRwMap() {
		return this.rwMap;
	}

	@Override()
	protected String[] getOrderBy() {
		return FacturasExpedienteDaoImpl.ORDER_BY_WHITE_LIST;
	}

	@Override()
	protected String getPK() {
		return DBConstants.ID_FACTURA_0A5;
	}

	@Override()
	protected RowMapper<FacturasExpediente> getRwMapPK() {
		return this.rwMapPK;
	}

	@Override()
	protected String getWherePK(FacturasExpediente bean, List<Object> params) {
		params.add(bean.getIdFactura());
		params.add(bean.getAnyo());
		params.add(bean.getNumExp());

		StringBuilder where = new StringBuilder();
		where.append(DaoConstants.WHERE);
		where.append(DaoConstants.T1_MINUSCULA);
		where.append(DaoConstants.SIGNO_PUNTO);
		where.append(DBConstants.ID_FACTURA_0A5);
		where.append(DaoConstants.SIGNOIGUAL_INTERROGACION);
		where.append(DaoConstants.AND);
		where.append(DaoConstants.T1_MINUSCULA);
		where.append(DaoConstants.SIGNO_PUNTO);
		where.append(DBConstants.ANYO_0A5);
		where.append(DaoConstants.SIGNOIGUAL_INTERROGACION);
		where.append(DaoConstants.AND);
		where.append(DaoConstants.T1_MINUSCULA);
		where.append(DaoConstants.SIGNO_PUNTO);
		where.append(DBConstants.NUM_EXP_0A5);
		where.append(DaoConstants.SIGNOIGUAL_INTERROGACION);

		return where.toString();
	}

	@Override()
	protected String getWhere(FacturasExpediente bean, List<Object> params) {
		return getWhereClausule(bean, params);
	}

	@Override()
	protected String getWhereLike(FacturasExpediente bean, Boolean startsWith, List<Object> params, Boolean search) {
		return getWhereClausule(bean, params);
	}

	/**
	 * Obtiene la clausula where
	 * 
	 * @param bean
	 * @param params
	 * @return String
	 */
	private String getWhereClausule(FacturasExpediente bean, List<Object> params) {
		StringBuilder where = new StringBuilder(FacturasExpedienteDaoImpl.STRING_BUILDER_INIT);

		if (bean != null) {
			where.append(SqlUtils.generarWhereIgual(DBConstants.ID_FACTURA_0A5, bean.getIdFactura(), params));
			where.append(SqlUtils.generarWhereIgual(DBConstants.ANYO_0A5, bean.getAnyo(), params));
			where.append(SqlUtils.generarWhereIgual(DBConstants.NUM_EXP_0A5, bean.getNumExp(), params));
		}

		return where.toString();
	}

	/**
	 * 
	 * @param lista
	 *            List<Expediente>
	 */
	@Override
	public void addExpedientes(List<FacturasExpediente> lista, Long idFactura) {
		String query = "INSERT INTO AA79BA5S01 (ID_FACTURA_0A5, ANYO_0A5, NUM_EXP_0A5) VALUES (?,?,?)";
		final List<Object[]> params = new ArrayList<Object[]>();
		final List<Object> aux = new ArrayList<Object>();
		for (FacturasExpediente expediente : lista) {
			aux.clear();
			aux.add(idFactura);
			aux.add(expediente.getAnyo());
			aux.add(expediente.getNumExp());
			params.add(aux.toArray());
		}
		this.getJdbcTemplate().batchUpdate(query, params);
	}

}
