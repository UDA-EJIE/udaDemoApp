package com.ejie.aa79b.dao;

import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.List;

import org.springframework.jdbc.core.RowMapper;
import org.springframework.stereotype.Repository;
import org.springframework.transaction.annotation.Transactional;

import com.ejie.aa79b.common.DBConstants;
import com.ejie.aa79b.common.SqlUtils;
import com.ejie.aa79b.model.TrabajadoresGruposTrabajo;

/**
 * TrabajadoresGruposTrabajoDaoImpl generated by UDA, 24-nov-2017 10:10:28.
 * 
 * @author UDA
 */

@Repository()
@Transactional()
public class TrabajadoresGruposTrabajoDaoImpl extends GenericoDaoImpl<TrabajadoresGruposTrabajo>
		implements TrabajadoresGruposTrabajoDao {

	public TrabajadoresGruposTrabajoDaoImpl() {
		super(TrabajadoresGruposTrabajo.class);
	}

	public static final String[] ORDER_BY_WHITE_LIST = new String[] { "IDGRUPO028", "DNITRABAJADOR028",
			DBConstants.DNICOMPLETO, DBConstants.NOMBRECOMPLETO };

	/*
	 * ROW_MAPPERS
	 */
	private RowMapper<TrabajadoresGruposTrabajo> rwMap = new RowMapper<TrabajadoresGruposTrabajo>() {
		@Override
		public TrabajadoresGruposTrabajo mapRow(ResultSet rs, int rowNum) throws SQLException {
			TrabajadoresGruposTrabajo bean = new TrabajadoresGruposTrabajo();
			bean.setIdGrupo(rs.getLong("IDGRUPO028"));
			bean.setTipIden(rs.getInt(DBConstants.TIPIDEN));
			bean.setPreDni(rs.getString(DBConstants.PREDNI));
			bean.setDni(rs.getString("DNITRABAJADOR028"));
			bean.setSufDni(rs.getString(DBConstants.SUFDNI));
			bean.setNombre(rs.getString(DBConstants.NOMBRE));
			bean.setApellido1(rs.getString(DBConstants.APEL1));
			bean.setApellido2(rs.getString(DBConstants.APEL2));
			return bean;
		}
	};

	private RowMapper<TrabajadoresGruposTrabajo> rwMapPK = new RowMapper<TrabajadoresGruposTrabajo>() {
		@Override
		public TrabajadoresGruposTrabajo mapRow(ResultSet resultSet, int rowNum) throws SQLException {
			TrabajadoresGruposTrabajo bean = new TrabajadoresGruposTrabajo();
			bean.setIdGrupo(resultSet.getLong("IDGRUPO028"));
			bean.setDni(resultSet.getString("DNITRABAJADOR028"));
			return bean;
		}
	};

	private RowMapper<TrabajadoresGruposTrabajo> rwMapPersonalIzo = new RowMapper<TrabajadoresGruposTrabajo>() {
		@Override
		public TrabajadoresGruposTrabajo mapRow(ResultSet rs, int rowNum) throws SQLException {
			TrabajadoresGruposTrabajo bean = new TrabajadoresGruposTrabajo();
			bean.setTipIden(rs.getInt(DBConstants.TIPIDEN));
			bean.setPreDni(rs.getString(DBConstants.PREDNI));
			bean.setDni(rs.getString(DBConstants.DNI));
			bean.setSufDni(rs.getString(DBConstants.SUFDNI));
			bean.setNombre(rs.getString(DBConstants.NOMBRE));
			bean.setApellido1(rs.getString(DBConstants.APEL1));
			bean.setApellido2(rs.getString(DBConstants.APEL2));
			bean.setDniCompleto(rs.getString(DBConstants.DNICOMPLETO));
			bean.setNombreCompleto(rs.getString(DBConstants.NOMBRECOMPLETO));
			return bean;
		}
	};

	@Override()
	public TrabajadoresGruposTrabajo add(TrabajadoresGruposTrabajo trabajadoresgrupostrabajo) {
		String query = "INSERT INTO AA79B28S01 (ID_GRUPO_028, DNI_TRABAJADOR_028) VALUES (?,?)";
		this.getJdbcTemplate().update(query, trabajadoresgrupostrabajo.getIdGrupo(),
				trabajadoresgrupostrabajo.getDni());
		return trabajadoresgrupostrabajo;
	}

	@Override()
	public void remove(TrabajadoresGruposTrabajo trabajadoresgrupostrabajo) {
		String query = "DELETE FROM AA79B28S01 WHERE ID_GRUPO_028=? AND DNI_TRABAJADOR_028=?";
		this.getJdbcTemplate().update(query, trabajadoresgrupostrabajo.getIdGrupo(),
				trabajadoresgrupostrabajo.getDni());
	}

	@Override()
	protected String getSelect() {
		StringBuilder selectTrabGrupo = new StringBuilder();
		selectTrabGrupo.append("SELECT t1.ID_GRUPO_028 IDGRUPO028");
		selectTrabGrupo.append(", t1.DNI_TRABAJADOR_028 DNITRABAJADOR028");
		selectTrabGrupo.append(
				", TIPIDEN_077 TIPIDEN, PREDNI_077 PREDNI, DNI_077 DNI, SUFDNI_077 SUFDNI, NOMBRE_077 NOMBRE, APEL1_077 APEL1, APEL2_077 APEL2");
		selectTrabGrupo.append(", PREDNI_077 || DNI_077 || SUFDNI_077 AS DNICOMPLETO");
		selectTrabGrupo.append(", APEL1_077 || ' ' || APEL2_077 || ', ' || NOMBRE_077 AS NOMBRECOMPLETO");
		return selectTrabGrupo.toString();
	}

	@Override()
	protected String getFrom() {
		return " FROM AA79B28S01 t1 LEFT JOIN AA79B77S01 ON DNI_077 = DNI_TRABAJADOR_028";
	}

	@Override()
	protected RowMapper<TrabajadoresGruposTrabajo> getRwMap() {
		return this.rwMap;
	}

	private RowMapper<TrabajadoresGruposTrabajo> getRwMapPersonalIzo() {
		return this.rwMapPersonalIzo;
	}

	@Override()
	protected String[] getOrderBy() {
		return ORDER_BY_WHITE_LIST;
	}

	@Override()
	protected String getPK() {
		return "ID_GRUPO_028, DNI_TRABAJADOR_028";
	}

	@Override()
	protected RowMapper<TrabajadoresGruposTrabajo> getRwMapPK() {
		return this.rwMapPK;
	}

	@Override()
	protected String getWherePK(TrabajadoresGruposTrabajo bean, List<Object> params) {
		params.add(bean.getIdGrupo());
		params.add(bean.getDni());
		return " WHERE t1.ID_GRUPO_028 = ? AND DNI_TRABAJADOR_028 = ?";
	}

	@Override()
	protected String getWhere(TrabajadoresGruposTrabajo bean, List<Object> params) {
		StringBuilder where = new StringBuilder(EntidadesGruposTrabajoDaoImpl.STRING_BUILDER_INIT);
		where.append(SqlUtils.generarWhereIgual("ID_GRUPO_028", bean.getIdGrupo(), params));
		where.append(SqlUtils.generarWhereIgual("DNI_TRABAJADOR_028", bean.getDni(), params));
		return where.toString();
	}

	@Override()
	protected String getWhereLike(TrabajadoresGruposTrabajo bean, Boolean startsWith, List<Object> params,
			Boolean search) {
		StringBuilder where = new StringBuilder(EntidadesGruposTrabajoDaoImpl.STRING_BUILDER_INIT);
		where.append(SqlUtils.generarWhereIgual("ID_GRUPO_028", bean.getIdGrupo(), params));
		where.append(SqlUtils.generarWhereIgual("DNI_TRABAJADOR_028", bean.getDni(), params));
		return where.toString();
	}

	@Override()
	@Transactional(readOnly = true)
	public List<TrabajadoresGruposTrabajo> findAllSinRepetidos(TrabajadoresGruposTrabajo bean) {
		StringBuilder query = new StringBuilder(
				"SELECT DNI, TIPIDEN, PREDNI, SUFDNI, NOMBRE, APEL1, APEL2, PREDNI || DNI || SUFDNI AS DNICOMPLETO, APEL1 || ' ' || APEL2 || ', ' || NOMBRE AS NOMBRECOMPLETO");
		query.append(" FROM X54JAPI_PERSONAL_IZO ");
		query.append(" GROUP BY DNI,TIPIDEN,PREDNI,SUFDNI,NOMBRE,APEL1,APEL2 ");
		return this.getJdbcTemplate().query(query.toString(), this.getRwMapPersonalIzo());
	}
}
