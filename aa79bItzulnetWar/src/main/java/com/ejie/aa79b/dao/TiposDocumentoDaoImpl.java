package com.ejie.aa79b.dao;

import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.List;
import java.util.Locale;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.i18n.LocaleContextHolder;
import org.springframework.context.support.ReloadableResourceBundleMessageSource;
import org.springframework.jdbc.core.RowMapper;
import org.springframework.stereotype.Repository;
import org.springframework.transaction.annotation.Transactional;

import com.ejie.aa79b.common.Constants;
import com.ejie.aa79b.common.DBConstants;
import com.ejie.aa79b.common.SqlUtils;
import com.ejie.aa79b.dao.mapper.TiposDocumentoRowMapper;
import com.ejie.aa79b.model.TiposDocumento;
import com.ejie.aa79b.utils.Utils;
import com.ejie.x38.dto.JQGridRequestDto;

/**
 * TiposDocumentoDaoImpl generated by UDA, 30-nov-2017 16:05:35.
 *
 * @author UDA
 */

@Repository()
@Transactional()
public class TiposDocumentoDaoImpl extends GenericoDaoImpl<TiposDocumento> implements TiposDocumentoDao {

	@Autowired()
	private ReloadableResourceBundleMessageSource msg;

	protected static final String ID_042 = "ID_042";
	protected static final String[] ORDER_BY_WHITE_LIST = new String[] { DBConstants.ID, DBConstants.DESCES,
			DBConstants.DESCEU, "IDTIPORELEVANCIA", "INDFACTURABLE", "INDCONFIDENCIAL", "INDRECARGOURGENCIA",
			DBConstants.ESTADO, DBConstants.ESTADODESC, "INDFACTURABLEDESC", "INDCONFIDENCIALDESC",
			"INDRECARGOURGENCIADESC", "INDACTMEMORIADESC", "DESCRELEVANCIA", "DESCNORMES", "DESCNORMEU", "ORDEN" };
	protected static final String COMUN_SI = "comun.si";
	protected static final String COMUN_NO = "comun.no";

	/*
	 * ROW_MAPPERS
	 */
	private RowMapper<TiposDocumento> rwMap = new TiposDocumentoRowMapper();

	private RowMapper<TiposDocumento> rwMapPK = new RowMapper<TiposDocumento>() {
		@Override()
		public TiposDocumento mapRow(ResultSet resultSet, int rowNum) throws SQLException {
			TiposDocumento tiposDocumento = new TiposDocumento();
			tiposDocumento.setId(resultSet.getLong(DBConstants.ID));
			return tiposDocumento;
		}
	};

	/**
	 * Constructor
	 */
	public TiposDocumentoDaoImpl() {
		super(TiposDocumento.class);
	}

	@Override()
	public TiposDocumento add(TiposDocumento tiposdocumento) {
		String query = "INSERT INTO AA79B42S01 (ID_042, DESC_ES_042, DESC_EU_042, ID_TIPO_RELEVANCIA_042, IND_FACTURABLE_042, IND_CONFIDENCIAL_042, IND_RECARGO_URGENCIA_042, ESTADO_042, IND_ACTUALIZA_MEMORIAS_042, ORDEN_042) VALUES (AA79B42Q00.NEXTVAL,?,?,?,?,?,?,?,?,?)";
		this.getJdbcTemplate().update(query, tiposdocumento.getDescEs(), tiposdocumento.getDescEu(),
				tiposdocumento.getTipoRelevancia().getIdTipoRelevancia(),
				tiposdocumento.getIndFacturable() == null ? Constants.NO : tiposdocumento.getIndFacturable(),
				tiposdocumento.getIndConfidencial() == null ? Constants.NO : tiposdocumento.getIndConfidencial(),
				tiposdocumento.getIndRecargoUrgencia() == null ? Constants.NO : tiposdocumento.getIndRecargoUrgencia(),
				tiposdocumento.getEstado(), tiposdocumento.getIndActMemoria(), tiposdocumento.getOrden());
		return tiposdocumento;
	}

	@Override()
	public TiposDocumento update(TiposDocumento tiposdocumento) {
		String query = "UPDATE AA79B42S01 SET DESC_ES_042=?, DESC_EU_042=?, ID_TIPO_RELEVANCIA_042=?, IND_FACTURABLE_042=?, IND_CONFIDENCIAL_042=?, IND_RECARGO_URGENCIA_042=?, ESTADO_042=?,IND_ACTUALIZA_MEMORIAS_042=?,ORDEN_042=?  WHERE ID_042=?";
		this.getJdbcTemplate().update(query, tiposdocumento.getDescEs(), tiposdocumento.getDescEu(),
				tiposdocumento.getTipoRelevancia().getIdTipoRelevancia(),
				tiposdocumento.getIndFacturable() == null ? Constants.NO : tiposdocumento.getIndFacturable(),
				tiposdocumento.getIndConfidencial() == null ? Constants.NO : tiposdocumento.getIndConfidencial(),
				tiposdocumento.getIndRecargoUrgencia() == null ? Constants.NO : tiposdocumento.getIndRecargoUrgencia(),
				tiposdocumento.getEstado(), tiposdocumento.getIndActMemoria(),tiposdocumento.getOrden(), tiposdocumento.getId());
		return tiposdocumento;
	}

	@Override()
	public void remove(TiposDocumento tiposdocumento) {
		String query = "DELETE FROM AA79B42S01 WHERE ID_042=?";
		this.getJdbcTemplate().update(query, tiposdocumento.getId());
	}

	@Override()
	protected String getSelect() {
		Locale locale = LocaleContextHolder.getLocale();
		StringBuilder query = new StringBuilder();

		query.append("SELECT t1.ID_042 ID");
		query.append(", t1.DESC_ES_042 DESCES");
		query.append(", t1.DESC_EU_042 DESCEU");
		query.append(", t1.ID_TIPO_RELEVANCIA_042 IDTIPORELEVANCIA");
		query.append(", t1.IND_FACTURABLE_042 INDFACTURABLE");
		query.append(", DECODE(t1.IND_FACTURABLE_042, '").append(Constants.SI).append("', '")
				.append(this.msg.getMessage(COMUN_SI, null, locale)).append("', '")
				.append(this.msg.getMessage(COMUN_NO, null, locale)).append("') AS INDFACTURABLEDESC");
		query.append(", t1.IND_CONFIDENCIAL_042 INDCONFIDENCIAL");
		query.append(", t1.IND_ACTUALIZA_MEMORIAS_042 INDACTMEMORIA");
		query.append(", DECODE(t1.IND_ACTUALIZA_MEMORIAS_042, '").append(Constants.SI).append("', '")
				.append(this.msg.getMessage(COMUN_SI, null, locale)).append("', '")
				.append(this.msg.getMessage(COMUN_NO, null, locale)).append("') AS INDACTMEMORIADESC");
		query.append(", DECODE(t1.IND_CONFIDENCIAL_042, '").append(Constants.SI).append("', '")
				.append(this.msg.getMessage(COMUN_SI, null, locale)).append("', '")
				.append(this.msg.getMessage(COMUN_NO, null, locale)).append("') AS INDCONFIDENCIALDESC");
		query.append(", t1.IND_RECARGO_URGENCIA_042 INDRECARGOURGENCIA");
		query.append(", DECODE(t1.IND_RECARGO_URGENCIA_042, '").append(Constants.SI).append("', '")
				.append(this.msg.getMessage(COMUN_SI, null, locale)).append("', '")
				.append(this.msg.getMessage(COMUN_NO, null, locale)).append("') AS INDRECARGOURGENCIADESC");
		query.append(", t1.ESTADO_042 ESTADO");
		query.append(", DECODE(t1.ESTADO_042, '").append(Constants.ALTA).append("', '")
				.append(this.msg.getMessage("estado.alta", null, locale)).append("', '").append(Constants.BAJA)
				.append("', '").append(this.msg.getMessage("estado.baja", null, locale)).append("') AS ESTADODESC");
		if (Constants.LANG_CASTELLANO.equals(locale.getLanguage())) {
			query.append(", t2.DESC_RELEVANCIA_ES_010 AS DESCRELEVANCIA");
		} else {
			query.append(", t2.DESC_RELEVANCIA_EU_010 AS DESCRELEVANCIA");
		}
		query.append(", t2.PRIORIDAD_010 AS PRIORIDAD");
		// Para ordenaci√≥n con acentos etc
		query.append(", ").append(SqlUtils.normalizarCampoSql("t1.DESC_ES_042")).append(" AS DESCNORMES");
		query.append(", ").append(SqlUtils.normalizarCampoSql("t1.DESC_EU_042")).append(" AS DESCNORMEU");
		query.append(", t1.ORDEN_042 ORDEN");
		return query.toString();
	}

	@Override()
	protected String getFrom() {
		StringBuilder query = new StringBuilder();

		query.append(" FROM AA79B42S01 t1 ");
		query.append(" JOIN AA79B10S01 t2 ON t1.ID_TIPO_RELEVANCIA_042 = t2.ID_TIPO_RELEVANCIA_010 ");

		return query.toString();
	}

	@Override()
	protected RowMapper<TiposDocumento> getRwMap() {
		return this.rwMap;
	}

	@Override()
	protected String[] getOrderBy() {
		return TiposDocumentoDaoImpl.ORDER_BY_WHITE_LIST;
	}

	@Override()
	protected String getPK() {
		return ID_042;
	}

	@Override()
	protected RowMapper<TiposDocumento> getRwMapPK() {
		return this.rwMapPK;
	}

	@Override()
	protected String getWherePK(TiposDocumento bean, List<Object> params) {
		params.add(bean.getId());
		return " WHERE t1.ID_042 = ?";
	}

	@Override()
	protected String getWhere(TiposDocumento bean, List<Object> params) {

		StringBuilder where = new StringBuilder(TiposDocumentoDaoImpl.STRING_BUILDER_INIT);

		if (bean != null) {
			where.append(SqlUtils.generarWhereIgual(ID_042, bean.getId(), params));
			where.append(SqlUtils.generarWhereLikeNormalizado("DESC_ES_042", bean.getDescEs(), params, false));
			where.append(SqlUtils.generarWhereLikeNormalizado("DESC_EU_042", bean.getDescEu(), params, false));
			if (bean.getTipoRelevancia() != null) {
				where.append(SqlUtils.generarWhereIgual("ID_TIPO_RELEVANCIA_042",
						bean.getTipoRelevancia().getIdTipoRelevancia(), params));
			}
			where.append(SqlUtils.generarWhereIgual("IND_FACTURABLE_042", bean.getIndFacturable(), params));
			where.append(SqlUtils.generarWhereIgual("IND_CONFIDENCIAL_042", bean.getIndConfidencial(), params));
			where.append(SqlUtils.generarWhereIgual("IND_RECARGO_URGENCIA_042", bean.getIndRecargoUrgencia(), params));
			where.append(SqlUtils.generarWhereIgual("ESTADO_042", bean.getEstado(), params));
			where.append(SqlUtils.generarWhereIgual("ORDEN_042", bean.getOrden(), params));
		}

		return where.toString();
	}

	@Override()
	protected String getWhereLike(TiposDocumento bean, Boolean startsWith, List<Object> params, Boolean search) {

		StringBuilder where = new StringBuilder(TiposDocumentoDaoImpl.STRING_BUILDER_INIT);

		if (bean != null) {
			where.append(SqlUtils.generarWhereIgual(ID_042, bean.getId(), params));
			where.append(SqlUtils.generarWhereLikeNormalizado("DESC_ES_042", bean.getDescEs(), params, startsWith));
			where.append(SqlUtils.generarWhereLikeNormalizado("DESC_EU_042", bean.getDescEu(), params, startsWith));
			if (bean.getTipoRelevancia() != null) {
				where.append(SqlUtils.generarWhereIgual("ID_TIPO_RELEVANCIA_042",
						bean.getTipoRelevancia().getIdTipoRelevancia(), params));
			}
			where.append(SqlUtils.generarWhereIgual("IND_FACTURABLE_042", bean.getIndFacturable(), params));
			where.append(SqlUtils.generarWhereIgual("IND_CONFIDENCIAL_042", bean.getIndConfidencial(), params));
			where.append(SqlUtils.generarWhereIgual("IND_RECARGO_URGENCIA_042", bean.getIndRecargoUrgencia(), params));
			where.append(SqlUtils.generarWhereIgual("ESTADO_042", bean.getEstado(), params));
			where.append(SqlUtils.generarWhereIgual("ORDEN_042", bean.getOrden(), params));
		}
		return where.toString();
	}

	@Override()
    @Transactional(readOnly = true)
    public List<TiposDocumento> findAll(TiposDocumento bean, JQGridRequestDto jqGridRequestDto) {
        List<Object> params = new ArrayList<Object>();
        StringBuilder query = new StringBuilder(this.getWith());
        query.append(this.getSelect());
        query.append(this.getFrom(bean, params));

        query.append(GenericoDaoImpl.DEFAULT_WHERE);
        query.append(this.getWhere(bean, params));

    	return this.getJdbcTemplate().query(Utils.getPaginationQuery(jqGridRequestDto, false, query), this.getRwMap(), params.toArray());
    }
}
