package com.ejie.aa79b.service;

import java.util.LinkedHashMap;
import java.util.List;
import java.util.Locale;
import java.util.Map;

import org.apache.commons.lang.StringUtils;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.support.ReloadableResourceBundleMessageSource;
import org.springframework.stereotype.Service;

import com.ejie.aa79b.common.Constants;
import com.ejie.aa79b.dao.AyudaAplicacionDao;
import com.ejie.aa79b.dao.GenericoDao;
import com.ejie.aa79b.dao.RegistroAccionesDao;
import com.ejie.aa79b.model.AyudaAplicacion;
import com.ejie.aa79b.model.RegistroAcciones;
import com.ejie.aa79b.utils.Utils;

/**
 * AyudaAplicacionServiceImpl generated by UDA, 16-nov-2017 14:42:25.
 * 
 * @author UDA
 */

@Service(value = "ayudaAplicacionService")
public class AyudaAplicacionServiceImpl extends GenericoServiceImpl<AyudaAplicacion> implements AyudaAplicacionService {

	@Autowired
	private AyudaAplicacionDao ayudaAplicacionDao;
	@Autowired()
    private RegistroAccionesDao registroAccionesDao;
    @Autowired()
    private ReloadableResourceBundleMessageSource msg;
    
    private static final String ID = "id";
    private static final String TITULO = "titulo";
    private static final String ORDEN = "orden";
    private static final String ID_AYUDA_PADRE = "idAyudaPadre";
    private static final String LABEL_TITULO = "label.titulo";
    private static final String LABEL_ID_AYUDA_PADRE = "label.idAyudaPadre";
    private static final String LABEL_ORDEN = "label.orden";
	
	@Override
	protected GenericoDao<AyudaAplicacion> getDao() {
		return this.ayudaAplicacionDao;
	}

	/**
	 * Finds a list of rows in the AyudaAplicacion table.
	 * 
	 *  @param bean
	 *            AyudaAplicacion
	 *
	 * @return List<AyudaAplicacion>
	 */
	@Override()
	public List<AyudaAplicacion> findAll(AyudaAplicacion bean) {
		return this.ayudaAplicacionDao.findAll(bean);
	}
	
	/**
	 * Inserts a single row in the AyudaAplicacion table.
	 *
	 * @param bean
	 *            AyudaAplicacion
	 * @return AyudaAplicacion
	 */
	@Override
	public AyudaAplicacion add(AyudaAplicacion bean) {
		AyudaAplicacion ayudaAplicacion = this.ayudaAplicacionDao.add(bean);
		
		RegistroAcciones reg = new RegistroAcciones();
		reg.setIdPuntoMenu(Constants.PUNTO_MENU_AYUDA);
		reg.setIdAccion(Constants.ACCION_ALTA);
				
		Map<String, String> parametros = new LinkedHashMap<String, String>();
		parametros.put("idAyuda", "label.id");
		parametros.put(TITULO, LABEL_TITULO);
		parametros.put(ID_AYUDA_PADRE, LABEL_ID_AYUDA_PADRE);
		parametros.put(ORDEN, LABEL_ORDEN);
		
		Locale locale = new Locale(Constants.LANG_EUSKERA);
        String aux = Utils.observacionesRegistro(bean, null, parametros, this.msg, locale);
		if (StringUtils.isNotBlank(aux)) {
			StringBuilder observ = new StringBuilder();
			observ.append(this.msg.getMessage("mensaje.nodoArbol.creado", null, locale)).append(" \n");
			observ.append(aux);
			reg.setObserv(observ.toString());
			this.registroAccionesDao.add(reg);
		}
		
		return ayudaAplicacion;
	}
	
	/**
	 * Updates a single row in the AyudaAplicacion table.
	 *
	 * @param bean
	 *            AyudaAplicacion
	 * @return AyudaAplicacion
	 */
	@Override()
	public AyudaAplicacion update(AyudaAplicacion bean) {
		AyudaAplicacion original = this.ayudaAplicacionDao.find(bean);
		AyudaAplicacion ayudaAplicacion = this.ayudaAplicacionDao.update(bean);
		
		this.registrarAccion(bean, original, "mensaje.contenido.modificado");
		
		return ayudaAplicacion;
	}
	
	/**
	 * Updates a single row in the AyudaAplicacion table.
	 *
	 * @param bean
	 *            AyudaAplicacion
	 * @return AyudaAplicacion
	 */
	@Override()
	public AyudaAplicacion rename(AyudaAplicacion bean) {
		
		AyudaAplicacion original = this.ayudaAplicacionDao.find(bean);
		AyudaAplicacion ayudaAplicacion = this.ayudaAplicacionDao.rename(bean);
		
		RegistroAcciones reg = new RegistroAcciones();
		reg.setIdPuntoMenu(Constants.PUNTO_MENU_AYUDA);
		reg.setIdAccion(Constants.ACCION_MODIFICACION);
				
		Map<String, String> parametros = new LinkedHashMap<String, String>();
		parametros.put(TITULO, LABEL_TITULO);
		
		Locale locale = new Locale(Constants.LANG_EUSKERA);
        String aux = Utils.observacionesRegistro(bean, original, parametros, this.msg, locale);
		if (StringUtils.isNotBlank(aux)) {
			StringBuilder observ = new StringBuilder();
			observ.append(ID).append("=").append(bean.getIdAyuda()).append(" \n");
			observ.append(aux);
			reg.setObserv(observ.toString());
			this.registroAccionesDao.add(reg);
		}
		
		return ayudaAplicacion;
	}
	
	/**
	 * Deletes a single row in the AyudaAplicacion table.
	 *
	 * @param bean
	 *            AyudaAplicacion
	 */
	@Override
	public void remove(AyudaAplicacion bean) {
		AyudaAplicacion original = this.ayudaAplicacionDao.find(bean);
		this.ayudaAplicacionDao.remove(bean);
		
		this.registrarAccion(bean, original, "mensaje.nodoArbol.eliminado");
	}
	
	/**
	 * Updates a single row in the AyudaAplicacion table.
	 *
	 * @param bean
	 *            AyudaAplicacion
	 * @return AyudaAplicacion
	 */
	@Override()
	public AyudaAplicacion move(AyudaAplicacion bean) {
		
		AyudaAplicacion original = this.ayudaAplicacionDao.find(bean);
		AyudaAplicacion ayudaAplicacion = this.ayudaAplicacionDao.move(bean);
		
		RegistroAcciones reg = new RegistroAcciones();
		reg.setIdPuntoMenu(Constants.PUNTO_MENU_AYUDA);
		reg.setIdAccion(Constants.ACCION_MODIFICACION);
				
		Map<String, String> parametros = new LinkedHashMap<String, String>();
		parametros.put(ID_AYUDA_PADRE, LABEL_ID_AYUDA_PADRE);
		parametros.put(ORDEN, LABEL_ORDEN);
		
		Locale locale = new Locale(Constants.LANG_EUSKERA);
        String aux = Utils.observacionesRegistro(bean, original, parametros, this.msg, locale);
		if (StringUtils.isNotBlank(aux)) {
			StringBuilder observ = new StringBuilder();
			observ.append(ID).append("=").append(bean.getIdAyuda()).append(" \n");
			observ.append(TITULO).append("=").append(original.getTitulo()).append(" \n");
			observ.append(aux);
			reg.setObserv(observ.toString());
			this.registroAccionesDao.add(reg);
		}
		
		return ayudaAplicacion;
	}
	
	private void registrarAccion(AyudaAplicacion bean, AyudaAplicacion original, String mensaje){
		RegistroAcciones reg = new RegistroAcciones();
		reg.setIdPuntoMenu(Constants.PUNTO_MENU_AYUDA);
		reg.setIdAccion(Constants.ACCION_MODIFICACION);
		
		Locale locale = new Locale(Constants.LANG_EUSKERA);
		StringBuilder observ = new StringBuilder();
		observ.append(this.msg.getMessage(mensaje, null, locale)).append(" \n");
		observ.append(ID).append("=").append(bean.getIdAyuda()).append(" \n");
		observ.append(TITULO).append("=").append(original.getTitulo()).append(" \n");
		reg.setObserv(observ.toString());
		this.registroAccionesDao.add(reg);
	}	

}
