package com.ejie.aa79b.service;

import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.ejie.aa79b.dao.DatosPersonaDao;
import com.ejie.aa79b.dao.GenericoDao;
import com.ejie.aa79b.model.DatosPersona;
import com.ejie.aa79b.model.ListaDatosPersona;
import com.ejie.aa79b.model.webservices.Aa79bPersona;
import com.ejie.x38.dto.JQGridRequestDto;
import com.ejie.x38.dto.JQGridResponseDto;
import com.ejie.x38.dto.TableRowDto;

/**
 * DatosPersonaServiceImpl generated by UDA, 22-feb-2018 14:12:09.
 * 
 * @author UDA
 */

@Service(value = "datosPersonaService")
public class DatosPersonaServiceImpl extends GenericoServiceImpl<DatosPersona> implements DatosPersonaService {

	@Autowired
	private DatosPersonaDao datosPersonaDao;

	@Override
	protected GenericoDao<DatosPersona> getDao() {
		return this.datosPersonaDao;
	}

	@Override
	public JQGridResponseDto<DatosPersona> filterByRol(DatosPersona datosPersona, JQGridRequestDto jqGridRequestDto,
			boolean startsWith) {
		List<DatosPersona> listaDatosPersona = this.datosPersonaDao.filterByRol(datosPersona, jqGridRequestDto);
		Long recordNum = this.datosPersonaDao.filterByRolCount(datosPersona, false);
		if (jqGridRequestDto.getMultiselection().getSelectedIds() != null) {
			List<TableRowDto<DatosPersona>> reorderSelection = this.datosPersonaDao.reorderSelection(datosPersona,
					jqGridRequestDto, startsWith);
			return new JQGridResponseDto<DatosPersona>(jqGridRequestDto, recordNum, listaDatosPersona,
					reorderSelection);
		}
		return new JQGridResponseDto<DatosPersona>(jqGridRequestDto, recordNum, listaDatosPersona);

	}

	@Override
	public ListaDatosPersona getDatosPersona(ListaDatosPersona listaDatosPersona) {
		return this.datosPersonaDao.getDatosPersona(listaDatosPersona);
	}

	@Override
	public ListaDatosPersona comprobarYGuardar(ListaDatosPersona listaDatosPersona) {
		ListaDatosPersona listaDatosPersonaAux = this.datosPersonaDao.getDatosPersona(listaDatosPersona);
		int esta = 0;
		if (listaDatosPersonaAux != null && listaDatosPersonaAux.getListaDatosPersona() != null
				&& !listaDatosPersonaAux.getListaDatosPersona().isEmpty()) {
			for (DatosPersona datosPersona : listaDatosPersonaAux.getListaDatosPersona()) {
				esta = this.datosPersonaDao.comprobarSiExistePersona(datosPersona);
				if (esta == 0) {
					this.datosPersonaDao.add(datosPersona);
				}
			}
		}

		return listaDatosPersonaAux;
	}

	@SuppressWarnings("unchecked")
	@Override
	public JQGridResponseDto<Aa79bPersona> findPersonasGIP(String dni, Aa79bPersona bean,
			JQGridRequestDto jqGridRequestDto, boolean startsWith) {

		List<Aa79bPersona> listaPersonas = (List<Aa79bPersona>) this.datosPersonaDao.findPersonasGIP(dni, bean,
				jqGridRequestDto, false, false);

		Long recordNum = 0L;

		if (listaPersonas != null && !listaPersonas.isEmpty()) {
			recordNum = (Long) this.datosPersonaDao.findPersonasGIP(dni, bean, jqGridRequestDto, false, true);
		}

		if (jqGridRequestDto != null) {
			return new JQGridResponseDto<Aa79bPersona>(jqGridRequestDto, recordNum, listaPersonas);
		} else {
			return new JQGridResponseDto<Aa79bPersona>(new JQGridRequestDto(), recordNum, listaPersonas);
		}

	}

	@Override
	public boolean comprobarPersona(String dni) {
		return this.datosPersonaDao.comprobarPersona(dni);
	}

}
