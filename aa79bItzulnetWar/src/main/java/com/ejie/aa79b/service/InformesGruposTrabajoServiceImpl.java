package com.ejie.aa79b.service;
import java.util.ArrayList;
import java.util.List;
import java.util.Locale;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.support.ReloadableResourceBundleMessageSource;
import org.springframework.stereotype.Service;

import com.ejie.aa79b.common.Constants;
import com.ejie.aa79b.common.Reports;
import com.ejie.aa79b.dao.EntidadesGruposTrabajoDao;
import com.ejie.aa79b.dao.GruposTrabajoDao;
import com.ejie.aa79b.dao.PersonalIZODao;
import com.ejie.aa79b.dao.TrabajadoresGruposTrabajoDao;
import com.ejie.aa79b.model.EntidadesGruposTrabajo;
import com.ejie.aa79b.model.GruposTrabajo;
import com.ejie.aa79b.model.PersonalIZO;
import com.ejie.aa79b.model.TrabajadoresGruposTrabajo;
import com.ejie.aa79b.model.excel.ExcelCelda;
import com.ejie.aa79b.model.excel.ExcelEstilo;
import com.ejie.aa79b.model.excel.ExcelHoja;
import com.ejie.aa79b.model.excel.ExcelModel;
import com.ejie.aa79b.model.excel.content.ExcelInforme;
import com.ejie.aa79b.utils.Utils;

/**
 * GruposTrabajoServiceImpl generated by UDA, 24-nov-2017 10:10:29.
 * @author UDA
 */

@Service(value = "informesGruposTrabajoService")
public class InformesGruposTrabajoServiceImpl implements InformesGruposTrabajoService {

	@Autowired()
	private GruposTrabajoDao gruposTrabajoDao;
	@Autowired()
	private ReloadableResourceBundleMessageSource msg;
	@Autowired()
	private TrabajadoresGruposTrabajoDao trabajadoresGruposTrabajoDao;
	@Autowired()
	private EntidadesGruposTrabajoDao entidadesGruposTrabajoDao;
	@Autowired()
	private PersonalIZODao personalIZODao;
	
	@Override()
	public ExcelModel getInformeResponsable() {
		
		Locale locale = new Locale(Constants.LANG_EUSKERA);
		final String titulo = this.msg.getMessage("gruposTrabajo.informe.porResponsable", null, locale);
		final ExcelModel excelModel = new ExcelModel();
		excelModel.setNombre(titulo);
		final ExcelHoja excelHoja= new ExcelHoja(titulo, 0);
		
		this.crearCabecera(titulo, locale, excelHoja);
		
		GruposTrabajo filter = new GruposTrabajo();
		EntidadesGruposTrabajo filterEntidades = new EntidadesGruposTrabajo();
		TrabajadoresGruposTrabajo filterTrabajadores = new TrabajadoresGruposTrabajo();
		final List<GruposTrabajo> rdo = this.gruposTrabajoDao.findAllLikeResponsable(filter);
		for (GruposTrabajo grupo : rdo) {
			if (grupo.getId() != 0) {
				filterEntidades.setIdGrupo(grupo.getId());
				grupo.setEntidades(this.entidadesGruposTrabajoDao.findAll(filterEntidades, null));
				filterTrabajadores.setIdGrupo(grupo.getId());
				grupo.setTrabajadores(this.trabajadoresGruposTrabajoDao.findAll(filterTrabajadores, null));
			}
		}

		List<List<GruposTrabajo>> responsables = Utils.separarLista(rdo, "responsable.dni");
		for (List<GruposTrabajo> responsable : responsables) {
			ExcelInforme tabla = new ExcelInforme();
			tabla.setCriterio(responsable.get(0));
			tabla.addCriterio("label.responsable", "responsable.nombreCompleto", 2, 5);
			tabla.setMsg(this.msg);
			tabla.setLocale(locale);
			tabla.setPosicionX(1);
			excelHoja.addContenido(tabla);
			
			for (GruposTrabajo grupo : responsable) {
				ExcelInforme subTabla = new ExcelInforme();
				subTabla.setCriterio(grupo);
				subTabla.addCriterio("label.grupoTrabajo", "descEu", 2, 5);
				subTabla.addCriterio("label.tipoExpediente", "tipoExpedienteDesc", 2, 1);
				subTabla.addCriterio("label.estado", "estadoDesc", 1, 1, true);
				subTabla.addCriterio("label.bopv", "bopvDesc", 1, 1);
				subTabla.addCriterio("label.previstoBopv", "previstoBopvDesc", 2, 1);
				subTabla.addCriterio("label.fechaAlta", "fechaAlta", 2, 2);
				subTabla.addCriterio("label.fechaBaja", "fechaBaja", 2, 2, true);
				subTabla.addColumna("label.entidadesSolicitantes", "entidades", "descEu", 5, true);
				subTabla.addColumna("label.traductoresInterpretes", "trabajadores","nombreCompleto",  5, true);
				List<GruposTrabajo> aux = new ArrayList<GruposTrabajo>();
				aux.add(grupo);
				subTabla.setDatos(aux);
				subTabla.setMsg(this.msg);
				subTabla.setLocale(locale);
				subTabla.setPosicionX(2);
				excelHoja.addContenido(subTabla);
				
			}
		}
		
		excelModel.getListaHojas().add(excelHoja);
		return excelModel;
	}

	@Override()
	public ExcelModel getInformeTradInterp() {
		Locale locale = new Locale(Constants.LANG_EUSKERA);
		final String titulo = this.msg.getMessage("gruposTrabajo.informe.porTradInterp", null, locale);
		final ExcelModel excelModel = new ExcelModel();
		excelModel.setNombre(titulo);
		final ExcelHoja excelHoja= new ExcelHoja(titulo, 0);
		
		this.crearCabecera(titulo, locale, excelHoja);
		
		GruposTrabajo filter = new GruposTrabajo();
		final List<GruposTrabajo> rdo = this.gruposTrabajoDao.findAllLikeTradInterp(filter);
		final List<List<GruposTrabajo>> datos = Utils.separarLista(rdo, "traductor.dni");
		for (List<GruposTrabajo> traductor : datos) {
			ExcelInforme tablas = new ExcelInforme();
			tablas.setCriterio(traductor.get(0));
			tablas.addCriterio("label.traductorInterprete", "traductor.nombreCompleto", 3, 6);
			tablas.addColumna("label.grupoTrabajo", "descEu", 6);
			tablas.addColumna("label.responsable", "responsable.nombreCompleto", 6);
			tablas.setDatos(traductor);
			tablas.setMsg(this.msg);
			tablas.setLocale(locale);
			tablas.setPosicionX(1);
			excelHoja.addContenido(tablas);
		}
		
		excelModel.getListaHojas().add(excelHoja);
		return excelModel;
	}

	@Override()
	public ExcelModel getInformeEntidad() {
		Locale locale = new Locale(Constants.LANG_EUSKERA);
		final String titulo = this.msg.getMessage("gruposTrabajo.informe.porEntidad", null, locale);
		final ExcelModel excelModel = new ExcelModel();
		excelModel.setNombre(titulo);
		final ExcelHoja excelHoja= new ExcelHoja(titulo, 0);
		
		this.crearCabecera(titulo, locale, excelHoja);
		
		GruposTrabajo filter = new GruposTrabajo();
		final List<GruposTrabajo> rdo = this.gruposTrabajoDao.findAllLikeEntidades(filter);
		final List<List<GruposTrabajo>> datos = Utils.separarLista(rdo, "entidadSolicitante.codigoCompleto");
		for (List<GruposTrabajo> traductor : datos) {
			ExcelInforme tablas = new ExcelInforme();
			tablas.setCriterio(traductor.get(0));
			tablas.addCriterio("label.entidad", "entidadSolicitante.descEu", 3, 6);
			tablas.setDatos(traductor);
			tablas.addColumna("label.grupoTrabajo", "descEu", 6);
			tablas.addColumna("label.responsable", "responsable.nombreCompleto", 6);
			tablas.setMsg(this.msg);
			tablas.setLocale(locale);
			tablas.setPosicionX(1);
			excelHoja.addContenido(tablas);
		}
		
		excelModel.getListaHojas().add(excelHoja);
		return excelModel;
	}

	@Override()
	public ExcelModel getInformeSituacionActual() {
		Locale locale = new Locale(Constants.LANG_EUSKERA);
		String titulo = this.msg.getMessage("gruposTrabajo.informe.situacionActual", null, locale);
		final ExcelModel excelModel = new ExcelModel();
		excelModel.setNombre(titulo);
		
		Integer numHoja = 0;
		
		titulo = this.msg.getMessage("gruposTrabajo.informe.entidadesBajaAsociadas", null, locale);
		ExcelHoja excelHoja= new ExcelHoja(titulo, numHoja++);
		this.crearCabecera(titulo, locale, excelHoja);
		GruposTrabajo filter = new GruposTrabajo();
		filter.getEntidadSolicitante().setEstado(Constants.BAJA);
		final List<GruposTrabajo> rdoEntidades = this.gruposTrabajoDao.findAllLikeEntidades(filter);
		ExcelInforme tabla = new ExcelInforme();
		tabla.setMsg(this.msg);
		tabla.setLocale(locale);
		tabla.setPosicionX(1);
		tabla.addColumna("label.entidad","entidadSolicitante.descEu",  6);
		tabla.addColumna("label.grupoTrabajo", "descEu", 6);
		tabla.setDatos(rdoEntidades);
		excelHoja.addContenido(tabla);
		excelModel.getListaHojas().add(excelHoja);
		
		titulo = this.msg.getMessage("gruposTrabajo.informe.responsablesSinPermisosAsociados", null, locale);
		excelHoja= new ExcelHoja(titulo, numHoja++);
		this.crearCabecera(titulo, locale, excelHoja);
		filter = new GruposTrabajo();
		filter.getResponsable().setEstado(Constants.BAJA);
		final List<GruposTrabajo> rdoResponsable = this.gruposTrabajoDao.findAllLikeResponsable(filter);
		tabla = new ExcelInforme();
		tabla.setMsg(this.msg);
		tabla.setLocale(locale);
		tabla.setPosicionX(1);
		tabla.addColumna("label.responsable", "responsable.nombreCompleto", 6);
		tabla.addColumna("label.grupoTrabajo", "descEu", 6);
		tabla.setDatos(rdoResponsable);
		excelHoja.addContenido(tabla);
		excelModel.getListaHojas().add(excelHoja);
		
		titulo = this.msg.getMessage("gruposTrabajo.informe.tradInterpSinPermisosAsociados", null, locale);
		excelHoja= new ExcelHoja(titulo, numHoja++);
		this.crearCabecera(titulo, locale, excelHoja);
		filter = new GruposTrabajo();
		filter.getTraductor().setEstado(Constants.BAJA);
		final List<GruposTrabajo> rdoTraductores = this.gruposTrabajoDao.findAllLikeTradInterp(filter);
		tabla = new ExcelInforme();
		tabla.setMsg(this.msg);
		tabla.setLocale(locale);
		tabla.setPosicionX(1);
		tabla.addColumna("label.traductorInterprete", "traductor.nombreCompleto", 6);
		tabla.addColumna("label.grupoTrabajo", "descEu", 6);
		tabla.setDatos(rdoTraductores);
		excelHoja.addContenido(tabla);
		excelModel.getListaHojas().add(excelHoja);
		
		titulo = this.msg.getMessage("gruposTrabajo.informe.asignadoresSinGrupo", null, locale);
		excelHoja= new ExcelHoja(titulo, numHoja++);
		this.crearCabecera(titulo, locale, excelHoja);
		final List<PersonalIZO> asignadores = this.personalIZODao.findAsignadoresSinGrupo(new PersonalIZO());
		tabla = new ExcelInforme();
		tabla.setMsg(this.msg);
		tabla.setLocale(locale);
		tabla.setPosicionX(1);
		tabla.addColumna("label.responsable", "nombreCompleto", 6);
		tabla.setDatos(asignadores);
		excelHoja.addContenido(tabla);
		excelModel.getListaHojas().add(excelHoja);
		
		titulo = this.msg.getMessage("gruposTrabajo.informe.tradInterpSinGrupo", null, locale);
		excelHoja= new ExcelHoja(titulo, numHoja++);
		this.crearCabecera(titulo, locale, excelHoja);
		final List<PersonalIZO> tradInterp = this.personalIZODao.findTraductoresSinGrupo(new PersonalIZO());
		tabla = new ExcelInforme();
		tabla.setMsg(this.msg);
		tabla.setLocale(locale);
		tabla.setPosicionX(1);
		tabla.addColumna("label.traductorInterprete", "nombreCompleto", 6);
		tabla.setDatos(tradInterp);
		excelHoja.addContenido(tabla);
		excelModel.getListaHojas().add(excelHoja);
		
		return excelModel;
	}
	
	
	private void crearCabecera(String titulo, Locale locale, ExcelHoja excelHoja) {
		// Parametros
		ExcelCelda imagenCelda = new ExcelCelda();
		imagenCelda.setTipoCelda(Reports.TIPO_CELDA_IMAGEN);
		imagenCelda.setRutaImagen(Reports.RUTA_IMAGEN);
		imagenCelda.setPosicionX(0);
		imagenCelda.setPosicionX(0);
		excelHoja.addParametro("imagen", imagenCelda);
		ExcelCelda tituloCelda = new ExcelCelda(titulo, Constants.TRES, Constants.DOS, ExcelEstilo.TITLE);
		excelHoja.addParametro("titulo", tituloCelda);
	}
	
	@Override()
	public List<EntidadesGruposTrabajo> getEntidadesGruposTrabajo(EntidadesGruposTrabajo filterEntidades) {
		return this.entidadesGruposTrabajoDao.findAll(filterEntidades, null);
		
	}
	
	@Override()
	public List<TrabajadoresGruposTrabajo> getTrabajadoresGruposTrabajo(TrabajadoresGruposTrabajo filterTrabajadores) {
		return this.trabajadoresGruposTrabajoDao.findAll(filterTrabajadores, null);
	}
}

