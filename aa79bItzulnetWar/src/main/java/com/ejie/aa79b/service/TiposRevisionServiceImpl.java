package com.ejie.aa79b.service;

import java.util.LinkedHashMap;
import java.util.Locale;
import java.util.Map;

import org.apache.commons.lang.StringUtils;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.support.ReloadableResourceBundleMessageSource;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import com.ejie.aa79b.common.Constants;
import com.ejie.aa79b.dao.GenericoDao;
import com.ejie.aa79b.dao.RegistroAccionesDao;
import com.ejie.aa79b.dao.TiposRevisionDao;
import com.ejie.aa79b.model.RegistroAcciones;
import com.ejie.aa79b.model.TiposRevision;
import com.ejie.aa79b.utils.Utils;

/**
 * TiposRevisionServiceImpl generated by UDA, 28-nov-2017 15:23:30.
 * 
 * @author UDA
 */

@Service(value = "tiposRevisionService")
public class TiposRevisionServiceImpl extends GenericoServiceImpl<TiposRevision> implements TiposRevisionService {

    @Autowired
    private TiposRevisionDao tiposRevisionDao;
    @Autowired()
    private RegistroAccionesDao registroAccionesDao;
    @Autowired()
    private ReloadableResourceBundleMessageSource msg;
    
    @Override
    protected GenericoDao<TiposRevision> getDao() {
        return this.tiposRevisionDao;
    }
    
    @Override()
    @Transactional(rollbackFor = Throwable.class)
    public TiposRevision update(TiposRevision bean) {
        TiposRevision original = this.tiposRevisionDao.find(bean);
        this.tiposRevisionDao.update(bean);
        
        RegistroAcciones regTiposrevision = new RegistroAcciones();
        regTiposrevision.setIdPuntoMenu(Constants.PUNTO_MENU_TIPOS_REVISION);
        regTiposrevision.setIdAccion(Constants.ACCION_MODIFICACION);
        
        Map<String, String> paramTiposRevision = new LinkedHashMap<String, String>();
        paramTiposRevision.put("estado018", "label.estado");
        paramTiposRevision.put("porPalabrasRev018", "label.xPalabras");
                
        Locale locale = new Locale(Constants.LANG_EUSKERA);
        String aux = Utils.observacionesRegistro(bean, original, paramTiposRevision, this.msg, locale);
        if (StringUtils.isNotBlank(aux)) {
            StringBuilder observ = new StringBuilder();
            observ.append(original.getDescEu018()).append(" (id=").append(original.getId018()).append("): \n");
            observ.append(aux);
            regTiposrevision.setObserv(observ.toString());
            this.registroAccionesDao.add(regTiposrevision);
        }
        return bean;
    }
    
}