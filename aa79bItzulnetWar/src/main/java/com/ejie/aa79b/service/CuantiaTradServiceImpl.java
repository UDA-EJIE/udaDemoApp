package com.ejie.aa79b.service;

import java.util.LinkedHashMap;
import java.util.Locale;
import java.util.Map;

import org.apache.commons.lang.StringUtils;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.support.ReloadableResourceBundleMessageSource;
import org.springframework.stereotype.Service;

import com.ejie.aa79b.common.Constants;
import com.ejie.aa79b.dao.CuantiaTradDao;
import com.ejie.aa79b.dao.GenericoDao;
import com.ejie.aa79b.dao.RegistroAccionesDao;
import com.ejie.aa79b.model.CuantiaTrad;
import com.ejie.aa79b.model.RegistroAcciones;
import com.ejie.aa79b.utils.Utils;

/**
 * CuantiaTradServiceImpl generated by UDA, 15-dic-2017 14:11:45.
 * 
 * @author UDA
 */

@Service(value = "cuantiaTradService")
public class CuantiaTradServiceImpl extends GenericoServiceImpl<CuantiaTrad> implements CuantiaTradService {

    @Autowired
    private CuantiaTradDao cuantiaTradDao;
    @Autowired()
    private RegistroAccionesDao registroAccionesDao;
    @Autowired()
    private ReloadableResourceBundleMessageSource msg;
    
    @Override
    protected GenericoDao<CuantiaTrad> getDao() {
        return this.cuantiaTradDao;
    }
    
    @Override()
    public CuantiaTrad add(CuantiaTrad bean) {
             
        CuantiaTrad cuantiaTradAux = this.cuantiaTradDao.add(bean);
        
        RegistroAcciones regAcciones = new RegistroAcciones();
        regAcciones.setIdPuntoMenu(Constants.PUNTO_MENU_ORDEN_PRECIOS);
        regAcciones.setIdAccion(Constants.ACCION_ALTA);
        Locale locale = new Locale(Constants.LANG_EUSKERA);
        
        StringBuilder observ = new StringBuilder();
        
        observ.append(this.msg.getMessage("menu.ordenPreciosPublicos", null, locale)).append(" id: ").append(cuantiaTradAux.getIdOrden()).append(" \n");
        observ.append(this.msg.getMessage("label.cuantias.serviciosTraduccion", null, locale)).append("- id ").append(this.msg.getMessage("label.tipoRelevancia", null, locale)).append(": ").append(cuantiaTradAux.getIdTipoRelevancia()).append(" \n");
        
        observ.append(this.msg.getMessage("label.tarifaEsEu", null, locale)).append(": ").append(cuantiaTradAux.getTarifaEsEu()).append(" - ");
        observ.append(this.msg.getMessage("label.tarifaEuEs", null, locale)).append(": ").append(cuantiaTradAux.getTarifaEuEs()).append(" \n");
                      
        regAcciones.setObserv(observ.toString());
        this.registroAccionesDao.add(regAcciones);        
        
        return cuantiaTradAux;
    }

    @Override()
    public CuantiaTrad update(CuantiaTrad bean) {
        CuantiaTrad original = this.cuantiaTradDao.find(bean);
        
        CuantiaTrad cuantiaTradAux =  this.cuantiaTradDao.update(bean);
        
        RegistroAcciones regAcciones = new RegistroAcciones();
        regAcciones.setIdPuntoMenu(Constants.PUNTO_MENU_ORDEN_PRECIOS);
        regAcciones.setIdAccion(Constants.ACCION_MODIFICACION);
        
        Map<String, String> paramAcciones = new LinkedHashMap<String, String>();
        paramAcciones.put("idOrden", "menu.ordenPreciosPublicos");
        paramAcciones.put("tarifaEsEu", "label.tarifaEsEu");
        paramAcciones.put("tarifaEuEs", "label.tarifaEuEs");        
        
        Locale locale = new Locale(Constants.LANG_EUSKERA);
        String aux = Utils.observacionesRegistro(bean, original, paramAcciones, this.msg, locale);
        if (StringUtils.isNotBlank(aux)) {
            StringBuilder observ = new StringBuilder();
            observ.append(this.msg.getMessage("menu.ordenPreciosPublicos", null, locale)).append(" id: ").append(original.getIdOrden()).append(" \n");
            observ.append(this.msg.getMessage("label.cuantias.serviciosTraduccion", null, locale)).append("- id ").append(this.msg.getMessage("label.tipoRelevancia", null, locale)).append(": ").append(original.getIdTipoRelevancia()).append(" \n");
            observ.append(aux);
            regAcciones.setObserv(observ.toString());
            this.registroAccionesDao.add(regAcciones);
        }
        
        return cuantiaTradAux;
    }

}