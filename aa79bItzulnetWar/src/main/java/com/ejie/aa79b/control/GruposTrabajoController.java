package com.ejie.aa79b.control;

import java.util.ArrayList;
import java.util.Date;
import java.util.List;
import java.util.Locale;
import java.util.Properties;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import org.apache.commons.lang.StringUtils;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.propertyeditors.CustomDateEditor;
import org.springframework.context.i18n.LocaleContextHolder;
import org.springframework.context.support.ReloadableResourceBundleMessageSource;
import org.springframework.http.HttpStatus;
import org.springframework.security.core.context.SecurityContextHolder;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.ui.ModelMap;
import org.springframework.web.bind.WebDataBinder;
import org.springframework.web.bind.annotation.InitBinder;
import org.springframework.web.bind.annotation.ModelAttribute;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.ResponseBody;
import org.springframework.web.bind.annotation.ResponseStatus;
import org.springframework.web.servlet.ModelAndView;

import com.ejie.aa79b.common.Constants;
import com.ejie.aa79b.model.Entidad;
import com.ejie.aa79b.model.EntidadesGruposTrabajo;
import com.ejie.aa79b.model.GruposTrabajo;
import com.ejie.aa79b.model.PersonalIZO;
import com.ejie.aa79b.model.TrabajadoresGruposTrabajo;
import com.ejie.aa79b.model.enums.TipoExpedienteGrupoEnum;
import com.ejie.aa79b.model.excel.ExcelModel;
import com.ejie.aa79b.security.Usuario;
import com.ejie.aa79b.service.ExcelReportService;
import com.ejie.aa79b.service.GruposTrabajoService;
import com.ejie.aa79b.service.InformesGruposTrabajoService;
import com.ejie.aa79b.service.PdfReportService;
import com.ejie.aa79b.service.PersonalIZOService;
import com.ejie.aa79b.utils.Utils;
import com.ejie.x38.control.bind.annotation.RequestJsonBody;
import com.ejie.x38.dto.JQGridRequestDto;
import com.ejie.x38.dto.JQGridResponseDto;
import com.ejie.x38.dto.TableRowDto;
import com.ejie.x38.util.DateTimeManager;

/**
 * GruposTrabajoController generated by UDA, 24-nov-2017 10:10:29.
 * 
 * @author UDA
 */

@Controller()
@RequestMapping(value = "/administracion/grupostrabajo")
public class GruposTrabajoController {

	private static final Logger LOGGER = LoggerFactory.getLogger(GruposTrabajoController.class);

	@Autowired()
	private Properties appConfiguration;
	@Autowired()
	private ReloadableResourceBundleMessageSource appMessageSource;
	@Autowired()
	private GruposTrabajoService gruposTrabajoService;
	@Autowired()
	private ExcelReportService excelReportService;
	@Autowired()
	private PdfReportService pdfReportService;
	@Autowired()
	private ReloadableResourceBundleMessageSource messageSource;
	@Autowired()
	private PersonalIZOService personalIZOService;
	@Autowired()
	private InformesGruposTrabajoService informesGruposTrabajoService;

	@InitBinder("grupoTrabajo")
	void initBinder(WebDataBinder binder, Locale locale) {
		binder.registerCustomEditor(Date.class,
				new CustomDateEditor(DateTimeManager.getDateTimeFormat(locale), false, 10));
	}

	/**
	 * Metodo de presentacion del RUP_TABLE.
	 * 
	 * @param model
	 *            Model
	 * @return String
	 */
	@RequestMapping(value = "/maint", method = RequestMethod.GET)
	public String getFormEdit(Model model) {
		GruposTrabajoController.LOGGER.info("[GET - View] : grupostrabajo");
		this.cargarAsignadores(model, null, Constants.MAINT);
		return "grupostrabajo";
	}

	private void cargarAsignadores(Model model, PersonalIZO asignador, String alta) {
		PersonalIZO filterPersonalIZO = new PersonalIZO();
		filterPersonalIZO.setAsignador(Constants.SI);
		List<PersonalIZO> asignadores = this.personalIZOService.findAsignadores(filterPersonalIZO, alta);

		if (asignador != null && StringUtils.isNotBlank(asignador.getDni())) {
			Boolean encontrado = false;
			for (PersonalIZO bean : asignadores) {
				if (StringUtils.equals(asignador.getDni(), bean.getDni())) {
					encontrado = true;
				}
			}
			if (!encontrado) {
				asignadores.add(asignador);
			}
		}
		model.addAttribute("asignadores", asignadores);
	}

	/**
	 * Metodo de presentacion del RUP_TABLE.
	 * 
	 * @param model
	 *            Model
	 * @return String
	 */

	@RequestMapping(value = "/detalle", method = RequestMethod.POST)
	public String getDetalle(Model model, @RequestJsonBody() GruposTrabajo gruposTrabajo) {
		GruposTrabajo bean = new GruposTrabajo();
		String alta = Constants.DETALLE;

		if (gruposTrabajo.getId() != null) {
			bean = this.gruposTrabajoService.find(gruposTrabajo);
		} else {
			alta = Constants.ALTA;
			bean.setPalabrasDesde(Constants.RANGO_PALABRAS_DESDE);
			bean.setPalabrasHasta(Constants.RANGO_PALABRAS_HASTA);
			bean.setEstado(Constants.ALTA);
		}
		model.addAttribute("grupoTrabajo", bean);
		this.cargarAsignadores(model, bean.getResponsable(), alta);
		return "grupostrabajo-detalle";
	}

	@RequestMapping(value = "/getAsignadores", method = RequestMethod.GET)
	public @ResponseBody() List<PersonalIZO> getAsignadores() {
		PersonalIZO filterPersonalIZO = new PersonalIZO();
		filterPersonalIZO.setAsignador(Constants.SI);
		return this.personalIZOService.findAsignadores(filterPersonalIZO, Constants.MAINT);
	}

	/**
	 * Metodo de presentacion del RUP_TABLE.
	 * 
	 * @param model
	 *            Model
	 * @return String
	 */
	@RequestMapping(value = "/existeInterpretacion", method = RequestMethod.POST)
	public @ResponseBody Boolean existeInterpretacion(Model model, @RequestJsonBody() GruposTrabajo bean) {
		bean.setIdTipoExpediente(TipoExpedienteGrupoEnum.INTERPRETACION.getValue());
		bean.setEstado(Constants.ALTA);
		return this.gruposTrabajoService.countExiste(bean) > 0;
	}

	@RequestMapping(value = "/existeBOPV", method = RequestMethod.POST)
	public @ResponseBody Boolean existeBOPV(Model model, @RequestJsonBody() GruposTrabajo bean) {
		bean.setIdTipoExpediente(TipoExpedienteGrupoEnum.TRADUCCION_REVISION.getValue());
		bean.setIndBopv(Constants.SI);
		return this.gruposTrabajoService.countExiste(bean) > 0;
	}

	@RequestMapping(value = "/existePrevistoBOPV", method = RequestMethod.POST)
	public @ResponseBody Boolean existePrevistoBOPV(Model model, @RequestJsonBody() GruposTrabajo bean) {
		bean.setIdTipoExpediente(TipoExpedienteGrupoEnum.TRADUCCION_REVISION.getValue());
		bean.setIndPrevistoBopv(Constants.SI);
		return this.gruposTrabajoService.countExiste(bean) > 0;
	}

	/*
	 * OPERACIONES CRUD (Create, Read, Update, Delete)
	 * 
	 */

	/**
	 * Operacion CRUD Read. Devuelve el bean correspondiente al identificador
	 * indicado.
	 * 
	 * @param id026
	 *            Long
	 * @return GruposTrabajo Objeto correspondiente al identificador indicado.
	 */
	@RequestMapping(value = "/{id026}", method = RequestMethod.GET)
	public @ResponseBody GruposTrabajo get(@PathVariable Long id026) {
		GruposTrabajo gruposTrabajo = new GruposTrabajo();
		gruposTrabajo.setId(id026);
		gruposTrabajo = this.gruposTrabajoService.find(gruposTrabajo);
		GruposTrabajoController.LOGGER.info("[GET - findBy_PK] : Obtener GruposTrabajo por PK");
		return gruposTrabajo;
	}

	/**
	 * Devuelve una lista de beans correspondientes a los valores de filtrados
	 * indicados en el objeto pasado como parametro.
	 *
	 * @param filterGruposTrabajo
	 *            GruposTrabajo Objeto que contiene los parametros de filtrado
	 *            utilizados en la busqueda.
	 * @return List<GruposTrabajo> Lista de objetos correspondientes a la
	 *         busqueda realizada.
	 */
	@RequestMapping(method = RequestMethod.GET)
	public @ResponseBody List<GruposTrabajo> getAll(@ModelAttribute GruposTrabajo filterGruposTrabajo) {
		GruposTrabajoController.LOGGER.info("[GET - find_ALL] : Obtener GruposTrabajo por filtro");
		return this.gruposTrabajoService.findAll(filterGruposTrabajo, null);
	}

	/**
	 * Operacion CRUD Edit. Modificacion del bean indicado.
	 *
	 * @param gruposTrabajo
	 *            GruposTrabajo Bean que contiene la informacion a modificar.
	 * @return GruposTrabajo Bean resultante de la modificacion.
	 */
	@RequestMapping(method = RequestMethod.PUT)
	public @ResponseBody GruposTrabajo edit(@RequestBody GruposTrabajo gruposTrabajo) {
		GruposTrabajo gruposTrabajoAux;
		if (gruposTrabajo.getId() == null) {
			gruposTrabajoAux = this.gruposTrabajoService.add(gruposTrabajo);
		} else {
			gruposTrabajoAux = this.gruposTrabajoService.update(gruposTrabajo);
		}
		GruposTrabajoController.LOGGER.info("[PUT] : GruposTrabajo actualizado correctamente");
		return gruposTrabajoAux;
	}

	/**
	 * Operacion CRUD Delete. Borrado del registro correspondiente al
	 * identificador especificado.
	 *
	 * @param id026
	 *            Long Identificador del objeto que se desea eliminar.
	 * @return GruposTrabajo Bean eliminado.
	 */
	@RequestMapping(value = "/{id026}", method = RequestMethod.DELETE)
	@ResponseStatus(value = HttpStatus.OK)
	public @ResponseBody GruposTrabajo remove(@PathVariable Long id026) {
		GruposTrabajo gruposTrabajo = new GruposTrabajo();
		gruposTrabajo.setId(id026);
		this.gruposTrabajoService.remove(gruposTrabajo);
		GruposTrabajoController.LOGGER.info("[DELETE] : GruposTrabajo borrado correctamente");
		return gruposTrabajo;
	}

	/*
	 * METODOS COMPONENTE RUP_TABLE
	 * 
	 */

	/**
	 * Operacion de filtrado del componente RUP_TABLE.
	 * 
	 * @param filterGruposTrabajo
	 *            GruposTrabajo Bean que contiene los parametros de filtrado a
	 *            emplear.
	 * @param jqGridRequestDto
	 *            Dto que contiene los parametros de configuracion propios del
	 *            RUP_TABLE a aplicar en el filtrado.
	 * @return JQGridResponseDto<GruposTrabajo> Dto que contiene el resultado
	 *         del filtrado realizado por el componente RUP_TABLE.
	 */
	@RequestMapping(value = "/filter", method = RequestMethod.POST)
	public @ResponseBody JQGridResponseDto<GruposTrabajo> filter(
			@RequestJsonBody(param = "filter") GruposTrabajo filterGruposTrabajo,
			@RequestJsonBody JQGridRequestDto jqGridRequestDto) {
		GruposTrabajoController.LOGGER.info("[POST - filter] : Obtener GruposTrabajos");
		return this.gruposTrabajoService.filter(filterGruposTrabajo, jqGridRequestDto, false);
	}

	/**
	 * Operacion de busqueda del componente RUP_TABLE.
	 * 
	 * @param filterGruposTrabajo
	 *            GruposTrabajo Bean que contiene los parametros de filtrado a
	 *            emplear.
	 * @param searchGruposTrabajo
	 *            GruposTrabajo Bean que contiene los parametros de busqueda a
	 *            emplear.
	 * @param jqGridRequestDto
	 *            Dto que contiene los parametros de configuracion propios del
	 *            RUP_TABLE a aplicar en la búsqueda.
	 * @return TableRowDto<GruposTrabajo> Dto que contiene el resultado de la
	 *         busqueda realizada por el componente RUP_TABLE.
	 */
	@RequestMapping(value = "/search", method = RequestMethod.POST)
	public @ResponseBody List<TableRowDto<GruposTrabajo>> search(
			@RequestJsonBody(param = "filter") GruposTrabajo filterGruposTrabajo,
			@RequestJsonBody(param = "search") GruposTrabajo searchGruposTrabajo,
			@RequestJsonBody JQGridRequestDto jqGridRequestDto) {
		GruposTrabajoController.LOGGER.info("[POST - search] : Buscar GruposTrabajos");
		return this.gruposTrabajoService.search(filterGruposTrabajo, searchGruposTrabajo, jqGridRequestDto, false);
	}

	@RequestMapping(value = "/xlsxReport", method = RequestMethod.POST)
	public void xlsxTabla(@RequestParam(value = "columns", required = false) String columns,
			@RequestParam(value = "criterios", required = false) String criterios,
			@ModelAttribute() JQGridRequestDto jqGridRequestDto, @ModelAttribute() GruposTrabajo filterGruposTrabajo,
			HttpServletResponse response, Locale locale) {
		GruposTrabajoController.LOGGER.info("[POST - subm]: xlsxTabla ========================================");
		JQGridRequestDto jqGridRequestDtoReport = new JQGridRequestDto(null, null, jqGridRequestDto.getSidx(),
				jqGridRequestDto.getSord());
		List<GruposTrabajo> respuesta = this.gruposTrabajoService.findAllLike(filterGruposTrabajo,
				jqGridRequestDtoReport, false);
		this.excelReportService.generarExcel("printExcel", response, criterios, columns, respuesta, locale,
				"menu.gestionGruposTrabajo", this.messageSource.getMessage("menu.gestionGruposTrabajo", null, locale));
	}

	@RequestMapping(value = "/pdfReport", method = RequestMethod.POST)
	public void pdfTabla(@RequestParam(value = "columns", required = false) String columns,
			@RequestParam(value = "criterios", required = false) String criterios, HttpServletResponse response,
			@ModelAttribute() JQGridRequestDto jqGridRequestDto, @ModelAttribute() GruposTrabajo filterGruposTrabajo) {
		GruposTrabajoController.LOGGER.info("[POST - subm]: pdfTabla ========================================");
		Locale locale = LocaleContextHolder.getLocale();
		JQGridRequestDto jqGridRequestDtoReport = new JQGridRequestDto(null, null, jqGridRequestDto.getSidx(),
				jqGridRequestDto.getSord());
		List<GruposTrabajo> respuesta = this.gruposTrabajoService.findAllLike(filterGruposTrabajo,
				jqGridRequestDtoReport, false);
		this.pdfReportService.generarPdf("defaultPDF", response, criterios, columns, respuesta,
				"menu.gestionGruposTrabajo", locale, this.messageSource.getMessage("menu.gestionGruposTrabajo", null, locale));
	}

	@RequestMapping(value = "/informes/responsable", method = RequestMethod.POST)
	public void informeResponsable(HttpServletResponse response, Locale locale) {
		final ExcelModel excelModel = this.informesGruposTrabajoService.getInformeResponsable();
		this.excelReportService.generarExcel("printExcel", excelModel, response);
	}

	@RequestMapping(value = "/informes/responsablePDF")
	public ModelAndView informeResponsablePDF(ModelMap modelMap, Locale locale, HttpServletRequest request) {

		// Nombre fichero
		modelMap.put("fileName",
				this.appMessageSource.getMessage("gruposTrabajo.informe.porResponsable", null, locale));
		// En lÃ­nea (no descarga fichero) ?
		modelMap.put("isInline", false);
		// Cabeceras comunes y locale (parameter)
		modelMap.put("TITULO", this.appMessageSource.getMessage("gruposTrabajo.informe.porResponsable", null, locale));
		modelMap.put("STATICS", this.appConfiguration.getProperty("datos.path"));
		modelMap.put("RESPONSABLE", this.appMessageSource.getMessage("label.responsable", null, locale));
		modelMap.put("GRUPO_TRABAJO", this.appMessageSource.getMessage("label.grupoTrabajo", null, locale));
		modelMap.put("TIP_EXP", this.appMessageSource.getMessage("label.tipoExpediente", null, locale));
		modelMap.put("ESTADO", this.appMessageSource.getMessage("label.estado", null, locale));
		modelMap.put("BOPV", this.appMessageSource.getMessage("label.bopv", null, locale));
		modelMap.put("PREBOPV", this.appMessageSource.getMessage("label.previstoBopv", null, locale));
		modelMap.put("FECH_ALTA", this.appMessageSource.getMessage("label.fechaAlta", null, locale));
		modelMap.put("FECH_BAJA", this.appMessageSource.getMessage("label.fechaBaja", null, locale));
		modelMap.put("E_SOLICITANTES", this.appMessageSource.getMessage("label.entidadesSolicitantes", null, locale));
		modelMap.put("T_INTERPRETE", this.appMessageSource.getMessage("label.traductoresInterpretes", null, locale));
		modelMap.put("PAGINA", this.appMessageSource.getMessage("label.pagina", null, locale));
		modelMap.put("FECHA", this.appMessageSource.getMessage("label.fecha", null, locale));
		modelMap.put("REPORT_LOCALE", locale);

		// Datos (field)
		GruposTrabajo filter = new GruposTrabajo();
		EntidadesGruposTrabajo filterEntidades = new EntidadesGruposTrabajo();
		TrabajadoresGruposTrabajo filterTrabajadores = new TrabajadoresGruposTrabajo();

		List<GruposTrabajo> rdo = this.gruposTrabajoService.findAllLikeResponsable(filter);

		List<List<GruposTrabajo>> datos = Utils.separarLista(rdo, "responsable.dni");
		final List<GruposTrabajo> rdo2 = new ArrayList<GruposTrabajo>();
		for (List<GruposTrabajo> list : datos) {
			for (GruposTrabajo grupoTrabajo : list) {

				if (grupoTrabajo.getId() != 0) {
					filterEntidades.setIdGrupo(grupoTrabajo.getId());
					List<EntidadesGruposTrabajo> listEnti = this.informesGruposTrabajoService
							.getEntidadesGruposTrabajo(filterEntidades);
					grupoTrabajo.setEntidades(listEnti);

					filterTrabajadores.setIdGrupo(grupoTrabajo.getId());
					List<TrabajadoresGruposTrabajo> listTrab = this.informesGruposTrabajoService
							.getTrabajadoresGruposTrabajo(filterTrabajadores);
					grupoTrabajo.setTrabajadores(listTrab);

				}
				rdo2.add(grupoTrabajo);
			}

		}
		modelMap.put("lDatos", rdo2);

		// GeneraciÃ³n del PDF
		return new ModelAndView("pdfResponsable", modelMap);

	}

	@RequestMapping(value = "/informes/entidadesPDF")
	public ModelAndView informeEntidadesPDF(ModelMap modelMap, Locale locale, HttpServletRequest request) {

		// Nombre fichero
		modelMap.put("fileName", this.appMessageSource.getMessage("gruposTrabajo.informe.porEntidad", null, locale));
		// En lÃ­nea (no descarga fichero) ?
		modelMap.put("isInline", false);
		// Cabeceras comunes y locale (parameter)
		modelMap.put("STATICS", this.appConfiguration.getProperty("datos.path"));
		modelMap.put("REPORT_LOCALE", locale);
		modelMap.put("TITULO", this.appMessageSource.getMessage("gruposTrabajo.informe.porEntidad", null, locale));
		modelMap.put("ENTIDAD", this.appMessageSource.getMessage("label.entidad", null, locale));
		modelMap.put("GRUPO_TRABAJO", this.appMessageSource.getMessage("label.grupoTrabajo", null, locale));
		modelMap.put("RESPONSABLE", this.appMessageSource.getMessage("label.responsable", null, locale));
		modelMap.put("PAGINA", this.appMessageSource.getMessage("label.pagina", null, locale));
		modelMap.put("FECHA", this.appMessageSource.getMessage("label.fecha", null, locale));

		// Datos (field)
		GruposTrabajo filter = new GruposTrabajo();
		final List<GruposTrabajo> rdo = this.gruposTrabajoService.findAllLikeEntidad(filter);
		final List<List<GruposTrabajo>> datos = Utils.separarLista(rdo, "entidadSolicitante.codigoCompleto");
		final List<Entidad> rdo2 = new ArrayList<Entidad>();
		for (List<GruposTrabajo> list : datos) {
			Entidad grupoTrabajoReport = list.get(0).getEntidadSolicitante();
			grupoTrabajoReport.setListaEntidades(list);
			rdo2.add(grupoTrabajoReport);
		}
		modelMap.put("lDatos", rdo2);

		// GeneraciÃ³n del PDF
		return new ModelAndView("pdfEntidad", modelMap);
	}

	@RequestMapping(value = "/informes/tradInterp", method = RequestMethod.POST)
	public void informeTradInterp(HttpServletResponse response, Locale locale) {
		final ExcelModel excelModel = this.informesGruposTrabajoService.getInformeTradInterp();
		this.excelReportService.generarExcel("printExcel", excelModel, response);
	}

	@RequestMapping(value = "/informes/entidad", method = RequestMethod.POST)
	public void informeEntidad(HttpServletResponse response, Locale locale) {
		final ExcelModel excelModel = this.informesGruposTrabajoService.getInformeEntidad();
		this.excelReportService.generarExcel("printExcel", excelModel, response);
	}

	@RequestMapping(value = "/informes/situacionActual", method = RequestMethod.POST)
	public void informeSituacionActual(HttpServletResponse response, Locale locale) {
		final ExcelModel excelModel = this.informesGruposTrabajoService.getInformeSituacionActual();
		this.excelReportService.generarExcel("printExcel", excelModel, response);
	}

	@RequestMapping(value = "/listCombo/{estado}", method = RequestMethod.GET)
	public @ResponseBody List<GruposTrabajo> getListCombo(@PathVariable String estado) {
		GruposTrabajo gruposTrabajo = new GruposTrabajo();
		GruposTrabajoController.LOGGER.info("[GET - find_ALL] : Obtener GruposTrabajo por filtro");
		gruposTrabajo.setEstado(estado);
		return this.gruposTrabajoService.findAll(gruposTrabajo, null);
	}
	
	@RequestMapping(value = "/listComboNoBOE/{estado}", method = RequestMethod.GET)
	public @ResponseBody List<GruposTrabajo> getListComboNoBOE(@PathVariable String estado) {
		GruposTrabajo gruposTrabajo = new GruposTrabajo();
		GruposTrabajoController.LOGGER.info("[GET - find_ALL] : Obtener GruposTrabajo por filtro");
		gruposTrabajo.setEstado(estado);
		gruposTrabajo.setExcluirBOE(true);
		return this.gruposTrabajoService.findAll(gruposTrabajo, null);
	}

	@RequestMapping(value = "/listComboCargaTrabajo/{estado}", method = RequestMethod.GET)
	public @ResponseBody List<GruposTrabajo> getListComboCargaTrabajo(@PathVariable String estado) {
		GruposTrabajoController.LOGGER.info("[GET - find_ALL] : Obtener GruposTrabajo por filtro");
		Usuario credentials = (Usuario) SecurityContextHolder.getContext().getAuthentication().getCredentials();
		GruposTrabajo gruposTrabajo = new GruposTrabajo();
		gruposTrabajo.setEstado(estado);
		PersonalIZO responsable = new PersonalIZO();
		responsable.setDni(credentials.getNif());
		gruposTrabajo.setResponsable(responsable);
		return this.gruposTrabajoService.findAll(gruposTrabajo, null);
	}

	@RequestMapping(value = "/informarCamposGrupoTrabajo/{id}", method = RequestMethod.GET)
	public @ResponseBody GruposTrabajo informarCamposGrupoTrabajo(@PathVariable Long id) {
		GruposTrabajo gruposTrabajo = new GruposTrabajo();
		GruposTrabajoController.LOGGER.info("[GET - find_ALL] : Obtener GruposTrabajo por filtro");
		gruposTrabajo.setId(id);
		return this.gruposTrabajoService.informarCamposGrupoTrabajo(gruposTrabajo);
	}

	/**
	 * Devuelve una lista de beans del tipo GruposTrabajo.
	 *
	 * @return List<GruposTrabajo> Lista de objetos.
	 */
	@RequestMapping(value = "/findAllGruposTrabajo", method = RequestMethod.GET)
	public @ResponseBody List<GruposTrabajo> getAllGruposTrabajo() {
		GruposTrabajoController.LOGGER
				.info("[GET - find_ALL] : Obtener GruposTrabajo dados de alta para un responsable");

		GruposTrabajo gruposTrabajo = new GruposTrabajo();
		PersonalIZO responsable = new PersonalIZO();
		Usuario credentials = (Usuario) SecurityContextHolder.getContext().getAuthentication().getCredentials();
		responsable.setDni(credentials.getNif());
		gruposTrabajo.setResponsable(responsable);

		return this.gruposTrabajoService.findAllLikeGruposTrabajo(gruposTrabajo);
	}

	/**
	 * Devuelve una lista de beans del tipo GruposTrabajo.
	 *
	 * @return List<GruposTrabajo> Lista de objetos.
	 */
	@RequestMapping(value = "/findAllGruposTrabajoConIdTipoExp/{iIdTipoExpediente}", method = RequestMethod.GET)
	public @ResponseBody List<GruposTrabajo> getAllGruposTrabajoTipoExp(@PathVariable Integer iIdTipoExpediente) {
		GruposTrabajoController.LOGGER
				.info("[GET - find_ALL] : Obtener GruposTrabajo dados de alta para un responsable");
		GruposTrabajo gruposTrabajo = new GruposTrabajo();
		PersonalIZO responsable = new PersonalIZO();
		Usuario credentials = (Usuario) SecurityContextHolder.getContext().getAuthentication().getCredentials();
		responsable.setDni(credentials.getNif());
		gruposTrabajo.setResponsable(responsable);
		gruposTrabajo.setIdTipoExpediente(iIdTipoExpediente);

		return this.gruposTrabajoService.findAllLikeGruposTrabajo(gruposTrabajo);
	}

}
