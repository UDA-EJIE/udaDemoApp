package com.ejie.aa79b.control;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.ResponseBody;

import com.ejie.aa79b.model.Expediente;
import com.ejie.aa79b.service.BitacoraExpedienteService;
import com.ejie.aa79b.service.ConsultasService;
import com.ejie.aa79b.utils.ConsultaExpedienteUtils;

/**
 * BitacoraExpedienteController generated by UDA, 31-ene-2018 15:08:53.
 *
 * @author UDA
 */

@Controller
@RequestMapping(value = "/tramitacionexpedientes/gestionexpedientes/estudioexpedientes/bitacoraexpediente")

public class BitacoraExpedienteController {

	private static final Logger LOGGER = LoggerFactory.getLogger(BitacoraExpedienteController.class);

	@Autowired
	private BitacoraExpedienteService bitacoraExpedienteService;
	@Autowired()
	private ConsultasService consultasService;

	/**
	 * @param filterBitacoraExpediente
	 *            Expediente
	 * @return Expediente Objeto correspondiente al identificador indicado.
	 */
	@RequestMapping(value = "/getCabeceraBitacora", method = RequestMethod.POST)
	public @ResponseBody Expediente getCabeceraBitacora(@RequestBody Expediente filterBitacoraExpediente) {
		BitacoraExpedienteController.LOGGER
				.info("[POST - getCabeceraBitacora]: Inicio ========================================");

		return this.bitacoraExpedienteService.getCabeceraBitacora(filterBitacoraExpediente);
	}

	/**
	 * @param filterBitacoraExpediente
	 *            Expediente
	 * @return Expediente Objeto correspondiente al identificador indicado.
	 */
	@RequestMapping(value = "/getCabeceraBitacoraConEstadoGestor", method = RequestMethod.POST)
	public @ResponseBody Expediente getCabeceraBitacoraConEstadoGestor(
			@RequestBody Expediente filterBitacoraExpediente) {
		BitacoraExpedienteController.LOGGER
				.info("[POST - getCabeceraBitacoraConEstadoGestor]: Inicio ========================================");
		Expediente expediente = this.bitacoraExpedienteService.getCabeceraBitacora(filterBitacoraExpediente);

		if (ConsultaExpedienteUtils.gestorValido(expediente)) {
			expediente.getGestorExpediente().getSolicitante().setEstado(
					this.consultasService.getEstadoGestor(expediente.getGestorExpediente().getSolicitante().getDni()));
		}
		return expediente;
	}

}
