package com.ejie.aa79b.control;

import java.util.ArrayList;
import java.util.List;

import org.apache.commons.lang.StringUtils;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.security.core.context.SecurityContextHolder;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.ModelAttribute;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.ResponseBody;

import com.ejie.aa79b.common.Constants;
import com.ejie.aa79b.model.Entidad;
import com.ejie.aa79b.model.PersonalIZO;
import com.ejie.aa79b.model.Solicitante;
import com.ejie.aa79b.security.Usuario;
import com.ejie.aa79b.service.PersonalIZOService;

/**
 * PersonalIZOController generated by UDA, 05-dic-2017 15:17:21.
 * 
 * @author UDA
 */

@Controller
@RequestMapping(value = "/personalIZO")

public class PersonalIZOController {

	private static final Logger LOGGER = LoggerFactory.getLogger(PersonalIZOController.class);

	@Autowired()
	private PersonalIZOService personalIZOService;

	/**
	 * Devuelve una lista de beans correspondientes a los valores de filtrados
	 * indicados en el objeto pasado como parametro.
	 *
	 * @param filterPersonalIZO
	 *            PersonalIZO Objeto que contiene los parametros de filtrado
	 *            utilizados en la busqueda.
	 * @return List<PersonalIZO> Lista de objetos correspondientes a la busqueda
	 *         realizada.
	 */
	@RequestMapping(value = "/asignador", method = RequestMethod.GET)
	public @ResponseBody List<PersonalIZO> getAsignador(@ModelAttribute PersonalIZO filterPersonalIZO) {
		PersonalIZOController.LOGGER.info("[GET - find_ALL] : Obtener PersonalIZO por filtro");
		filterPersonalIZO.setAsignador(Constants.SI);
		return this.personalIZOService.findAll(filterPersonalIZO, null);
	}

	/**
	 * Devuelve una lista de beans correspondientes a los ids de grupos de
	 * trabajo pasados
	 * 
	 * @param gruposTrabajo
	 *            List<Long>
	 * @return List<PersonalIZO>
	 */
	@RequestMapping(value = "/asignadorGrupoTrabajo/{gruposTrabajo}", method = RequestMethod.GET)
	public @ResponseBody List<PersonalIZO> getAsignadores(@PathVariable String gruposTrabajo) {
		List<Long> listGruposTrabajo = new ArrayList<Long>();
		if (gruposTrabajo != null && !"".equals(gruposTrabajo) && !"-1".equals(gruposTrabajo)) {
			String[] ids = gruposTrabajo.split("_");
			for (String value : ids) {
				listGruposTrabajo.add(Long.valueOf(value));
			}
		}
		PersonalIZOController.LOGGER.info("[GET - find_ALL] : Obtener PersonalIZO por filtro");
		return this.personalIZOService.getAsignadores(listGruposTrabajo);
	}

	/**
	 * Devuelve una lista de beans correspondientes a los valores de filtrados
	 * indicados en el objeto pasado como parametro.
	 *
	 * @param filterPersonalIZO
	 *            PersonalIZO Objeto que contiene los parametros de filtrado
	 *            utilizados en la busqueda.
	 * @return List<PersonalIZO> Lista de objetos correspondientes a la busqueda
	 *         realizada.
	 */
	@RequestMapping(value = "/tradInterp", method = RequestMethod.GET)
	public @ResponseBody List<PersonalIZO> getTradInterp(@ModelAttribute PersonalIZO filterPersonalIZO) {
		PersonalIZOController.LOGGER.info("[GET - find_ALL] : Obtener PersonalIZO por filtro");
		filterPersonalIZO.setAsignador(Constants.SI);
		return this.personalIZOService.findTradInterpAsign(filterPersonalIZO);
	}

	@RequestMapping(value = "/asignadoresPlanificacion", method = RequestMethod.GET)
	public @ResponseBody List<PersonalIZO> getAsignadoresPlanificacion(@ModelAttribute PersonalIZO filterPersonalIZO) {
		PersonalIZOController.LOGGER.info("[GET - find_ALL] : Obtener PersonalIZO por filtro");
		filterPersonalIZO.setAsignador(Constants.SI);
		return this.personalIZOService.getAsignadoresPlanificacion(filterPersonalIZO);
	}

	@RequestMapping(value = "/getTraductores", method = RequestMethod.GET)
	public @ResponseBody List<PersonalIZO> getTraductores(@ModelAttribute PersonalIZO filterPersonalIZO) {
		PersonalIZOController.LOGGER.info("[GET - find_ALL] : Obtener PersonalIZO por filtro");
		filterPersonalIZO.setTraductor(Constants.SI);
		return this.personalIZOService.findTraductores(filterPersonalIZO);
	}

	@RequestMapping(value = "/traductor", method = RequestMethod.GET)
	public @ResponseBody List<PersonalIZO> getTraductor(@ModelAttribute PersonalIZO filterPersonalIZO) {
		PersonalIZOController.LOGGER.info("[GET - find_ALL] : Obtener PersonalIZO por filtro");
		filterPersonalIZO.setTraductor(Constants.SI);
		return this.personalIZOService.findAll(filterPersonalIZO, null);
	}

	@RequestMapping(value = "/interprete", method = RequestMethod.GET)
	public @ResponseBody List<PersonalIZO> getInterprete(@ModelAttribute PersonalIZO filterPersonalIZO) {
		PersonalIZOController.LOGGER.info("[GET - find_ALL] : Obtener PersonalIZO por filtro");
		filterPersonalIZO.setInterprete(Constants.SI);
		return this.personalIZOService.findAll(filterPersonalIZO, null);
	}

	/**
	 * Devuelve una lista de beans correspondientes a los valores de filtrados
	 * indicados en el objeto pasado como parametro.
	 *
	 * @param filterPersonalIZO
	 *            PersonalIZO Objeto que contiene los parametros de filtrado
	 *            utilizados en la busqueda.
	 * @return List<PersonalIZO> Lista de objetos correspondientes a la busqueda
	 *         realizada.
	 */
	@RequestMapping(value = "/tecnTrad", method = RequestMethod.GET)
	public @ResponseBody List<PersonalIZO> getTecnTrad(@ModelAttribute PersonalIZO filterPersonalIZO) {
		PersonalIZOController.LOGGER.info("[GET - find_ALL] : Obtener PersonalIZO por filtro");
		Usuario credentials = (Usuario) SecurityContextHolder.getContext().getAuthentication().getCredentials();
		if (!credentials.getTecnico()) {
			filterPersonalIZO.setDni(credentials.getNif());
		}
		filterPersonalIZO.setTecnicoGestor(Constants.SI);

		return this.personalIZOService.findAllLike(filterPersonalIZO, null, false);
	}

	/**
	 * Devuelve una lista con todos los registros de la vista PERSONAL_IZO
	 *
	 * @param filterPersonalIZO
	 *            PersonalIZO Objeto que contiene los parametros de filtrado
	 *            utilizados en la busqueda.
	 * @return List<PersonalIZO> Lista de objetos correspondientes a la busqueda
	 *         realizada.
	 */
	@RequestMapping(value = "/todos", method = RequestMethod.GET)
	public @ResponseBody List<PersonalIZO> getTodos(@ModelAttribute PersonalIZO filterPersonalIZO) {
		PersonalIZOController.LOGGER.info("[GET - find_ALL] : Obtener PersonalIZO por filtro");
		Usuario credentials = (Usuario) SecurityContextHolder.getContext().getAuthentication().getCredentials();
		if (!credentials.getTecnico()) {
			filterPersonalIZO.setDni(credentials.getNif());
		}
		return this.personalIZOService.findAllLike(filterPersonalIZO, null, false);
	}

	@RequestMapping(value = "/filterTecnicoAsignadoAEstudio", method = RequestMethod.GET)
	public @ResponseBody List<PersonalIZO> getTecnicosGestores(@RequestParam() String q) {
		PersonalIZOController.LOGGER.info("[GET - find_ALL] : Obtener PersonalIZO por filtro");
		PersonalIZO filterPersonalIZO = new PersonalIZO();
		filterPersonalIZO.setTecnicoGestor("S");
		filterPersonalIZO.setNombreFiltro(q);

		return this.personalIZOService.filterTecnicoAsignadoAEstudio(filterPersonalIZO);
	}

	@RequestMapping(value = "/gestoresActivos/{tipo}/{codigo}", method = RequestMethod.GET)
	public @ResponseBody List<PersonalIZO> findGestores(@PathVariable() String tipo, @PathVariable() Integer codigo,
			@RequestParam() String q) {
		Solicitante gestorFilter = new Solicitante();
		gestorFilter.setNombreFiltro(q);
		Entidad entidad = new Entidad();
		// si la entidad pasada es nula, vacia o un string con valor "-1", no lo
		// incluye en el filtro
		if (!StringUtils.isBlank(tipo) && !Constants.MINUS_UNO.toString().equals(tipo)) {
			entidad.setTipo(tipo);
		}
		// si el codigo de entidad pasado es -1, no lo incluye en el filtro
		if (Constants.MINUS_UNO != codigo) {
			entidad.setCodigo(codigo);
		}
		gestorFilter.setEntidad(entidad);
		return this.personalIZOService.getGestoresActivos(gestorFilter);
	}

}
