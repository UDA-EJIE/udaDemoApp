package com.ejie.aa79b.service;

import java.math.BigDecimal;
import java.util.Date;
import java.util.List;
import java.util.Locale;

import org.apache.commons.lang.StringUtils;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.support.ReloadableResourceBundleMessageSource;
import org.springframework.security.core.context.SecurityContextHolder;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import com.ejie.aa79b.common.Constants;
import com.ejie.aa79b.dao.DocumentosExpedienteDao;
import com.ejie.aa79b.dao.DocumentosGeneralDao;
import com.ejie.aa79b.dao.ExpedienteDao;
import com.ejie.aa79b.dao.GenericoDao;
import com.ejie.aa79b.dao.GestorExpedienteDao;
import com.ejie.aa79b.dao.IdiomaDestinoDao;
import com.ejie.aa79b.dao.OidsAuxiliarDao;
import com.ejie.aa79b.dao.RegistroAccionesDao;
import com.ejie.aa79b.dao.TareasDao;
import com.ejie.aa79b.model.DocumentosExpediente;
import com.ejie.aa79b.model.DocumentosPostTraduccionBOE;
import com.ejie.aa79b.model.EntradaDatosDocumento;
import com.ejie.aa79b.model.Expediente;
import com.ejie.aa79b.model.FicheroDocExp;
import com.ejie.aa79b.model.RegistroAcciones;
import com.ejie.aa79b.model.Tareas;
import com.ejie.aa79b.model.enums.ClasificacionDocumentosEnum;
import com.ejie.aa79b.model.enums.TipoOrigenFicheroEnum;
import com.ejie.aa79b.model.webservices.Aa79bDocumentoExpediente;
import com.ejie.aa79b.model.webservices.Aa79bFicheroDocExp;
import com.ejie.aa79b.security.Usuario;
import com.ejie.x38.dto.JQGridRequestDto;

/**
 * DocumentosExpedienteServiceImpl generated by UDA, 06-feb-2018 10:13:42.
 *
 * @author UDA
 */

@Service(value = "documentosExpedienteService")
public class DocumentosExpedienteServiceImpl extends GenericoServiceImpl<DocumentosExpediente>
		implements DocumentosExpedienteService {

	@Autowired
	private DocumentosExpedienteDao documentosExpedienteDao;
	@Autowired()
	private RegistroAccionesDao registroAccionesDao;
	@Autowired()
	private ReloadableResourceBundleMessageSource msg;

	@Autowired()
	private ExpedienteTradRevService expedienteTradRevService;
	@Autowired()
	private ExpedienteDao expedienteDao;
	@Autowired()
	private GestorExpedienteDao gestorExpedienteDao;
	@Autowired()
	private DocumentosGeneralDao documentosGeneralDao;
	@Autowired()
	private TareasDao tareasDao;
	@Autowired()
	private IdiomaDestinoDao idiomaDestinoDao;

	@Autowired()
	private OidsAuxiliarDao oidsAuxiliarDao;

	protected static final String NUMEROEXPEDIENTE = "label.numeroExpediente";
	protected static final String LABELOID = "label.documento.oid";
	protected static final String FICHEROADJUNTO = "label.ficheroAdjunto";
	protected static final String EXCEPCIONPID = "Excepción eliminando el fichero del PID. ";
	protected static final String IDIGUAL = " (id=";
	protected static final String FINLINEA = "): \n";
	protected static final String MENSAJE_NUEVO_DOC = "mensaje.nuevoDocumento";
	protected static final String EXCEPCION_PID = "Excepción subiendo el fichero al PID. ";
	private static final Logger LOGGER = LoggerFactory.getLogger(DocumentosExpedienteServiceImpl.class);

	@Override
	protected GenericoDao<DocumentosExpediente> getDao() {
		return this.documentosExpedienteDao;
	}

	@Override()
	@Transactional(rollbackFor = Throwable.class)
	public DocumentosExpediente update(DocumentosExpediente bean, String origen) {
		int x = 0;
		Usuario credentials = (Usuario) SecurityContextHolder.getContext().getAuthentication().getCredentials();
		DocumentosExpediente original = this.documentosExpedienteDao.find(bean);
		try {
			for (x = 0; x < bean.getFicheros().size()
					&& StringUtils.isNotBlank(bean.getFicheros().get(x).getContentType()); x++) {
				this.appendIdiomaDestTitulo(x, bean);
				updateOAddCondicional(bean, origen, x, credentials, original);
			}

			// AQUI COMPROBAR QUE SI EL PRIMERO ES UN ZIP, EL SEGUNDO HAY QUE
			// BORRARLO...
			// como en pantalla he vaciado el oid, content-type y demás...no da
			// la segunda vuelta por el bucle
			eliminarSegundoDocRevision(bean, original);

			// Actualiz datos T53
			actualizaDatosT53(bean, origen, original);
		} catch (Exception e) {
			DocumentosExpedienteServiceImpl.LOGGER.info(EXCEPCION_PID, e);
			bean.getFicheros().get(x).setError(e.getLocalizedMessage());
		}
		return bean;
	}

	@Override()
	@Transactional(rollbackFor = Throwable.class)
	public void updateDocOriginal(DocumentosExpediente bean) {
		int x = 0;
		for (x = 0; x < bean.getFicheros().size()
				&& StringUtils.isNotBlank(bean.getFicheros().get(x).getContentType()); x++) {

			this.documentosExpedienteDao.update(bean, x);
		}
	}

	/**
	 * @param bean
	 * @param origen
	 * @param original
	 */
	private void actualizaDatosT53(DocumentosExpediente bean, String origen, DocumentosExpediente original) {
		if ((ClasificacionDocumentosEnum.TRADUCCION.getValue() == bean.getClaseDocumento()
				|| (ClasificacionDocumentosEnum.REVISION.getValue() == bean.getClaseDocumento()))
				&& ((original.getNumPalIzo().intValue() != bean.getNumPalIzo().intValue())
						|| (original.getTipoDocumento().intValue() != bean.getTipoDocumento().intValue()))) {

			DocumentosExpedienteServiceImpl.LOGGER.info(
					".................... LLAMADA A procRecalcularCamposDocumentacionPL UPDATE ........................");
			this.expedienteTradRevService.procRecalcularCamposDocumentacionPL(bean.getAnyo(), bean.getNumExp());
			bean.setLlamadaPL(true);
			if (Constants.ALTA.equals(origen)) {
				this.expedienteTradRevService.actualizarNumPalSolicConIzo(bean.getAnyo(), bean.getNumExp());
			}
		} else {
			bean.setLlamadaPL(false);
		}
	}

	/**
	 * @param bean
	 * @param origen
	 * @param x
	 * @param credentials
	 * @param original
	 */
	private void updateOAddCondicional(DocumentosExpediente bean, String origen, int x, Usuario credentials,
			DocumentosExpediente original) {
		if (original.getFicheros().size() > x) {

			if (!bean.getFicheros().get(x).getOid().contentEquals(original.getFicheros().get(x).getOid())) {
				this.updateConCambioFichero(bean, origen, x, credentials, original);
			} else {
				// fichero no modificado
				this.documentosExpedienteDao.update(bean, x);
			}

		} else {
			// fichero no modificado
			this.documentosExpedienteDao.add(bean, x);
			this.oidsAuxiliarDao.remove(bean.getFicheros().get(x).getOid());
		}
	}

	/**
	 * @param bean
	 * @param original
	 */
	private void eliminarSegundoDocRevision(DocumentosExpediente bean, DocumentosExpediente original) {
		if (bean.getClaseDocumento() != null
				&& ClasificacionDocumentosEnum.REVISION.getValue() == bean.getClaseDocumento()
				&& !original.getFicheros().get(Constants.CERO).getExtension().equalsIgnoreCase(Constants.ZIP)
				&& bean.getFicheros().get(Constants.CERO).getExtension().equalsIgnoreCase(Constants.ZIP)) {
			final DocumentosExpediente doc2BorrarXZIP = new DocumentosExpediente();
			doc2BorrarXZIP.setIdDoc(original.getFicheros().get(Constants.UNO).getIdDocInsertado());
			// con accion planaificacion para que no lance el PL, ya q se
			// lanza aquí más adelante...
			try {
				this.removeConVuelta(doc2BorrarXZIP, Constants.PLANIFICACION);
				bean.getFicheros().remove(bean.getFicheros().get(1));
			} catch (Exception e) {
				DocumentosExpedienteServiceImpl.LOGGER.info(EXCEPCION_PID, e);
				doc2BorrarXZIP.getFicheros().get(0).setError(e.getLocalizedMessage());
			}

		}
	}

	/**
	 * @param bean
	 * @param origen
	 * @param x
	 * @param credentials
	 * @param original
	 * @throws Exception
	 */
	private void updateConCambioFichero(DocumentosExpediente bean, String origen, int x, Usuario credentials,
			DocumentosExpediente original) {

		bean.getFicheros().get(x).setDniAlta(credentials.getNif());
		bean.getFicheros().get(x).setFechaAlta(new Date());
		bean.getFicheros().get(x).setOrigen(TipoOrigenFicheroEnum.INTERNO.getValue());

		this.documentosExpedienteDao.update(bean, x);

		if (StringUtils.isNotEmpty(original.getFicheros().get(x).getOid())) {
			this.oidsAuxiliarDao.add(original.getFicheros().get(x).getOid());
		}

		this.oidsAuxiliarDao.remove(bean.getFicheros().get(x).getOid());

		RegistroAcciones regAcciones = new RegistroAcciones();
		regAcciones.setIdPuntoMenu(Constants.PUNTO_MENU_TRAMITACION_EXPEDIENTES);
		regAcciones.setIdAccion(Constants.ACCION_MODIFICACION);
		regAcciones.setAnyo(bean.getAnyo());
		regAcciones.setNumExp(bean.getNumExp());
		Expediente expediente = new Expediente(bean.getAnyo(), bean.getNumExp());
		regAcciones.setIdEstadoBitacora(this.expedienteDao.leerIdEstadoBitacora(expediente));

		Locale locale = new Locale(Constants.LANG_EUSKERA);

		StringBuilder observ = new StringBuilder();
		observ.append(this.msg.getMessage(NUMEROEXPEDIENTE, null, locale)).append(": ").append(original.getAnyo())
				.append("_").append(original.getNumExp()).append(" \n");
		observ.append(this.msg.getMessage("mensaje.ficheroModificado", null, locale)).append(": ")
				.append(original.getTitulo()).append(IDIGUAL).append(original.getIdDoc()).append(FINLINEA);
		observ.append("OID: ").append(original.getFicheros().get(x).getOid()).append(" -> ")
				.append(bean.getFicheros().get(x).getOid());
		regAcciones.setObserv(observ.toString());
		this.registroAccionesDao.add(regAcciones);

	}

	@Override()
	@Transactional(rollbackFor = Throwable.class)
	public DocumentosExpediente add(DocumentosExpediente bean, String origen) {
		int x = 0;
		Expediente expediente = new Expediente(bean.getAnyo(), bean.getNumExp());
		long idEstadoBitacora = this.expedienteDao.leerIdEstadoBitacora(expediente);
		DocumentosExpediente documentosExpedienteAux = null;
		try {
			for (x = 0; x < bean.getFicheros().size()
					&& StringUtils.isNotBlank(bean.getFicheros().get(x).getContentType()); x++) {
				this.appendIdiomaDestTitulo(x, bean);
				documentosExpedienteAux = this.documentosExpedienteDao.add(bean, x);
				this.oidsAuxiliarDao.remove(bean.getFicheros().get(x).getOid());

				// Registro de acciones...
				RegistroAcciones regAcciones = new RegistroAcciones();
				regAcciones.setIdPuntoMenu(Constants.PUNTO_MENU_TRAMITACION_EXPEDIENTES);
				regAcciones.setIdAccion(Constants.ACCION_ALTA);
				regAcciones.setAnyo(bean.getAnyo());
				regAcciones.setNumExp(bean.getNumExp());
				regAcciones.setIdEstadoBitacora(idEstadoBitacora);

				Locale locale = new Locale(Constants.LANG_EUSKERA);

				StringBuilder observ = new StringBuilder();
				observ.append(this.msg.getMessage(MENSAJE_NUEVO_DOC, null, locale)).append(": ")
						.append(documentosExpedienteAux.getTitulo()).append(IDIGUAL)
						.append(documentosExpedienteAux.getIdDoc()).append(FINLINEA);
				observ.append(this.msg.getMessage(NUMEROEXPEDIENTE, null, locale)).append(": ")
						.append(documentosExpedienteAux.getAnyo()).append("_")
						.append(documentosExpedienteAux.getNumExp()).append(" \n");
				observ.append(this.msg.getMessage(FICHEROADJUNTO, null, locale)).append(" ")
						.append(this.msg.getMessage(LABELOID, null, locale)).append(": ")
						.append(bean.getFicheros().get(x).getOid());

				regAcciones.setObserv(observ.toString());
				this.registroAccionesDao.add(regAcciones);
			}
			// Actualiz datos T53
			if (ClasificacionDocumentosEnum.TRADUCCION.getValue() == bean.getClaseDocumento()
					|| ClasificacionDocumentosEnum.REVISION.getValue() == bean.getClaseDocumento()) {

				DocumentosExpedienteServiceImpl.LOGGER.info(
						".................... LLAMADA A procRecalcularCamposDocumentacionPL INSERT ........................");
				this.expedienteTradRevService.procRecalcularCamposDocumentacionPL(bean.getAnyo(), bean.getNumExp());
				bean.setLlamadaPL(true);

				// Llamada al PL que

				if (Constants.ALTA.equals(origen)) {
					this.expedienteTradRevService.actualizarNumPalSolicConIzo(bean.getAnyo(), bean.getNumExp());
				} else if (Constants.PLANIFICACION.equals(origen)) {
					DocumentosExpedienteServiceImpl.LOGGER
							.info(".................... LLAMADA A asociar_doc_a_entrega ........................");
					this.expedienteTradRevService.procAsociarDocAEntregaPL(bean.getAnyo(), bean.getNumExp(),
							documentosExpedienteAux.getFicheros().get(0).getIdDocInsertado());
				}
			} else {
				bean.setLlamadaPL(false);
			}
		} catch (Exception e) {
			DocumentosExpedienteServiceImpl.LOGGER.info(EXCEPCION_PID, e);
			bean.getFicheros().get(x).setError(e.getLocalizedMessage());
			documentosExpedienteAux = bean;
		}
		return documentosExpedienteAux;
	}

	private void appendIdiomaDest(int x, DocumentosExpediente beanDocExpediente) {
		String idiomaDest = "";
		if (x == 1) {
			idiomaDest = this.idiomaDestinoDao.getCodeWithAnyoAndNumeExp(beanDocExpediente.getAnyo(),
					beanDocExpediente.getNumExp());
			String elNombre = beanDocExpediente.getFicheros().get(0).getNombre();
			elNombre = elNombre.substring(Constants.CERO, elNombre.lastIndexOf('.'));
			elNombre = elNombre + "_" + (idiomaDest.substring(0, 1).toUpperCase() + idiomaDest.substring(1));
			elNombre = elNombre + "." + beanDocExpediente.getFicheros().get(1).getExtension();
			beanDocExpediente.getFicheros().get(x).setNombre(elNombre);
		}
	}

	private void appendIdiomaDestTitulo(int x, DocumentosExpediente beanDocExpediente) {
		String idiomaDest = "";
		if (x == 1) {
			idiomaDest = this.idiomaDestinoDao.getCodeWithAnyoAndNumeExp(beanDocExpediente.getAnyo(),
					beanDocExpediente.getNumExp());
			String elNombre = beanDocExpediente.getFicheros().get(0).getNombre();
			elNombre = elNombre.substring(Constants.CERO, elNombre.lastIndexOf('.'));
			elNombre = elNombre + "_" + (idiomaDest.substring(0, 1).toUpperCase() + idiomaDest.substring(1));
			elNombre = elNombre + "." + beanDocExpediente.getFicheros().get(1).getExtension();
			beanDocExpediente.setTitulo(elNombre);
		}
	}

	@Override()
	@Transactional(rollbackFor = Throwable.class)
	public DocumentosExpediente removeConVuelta(DocumentosExpediente documentosExpediente) {
		return this.removeConVuelta(documentosExpediente, Constants.CONSULTA);
	}

	@Override()
	@Transactional(rollbackFor = Throwable.class)
	public DocumentosExpediente removeConVuelta(DocumentosExpediente documentosExpediente, String origen) {
		DocumentosExpediente documentosExpedienteAux = this.documentosExpedienteDao.find(documentosExpediente);

		List<String> listaOids = this.documentosExpedienteDao.getOidsABorrar(documentosExpedienteAux.getIdDoc());
		this.documentosExpedienteDao.remove(documentosExpediente);
		for (String unOid : listaOids) {
			this.oidsAuxiliarDao.add(unOid);
		}

		// Registro de acciones...
		RegistroAcciones regAcciones = new RegistroAcciones();
		regAcciones.setIdPuntoMenu(Constants.PUNTO_MENU_TRAMITACION_EXPEDIENTES);
		regAcciones.setIdAccion(Constants.ACCION_BORRADO);
		regAcciones.setAnyo(documentosExpedienteAux.getAnyo());
		regAcciones.setNumExp(documentosExpedienteAux.getNumExp());
		Expediente expediente = new Expediente(documentosExpedienteAux.getAnyo(), documentosExpedienteAux.getNumExp());
		regAcciones.setIdEstadoBitacora(this.expedienteDao.leerIdEstadoBitacora(expediente));

		Locale locale = new Locale(Constants.LANG_EUSKERA);

		StringBuilder observ = new StringBuilder();
		observ.append(this.msg.getMessage("mensaje.documentoEliminado", null, locale)).append(": ")
				.append(documentosExpedienteAux.getTitulo()).append(IDIGUAL).append(documentosExpedienteAux.getIdDoc())
				.append(FINLINEA);
		observ.append(this.msg.getMessage(NUMEROEXPEDIENTE, null, locale)).append(": ")
				.append(documentosExpedienteAux.getAnyo()).append("_").append(documentosExpedienteAux.getNumExp())
				.append(" \n");
		observ.append(this.msg.getMessage(FICHEROADJUNTO, null, locale)).append(" ")
				.append(this.msg.getMessage(LABELOID, null, locale)).append(": ")
				.append(documentosExpedienteAux.getFicheros().get(0).getOid());
		if ((documentosExpedienteAux.getFicheros().size() > 1)
				&& (documentosExpedienteAux.getFicheros().get(1).getOid() != null)) {
			observ.append(this.msg.getMessage(FICHEROADJUNTO, null, locale)).append(" ")
					.append(this.msg.getMessage(LABELOID, null, locale)).append(": ")
					.append(documentosExpedienteAux.getFicheros().get(1).getOid());
		}
		regAcciones.setObserv(observ.toString());
		this.registroAccionesDao.add(regAcciones);

		// Actualiz datos T53
		if (ClasificacionDocumentosEnum.TRADUCCION.getValue() == documentosExpedienteAux.getClaseDocumento()
				|| ClasificacionDocumentosEnum.REVISION.getValue() == documentosExpedienteAux.getClaseDocumento()) {
			DocumentosExpedienteServiceImpl.LOGGER.info(
					".................... LLAMADA A procRecalcularCamposDocumentacionPL REMOVE ........................");
			this.expedienteTradRevService.procRecalcularCamposDocumentacionPL(documentosExpedienteAux.getAnyo(),
					documentosExpedienteAux.getNumExp());
			documentosExpedienteAux.setLlamadaPL(true);
			if (Constants.ALTA.equals(origen)) {
				this.expedienteTradRevService.actualizarNumPalSolicConIzo(documentosExpedienteAux.getAnyo(),
						documentosExpedienteAux.getNumExp());
			}
		} else {
			documentosExpedienteAux.setLlamadaPL(false);
		}
		return documentosExpedienteAux;

	}

	@Override
	public DocumentosExpediente find(DocumentosExpediente bean, String origen) {
		return this.getDao().find(bean);
	}

	@Override
	public Long comprobarencriptados(DocumentosExpediente documentosExpedienteFiltro, String reqEncriptado) {
		return this.documentosExpedienteDao.comprobarencriptados(documentosExpedienteFiltro, reqEncriptado);
	}

	@Override
	public boolean validaNumPalabrasMaxExp(DocumentosExpediente documentosExpediente) {
		boolean vuelta = true;
		if (documentosExpediente.getNumPalIzo() != null) {
			DocumentosExpediente documentosExpedienteAux = new DocumentosExpediente();
			documentosExpedienteAux.setNumExp(documentosExpediente.getNumExp());
			documentosExpedienteAux.setAnyo(documentosExpediente.getAnyo());
			if (documentosExpediente.getIdDoc() != null) {
				documentosExpedienteAux.setIdDoc(documentosExpediente.getIdDoc());
			}
			int sumatorio = this.documentosExpedienteDao.sumatorioPalabrasExpediente(documentosExpedienteAux);
			if (sumatorio + documentosExpediente.getNumPalIzo() > 999999) {
				vuelta = false;
			}
		}

		return vuelta;
	}

	@Override
	public void actualizarT53ConfidencialSI(Long anyo, Integer numExp) {
		this.expedienteTradRevService.actualizarT53ConfidencialSI(anyo, numExp);
	}

	@Override
	public List<Aa79bFicheroDocExp> getAa79bDocumentoExpediente(EntradaDatosDocumento bean) {
		return this.documentosExpedienteDao.getAa79bDocumentoExpediente(bean);
	}

	@Override
	public List<Aa79bDocumentoExpediente> getAa79bDocumentosExpediente(Aa79bDocumentoExpediente bean, Locale locale) {
		return this.documentosExpedienteDao.getAa79bDocumentosExpediente(bean, locale);
	}

	@Override
	public List<DocumentosExpediente> findAllEstudioSubsanacion(Long anyo, Integer numExp, Long idTarea) {
		return this.documentosExpedienteDao.findAllEstudioSubsanacion(anyo, numExp, idTarea);
	}

	@Override
	public FicheroDocExp findDatosFichero(BigDecimal idDoc) {
		return this.documentosExpedienteDao.findDatosFichero(idDoc);
	}

	@Override
	public List<DocumentosExpediente> findDocumentosTarea(DocumentosExpediente documentosExpediente, String dni,
			JQGridRequestDto jqGridRequestDto) {
		List<DocumentosExpediente> listaOriginalesyFinales = this.documentosExpedienteDao
				.findAllConFinales(documentosExpediente, dni, jqGridRequestDto);

		for (DocumentosExpediente unDocOrigyFin : listaOriginalesyFinales) {
			unDocOrigyFin.setFicherosTraduccionesIntermedias(
					this.documentosExpedienteDao.findAllIntermedios(unDocOrigyFin, dni, jqGridRequestDto));
			unDocOrigyFin.setJustificantesRevisionIntermedias(
					this.documentosExpedienteDao.findAllJustificantesIntermedios(unDocOrigyFin, dni, jqGridRequestDto));
		}
		return listaOriginalesyFinales;
	}

	@Override
	public List<DocumentosExpediente> findAllConFinales(DocumentosExpediente documentosExpediente,
			JQGridRequestDto jqGridRequestDto) {
		return this.documentosExpedienteDao.findAllConFinales(documentosExpediente, null, jqGridRequestDto);
	}

	@Override
	public List<DocumentosExpediente> findAllConIntermediosYFinales(DocumentosExpediente documentosExpediente,
			JQGridRequestDto jqGridRequestDto) {
		List<DocumentosExpediente> listaOriginalesyFinales = this.documentosExpedienteDao
				.findAllConFinales(documentosExpediente, null, jqGridRequestDto);

		for (DocumentosExpediente unDocOrigyFin : listaOriginalesyFinales) {
			unDocOrigyFin.setFicherosTraduccionesIntermedias(
					this.documentosExpedienteDao.findAllIntermedios(unDocOrigyFin, null, jqGridRequestDto));
			unDocOrigyFin.setJustificantesRevisionIntermedias(this.documentosExpedienteDao
					.findAllJustificantesIntermedios(unDocOrigyFin, null, jqGridRequestDto));
		}
		return listaOriginalesyFinales;
	}

	@Override
	public DocumentosPostTraduccionBOE findficherosBoePosttraduccion(DocumentosExpediente documentosExpediente) {

		DocumentosPostTraduccionBOE documentosPostTraduccionBOE = new DocumentosPostTraduccionBOE();
		final Expediente expediente = new Expediente();
		expediente.setAnyo(documentosExpediente.getAnyo());
		expediente.setNumExp(documentosExpediente.getNumExp());

		if (this.gestorExpedienteDao.isGestorBoe(expediente)) {

			// Si hay tarea de posttraduccion boe ejecutada, recupero su idTarea
			BigDecimal idTareaPostTrad = this.tareasDao.findTareaEjecutadaPosttraduccionBOE(expediente);
			if (idTareaPostTrad.compareTo(BigDecimal.ZERO) != 0) {
				documentosPostTraduccionBOE = this.documentosGeneralDao.consultaFicherosBOE(idTareaPostTrad);
			}
		}

		return documentosPostTraduccionBOE;

	}

	@Override
	public Boolean comprobarXliffObligatorio(Expediente expediente) {
		return this.documentosExpedienteDao.comprobarXliffObligatorio(expediente);
	}

	@Override
	public Boolean comprobarXliffObligatorioAlinearPostEntrega(Tareas tarea) {
		return this.documentosExpedienteDao.comprobarXliffObligatorioAlinearPostEntrega(tarea);
	}

}
