package com.ejie.aa79b.service;

import java.util.LinkedHashMap;
import java.util.Locale;
import java.util.Map;

import org.apache.commons.lang.StringUtils;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.support.ReloadableResourceBundleMessageSource;
import org.springframework.stereotype.Service;

import com.ejie.aa79b.common.Constants;
import com.ejie.aa79b.dao.CuantiaRevDao;
import com.ejie.aa79b.dao.GenericoDao;
import com.ejie.aa79b.dao.RegistroAccionesDao;
import com.ejie.aa79b.model.CuantiaRev;
import com.ejie.aa79b.model.RegistroAcciones;
import com.ejie.aa79b.utils.Utils;

/**
 * CuantiaRevServiceImpl generated by UDA, 15-dic-2017 14:11:45.
 * 
 * @author UDA
 */

@Service(value = "cuantiaRevService")
public class CuantiaRevServiceImpl extends GenericoServiceImpl<CuantiaRev> implements CuantiaRevService {

    @Autowired
    private CuantiaRevDao cuantiaRevDao;
    @Autowired()
    private RegistroAccionesDao registroAccionesDao;
    @Autowired()
    private ReloadableResourceBundleMessageSource msg;

    private static final String MENU = "menu.ordenPreciosPublicos";

    @Override
    protected GenericoDao<CuantiaRev> getDao() {
        return this.cuantiaRevDao;
    }

    @Override()
    public CuantiaRev add(CuantiaRev bean) {

        CuantiaRev cuantiaRevAux = this.cuantiaRevDao.add(bean);

        RegistroAcciones regAcciones = new RegistroAcciones();
        regAcciones.setIdPuntoMenu(Constants.PUNTO_MENU_ORDEN_PRECIOS);
        regAcciones.setIdAccion(Constants.ACCION_ALTA);
        Locale locale = new Locale(Constants.LANG_EUSKERA);

        StringBuilder observ = new StringBuilder();

        observ.append(this.msg.getMessage(MENU, null, locale)).append(" id: ").append(cuantiaRevAux.getIdOrden())
                .append(" \n");
        observ.append(this.msg.getMessage("label.cuantias.serviciosRevision", null, locale)).append("- id ")
                .append(this.msg.getMessage("label.tipoRelevancia", null, locale)).append(": ")
                .append(cuantiaRevAux.getIdTipoRelevancia()).append(" \n");

        observ.append(this.msg.getMessage("label.tarifaEsEu", null, locale)).append(": ")
                .append(cuantiaRevAux.getTarifaEsEu()).append(" - ");
        observ.append(this.msg.getMessage("label.tarifaEuEs", null, locale)).append(": ")
                .append(cuantiaRevAux.getTarifaEuEs()).append(" \n");

        regAcciones.setObserv(observ.toString());
        this.registroAccionesDao.add(regAcciones);

        return cuantiaRevAux;
    }

    @Override()
    public CuantiaRev update(CuantiaRev bean) {
        CuantiaRev original = this.cuantiaRevDao.find(bean);

        CuantiaRev cuantiaRevAux = this.cuantiaRevDao.update(bean);

        RegistroAcciones regAcciones = new RegistroAcciones();
        regAcciones.setIdAccion(Constants.ACCION_MODIFICACION);
        regAcciones.setIdPuntoMenu(Constants.PUNTO_MENU_ORDEN_PRECIOS);

        // Acciones
        Map<String, String> paramAcciones = new LinkedHashMap<String, String>();
        // orden
        paramAcciones.put("idOrden", MENU);
        // tarifas
        paramAcciones.put("tarifaEsEu", "label.tarifaEsEu");
        paramAcciones.put("tarifaEuEs", "label.tarifaEuEs");

        // Locale
        Locale locale = new Locale(Constants.LANG_EUSKERA);
        String aux = Utils.observacionesRegistro(bean, original, paramAcciones, this.msg, locale);
        // Si no es null
        if (StringUtils.isNotBlank(aux)) {
            StringBuilder observ = new StringBuilder();
            observ.append(this.msg.getMessage(MENU, null, locale)).append(" id: ").append(original.getIdOrden())
                    .append(" \n");
            // Revisi√≥n
            observ.append(this.msg.getMessage("label.cuantias.serviciosRevision", null, locale)).append("- id ")
                    .append(this.msg.getMessage("label.tipoRelevancia", null, locale)).append(": ")
                    .append(original.getIdTipoRelevancia()).append(" \n");
            observ.append(aux);
            regAcciones.setObserv(observ.toString());
            this.registroAccionesDao.add(regAcciones);
        }

        return cuantiaRevAux;
    }

}