package com.ejie.aa79b.service;

import java.util.List;

import org.apache.commons.lang.StringUtils;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.ejie.aa79b.common.Constants;
import com.ejie.aa79b.dao.BitacoraExpedienteDao;
import com.ejie.aa79b.dao.ExpedienteDao;
import com.ejie.aa79b.dao.GenericoDao;
import com.ejie.aa79b.dao.PropiedadDao;
import com.ejie.aa79b.model.BitacoraExpediente;
import com.ejie.aa79b.model.BitacoraSolicitante;
import com.ejie.aa79b.model.Expediente;

/**
 * BitacoraExpedienteServiceImpl generated by UDA, 31-ene-2018 15:08:48.
 *
 * @author UDA
 */

@Service(value = "bitacoraExpedienteService")
public class BitacoraExpedienteServiceImpl extends GenericoServiceImpl<BitacoraExpediente>
		implements BitacoraExpedienteService {

	private static final String ESTADO_BITACORA = "t1.ID_ESTADO_BITACORA_059";
	private static final String ORDEN_ASC = "ASC";

	@Autowired
	private BitacoraExpedienteDao bitacoraExpedienteDao;
	@Autowired
	private ExpedienteDao expedienteDao;
	@Autowired
	private PropiedadDao propiedadDao;

	@Override
	protected GenericoDao<BitacoraExpediente> getDao() {
		return this.bitacoraExpedienteDao;
	}

	/**
	 *
	 * @param expediente
	 *            Expediente
	 * @return Expediente
	 */
	@Override()
	public Expediente getCabeceraBitacora(Expediente expediente) {

		final Expediente expedienteReturn = this.expedienteDao.find(expediente);
		final BitacoraExpediente bitacora = new BitacoraExpediente();
		bitacora.setAnyo(expedienteReturn.getAnyo());
		bitacora.setNumExp(expedienteReturn.getNumExp());

		// Se obtiene el listado de estados de la bit√°cora
		final List<BitacoraExpediente> listaBitacoras = this.bitacoraExpedienteDao.findAllOrdered(bitacora,
				ESTADO_BITACORA, ORDEN_ASC);
		expedienteReturn.setListaBitacoraExpediente(listaBitacoras);

		if ( StringUtils.isNotEmpty( expedienteReturn.getAplicacionOrigen() )) {
			expedienteReturn.setIndAplicacionComunicaciones(  Boolean.TRUE.equals(this.propiedadDao.esAplicacionComunicaciones( expedienteReturn.getAplicacionOrigen() ))?Constants.SI:Constants.NO );
		}
		return expedienteReturn;
	}

	@Override()
	public void addBitacoraSolicitante(BitacoraSolicitante bitacoraSolicitante, int accionBitacoraSol) {
		this.bitacoraExpedienteDao.addBitacoraSolicitante(bitacoraSolicitante, accionBitacoraSol);
	}

}
