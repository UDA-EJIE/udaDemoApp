package com.ejie.aa79b.service;

import java.util.LinkedHashMap;
import java.util.Locale;
import java.util.Map;

import org.apache.commons.lang.StringUtils;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.support.ReloadableResourceBundleMessageSource;
import org.springframework.stereotype.Service;

import com.ejie.aa79b.common.Constants;
import com.ejie.aa79b.dao.GenericoDao;
import com.ejie.aa79b.dao.RegistroAccionesDao;
import com.ejie.aa79b.dao.TarifExpTradRevDao;
import com.ejie.aa79b.model.RegistroAcciones;
import com.ejie.aa79b.model.TarifExpTradRev;
import com.ejie.aa79b.utils.Utils;

/**
 * TarifExpTradRevServiceImpl generated by UDA, 15-dic-2017 14:11:45.
 * 
 * @author UDA
 */
@Service(value = "tarifExpTradRevService")
public class TarifExpTradRevServiceImpl extends GenericoServiceImpl<TarifExpTradRev> implements TarifExpTradRevService {

    protected static final String ORDENPRECIOSPUBLICOS = "menu.ordenPreciosPublicos";
    
    @Autowired 
    private TarifExpTradRevDao tarifExpTradRevDao;
    @Autowired()
    private RegistroAccionesDao registroAccionesDao;
    @Autowired()
    private ReloadableResourceBundleMessageSource msg;
    
    @Override
    protected GenericoDao<TarifExpTradRev> getDao() {
        return this.tarifExpTradRevDao;
    }

    
    @Override()
    public TarifExpTradRev add(TarifExpTradRev bean) {
             
        TarifExpTradRev tarifExpTradRevAux = this.tarifExpTradRevDao.add(bean);
        
        RegistroAcciones regAcciones = new RegistroAcciones();
        regAcciones.setIdPuntoMenu(Constants.PUNTO_MENU_ORDEN_PRECIOS);
        regAcciones.setIdAccion(Constants.ACCION_ALTA);
        Locale locale = new Locale(Constants.LANG_EUSKERA);
        
        StringBuilder observ = new StringBuilder();
        
        observ.append(this.msg.getMessage(ORDENPRECIOSPUBLICOS, null, locale)).append(" id: ").append(tarifExpTradRevAux.getIdOrden()).append(" \n");
        observ.append(this.msg.getMessage("label.cuantias.tarifExpTradRev", null, locale)).append(": \n");
        
        observ.append(this.msg.getMessage("label.recargoDificultad", null, locale)).append(": ").append(tarifExpTradRevAux.getPorRecargoDif()).append(" \n");
        observ.append(this.msg.getMessage("label.recargoUrgencia", null, locale)).append(": ").append(tarifExpTradRevAux.getPorRecargoUrg()).append(" \n");
        
        observ.append(this.msg.getMessage("label.precioMinimo", null, locale)).append(": ").append(tarifExpTradRevAux.getPrecioMinimo()).append(" \n");
        observ.append(this.msg.getMessage("label.numPalabrasTarif", null, locale)).append(": ").append(tarifExpTradRevAux.getNumPalabrasTarifConcor()).append(" \n");
        observ.append(this.msg.getMessage("label.95100por", null, locale)).append(": ").append(tarifExpTradRevAux.getPorPalabraConcor95100()).append(" \n");
        observ.append(this.msg.getMessage("label.8594por", null, locale)).append(": ").append(tarifExpTradRevAux.getPorPalabraConcor8594()).append(" \n");
        observ.append(this.msg.getMessage("label.85Menorpor", null, locale)).append(": ").append(tarifExpTradRevAux.getPorPalabraConcor084()).append(" \n");
                              
        regAcciones.setObserv(observ.toString());
        this.registroAccionesDao.add(regAcciones);        
        
        return tarifExpTradRevAux;
    }

    @Override()
    public TarifExpTradRev update(TarifExpTradRev bean) {
        TarifExpTradRev original = this.tarifExpTradRevDao.find(bean);
        
        TarifExpTradRev tarifExpTradRevAux =  this.tarifExpTradRevDao.update(bean);
        
        RegistroAcciones regAcciones = new RegistroAcciones();
        regAcciones.setIdPuntoMenu(Constants.PUNTO_MENU_ORDEN_PRECIOS);
        regAcciones.setIdAccion(Constants.ACCION_MODIFICACION);
        
        Map<String, String> paramAcciones = new LinkedHashMap<String, String>();
        paramAcciones.put("idOrden", ORDENPRECIOSPUBLICOS);
        paramAcciones.put("porRecargoDif", "label.recargoDificultad");
        paramAcciones.put("porRecargoUrg", "label.recargoUrgencia");        
        paramAcciones.put("precioMinimo", "label.precioMinimo");
        paramAcciones.put("numPalabrasTarifConcor", "label.numPalabrasTarif");
        paramAcciones.put("porPalabraConcor084", "label.95100por");
        paramAcciones.put("porPalabraConcor8594", "label.8594por");
        paramAcciones.put("porPalabraConcor95100", "label.85Menorpor");                      
        
        Locale locale = new Locale(Constants.LANG_EUSKERA);
        String aux = Utils.observacionesRegistro(bean, original, paramAcciones, this.msg, locale);
        if (StringUtils.isNotBlank(aux)) {
            StringBuilder observ = new StringBuilder();
            observ.append(this.msg.getMessage(ORDENPRECIOSPUBLICOS, null, locale)).append(" id: ").append(tarifExpTradRevAux.getIdOrden()).append(" \n");
            observ.append(this.msg.getMessage("label.cuantias.tarifExpTradRev", null, locale)).append(": \n");
            observ.append(aux);
            regAcciones.setObserv(observ.toString());
            this.registroAccionesDao.add(regAcciones);
        }
        
        return tarifExpTradRevAux;
    }
    
}