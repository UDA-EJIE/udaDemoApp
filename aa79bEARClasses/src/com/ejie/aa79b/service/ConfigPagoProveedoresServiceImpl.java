package com.ejie.aa79b.service;
import java.util.LinkedHashMap;
import java.util.Locale;
import java.util.Map;

import org.apache.commons.lang.StringUtils;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.support.ReloadableResourceBundleMessageSource;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import com.ejie.aa79b.common.Constants;
import com.ejie.aa79b.dao.ConfigPagoProveedoresDao;
import com.ejie.aa79b.dao.GenericoDao;
import com.ejie.aa79b.dao.RegistroAccionesDao;
import com.ejie.aa79b.model.ConfigPagoProveedores;
import com.ejie.aa79b.model.RegistroAcciones;
import com.ejie.aa79b.utils.Utils;

/**
 * ConfigPagoProveedoresServiceImpl generated by UDA, 05-dic-2017 15:17:18.
 * @author UDA
 */

@Service(value = "configPagoProveedoresService")
public class ConfigPagoProveedoresServiceImpl extends GenericoServiceImpl<ConfigPagoProveedores> implements ConfigPagoProveedoresService {

	@Autowired()
	private ConfigPagoProveedoresDao configPagoProveedoresDao;
	@Autowired()
	private RegistroAccionesDao registroAccionesDao;
    @Autowired()
    private ReloadableResourceBundleMessageSource msg;

	@Override()
	protected GenericoDao<ConfigPagoProveedores> getDao() {
		return this.configPagoProveedoresDao;
	}

	@Override()
	@Transactional(rollbackFor = Throwable.class)
	public ConfigPagoProveedores add(ConfigPagoProveedores bean) {
		this.configPagoProveedoresDao.add(bean);
		if (Constants.SI.equals(bean.getVigente())) {
			this.configPagoProveedoresDao.updateVigente(bean);
		}
		this.registrarAccion(bean, null);
		return bean;
	}

	@Override()
	@Transactional(rollbackFor = Throwable.class)
	public ConfigPagoProveedores update(ConfigPagoProveedores bean) {
		ConfigPagoProveedores original = this.configPagoProveedoresDao.find(bean);
		this.configPagoProveedoresDao.update(bean);
		if (Constants.SI.equals(bean.getVigente())) {
			this.configPagoProveedoresDao.updateVigente(bean);
		}
		this.registrarAccion(bean, original);
		return bean;
	}

	private void registrarAccion(ConfigPagoProveedores bean, ConfigPagoProveedores original) {
		RegistroAcciones reg = new RegistroAcciones();
		reg.setIdPuntoMenu(Constants.PUNTO_MENU_DATOS_BASICOS);
		if (original == null) {
			reg.setIdAccion(Constants.ACCION_ALTA);
		} else {
			reg.setIdAccion(Constants.ACCION_MODIFICACION);
		}
		
		Map<String, String> parametros = new LinkedHashMap<String, String>();
		parametros.put("porIva", "label.porIva");
		parametros.put("fechaDesde", "label.fechaDesde");
		parametros.put("fechaHasta", "label.fechaHasta");
		parametros.put("vigenteDesc", "label.enVigor");
		
		Locale locale = new Locale(Constants.LANG_EUSKERA);
		bean.setVigenteDesc(Utils.literalSiNo(this.msg, bean.getVigente(), locale));
		if (original != null) {
			original.setVigenteDesc(Utils.literalSiNo(this.msg, original.getVigente(), locale));	
		}
		String aux = Utils.observacionesRegistro(bean, original, parametros, this.msg, locale);
		if (StringUtils.isNotBlank(aux)) {
			StringBuilder observ = new StringBuilder();
			observ.append(this.msg.getMessage("label.pagoProveeedores", null, locale)).append("\n");
			observ.append(aux);
			reg.setObserv(observ.toString());
			this.registroAccionesDao.add(reg);
		}
	}
}

