package com.ejie.aa79b.dao;

import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Locale;
import java.util.Map;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.support.ReloadableResourceBundleMessageSource;
import org.springframework.dao.support.DataAccessUtils;
import org.springframework.jdbc.core.RowMapper;
import org.springframework.stereotype.Repository;
import org.springframework.transaction.annotation.Transactional;

import com.ejie.aa79b.common.DaoConstants;
import com.ejie.aa79b.common.SqlUtils;
import com.ejie.aa79b.model.MetadatosBusqueda;

/**
 * MetadatosBusquedaDaoImpl generated by UDA, 26-ene-2018 9:51:08.
 * 
 * @author UDA
 */

@Repository
@Transactional
public class MetadatosBusquedaDaoImpl extends GenericoDaoImpl<MetadatosBusqueda> implements MetadatosBusquedaDao {

	@Autowired()
	private ReloadableResourceBundleMessageSource msg;

	protected static final String ID_METADATOS_BUSQUEDA = "ID_019";
	protected static final String DESC_ES_METADATOS_BUSQUEDA = "DESC_ES_019";
	protected static final String DESC_EU_METADATOS_BUSQUEDA = "DESC_EU_019";
	protected static final String ESTADO_METADATOS_BUSQUEDA = "ESTADO_019";
	protected static final String ESTADO_DESC_ES_METADATOS_BUSQUEDA = "ESTADODESCES";
	protected static final String ESTADO_DESC_EU_METADATOS_BUSQUEDA = "ESTADODESCEU";
	protected static final String ESTADO_DESC_NORM_ES_METADATOS_BUSQUEDA = "DESCNORMES";
	protected static final String ESTADO_DESC_NORM_EU_METADATOS_BUSQUEDA = "DESCNORMEU";

	protected static final String[] ORDER_BY_WHITE_LIST = new String[] { ID_METADATOS_BUSQUEDA,
			DESC_ES_METADATOS_BUSQUEDA, DESC_EU_METADATOS_BUSQUEDA, ESTADO_METADATOS_BUSQUEDA,
			ESTADO_DESC_ES_METADATOS_BUSQUEDA, ESTADO_DESC_EU_METADATOS_BUSQUEDA,
			ESTADO_DESC_NORM_EU_METADATOS_BUSQUEDA, ESTADO_DESC_NORM_ES_METADATOS_BUSQUEDA };

	public MetadatosBusquedaDaoImpl() {
		// Constructor
		super(MetadatosBusqueda.class);
	}

	/*
	 * ROW_MAPPERS
	 */
	private RowMapper<MetadatosBusqueda> rwMap = new RowMapper<MetadatosBusqueda>() {
		public MetadatosBusqueda mapRow(ResultSet resultSet, int rowNum) throws SQLException {
			MetadatosBusqueda metadatosBusqueda = new MetadatosBusqueda();
			metadatosBusqueda.setId(resultSet.getLong(ID_METADATOS_BUSQUEDA));
			metadatosBusqueda.setDescEs(resultSet.getString(DESC_ES_METADATOS_BUSQUEDA));
			metadatosBusqueda.setDescEu(resultSet.getString(DESC_EU_METADATOS_BUSQUEDA));
			metadatosBusqueda.setEstado(resultSet.getString(ESTADO_METADATOS_BUSQUEDA));
			metadatosBusqueda.setDescEstadoEs(resultSet.getString(ESTADO_DESC_ES_METADATOS_BUSQUEDA));
			metadatosBusqueda.setDescEstadoEu(resultSet.getString(ESTADO_DESC_EU_METADATOS_BUSQUEDA));

			return metadatosBusqueda;
		}
	};

	private RowMapper<MetadatosBusqueda> rwMapPK = new RowMapper<MetadatosBusqueda>() {
		public MetadatosBusqueda mapRow(ResultSet resultSet, int rowNum) throws SQLException {
			MetadatosBusqueda metadatosBusqueda = new MetadatosBusqueda();
			metadatosBusqueda.setId(resultSet.getLong(ID_METADATOS_BUSQUEDA));

			return metadatosBusqueda;
		}
	};

	/**
	 * Inserts a single row in the MetadatosBusqueda table.
	 *
	 * @param metadatosbusqueda
	 *            MetadatosBusqueda
	 * @return MetadatosBusqueda
	 */
	public MetadatosBusqueda add(MetadatosBusqueda metadatosbusqueda) {
		Long elID = this.getNextVal("AA79B19Q00");
		String query = "INSERT INTO AA79B19S01 (ID_019, DESC_ES_019, DESC_EU_019, ESTADO_019) VALUES (?,?,?,?)";
		this.getJdbcTemplate().update(query, elID, metadatosbusqueda.getDescEs(), metadatosbusqueda.getDescEu(),
				metadatosbusqueda.getEstado());
		metadatosbusqueda.setId(elID);
		return metadatosbusqueda;
	}

	/**
	 * Updates a single row in the MetadatosBusqueda table.
	 *
	 * @param metadatosbusqueda
	 *            MetadatosBusqueda
	 * @return MetadatosBusqueda
	 */
	public MetadatosBusqueda update(MetadatosBusqueda metadatosbusqueda) {
		String query = "UPDATE AA79B19S01 SET DESC_ES_019=?, DESC_EU_019=?, ESTADO_019=? WHERE ID_019=?";
		this.getJdbcTemplate().update(query, metadatosbusqueda.getDescEs(), metadatosbusqueda.getDescEu(),
				metadatosbusqueda.getEstado(), metadatosbusqueda.getId());
		return metadatosbusqueda;
	}

	@Override
	protected String getSelect() {
		Locale es = new Locale("es");
		Locale eu = new Locale("eu");

		StringBuilder query = new StringBuilder();

		query.append("SELECT t1.ID_019 ID_019");
		query.append(", t1.DESC_ES_019 DESC_ES_019");
		query.append(", t1.DESC_EU_019 DESC_EU_019");
		query.append(", t1.ESTADO_019 ESTADO_019");
		query.append(", DECODE(t1.ESTADO_019, 'A', '").append(this.msg.getMessage("estado.alta", null, es))
				.append("', 'B', '").append(this.msg.getMessage("estado.baja", null, es)).append("') AS ESTADODESCES");
		query.append(", DECODE(t1.ESTADO_019, 'A', '").append(this.msg.getMessage("estado.alta", null, eu))
				.append("', 'B', '").append(this.msg.getMessage("estado.baja", null, eu)).append("') AS ESTADODESCEU");

		query.append(", ").append(SqlUtils.normalizarCampoSql("t1.DESC_EU_019")).append(" AS DESCNORMEU");
		query.append(", ").append(SqlUtils.normalizarCampoSql("t1.DESC_ES_019")).append(" AS DESCNORMES");

		return query.toString();
	}

	@Override
	protected String getFrom() {
		return " FROM AA79B19S01 t1 ";
	}

	@Override
	protected RowMapper<MetadatosBusqueda> getRwMap() {
		return this.rwMap;
	}

	@Override
	protected String[] getOrderBy() {
		return MetadatosBusquedaDaoImpl.ORDER_BY_WHITE_LIST;
	}

	@Override
	protected String getPK() {
		return ID_METADATOS_BUSQUEDA;
	}

	@Override
	protected RowMapper<MetadatosBusqueda> getRwMapPK() {
		return this.rwMapPK;
	}

	@Override
	protected String getWherePK(MetadatosBusqueda bean, List<Object> params) {
		params.add(bean.getId());
		return " WHERE t1.ID_019 = ?";
	}

	@Override
	protected String getWhere(MetadatosBusqueda bean, List<Object> params) {
		StringBuilder where = new StringBuilder(MetadatosBusquedaDaoImpl.STRING_BUILDER_INIT);

		where.append(SqlUtils.generarWhereIgual("t1.ID_019", bean.getId(), params));
		where.append(SqlUtils.generarWhereLikeNormalizado("t1.DESC_ES_019", bean.getDescEs(), params, false));
		where.append(SqlUtils.generarWhereLikeNormalizado("t1.DESC_EU_019", bean.getDescEu(), params, false));
		where.append(SqlUtils.generarWhereIgual("t1.ESTADO_019", bean.getEstado(), params));

		Map<String, Object> mapWhere = new HashMap<String, Object>();
		mapWhere.put("query", where);
		mapWhere.put("params", params);

		return where.toString();
	}

	@Override
	protected String getWhereLike(MetadatosBusqueda bean, Boolean startsWith, List<Object> params, Boolean search) {
		StringBuilder where = new StringBuilder(MetadatosBusquedaDaoImpl.STRING_BUILDER_INIT);

		where.append(SqlUtils.generarWhereIgual("t1.ID_019", bean.getId(), params));
		where.append(SqlUtils.generarWhereLikeNormalizado("t1.DESC_ES_019", bean.getDescEs(), params, startsWith));
		where.append(SqlUtils.generarWhereLikeNormalizado("t1.DESC_EU_019", bean.getDescEu(), params, startsWith));
		where.append(SqlUtils.generarWhereIgual("t1.ESTADO_019", bean.getEstado(), params));

		Map<String, Object> mapWhere = new HashMap<String, Object>();
		mapWhere.put("query", where);
		mapWhere.put("params", params);

		return where.toString();
	}

	@Override
	public MetadatosBusqueda buscarPorDescIgual(MetadatosBusqueda metadatosBusqueda) {
		List<Object> params = new ArrayList<Object>();
		StringBuilder query = new StringBuilder(this.getSelect());
		query.append(this.getFrom(metadatosBusqueda, params));

		query.append(DaoConstants.WHERE);
		query.append(" t1.DESC_EU_019 " + DaoConstants.SIGNOIGUAL_INTERROGACION);
		params.add(metadatosBusqueda.getDescEu());

		List<MetadatosBusqueda> beanList = this.getJdbcTemplate().query(query.toString(), this.getRwMap(),
				params.toArray());
		return DataAccessUtils.uniqueResult(beanList);
	}
}
