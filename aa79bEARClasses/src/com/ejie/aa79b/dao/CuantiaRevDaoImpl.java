package com.ejie.aa79b.dao;

import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.List;

import org.springframework.jdbc.core.RowMapper;
import org.springframework.stereotype.Repository;
import org.springframework.transaction.annotation.Transactional;

import com.ejie.aa79b.common.BdTablesEnum;
import com.ejie.aa79b.common.DaoConstants;
import com.ejie.aa79b.common.SqlUtils;
import com.ejie.aa79b.dao.mapper.CuantiaRevRowMapper;
import com.ejie.aa79b.model.CuantiaRev;
import com.ejie.aa79b.model.enums.EstadoEnum;

/**
 * CuantiaRevDaoImpl generated by UDA, 15-dic-2017 14:11:45.
 * 
 * @author UDA
 */

@Repository
@Transactional
public class CuantiaRevDaoImpl extends GenericoDaoImpl<CuantiaRev> implements CuantiaRevDao {

    protected static final String TABLA = BdTablesEnum.CUANTIA_REV.getValue();
    protected static final String ID_ORDEN_034 = "ID_ORDEN_034";
    protected static final String PKLIST = "ID_ORDEN_034,ID_TIPO_RELEVANCIA_010";
    protected static final String COMPLETE_SELECT = "SELECT  t3.ID_030 ID030,t2.ID_TIPO_RELEVANCIA_010 IDTIPORELEVANCIA010,t1.TARIFA_ES_EU_034 TARIFAESEU034,t1.TARIFA_EU_ES_034 TARIFAEUES034, "
            + "t2.DESC_RELEVANCIA_EU_010 DESCRELEVANCIAEU010, t2.DESC_RELEVANCIA_ES_010 DESCRELEVANCIAES010 ";
    protected static final String COMPLETE_SELECT_COUNT = "SELECT COUNT(1) FROM AA79B34S01 t1 ";
    protected static final String[] ORDER_BY_WHITE_LIST = new String[] { "IDORDEN034", "IDTIPORELEVANCIA010",
            "TARIFAESEU034", "TARIFAEUES034", "DESCRELEVANCIAEU010" };

    /*
     * ROW_MAPPERS
     */
    private RowMapper<CuantiaRev> rwMap = new CuantiaRevRowMapper();

    private RowMapper<CuantiaRev> rwMapPK = new RowMapper<CuantiaRev>() {
        @Override
        public CuantiaRev mapRow(ResultSet resultSet, int rowNum) throws SQLException {
            CuantiaRev cuantiaRev = new CuantiaRev();
            cuantiaRev.setIdOrden(resultSet.getLong("ID030"));
            cuantiaRev.setIdTipoRelevancia(resultSet.getLong("IDTIPORELEVANCIA010"));
            return cuantiaRev;
        }
    };

    /**
     * Constructor
     */
    public CuantiaRevDaoImpl() {
        super(CuantiaRev.class);
    }

    @Override()
    public CuantiaRev add(CuantiaRev cuantiarev) {
        String query = "INSERT INTO AA79B34S01 (ID_ORDEN_034, ID_TIPO_RELEVANCIA_034, TARIFA_ES_EU_034, TARIFA_EU_ES_034) VALUES (?,?,?,?)";
        this.getJdbcTemplate().update(query, cuantiarev.getIdOrden(), cuantiarev.getIdTipoRelevancia(),
                cuantiarev.getTarifaEsEu(), cuantiarev.getTarifaEuEs());
        return cuantiarev;
    }

    @Override()
    public CuantiaRev update(CuantiaRev cuantiarev) {
        this.remove(cuantiarev);
        this.add(cuantiarev);
        return cuantiarev;
    }

    @Override()
    public void remove(CuantiaRev cuantiarev) {
        String query = "DELETE FROM AA79B34S01 WHERE ID_ORDEN_034=? AND ID_TIPO_RELEVANCIA_034=?";
        this.getJdbcTemplate().update(query, cuantiarev.getIdOrden(), cuantiarev.getIdTipoRelevancia());
    }

    @Override()
    protected String getSelect() {
        return COMPLETE_SELECT;
    }

    @Override()
    protected String getFrom() {
        StringBuilder query = new StringBuilder();
        query.append(" FROM AA79B34S01 t1, AA79B10S01 t2, AA79B30S01 t3");
        return query.toString();
    }

    @Override()
    protected RowMapper<CuantiaRev> getRwMap() {
        return this.rwMap;
    }

    @Override()
    protected String[] getOrderBy() {
        return CuantiaRevDaoImpl.ORDER_BY_WHITE_LIST;
    }

    @Override()
    protected String getPK() {
        return PKLIST;
    }

    @Override()
    protected RowMapper<CuantiaRev> getRwMapPK() {
        return this.rwMapPK;
    }

    @Override()
    protected String getWherePK(CuantiaRev cuantiarev, List<Object> params) {
        params.add(cuantiarev.getIdOrden());
        params.add(cuantiarev.getIdTipoRelevancia());

        return " WHERE " + this.getJoin() + "AND t3.ID_030 = ? AND t2.ID_TIPO_RELEVANCIA_010 = ? ";
    }

    @Override
    protected String getWhere(CuantiaRev cuantiarev, List<Object> params) {

        StringBuilder where = new StringBuilder(CuantiaRevDaoImpl.STRING_BUILDER_INIT);
        where.append(DaoConstants.AND).append(this.getJoin());

        if (cuantiarev != null) {
            where.append(
                    SqlUtils.generarWhereIgual("t1.ID_TIPO_RELEVANCIA_034", cuantiarev.getIdTipoRelevancia(), params));
            where.append(SqlUtils.generarWhereIgual("T3.ID_030", cuantiarev.getIdOrden(), params));
            where.append(SqlUtils.generarWhereIgual("t1.TARIFA_ES_EU_034", cuantiarev.getTarifaEsEu(), params));
            where.append(SqlUtils.generarWhereIgual("t1.TARIFA_EU_ES_034", cuantiarev.getTarifaEuEs(), params));
        }

        where.append(SqlUtils.generarWhereIgual("t2.ESTADO_010", EstadoEnum.ALTA.getValue(), params));

        return where.toString();
    }

    @Override
    protected String getWhereLike(CuantiaRev cuantiarev, Boolean startsWith, List<Object> params, Boolean search) {

        StringBuilder whereLike = new StringBuilder(CuantiaRevDaoImpl.STRING_BUILDER_INIT);

        whereLike.append(DaoConstants.AND).append(this.getJoin());
        if (cuantiarev != null) {
            whereLike.append(
                    SqlUtils.generarWhereIgual("t1.ID_TIPO_RELEVANCIA_034", cuantiarev.getIdTipoRelevancia(), params));
            whereLike.append(SqlUtils.generarWhereIgual("T3.ID_030", cuantiarev.getIdOrden(), params));
            whereLike.append(SqlUtils.generarWhereIgual("t1.TARIFA_ES_EU_034", cuantiarev.getTarifaEsEu(), params));
            whereLike.append(SqlUtils.generarWhereIgual("t1.TARIFA_EU_ES_034", cuantiarev.getTarifaEuEs(), params));
        }

        whereLike.append(SqlUtils.generarWhereIgual("t2.ESTADO_010", EstadoEnum.ALTA.getValue(), params));

        return whereLike.toString();
    }

    private String getJoin() {
        return " t3.ID_030 = t1.ID_ORDEN_034 (+) and t2.ID_TIPO_RELEVANCIA_010 = t1.ID_TIPO_RELEVANCIA_034 (+) ";
    }

    
}
