package com.ejie.aa79b.dao;

import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.List;

import org.springframework.dao.support.DataAccessUtils;
import org.springframework.jdbc.core.RowMapper;
import org.springframework.stereotype.Repository;
import org.springframework.transaction.annotation.Transactional;

import com.ejie.aa79b.common.BdTablesEnum;
import com.ejie.aa79b.common.Constants;
import com.ejie.aa79b.common.DaoConstants;
import com.ejie.aa79b.common.SqlUtils;
import com.ejie.aa79b.dao.mapper.OrdenPreciosRowMapper;
import com.ejie.aa79b.model.OrdenPrecios;

/**
 * OrdenPreciosDaoImpl generated by UDA, 15-dic-2017 14:11:45.
 * 
 * @author UDA
 */

@Repository
@Transactional
public class OrdenPreciosDaoImpl extends GenericoDaoImpl<OrdenPrecios> implements OrdenPreciosDao {

	protected static final String TABLA = BdTablesEnum.ORDEN_PRECIOS.getValue();
	protected static final String ID_030 = "ID_030";
	protected static final String ID030 = "ID";
	protected static final String COMPLETE_SELECT = "SELECT t1.ID_030 ID,t1.TITULO_030 TITULO030,t1.FECHA_VIGOR_030 FECHAVIGOR030,"
			+ "t1.FECHA_FIN_VIGOR_030 FECHAFINVIGOR030,t1.IND_VIGOR_030 INDVIGOR030,t1.URL_ORDEN_030 URLORDEN030,"
			+ "t2.ID_031 IVAID031,t2.FECHA_DESDE_VIGENCIA_031 IVAFECHADESDEVIGENCIA031,"
			+ "t2.FECHA_HASTA_VIGENCIA_031 IVAFECHAHASTAVIGENCIA031,t2.POR_IVA_031 IVAPORIVA031,t2.IND_VIGENTE_031 IVAINDVIGENTE031";
	protected static final String[] ORDER_BY_WHITE_LIST = new String[] { ID030, "TITULO030", "FECHAVIGOR030",
			"FECHAFINVIGOR030", "INDVIGOR030", "IVAPORIVA031" };
	protected static final String T1_IND_VIGOR_030 = "t1.IND_VIGOR_030";
	protected static final String T2_FECHA_HASTA_VIGENCIA = "t2.FECHA_HASTA_VIGENCIA_031";
	protected static final String T2_IND_VIGENTE_031 = "t2.IND_VIGENTE_031";
	protected static final String T1_ID_030 = "t1.ID_030";

	/*
	 * ROW_MAPPERS
	 */
	private RowMapper<OrdenPrecios> rwMap = new OrdenPreciosRowMapper();

	private RowMapper<OrdenPrecios> rwMapPK = new RowMapper<OrdenPrecios>() {
		@Override()
		public OrdenPrecios mapRow(ResultSet resultSet, int rowNum) throws SQLException {
			OrdenPrecios ordenPrecios = new OrdenPrecios();
			ordenPrecios.setId(resultSet.getLong(ID030));
			return ordenPrecios;
		}
	};

	/**
	 * Constructor
	 */
	public OrdenPreciosDaoImpl() {
		super(OrdenPrecios.class);
	}

	/**
	 * Inserts a single row in the OrdenPrecios table.
	 *
	 * @param ordenprecios
	 *            OrdenPrecios
	 * @return OrdenPrecios
	 */
	@Override()
	public OrdenPrecios add(OrdenPrecios ordenprecios) {
		final StringBuilder queryId = new StringBuilder("SELECT AA79B30Q00.NEXTVAL FROM dual ");
		final Long id = this.getJdbcTemplate().queryForObject(queryId.toString(), Long.class);
		ordenprecios.setId(id);

		String query = "INSERT INTO AA79B30S01 (ID_030, TITULO_030, FECHA_VIGOR_030, FECHA_FIN_VIGOR_030, IND_VIGOR_030, URL_ORDEN_030) VALUES (?,?,?,?,?,?)";
		this.getJdbcTemplate().update(query, ordenprecios.getId(), ordenprecios.getTitulo(),
				ordenprecios.getFechaVigor(), ordenprecios.getFechaFinVigor(),
				ordenprecios.getIndVigor() == null ? Constants.NO : ordenprecios.getIndVigor(),
				ordenprecios.getUrlOrden());
		return ordenprecios;
	}

	/**
	 * Updates a single row in the OrdenPrecios table.
	 *
	 * @param ordenprecios
	 *            OrdenPrecios
	 * @return OrdenPrecios
	 */
	@Override()
	public OrdenPrecios update(OrdenPrecios ordenprecios) {
		String query = "UPDATE AA79B30S01 SET TITULO_030=?, FECHA_VIGOR_030=?, FECHA_FIN_VIGOR_030=?, IND_VIGOR_030=?, URL_ORDEN_030=? WHERE ID_030=?";
		this.getJdbcTemplate().update(query, ordenprecios.getTitulo(), ordenprecios.getFechaVigor(),
				ordenprecios.getFechaFinVigor(),
				ordenprecios.getIndVigor() == null ? Constants.NO : ordenprecios.getIndVigor(),
				ordenprecios.getUrlOrden(), ordenprecios.getId());
		return ordenprecios;
	}

	/**
	 * Removes a single row in the OrdenPrecios table.
	 *
	 * @param ordenprecios
	 *            OrdenPrecios
	 * @return
	 */
	@Override()
	public void remove(OrdenPrecios ordenprecios) {
		String query = "DELETE FROM AA79B30S01 WHERE ID_030=?";
		this.getJdbcTemplate().update(query, ordenprecios.getId());
	}

	@Override()
	protected String getSelect() {
		return COMPLETE_SELECT;
	}

	@Override()
	protected String getFrom() {
		StringBuilder query = new StringBuilder();
		query.append(" FROM AA79B30S01 t1 ");
		query.append(" LEFT JOIN AA79B31S01 t2 ON t1.ID_030 = t2.ID_ORDEN_031 " + DaoConstants.AND + T2_IND_VIGENTE_031
				+ "= '" + Constants.SI + "'");

		return query.toString();
	}

	@Override()
	protected RowMapper<OrdenPrecios> getRwMap() {
		return this.rwMap;
	}

	@Override()
	protected String[] getOrderBy() {
		return OrdenPreciosDaoImpl.ORDER_BY_WHITE_LIST;
	}

	@Override()
	protected String getPK() {
		return ID_030;
	}

	@Override()
	protected RowMapper<OrdenPrecios> getRwMapPK() {
		return this.rwMapPK;
	}

	@Override()
	protected String getWherePK(OrdenPrecios bean, List<Object> params) {
		params.add(bean.getId());
		return " WHERE t1.ID_030 = ?";
	}

	@Override
	protected String getWhere(OrdenPrecios ordenprecios, List<Object> params) {
		StringBuilder where = new StringBuilder(OrdenPreciosDaoImpl.STRING_BUILDER_INIT);

		if (ordenprecios != null) {
			where.append(SqlUtils.generarWhereIgual(T1_ID_030, ordenprecios.getId(), params));
			where.append(
					SqlUtils.generarWhereLikeNormalizado("t1.TITULO_030", ordenprecios.getTitulo(), params, false));
			where.append(SqlUtils.generarWhereIgual("t1.FECHA_VIGOR_030", ordenprecios.getFechaVigor(), params));
			where.append(SqlUtils.generarWhereIgual("t1.FECHA_FIN_VIGOR_030", ordenprecios.getFechaFinVigor(), params));
			where.append(
					SqlUtils.generarWhereLikeNormalizado(T1_IND_VIGOR_030, ordenprecios.getIndVigor(), params, false));
			where.append(SqlUtils.generarWhereLikeNormalizado("t1.URL_ORDEN_030", ordenprecios.getUrlOrden(), params,
					false));
		}

		return where.toString();
	}

	@Override
	protected String getWhereLike(OrdenPrecios ordenprecios, Boolean startsWith, List<Object> params, Boolean search) {

		StringBuilder whereLike = new StringBuilder(OrdenPreciosDaoImpl.STRING_BUILDER_INIT);

		if (ordenprecios != null) {
			whereLike.append(SqlUtils.generarWhereIgual(T1_ID_030, ordenprecios.getId(), params));
			whereLike.append(
					SqlUtils.generarWhereLikeNormalizado("t1.TITULO_030", ordenprecios.getTitulo(), params, false));
			whereLike.append(SqlUtils.generarWhereIgual("t1.FECHA_VIGOR_030", ordenprecios.getFechaVigor(), params));
			whereLike.append(
					SqlUtils.generarWhereIgual("t1.FECHA_FIN_VIGOR_030", ordenprecios.getFechaFinVigor(), params));
			whereLike.append(
					SqlUtils.generarWhereLikeNormalizado(T1_IND_VIGOR_030, ordenprecios.getIndVigor(), params, false));
			whereLike.append(SqlUtils.generarWhereLikeNormalizado("t1.URL_ORDEN_030", ordenprecios.getUrlOrden(),
					params, false));
		}

		return whereLike.toString();
	}

	@Override()
	public Long comprobarOrdenes(OrdenPrecios ordenprecios) {
		final List<Object> params = new ArrayList<Object>();
		final StringBuilder query = new StringBuilder(OrdenPreciosDaoImpl.STRING_BUILDER_INIT);
		query.append("SELECT COUNT(1) ").append(this.getFrom());
		query.append(" WHERE 1=1 ");
		query.append(SqlUtils.generarWhereLikeNormalizado(T1_IND_VIGOR_030, ordenprecios.getIndVigor(), params, false));
		query.append(SqlUtils.generarWhereDistinto(T1_ID_030, ordenprecios.getId(), params));

		return this.getJdbcTemplate().queryForObject(query.toString(), params.toArray(), Long.class);
	}

	@Override()
	public String getUrlOrden() {
		final List<Object> params = new ArrayList<Object>();
		final StringBuilder query = new StringBuilder(OrdenPreciosDaoImpl.STRING_BUILDER_INIT);
		query.append("SELECT URL_ORDEN_030 FROM  AA79B30S01 WHERE IND_VIGOR_030 = 'S'");

		return this.getJdbcTemplate().queryForObject(query.toString(), params.toArray(), String.class);
	}

	@Override()
	public OrdenPrecios getOrdenPreciosVigente(OrdenPrecios ordenprecios) {
		final List<Object> params = new ArrayList<Object>();
		final StringBuilder query = new StringBuilder(OrdenPreciosDaoImpl.STRING_BUILDER_INIT);
		query.append(this.getSelect());
		query.append(this.getFrom());
		query.append(DaoConstants.WHERE);
		query.append("t1.IND_VIGOR_030 = ? ");
		params.add(ordenprecios.getIndVigor());

		List<OrdenPrecios> beanList = this.getJdbcTemplate().query(query.toString(), this.rwMap, params.toArray());

		return DataAccessUtils.uniqueResult(beanList);
	}
}
