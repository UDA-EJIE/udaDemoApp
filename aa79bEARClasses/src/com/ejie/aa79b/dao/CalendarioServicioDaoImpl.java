package com.ejie.aa79b.dao;

import java.sql.CallableStatement;
import java.sql.Connection;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Types;
import java.util.ArrayList;
import java.util.Date;
import java.util.List;

import org.springframework.dao.support.DataAccessUtils;
import org.springframework.jdbc.core.CallableStatementCreator;
import org.springframework.jdbc.core.RowMapper;
import org.springframework.jdbc.core.SqlParameter;
import org.springframework.stereotype.Repository;
import org.springframework.transaction.annotation.Transactional;

import com.ejie.aa79b.common.Constants;
import com.ejie.aa79b.common.SqlUtils;
import com.ejie.aa79b.model.CalendarioServicio;
import com.ejie.aa79b.utils.DateUtils;

/**
 * CalendarioServicioDaoImpl generated by UDA, 10-nov-2017 14:54:32.
 * 
 * @author UDA
 */

@Repository
@Transactional
public class CalendarioServicioDaoImpl extends GenericoDaoImpl<CalendarioServicio> implements CalendarioServicioDao {

	protected static final String ANYO_CALENDARIO_022 = "ANYO_CALENDARIO_022";
	protected static final String ANYOCALENDARIO022 = "ANYOCALENDARIO022";
	protected static final String[] ORDER_BY_WHITE_LIST = new String[] { ANYOCALENDARIO022, "VERANODESDE022",
			"VERANOHASTA022" };

	/*
	 * ROW_MAPPERS
	 */

	private RowMapper<CalendarioServicio> rwMap = new RowMapper<CalendarioServicio>() {
		@Override()
		public CalendarioServicio mapRow(ResultSet resultSet, int rowNum) throws SQLException {
			return new CalendarioServicio(resultSet.getLong(ANYOCALENDARIO022), resultSet.getDate("VERANODESDE022"),
					resultSet.getDate("VERANOHASTA022"));
		}
	};

	private RowMapper<CalendarioServicio> rwMapPK = new RowMapper<CalendarioServicio>() {
		@Override()
		public CalendarioServicio mapRow(ResultSet resultSet, int rowNum) throws SQLException {
			return new CalendarioServicio(resultSet.getLong(ANYOCALENDARIO022));
		}
	};

	/**
	 * Constructor
	 */
	public CalendarioServicioDaoImpl() {
		/* Constructor */
		super(CalendarioServicio.class);
	}

	@Override
	public CalendarioServicio add(CalendarioServicio calendarioservicio) {
		String query = "INSERT INTO AA79B22S01 (ANYO_CALENDARIO_022, VERANO_DESDE_022, VERANO_HASTA_022) VALUES (?,?,?)";
		this.getJdbcTemplate().update(query, calendarioservicio.getAnyoCalendario(),
				calendarioservicio.getVeranoDesde(), calendarioservicio.getVeranoHasta());
		return calendarioservicio;
	}

	@Override()
	public CalendarioServicio update(CalendarioServicio calendarioservicio) {
		String query = "UPDATE AA79B22S01 SET VERANO_DESDE_022=?, VERANO_HASTA_022=? WHERE ANYO_CALENDARIO_022=?";
		this.getJdbcTemplate().update(query, calendarioservicio.getVeranoDesde(), calendarioservicio.getVeranoHasta(),
				calendarioservicio.getAnyoCalendario());
		return calendarioservicio;
	}

	@Override()
	public void remove(CalendarioServicio calendarioservicio) {
		String query = "DELETE FROM AA79B22S01 WHERE ANYO_CALENDARIO_022=?";
		this.getJdbcTemplate().update(query, calendarioservicio.getAnyoCalendario());
	}

	// Â¿QUITAR?
	@Override()
	@Transactional(readOnly = true)
	public CalendarioServicio find(CalendarioServicio calendarioservicio) {
		String query = "SELECT t1.ANYO_CALENDARIO_022 ANYOCALENDARIO022, t1.VERANO_DESDE_022 VERANODESDE022, t1.VERANO_HASTA_022 VERANOHASTA022 FROM AA79B22S01 t1  WHERE t1.ANYO_CALENDARIO_022 = ?  ";

		List<CalendarioServicio> calendarioservicioList = this.getJdbcTemplate().query(query, this.rwMap,
				calendarioservicio.getAnyoCalendario());
		if (!calendarioservicioList.isEmpty()) {
			return DataAccessUtils.uniqueResult(calendarioservicioList);
		} else {
			return new CalendarioServicio();
		}

	}

	@Override()
	public void procCargaFestivosDefecto(final long elAnyo) {

		List<SqlParameter> paramList = new ArrayList<SqlParameter>();
		paramList.add(new SqlParameter(Types.NUMERIC));

		this.getJdbcTemplate().call(new CallableStatementCreator() {
			@Override()
			public CallableStatement createCallableStatement(Connection connection) throws SQLException {
				CallableStatement callableStatement = connection.prepareCall("{call CARGAR_CALENDARIO_SERVICIO(?)}");
				callableStatement.setLong(1, elAnyo);
				return callableStatement;
			}
		}, paramList);
	}

	@Override()
	protected String getSelect() {
		StringBuilder query = new StringBuilder(
				"SELECT t1.ANYO_CALENDARIO_022 ANYOCALENDARIO022, t1.VERANO_DESDE_022 VERANODESDE022, t1.VERANO_HASTA_022 VERANOHASTA022 ");
		return query.toString();
	}

	@Override()
	protected String getFrom() {
		return " FROM AA79B22S01 t1 ";
	}

	@Override()
	protected RowMapper<CalendarioServicio> getRwMap() {
		return this.rwMap;
	}

	@Override()
	protected String[] getOrderBy() {
		return CalendarioServicioDaoImpl.ORDER_BY_WHITE_LIST;
	}

	@Override()
	protected String getPK() {
		return ANYO_CALENDARIO_022;
	}

	@Override()
	protected RowMapper<CalendarioServicio> getRwMapPK() {
		return this.rwMapPK;
	}

	@Override()
	protected String getWherePK(CalendarioServicio bean, List<Object> params) {
		params.add(bean.getAnyoCalendario());
		return "  WHERE t1.ANYO_CALENDARIO_022 = ?";
	}

	@Override()
	protected String getWhere(CalendarioServicio bean, List<Object> params) {

		StringBuilder where = new StringBuilder(CalendarioServicioDaoImpl.STRING_BUILDER_INIT);
		where.append(SqlUtils.generarWhereIgual(ANYO_CALENDARIO_022, bean.getAnyoCalendario(), params));
		where.append(SqlUtils.generarWhereIgual("VERANO_DESDE_022", bean.getVeranoDesde(), params));
		where.append(SqlUtils.generarWhereIgual("VERANO_HASTA_022", bean.getVeranoHasta(), params));
		return where.toString();
	}

	@Override()
	protected String getWhereLike(CalendarioServicio bean, Boolean startsWith, List<Object> params, Boolean search) {

		StringBuilder where = new StringBuilder(CalendarioServicioDaoImpl.STRING_BUILDER_INIT);
		where.append(SqlUtils.generarWhereIgual(ANYO_CALENDARIO_022, bean.getAnyoCalendario(), params));
		where.append(SqlUtils.generarWhereIgual("VERANO_DESDE_022", bean.getVeranoDesde(), params));
		where.append(SqlUtils.generarWhereIgual("VERANO_HASTA_022", bean.getVeranoHasta(), params));
		return where.toString();
	}

	@Override()
	public List<Long> getFestivosYFinde2anyos(Date fechaInicio) {

		List<Object> params = new ArrayList<Object>();
		StringBuilder query = new StringBuilder("SELECT DIA_CALENDARIO_023 FROM AA79B23S01 WHERE 1=1");

		query.append(SqlUtils.generarWhereMayorIgualFecha("DIA_CALENDARIO_023", "DD/mm/YY",
				DateUtils.obtFechaHoraFormateada(fechaInicio, Constants.HORA_MINUTOS_CERO), params));
		List<Date> listaFechas = this.getJdbcTemplate().queryForList(query.toString(), params.toArray(), Date.class);
		List<Long> lstFechas = new ArrayList<Long>();

		if (listaFechas != null) {
			for (Date fecha : listaFechas) {
				lstFechas.add(fecha.getTime());
			}
		}

		return lstFechas;
	}

}
