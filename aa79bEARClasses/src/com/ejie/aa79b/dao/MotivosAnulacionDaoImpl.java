package com.ejie.aa79b.dao;

import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Locale;
import java.util.Map;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.support.ReloadableResourceBundleMessageSource;
import org.springframework.jdbc.core.RowMapper;
import org.springframework.stereotype.Repository;
import org.springframework.transaction.annotation.Transactional;

import com.ejie.aa79b.common.DBConstants;
import com.ejie.aa79b.common.DaoConstants;
import com.ejie.aa79b.common.SqlUtils;
import com.ejie.aa79b.model.MotivosAnulacion;
import com.ejie.aa79b.model.enums.MotivosAnulacionEnum;

/**
 * MotivosAnulacionDaoImpl generated by UDA, 16-nov-2017 12:15:12.
 * 
 * @author UDA
 */

@Repository
@Transactional
public class MotivosAnulacionDaoImpl extends GenericoDaoImpl<MotivosAnulacion> implements MotivosAnulacionDao {

	public MotivosAnulacionDaoImpl() {
		super(MotivosAnulacion.class);
	}

	@Autowired()
	private ReloadableResourceBundleMessageSource msg;

	protected static final String[] ORDER_BY_WHITE_LIST = new String[] { "ID012", "ESTADO012", "DESCES012", "DESCEU012",
			"ESTADODESCES", "ESTADODESCEU", "DESCNORMEU", "DESCNORMES" };

	/*
	 * ROW_MAPPERS
	 */
	private RowMapper<MotivosAnulacion> rwMap = new RowMapper<MotivosAnulacion>() {
		@Override
		public MotivosAnulacion mapRow(ResultSet resultSet, int rowNum) throws SQLException {
			MotivosAnulacion motivo = new MotivosAnulacion(resultSet.getLong("ID012"), resultSet.getString("DESCES012"),
					resultSet.getString("DESCEU012"), resultSet.getString("ESTADO012"));

			motivo.setDescEstadoEs(resultSet.getString("ESTADODESCES"));
			motivo.setDescEstadoEu(resultSet.getString("ESTADODESCEU"));
			return motivo;
		}
	};

	private RowMapper<MotivosAnulacion> rwMapPK = new RowMapper<MotivosAnulacion>() {
		@Override
		public MotivosAnulacion mapRow(ResultSet resultSet, int rowNum) throws SQLException {
			return new MotivosAnulacion(resultSet.getLong("ID012"), resultSet.getString("ESTADO012"),
					resultSet.getString("DESCES012"), resultSet.getString("DESCEU012"));
		}
	};

	@Override
	public MotivosAnulacion add(MotivosAnulacion motivosanulacion) {
		String query = "INSERT INTO AA79B12S01 (ID_012, ESTADO_012, DESC_ES_012, DESC_EU_012) VALUES (AA79B12Q00.NEXTVAL,?,?,?)";
		this.getJdbcTemplate().update(query, motivosanulacion.getEstado012(), motivosanulacion.getDescEs012(),
				motivosanulacion.getDescEu012());
		return motivosanulacion;
	}

	/**
	 * Updates a single row in the MotivosAnulacion table.
	 *
	 * @param motivosanulacion
	 *            MotivosAnulacion
	 * @return MotivosAnulacion
	 */
	@Override
	public MotivosAnulacion update(MotivosAnulacion motivosanulacion) {
		String query = "UPDATE AA79B12S01 SET ESTADO_012=?, DESC_ES_012=?, DESC_EU_012=? WHERE ID_012=?";
		this.getJdbcTemplate().update(query, motivosanulacion.getEstado012(), motivosanulacion.getDescEs012(),
				motivosanulacion.getDescEu012(), motivosanulacion.getId012());
		return motivosanulacion;
	}

	@Override()
	protected String getSelect() {
		Locale es = new Locale("es");
		Locale eu = new Locale("eu");
		StringBuilder selectMotivosAnulacion = new StringBuilder();

		selectMotivosAnulacion.append("SELECT  t1.ID_012 ID012");
		selectMotivosAnulacion.append(",  t1.DESC_EU_012 DESCEU012");
		selectMotivosAnulacion.append(", t1.DESC_ES_012 DESCES012");
		selectMotivosAnulacion.append(", t1.ESTADO_012 ESTADO012");
		selectMotivosAnulacion.append(", DECODE(t1.ESTADO_012, 'A', '")
				.append(this.msg.getMessage("estado.alta", null, es)).append("', 'B', '")
				.append(this.msg.getMessage("estado.baja", null, es)).append("') AS ESTADODESCES");
		selectMotivosAnulacion.append(", DECODE(t1.ESTADO_012, 'A', '")
				.append(this.msg.getMessage("estado.alta", null, eu)).append("', 'B', '")
				.append(this.msg.getMessage("estado.baja", null, eu)).append("') AS ESTADODESCEU");
		selectMotivosAnulacion.append(", ").append(SqlUtils.normalizarCampoSql("t1.DESC_EU_012"))
				.append(" AS DESCNORMEU");
		selectMotivosAnulacion.append(", ").append(SqlUtils.normalizarCampoSql("t1.DESC_ES_012"))
				.append(" AS DESCNORMES");
		return selectMotivosAnulacion.toString();
	}

	@Override()
	protected String getFrom() {
		return " FROM AA79B12S01 t1 ";
	}

	@Override()
	protected RowMapper<MotivosAnulacion> getRwMap() {
		return this.rwMap;
	}

	@Override()
	protected String[] getOrderBy() {
		return MotivosAnulacionDaoImpl.ORDER_BY_WHITE_LIST;
	}

	@Override()
	protected String getPK() {
		return "ID_012";
	}

	@Override()
	protected RowMapper<MotivosAnulacion> getRwMapPK() {
		return this.rwMapPK;
	}

	@Override()
	protected String getWherePK(MotivosAnulacion bean, List<Object> params) {
		params.add(bean.getId012());
		return " WHERE t1.ID_012 = ?";
	}

	@Override
	protected String getWhere(MotivosAnulacion bean, List<Object> params) {

		StringBuilder where = new StringBuilder(MotivosAnulacionDaoImpl.STRING_BUILDER_INIT);

		where.append(SqlUtils.generarWhereIgual("t1.ID_012", bean.getId012(), params));

		where.append(SqlUtils.generarWhereLikeNormalizado("t1.DESC_ES_012", bean.getDescEs012(), params, false));

		where.append(SqlUtils.generarWhereLikeNormalizado("t1.DESC_EU_012", bean.getDescEu012(), params, false));

		where.append(SqlUtils.generarWhereIgual("t1.ESTADO_012", bean.getEstado012(), params));

		Map<String, Object> mapWhere = new HashMap<String, Object>();
		mapWhere.put("query", where);
		mapWhere.put("params", params);

		return where.toString();
	}

	@Override
	protected String getWhereLike(MotivosAnulacion bean, Boolean startsWith, List<Object> params, Boolean search) {
		StringBuilder where = new StringBuilder(MotivosAnulacionDaoImpl.STRING_BUILDER_INIT);

		where.append(SqlUtils.generarWhereIgual("t1.ID_012", bean.getId012(), params));

		where.append(SqlUtils.generarWhereLikeNormalizado("t1.DESC_ES_012", bean.getDescEs012(), params, startsWith));

		where.append(SqlUtils.generarWhereLikeNormalizado("t1.DESC_EU_012", bean.getDescEu012(), params, startsWith));

		where.append(SqlUtils.generarWhereIgual("t1.ESTADO_012", bean.getEstado012(), params));

		Map<String, Object> mapWhere = new HashMap<String, Object>();
		mapWhere.put("query", where);
		mapWhere.put("params", params);

		return where.toString();
	}

	@Override()
	public List<MotivosAnulacion> findAllMotivosAnulacion(MotivosAnulacion bean) {
		List<Object> params = new ArrayList<Object>();
		StringBuilder query = new StringBuilder(this.getSelect());
		query.append(this.getFrom(bean, params));

		query.append(GenericoDaoImpl.DEFAULT_WHERE);
		query.append(SqlUtils.generarWhereIgual(DaoConstants.T1_MINUSCULA + DaoConstants.SIGNO_PUNTO + "ESTADO_012",
				bean.getEstado012(), params));
		query.append(DaoConstants.AND);
		query.append(DaoConstants.BLANK);
		query.append(DaoConstants.T1_MINUSCULA);
		query.append(DaoConstants.SIGNO_PUNTO);
		query.append(DBConstants.ID_012);
		query.append(DaoConstants.BLANK);
		query.append(DaoConstants.IN);
		query.append(DaoConstants.ABRIR_PARENTESIS);
		query.append(MotivosAnulacionEnum.PLAZO_SUBS_EXPIRADO.getValue());
		query.append(DaoConstants.SIGNO_COMA);
		query.append(MotivosAnulacionEnum.PRESUP_NO_ACEPTADO_PLAZO.getValue());
		query.append(DaoConstants.SIGNO_COMA);
		query.append(MotivosAnulacionEnum.FECHA_PROP_NO_ACEPTADA_PLAZO.getValue());
		query.append(DaoConstants.SIGNO_COMA);
		query.append(MotivosAnulacionEnum.FECHA_PROP_RECHAZADA.getValue());
		query.append(DaoConstants.CERRAR_PARENTESIS);

		return this.getJdbcTemplate().query(query.toString(), this.getRwMap(), params.toArray());
	}

}
