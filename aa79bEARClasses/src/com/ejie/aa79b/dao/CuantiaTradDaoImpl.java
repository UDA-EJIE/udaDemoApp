package com.ejie.aa79b.dao;

import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.List;

import org.springframework.jdbc.core.RowMapper;
import org.springframework.stereotype.Repository;
import org.springframework.transaction.annotation.Transactional;

import com.ejie.aa79b.common.BdTablesEnum;
import com.ejie.aa79b.common.DaoConstants;
import com.ejie.aa79b.common.SqlUtils;
import com.ejie.aa79b.dao.mapper.CuantiaTradRowMapper;
import com.ejie.aa79b.model.CuantiaTrad;
import com.ejie.aa79b.model.enums.EstadoEnum;

/**
 * CuantiaTradDaoImpl generated by UDA, 15-dic-2017 14:11:45.
 * 
 * @author UDA
 */

@Repository
@Transactional
public class CuantiaTradDaoImpl extends GenericoDaoImpl<CuantiaTrad> implements CuantiaTradDao {

    protected static final String TABLA = BdTablesEnum.CUANTIA_TRAD.getValue();
    protected static final String ID_ORDEN_033 = "ID_ORDEN_033";
    protected static final String PKLIST = "ID_ORDEN_033,ID_TIPO_RELEVANCIA_010";
    protected static final String COMPLETE_SELECT = "SELECT  t3.ID_030 ID030,t2.ID_TIPO_RELEVANCIA_010 IDTIPORELEVANCIA010,t1.TARIFA_ES_EU_033 TARIFAESEU033,t1.TARIFA_EU_ES_033 TARIFAEUES033, "
            + "t2.DESC_RELEVANCIA_EU_010 DESCRELEVANCIAEU010, t2.DESC_RELEVANCIA_ES_010 DESCRELEVANCIAES010 ";
    protected static final String COMPLETE_SELECT_COUNT = "SELECT COUNT(1) FROM AA79B33S01 t1 ";
    protected static final String[] ORDER_BY_WHITE_LIST = new String[] { "IDORDEN033", "IDTIPORELEVANCIA010",
            "TARIFAESEU033", "TARIFAEUES033", "DESCRELEVANCIAEU010" };

    /*
     * ROW_MAPPERS
     */
    private RowMapper<CuantiaTrad> rwMap = new CuantiaTradRowMapper();

    private RowMapper<CuantiaTrad> rwMapPK = new RowMapper<CuantiaTrad>() {
        @Override
        public CuantiaTrad mapRow(ResultSet resultSet, int rowNum) throws SQLException {
            CuantiaTrad cuantiaTrad = new CuantiaTrad();
            cuantiaTrad.setIdOrden(resultSet.getLong("ID030"));
            cuantiaTrad.setIdTipoRelevancia(resultSet.getLong("IDTIPORELEVANCIA010"));
            return cuantiaTrad;
        }
    };

    /**
     * Constructor
     */
    public CuantiaTradDaoImpl() {
        super(CuantiaTrad.class);
    }

    @Override()
    public CuantiaTrad add(CuantiaTrad cuantiatrad) {
        String query = "INSERT INTO AA79B33S01 (ID_ORDEN_033, ID_TIPO_RELEVANCIA_033, TARIFA_ES_EU_033, TARIFA_EU_ES_033) VALUES (?,?,?,?)";
        this.getJdbcTemplate().update(query, cuantiatrad.getIdOrden(), cuantiatrad.getIdTipoRelevancia(),
                cuantiatrad.getTarifaEsEu(), cuantiatrad.getTarifaEuEs());
        return cuantiatrad;
    }

    @Override()
    public CuantiaTrad update(CuantiaTrad cuantiatrad) {
        this.remove(cuantiatrad);
        this.add(cuantiatrad);
        return cuantiatrad;
    }

    @Override()
    public void remove(CuantiaTrad cuantiatrad) {
        String query = "DELETE FROM AA79B33S01 WHERE ID_ORDEN_033=? AND ID_TIPO_RELEVANCIA_033=?";
        this.getJdbcTemplate().update(query, cuantiatrad.getIdOrden(), cuantiatrad.getIdTipoRelevancia());
    }

    @Override()
    protected String getSelect() {
        return COMPLETE_SELECT;
    }

    @Override()
    protected String getFrom() {
        StringBuilder query = new StringBuilder();
        query.append(" FROM AA79B33S01 t1, AA79B10S01 t2, AA79B30S01 t3");
        return query.toString();
    }

    @Override()
    protected RowMapper<CuantiaTrad> getRwMap() {
        return this.rwMap;
    }

    @Override()
    protected String[] getOrderBy() {
        return CuantiaTradDaoImpl.ORDER_BY_WHITE_LIST;
    }

    @Override()
    protected String getPK() {
        return PKLIST;
    }

    @Override()
    protected RowMapper<CuantiaTrad> getRwMapPK() {
        return this.rwMapPK;
    }

    @Override()
    protected String getWherePK(CuantiaTrad cuantiatrad, List<Object> params) {
        params.add(cuantiatrad.getIdOrden());
        params.add(cuantiatrad.getIdTipoRelevancia());

        return " WHERE " + this.getJoin() + "AND t3.ID_030 = ? AND t2.ID_TIPO_RELEVANCIA_010 = ? ";
    }

    @Override
    protected String getWhere(CuantiaTrad cuantiatrad, List<Object> params) {

        StringBuilder where = new StringBuilder(CuantiaTradDaoImpl.STRING_BUILDER_INIT);
        where.append(DaoConstants.AND).append(this.getJoin());

        if (cuantiatrad != null) {
            where.append(
                    SqlUtils.generarWhereIgual("t1.ID_TIPO_RELEVANCIA_033", cuantiatrad.getIdTipoRelevancia(), params));
            where.append(SqlUtils.generarWhereIgual("T3.ID_030", cuantiatrad.getIdOrden(), params));
            where.append(SqlUtils.generarWhereIgual("t1.TARIFA_ES_EU_033", cuantiatrad.getTarifaEsEu(), params));
            where.append(SqlUtils.generarWhereIgual("t1.TARIFA_EU_ES_033", cuantiatrad.getTarifaEuEs(), params));
        }

        where.append(SqlUtils.generarWhereIgual("t2.ESTADO_010", EstadoEnum.ALTA.getValue(), params));

        return where.toString();
    }

    @Override
    protected String getWhereLike(CuantiaTrad cuantiatrad, Boolean startsWith, List<Object> params, Boolean search) {

        StringBuilder whereLike = new StringBuilder(CuantiaTradDaoImpl.STRING_BUILDER_INIT);

        whereLike.append(DaoConstants.AND).append(this.getJoin());
        if (cuantiatrad != null) {
            whereLike.append(
                    SqlUtils.generarWhereIgual("t1.ID_TIPO_RELEVANCIA_033", cuantiatrad.getIdTipoRelevancia(), params));
            whereLike.append(SqlUtils.generarWhereIgual("T3.ID_030", cuantiatrad.getIdOrden(), params));
            whereLike.append(SqlUtils.generarWhereIgual("t1.TARIFA_ES_EU_033", cuantiatrad.getTarifaEsEu(), params));
            whereLike.append(SqlUtils.generarWhereIgual("t1.TARIFA_EU_ES_033", cuantiatrad.getTarifaEuEs(), params));
        }

        whereLike.append(SqlUtils.generarWhereIgual("t2.ESTADO_010", EstadoEnum.ALTA.getValue(), params));

        return whereLike.toString();
    }

    private String getJoin() {
        return " t3.ID_030 = t1.ID_ORDEN_033 (+) and t2.ID_TIPO_RELEVANCIA_010 = t1.ID_TIPO_RELEVANCIA_033 (+) ";
    }
    
}
