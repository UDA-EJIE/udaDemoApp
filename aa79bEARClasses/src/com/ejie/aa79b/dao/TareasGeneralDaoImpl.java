package com.ejie.aa79b.dao;

import java.math.BigDecimal;
import java.sql.CallableStatement;
import java.sql.Connection;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Types;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;
import java.util.Locale;

import javax.annotation.Resource;
import javax.sql.DataSource;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.i18n.LocaleContextHolder;
import org.springframework.context.support.ReloadableResourceBundleMessageSource;
import org.springframework.dao.support.DataAccessUtils;
import org.springframework.jdbc.core.CallableStatementCallback;
import org.springframework.jdbc.core.CallableStatementCreator;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.jdbc.core.RowMapper;
import org.springframework.jdbc.core.SqlParameter;
import org.springframework.stereotype.Repository;
import org.springframework.transaction.annotation.Transactional;

import com.ejie.aa79b.common.Constants;
import com.ejie.aa79b.common.DBConstants;
import com.ejie.aa79b.common.DaoConstants;
import com.ejie.aa79b.common.SqlUtils;
import com.ejie.aa79b.dao.mapper.DocTareasDocsRevEntregaClteRowMapper;
import com.ejie.aa79b.dao.mapper.DocTareasDocsTradEntregaClteRowMapper;
import com.ejie.aa79b.dao.mapper.DocsDetalleTareaRowMapper;
import com.ejie.aa79b.dao.mapper.DocsTareaOrigenNoConformidadRevisionRowMapper;
import com.ejie.aa79b.dao.mapper.DocsTareaOrigenNoConformidadTraduccionRowMapper;
import com.ejie.aa79b.dao.mapper.DocsTareaOrigenNoConformidadTraductorRowMapper;
import com.ejie.aa79b.dao.mapper.DocsXliffTareaOrigenNoConformidadTraduccionRowMapper;
import com.ejie.aa79b.dao.mapper.DocumentoJustificanteRowMapper;
import com.ejie.aa79b.dao.mapper.DocumentoTareaRevisionRowMapper;
import com.ejie.aa79b.dao.mapper.DocumentoTareaRowMapper;
import com.ejie.aa79b.dao.mapper.DocumentoTareaXliffGroupRowMapper;
import com.ejie.aa79b.dao.mapper.DocumentoTareaXliffRowMapper;
import com.ejie.aa79b.dao.mapper.DocumentoTareasRevEntregaClteRowMapper;
import com.ejie.aa79b.dao.mapper.DocumentoTareasRevTradExtRowMapper;
import com.ejie.aa79b.dao.mapper.DocumentoTareasRevTradIntRowMapper;
import com.ejie.aa79b.dao.mapper.DocumentoTareasTraduccionFirmaRowMapper;
import com.ejie.aa79b.dao.mapper.DocumentoTareasTraduccionRowMapper;
import com.ejie.aa79b.dao.mapper.DocumentosTareaRowMapper;
import com.ejie.aa79b.dao.mapper.TareaTradosRowMapper;
import com.ejie.aa79b.dao.mapper.TareasBasicasRowMapper;
import com.ejie.aa79b.dao.mapper.TareasIdabaRowMapper;
import com.ejie.aa79b.model.DatosPagoProveedores;
import com.ejie.aa79b.model.DatosTareaTrados;
import com.ejie.aa79b.model.DocumentoTarea;
import com.ejie.aa79b.model.DocumentoTareaAdjunto;
import com.ejie.aa79b.model.DocumentosExpediente;
import com.ejie.aa79b.model.Entidad;
import com.ejie.aa79b.model.Expediente;
import com.ejie.aa79b.model.ExpedienteTradRev;
import com.ejie.aa79b.model.LimitePresupuesto;
import com.ejie.aa79b.model.Lotes;
import com.ejie.aa79b.model.PersonalIZO;
import com.ejie.aa79b.model.TareaIdaba;
import com.ejie.aa79b.model.TareaTrados;
import com.ejie.aa79b.model.Tareas;
import com.ejie.aa79b.model.TradosExp;
import com.ejie.aa79b.model.enums.ActivoEnum;
import com.ejie.aa79b.model.enums.ClasificacionDocumentosEnum;
import com.ejie.aa79b.model.enums.EstadoEjecucionTareaEnum;
import com.ejie.aa79b.model.enums.TipoExpedienteEnum;
import com.ejie.aa79b.model.enums.TipoExpedienteGrupoEnum;
import com.ejie.aa79b.model.enums.TipoTareaGestionAsociadaEnum;
import com.ejie.aa79b.utils.DAOUtils;
import com.ejie.aa79b.utils.Utils;
import com.ejie.x38.dto.JQGridManager;
import com.ejie.x38.dto.JQGridRequestDto;

/**
 * DocumentoTareaDaoImpl generated by UDA, 14-Jul-18 15:23:30.
 *
 * @author UDA
 */

@Repository
@Transactional
public class TareasGeneralDaoImpl implements TareasGeneralDao {

	@Autowired()
	private ReloadableResourceBundleMessageSource msg;

	private JdbcTemplate jdbcTemplate;

	protected static final String ID_018 = "ID_018";
	protected static final String T1ID_TAREA_083 = "t1.ID_TAREA_083";
	protected static final String T2ID_DOC_056 = "t2.ID_DOC_056";
	protected static final String T1ANYO_051 = "t1.ANYO_051";
	protected static final String T1NUM_EXP_051 = "t1.NUM_EXP_051";
	protected static final String T2IND_PUBLICAR_BOPV_053 = "t2.IND_PUBLICAR_BOPV_053";
	protected static final String T2IND_URGENTE_053 = "t2.IND_URGENTE_053";
	protected static final String T2IND_DIFICIL_053 = "t2.IND_DIFICIL_053";
	protected static final String AND_ID_DOC_056_EQUALS = "AND ID_DOC_056 = ?";
	protected static final String ACTIVOENUM = "ActivoEnum";
	protected static final String DOCORIGINAL_CLASE_DOCUMENTO_056 = "docOriginal.CLASE_DOCUMENTO_056";
	protected static final String ID_TAREA_083COMA = " ID_TAREA_083, ";
	protected static final String FROM_AA79B83S01_T1 = " FROM AA79B83S01 t1 ";
	protected static final String LEFT_JOIN_AA79B56S01_ON_ID_DOC_83 = " LEFT JOIN AA79B56S01 t2 ON t1.ID_DOC_083 = ";
	protected static final String SELECT_COUNT1_FROM = "SELECT COUNT(1) FROM ( ";
	protected static final String T3_CLASE_DOCUMENTO_056_EQUALS = " t3.CLASE_DOCUMENTO_056 = ";
	protected static final String TIPOSTAREA_DESC_ES_015_TIPOSTAREAES = " tiposTarea.DESC_ES_015 TIPOTAREAES, ";
	protected static final String TIPOSTAREA_DESC_EU_015_TIPOSTAREAEU = " tiposTarea.DESC_EU_015 TIPOTAREAEU, ";
	protected static final String LOTES_NOMBRE_LOTE_029_NOMBRELOTE = " lotes.NOMBRE_LOTE_029 NOMBRELOTE, ";
	protected static final String ENTIDADESSOLIC_DESC_ES_DESCES = " entidadesSolic.DESC_ES DESCES, ";
	protected static final String ENTIDADESSOLIC_DESC_EU_DESCEU = " entidadesSolic.DESC_EU DESCEU, ";
	protected static final String EJECUCIONTAREAS_FECHA_EJECUCION_082_FECHAEJECUCIONTAREA = " ejecucionTareas.FECHA_EJECUCION_082 FECHAEJECUCIONTAREA, ";
	protected static final String EJECUCIONTAREAS_IND_OBSV_082_INDOBSERVACIONES = DaoConstants.BLANK
			+ DaoConstants.EJECUCION_TAREAS_MINUSCULA + DaoConstants.SIGNO_PUNTO + DBConstants.IND_OBSV_082
			+ DaoConstants.BLANK + DBConstants.INDOBSERVACIONES + DaoConstants.SIGNO_COMA;
	protected static final String FROM_81_T1 = "FROM AA79B81S01 t1";
	protected static final String LEFTJOIN15ON81 = "LEFT JOIN AA79B15S01 a1 ON t1.ID_TIPO_TAREA_081 = a1.ID_015 ";
	protected static final String TIPOSTAREA_ID_015 = "tiposTarea.ID_015";
	protected static final String X54JAPI_ENTIDADES_ON_LOTES_EQUALS_TIPO_AND_CODIGO = "X54JAPI_ENTIDADES_SOLIC entidadesSolic ON lotes.TIPO_ENTIDAD_029 = entidadesSolic.TIPO AND lotes.ID_EMPRESA_PROV_029 = entidadesSolic.CODIGO ";
	protected static final String DOCJUSTIFICANTE_IND_VISIBLE_093_INDVISIBLEDOCJUST = " docJustificante.IND_VISIBLE_093 INDVISIBLEDOCJUST, ";
	protected static final String JUSTIFICANTE_TITULO_FICHERO_088_TITULODOCJUST = " justificante.TITULO_FICHERO_088 TITULODOCJUST, ";
	protected static final String JUSTIFICANTE_OID_FICHERO_088_OIDFICHERODOCJUST = " justificante.OID_FICHERO_088 OIDFICHERODOCJUST, ";
	protected static final String JUSTIFICANTE_IND_ENCRIPTADO_088_INDENCRIPTDOCJUST = " justificante.IND_ENCRIPTADO_088 INDENCRIPTDOCJUST, ";
	protected static final String AA7956_PAREJADOC_ON_DOCORIGINAL = "AA79B56S01 parejaDocOriginal ON parejaDocOriginal.ID_DOC_REL_056 = docOriginal.ID_DOC_056 ";
	protected static final String AA7988_JUSTIFICANTE_ON_DOCJUSTIFICANTE = "AA79B88S01 justificante ON docJustificante.ID_FICHERO_JUSTIFICANTE_093 = justificante.ID_FICHERO_088 ";
	protected static final String DOCUMENTOSTAREA_ID_TAREA_083 = DaoConstants.DOCUMENTOS_TAREA_MINUSCULA
			+ DaoConstants.SIGNO_PUNTO + DBConstants.ID_TAREA_083;
	protected static final String TAREAS_ID_TAREA_081 = DaoConstants.TAREAS + DaoConstants.SIGNO_PUNTO
			+ DBConstants.ID_TAREA_081;

	private RowMapper<DocumentoTarea> rwMap = new DocumentoTareaRowMapper();
	private RowMapper<TradosExp> rwMaptrados = new TradosRowMapper();
	private RowMapper<TareaTrados> rwMapTareaTrados = new TareaTradosRowMapper();
	private RowMapper<TareaIdaba> rwMapTareasIdaba = new TareasIdabaRowMapper();
	private RowMapper<DocumentoTarea> rwMapDocTareasTraduccion = new DocumentoTareasTraduccionRowMapper();
	private RowMapper<Tareas> rwMapDocTareasTraduccionFirma = new DocumentoTareasTraduccionFirmaRowMapper();
	private RowMapper<DocumentoTarea> rwMapDocTareasRevision = new DocumentoTareaRevisionRowMapper();
	private RowMapper<DocumentoTarea> rwMapDocJustificante = new DocumentoJustificanteRowMapper();
	private RowMapper<DocumentoTarea> rwMapDocTareasXliff = new DocumentoTareaXliffRowMapper();
	private RowMapper<DocumentoTarea> rwMapDocTareasGroupXliff = new DocumentoTareaXliffGroupRowMapper();
	private RowMapper<DocumentoTarea> rwMapDocsTareaOrigenNoConformidadTraduccion = new DocsTareaOrigenNoConformidadTraduccionRowMapper();
	private RowMapper<DocumentoTarea> rwMapDocsXliffTareaOrigenNoConformidadTraduccion = new DocsXliffTareaOrigenNoConformidadTraduccionRowMapper();
	private RowMapper<DocumentoTarea> rwMapDocsTareaOrigenNoConformidadRevision = new DocsTareaOrigenNoConformidadRevisionRowMapper();
	private RowMapper<DocumentoTarea> rwMapDocsTareaOrigenNoConformidadTraductor = new DocsTareaOrigenNoConformidadTraductorRowMapper();

	private RowMapper<TareaIdaba> rwMapTipoDocTareaIdaba = new RowMapper<TareaIdaba>() {
		@Override
		public TareaIdaba mapRow(ResultSet resultSet, int rowNum) throws SQLException {
			final TareaIdaba tareaIdaba = new TareaIdaba();
			tareaIdaba.setDescDoces(resultSet.getString("DESCDOCES"));
			tareaIdaba.setDescDoceu(resultSet.getString("DESCDOCEU"));
			return tareaIdaba;
		}

	};
	private RowMapper<TareaIdaba> rwMapEntidad = new RowMapper<TareaIdaba>() {
		@Override
		public TareaIdaba mapRow(ResultSet resultSet, int rowNum) throws SQLException {
			final TareaIdaba tareaIdaba = new TareaIdaba();
			tareaIdaba.setDescEntidades(resultSet.getString("DESCENTIDES"));
			tareaIdaba.setDescEntidadeu(resultSet.getString("DESCENTIDEU"));
			return tareaIdaba;
		}
	};

	private RowMapper<Expediente> rwMapObtenerAnyoNumexpEstadoBitacora = new RowMapper<Expediente>() {
		@Override
		public Expediente mapRow(ResultSet resultSet, int rowNum) throws SQLException {
			final Expediente expediente = new Expediente();
			expediente.setAnyo(resultSet.getLong(DBConstants.ANYO));
			expediente.setNumExp(resultSet.getInt(DBConstants.NUMEXP));
			expediente.setEstadoBitacora(resultSet.getLong(DBConstants.ESTADOBITACORA));
			ExpedienteTradRev expedienteTradRev = new ExpedienteTradRev();
			DatosTareaTrados datosTareaTrados = new DatosTareaTrados();
			datosTareaTrados.setIdTarea(resultSet.getBigDecimal(DBConstants.IDTAREA));
			expedienteTradRev.setTradosExp(datosTareaTrados);
			expediente.setExpedienteTradRev(expedienteTradRev);
			return expediente;
		}
	};

	private RowMapper<DocumentosExpediente> rwMapDocumentosTarea = new DocumentosTareaRowMapper();

	private RowMapper<DocumentoTarea> rwMapTrados = new RowMapper<DocumentoTarea>() {
		@Override
		public DocumentoTarea mapRow(ResultSet resultSet, int rowNum) throws SQLException {
			final DocumentoTarea documentoTarea = new DocumentoTarea();
			documentoTarea.setIdTarea(resultSet.getBigDecimal("ID_TAREA_081"));
			final DocumentoTareaAdjunto docAdjunto = new DocumentoTareaAdjunto();
			docAdjunto.setIdFichero(resultSet.getBigDecimal("ID_FICHERO_088"));
			docAdjunto.setOid(resultSet.getString("OID_FICHERO_088"));
			docAdjunto.setNombre(resultSet.getString("NOMBRE_FICHERO_088"));
			documentoTarea.setDocumentoAdjunto(docAdjunto);
			final DocumentosExpediente documentosExpediente = new DocumentosExpediente();
			documentosExpediente.setAnyo(resultSet.getLong("ANYO_081"));
			documentosExpediente.setNumExp(resultSet.getInt("NUM_EXP_081"));
			documentoTarea.setDocumentoOriginal(documentosExpediente);

			return documentoTarea;
		}

	};

	private RowMapper<Tareas> rwMapDocsTareaRevTradExt = new DocumentoTareasRevTradExtRowMapper();
	private RowMapper<Tareas> rwMapDocsTareaRevTradInt = new DocumentoTareasRevTradIntRowMapper();
	private RowMapper<Tareas> rwMapDocsRevEntregaClte = new DocumentoTareasRevEntregaClteRowMapper();
	private RowMapper<Tareas> rwMapDocsRevidadosEntregaClte = new DocTareasDocsRevEntregaClteRowMapper();
	private RowMapper<Tareas> rwMapDocsTraducidosEntregaClte = new DocTareasDocsTradEntregaClteRowMapper();
	private RowMapper<DocumentoTarea> rwMapDocsDetalleTarea = new DocsDetalleTareaRowMapper();

	private RowMapper<Lotes> rwMapDatosLoteAsignado = new RowMapper<Lotes>() {
		@Override
		public Lotes mapRow(ResultSet resultSet, int rowNum) throws SQLException {
			final Lotes lote = new Lotes();
			lote.setPorRecargoFormato(resultSet.getLong("POR_RECARGO_FORMATO_029"));
			lote.setIndRecargoApremio(resultSet.getString("IND_RECARGO_APREMIO_029"));
			lote.setPorRecargoApremio(resultSet.getLong("POR_RECARGO_APREMIO_029"));
			lote.setIdTipoPenalizacion(resultSet.getString("ID_TIPO_PENALIZACION_029"));
			lote.setPorPenalizacion(resultSet.getLong("POR_PENALIZACION_029"));
			return lote;
		}

	};

	private RowMapper<DatosPagoProveedores> rwMapDatosDePagoAProveedorAsignado = new RowMapper<DatosPagoProveedores>() {
		@Override
		public DatosPagoProveedores mapRow(ResultSet resultSet, int rowNum) throws SQLException {
			final DatosPagoProveedores datosPagoProveedores = new DatosPagoProveedores();
			datosPagoProveedores.setIdTarea(resultSet.getBigDecimal("ID_TAREA_094"));
			datosPagoProveedores.setIndRecargoFormato(resultSet.getString("IND_RECARGO_FORMATO_094"));
			datosPagoProveedores.setNumPalRecargoFormato(resultSet.getInt("NUM_PAL_RECARGO_FORMATO_094"));
			datosPagoProveedores.setIndRecargoApremio(resultSet.getString("IND_RECARGO_APREMIO_094"));
			datosPagoProveedores.setPorRecargoApremio(resultSet.getLong("POR_RECARGO_APREMIO_094"));
			datosPagoProveedores.setIndPenalizacion(resultSet.getString("IND_PENALIZACION_094"));
			datosPagoProveedores.setPorPenalizacion(resultSet.getLong("POR_PENALIZACION_094"));
			datosPagoProveedores.setNivelCalidad(resultSet.getString("NIVEL_CALIDAD_094"));
			return datosPagoProveedores;
		}

	};

	private RowMapper<DatosTareaTrados> rwMapTareaTradosEjec = new RowMapper<DatosTareaTrados>() {
		@Override
		public DatosTareaTrados mapRow(ResultSet resultSet, int rowNum) throws SQLException {
			final DatosTareaTrados datosTareaTrados = new DatosTareaTrados();
			datosTareaTrados.setNumTotalPal(resultSet.getInt(DBConstants.NUMTOTALPAL));
			datosTareaTrados.setNumPalConcor084(resultSet.getInt(DBConstants.NUMPALCONCOR084));
			datosTareaTrados.setNumPalConcor8594(resultSet.getInt(DBConstants.NUMPALCONCOR8594));
			datosTareaTrados.setNumPalConcor95100(resultSet.getInt(DBConstants.NUMPALCONCOR95100));
			datosTareaTrados.setNumPalConcor9599(resultSet.getInt(DBConstants.NUMPALCONCOR9599));
			datosTareaTrados.setNumPalConcor100(resultSet.getInt(DBConstants.NUMPALCONCOR100));
			return datosTareaTrados;
		}

	};

	private RowMapper<DatosTareaTrados> rwMapTareaTradosSinEjec = new RowMapper<DatosTareaTrados>() {
		@Override
		public DatosTareaTrados mapRow(ResultSet resultSet, int rowNum) throws SQLException {
			final DatosTareaTrados datosTareaTrados = new DatosTareaTrados();
			datosTareaTrados.setNumTotalPal(resultSet.getInt(DBConstants.NUMTOTALPAL));
			return datosTareaTrados;
		}

	};

	private RowMapper<PersonalIZO> rwMapPersonasPorRecursoAsig = new RowMapper<PersonalIZO>() {
		@Override
		public PersonalIZO mapRow(ResultSet resultSet, int rowNum) throws SQLException {
			final PersonalIZO personalIZO = new PersonalIZO();
			personalIZO.setDni(resultSet.getString(DBConstants.DNIRECURSO));
			personalIZO.setNombre(resultSet.getString(DBConstants.NOMBRE));
			personalIZO.setApellido1(resultSet.getString(DBConstants.APEL1));
			personalIZO.setApellido2(resultSet.getString(DBConstants.APEL2));
			return personalIZO;
		}
	};

	private RowMapper<PersonalIZO> rwMapProvedoresPorRecursoAsig = new RowMapper<PersonalIZO>() {
		@Override
		public PersonalIZO mapRow(ResultSet resultSet, int rowNum) throws SQLException {
			final PersonalIZO personalIZO = new PersonalIZO();
			Entidad bean = new Entidad();
			bean.setTipo(resultSet.getString(DBConstants.TIPO));
			bean.setCodigo(resultSet.getInt(DBConstants.CODIGO));
			bean.setDescEs(resultSet.getString(DBConstants.DESCES));
			bean.setDescEu(resultSet.getString(DBConstants.DESCEU));
			personalIZO.setEntidad(bean);
			return personalIZO;
		}
	};

	private RowMapper<LimitePresupuesto> rwMapLimitePresupuesto = new RowMapper<LimitePresupuesto>() {
		@Override
		public LimitePresupuesto mapRow(ResultSet resultSet, int arg1) throws SQLException {
			LimitePresupuesto limitePresupuesto = new LimitePresupuesto();
			limitePresupuesto.setFechaPropuesta(resultSet.getDate(DBConstants.FECHAPROPUESTA));
			limitePresupuesto.setHoraPropuesta(resultSet.getString(DBConstants.HORAPROPUESTA));
			limitePresupuesto.setFechaLimite(resultSet.getDate(DBConstants.FECHALIMITE));
			limitePresupuesto.setHoraLimite(resultSet.getString(DBConstants.HORALIMITE));
			return limitePresupuesto;
		}
	};
	private RowMapper<ExpedienteTradRev> rwMapInfoExp = new RowMapper<ExpedienteTradRev>() {
		@Override
		public ExpedienteTradRev mapRow(ResultSet resultSet, int arg1) throws SQLException {
			ExpedienteTradRev expedienteTradRev = new ExpedienteTradRev();
			expedienteTradRev.setAnyo(resultSet.getLong(DBConstants.ANYO));
			expedienteTradRev.setNumExp(resultSet.getInt(DBConstants.NUMEXP));
			expedienteTradRev.setRefTramitagune(resultSet.getString("REFTRAMITAGUNE"));
			return expedienteTradRev;
		}
	};

	public RowMapper<TradosExp> getRwMapTrados() {
		return this.rwMaptrados;
	}

	public RowMapper<DocumentosExpediente> getRwMaprwMapDocumentosTarea() {
		return this.rwMapDocumentosTarea;
	}

	public RowMapper<TareaTrados> getRwMapTareaTrados() {
		return this.rwMapTareaTrados;
	}

	public RowMapper<DocumentoTarea> getRwMap() {
		return this.rwMap;
	}

	public RowMapper<TareaIdaba> getRwMapTareasIdaba() {
		return this.rwMapTareasIdaba;
	}

	public RowMapper<TareaIdaba> getRwMapTipoDocTareaIdaba() {
		return this.rwMapTipoDocTareaIdaba;
	}

	public RowMapper<LimitePresupuesto> getRwMapLimitePresupuesto() {
		return this.rwMapLimitePresupuesto;
	}

	public JdbcTemplate getJdbcTemplate() {
		return this.jdbcTemplate;
	}

	@Resource()
	public void setDataSource(DataSource dataSource) {
		this.jdbcTemplate = new JdbcTemplate(dataSource);
	}

	/* Tareas tipo CORREDACCION */

	public StringBuilder getQueryCorredaccion(StringBuilder query) {
		query.append(" SELECT " + T1ID_TAREA_083 + ID_TAREA_083COMA);
		query.append(" " + T2ID_DOC_056
				+ " ID_DOC_056, t2.TITULO_056 TITULO_056,T2.CLASE_DOCUMENTO_056 CLASE_DOCUMENTO_056, t2.OID_FICHERO_056 OID_FICHERO_056,t2.IND_ENCRIPTADO_056 IND_ENCRIPTADO_056,t2.ANYO_056 ANYO_056,t2.NUM_EXP_056 NUM_EXP_056,t2.EXTENSION_DOC_056 EXTENSION_DOC_056,t2.NOMBRE_FICHERO_056 NOMBREDOCORIGINAL, ");
		query.append(" t3.ID_FICHERO_FINAL_092 ID_FICHERO_FINAL_092, t3.IND_VISIBLE_092 IND_VISIBLE_092, ");
		query.append(
				" t4.IND_ENCRIPTADO_088 IND_ENCRIPTADO_088,t4.OID_FICHERO_088 OID_FICHERO_088,t4.TITULO_FICHERO_088 TITULO_FICHERO_088,t4.NOMBRE_FICHERO_088 NOMBREFICHEROFINAL, ");
		query.append(
				" t3.ID_DOC_FINAL_ORIG_092 ID_DOC_FINAL_ORIG, t5.IND_ENCRIPTADO_088 ENCRIPTADO_ORIG_FINAL_088,t5.OID_FICHERO_088 OID_ORIG_FINAL_088,t5.TITULO_FICHERO_088 TITULO_ORIGINAL_FINAL_088,t5.NOMBRE_FICHERO_088 NOMBREORIGFINAL ");
		query.append(FROM_AA79B83S01_T1);
		query.append(LEFT_JOIN_AA79B56S01_ON_ID_DOC_83 + T2ID_DOC_056 + " ");
		query.append(" LEFT JOIN AA79B92S01 t3 ON (" + T2ID_DOC_056 + " = t3.ID_DOC_ORIG_092 AND t3.ID_TAREA_092 = "
				+ T1ID_TAREA_083 + ") ");
		query.append(" LEFT JOIN AA79B88S01 t4 ON t3.ID_FICHERO_FINAL_092 = t4.ID_FICHERO_088 ");
		query.append(" LEFT JOIN AA79B88S01 t5 ON t3.ID_DOC_FINAL_ORIG_092 = t5.ID_FICHERO_088  ");
		query.append(DaoConstants.WHERE + T1ID_TAREA_083
				+ " = ? AND (t2.CLASE_DOCUMENTO_056 = ? OR t2.CLASE_DOCUMENTO_056 = ? OR t2.CLASE_DOCUMENTO_056 = ?)");
		return query;
	}

	/**
	 *
	 * @param query StringBuilder
	 * @return StringBuilder
	 */
	public StringBuilder getQueryTrados(StringBuilder query) {
		query.append(" SELECT t1.ID_TAREA_081 ID_TAREA_081, ");
		query.append(" t3.OID_FICHERO_088 OID_FICHERO_088, ");
		query.append(" t3.ID_FICHERO_088 ID_FICHERO_088, ");
		query.append(" t3.NOMBRE_FICHERO_088 NOMBRE_FICHERO_088, ");
		query.append(" t1.ANYO_081 ANYO_081, ");
		query.append(" t1.NUM_EXP_081 NUM_EXP_081 ");
		query.append(" FROM AA79B81S01 t1 ");
		query.append(" LEFT JOIN AA79B90S01 t2 ON t1.ID_TAREA_081 = t2.ID_TAREA_090 ");
		query.append(" LEFT JOIN AA79B88S01 t3 ON t2.ID_FICHERO_TRADOS_090 = t3.ID_FICHERO_088 ");
		query.append(" WHERE T1.ID_TAREA_081 = ? ");

		return query;
	}

	public String getQueryTareasIdaba() {
		StringBuilder str = new StringBuilder();
		str.append("SELECT ");
		// falta lo del titulo del expediente
		str.append(" t1.TITULO_051 TITULOEXP, " + T1NUM_EXP_051
				+ " NUMEXP, t2.ID_TAREA_081 IDTAREA, t4.DESC_RELEVANCIA_EU_010 RELEU");
		str.append(
				", t4.DESC_RELEVANCIA_ES_010 RELES, t1.IND_PRIORITARIO_051 INDPRIORITARIO, t5.OBSV_EJECUCION_085 OBSERVACIONES");
		str.append(", t6.NOMBRE_077 NOMBRE, t6.APEL1_077 APE1, t6.APEL2_077 APE2");

		return str.toString();
	}

	private String getFromTareasIdaba() {
		StringBuilder from = new StringBuilder();
		from.append(" FROM AA79B51S01 t1 LEFT JOIN AA79B81S01 t2 on " + T1NUM_EXP_051 + "=t2.NUM_EXP_081 AND "
				+ T1ANYO_051
				+ " = t2.ANYO_081 LEFT JOIN AA79B53S01 t3 ON t3.NUM_EXP_053=t2.NUM_EXP_081 AND t3.ANYO_053 = t2.ANYO_081 LEFT JOIN AA79B85S01 t5 on t2.ID_TAREA_081=t5.ID_TAREA_085 LEFT JOIN AA79B10S01 t4 on t3.ID_RELEVANCIA_053 = t4.ID_TIPO_RELEVANCIA_010 LEFT JOIN AA79B77S01 t6 on t2.DNI_RECURSO_081=t6.DNI_077");
		return from.toString();
	}

	@Override
	public List<DocumentoTarea> findAllDocsTipoCorredaccion(DocumentoTarea documentoTarea,
			JQGridRequestDto jqGridRequestDto, boolean startsWith) {
		final List<Object> params = new ArrayList<Object>();
		StringBuilder query = new StringBuilder();
		query = this.getQueryCorredaccion(query);

		params.add(documentoTarea.getIdTarea());
		params.add(ClasificacionDocumentosEnum.TRADUCCION.getValue());
		params.add(ClasificacionDocumentosEnum.TRABAJO.getValue());
		params.add(ClasificacionDocumentosEnum.REVISION.getValue());
		if (jqGridRequestDto != null) {
			query = JQGridManager.getPaginationQuery(jqGridRequestDto, query, new String[] { DBConstants.ID_DOC_056 });
		}
		return this.getJdbcTemplate().query(query.toString(), this.rwMap, params.toArray());
	}

	@Override
	public Long findAllDocsTipoCorredaccionCount(DocumentoTarea documentoTarea, boolean b) {
		List<Object> params = new ArrayList<Object>();
		StringBuilder query = new StringBuilder(SELECT_COUNT1_FROM);
		this.getQueryCorredaccion(query);
		query.append(" )");
		params.add(documentoTarea.getIdTarea());
		params.add(ClasificacionDocumentosEnum.TRADUCCION.getValue());
		params.add(ClasificacionDocumentosEnum.TRABAJO.getValue());
		params.add(ClasificacionDocumentosEnum.REVISION.getValue());
		return this.getJdbcTemplate().queryForObject(query.toString(), params.toArray(), Long.class);
	}

	@Override()
	@Transactional(readOnly = true)
	public DocumentoTarea findRegCorredaccion(DocumentoTarea bean) {
		List<Object> params = new ArrayList<Object>();
		StringBuilder query = new StringBuilder();
		query = this.getQueryCorredaccion(query);
		query.append(" " + AND_ID_DOC_056_EQUALS + " ");
		params.add(bean.getIdTarea());
		params.add(ClasificacionDocumentosEnum.TRADUCCION.getValue());
		params.add(ClasificacionDocumentosEnum.TRABAJO.getValue());
		params.add(ClasificacionDocumentosEnum.REVISION.getValue());
		params.add(bean.getDocumentoOriginal().getIdDoc());
		List<DocumentoTarea> beanList = this.jdbcTemplate.query(query.toString(), this.getRwMap(), params.toArray());
		return DataAccessUtils.uniqueResult(beanList);
	}

	public StringBuilder getQueryCorredaccionXliff(StringBuilder query) {
		query.append(" SELECT t1.ID_TAREA_096 ID_TAREA_096, t1.ID_FICHERO_XLIFF_096 ID_FICHERO_XLIFF_096,");
		query.append(
				" t2.IND_ENCRIPTADO_088 IND_ENCRIPTADO_088,t2.OID_FICHERO_088 OID_FICHERO_088,t2.TITULO_FICHERO_088 TITULO_FICHERO_088 ");
		query.append(" FROM AA79B96S01 t1 ");
		query.append(" LEFT JOIN AA79B88S01 t2 ON t1.ID_FICHERO_XLIFF_096 = t2.ID_FICHERO_088 ");
		query.append(" WHERE t1.ID_TAREA_096 = ?");
		return query;
	}

	/* CORREDACCION XLIFF */
	@Override
	public List<DocumentoTarea> findAllDocsTipoCorredaccionXliff(DocumentoTarea documentoTarea,
			JQGridRequestDto jqGridRequestDto, boolean startsWith) {
		final List<Object> params = new ArrayList<Object>();
		StringBuilder query = new StringBuilder();
		query = this.getQueryCorredaccionXliff(query);

		params.add(documentoTarea.getIdTarea());

		if (jqGridRequestDto != null) {
			query = JQGridManager.getPaginationQuery(jqGridRequestDto, query, new String[] { "ID_FICHERO_XLIFF_096" });
		}

		return this.getJdbcTemplate().query(query.toString(), this.rwMapDocTareasXliff, params.toArray());

	}

	@Override
	public Long findAllDocsTipoCorredaccionXliffCount(DocumentoTarea documentoTarea, boolean b) {
		List<Object> params = new ArrayList<Object>();
		StringBuilder query = new StringBuilder(SELECT_COUNT1_FROM);
		this.getQueryCorredaccionXliff(query);
		query.append(" )");
		params.add(documentoTarea.getIdTarea());
		return this.getJdbcTemplate().queryForObject(query.toString(), params.toArray(), Long.class);
	}

	/* Tareas tipo sin gestion asociada */

	public TareaIdaba getDatosTareaIdaba(Long idExpediente, BigDecimal idTarea, Long idTipoTarea, Long anyoExpediente) {
		StringBuilder strArea = new StringBuilder();
		strArea.append(this.getQueryTareasIdaba());
		strArea.append(this.getFromTareasIdaba());
		strArea.append(" WHERE  t2.ID_TAREA_081 = ?");
		strArea.append(" AND t2.ID_TIPO_TAREA_081 = ? ");
		strArea.append(" AND t2.NUM_EXP_081 = ? ");
		strArea.append(" AND t2.ANYO_081= ? ");

		List<Object> params = new ArrayList<Object>();
		params.add(idTarea);
		params.add(idTipoTarea);
		params.add(idExpediente);
		params.add(anyoExpediente);
		return this.getJdbcTemplate().queryForObject(strArea.toString(), this.getRwMapTareasIdaba(), params.toArray());
	}

	@Override
	public TareaIdaba getTareasIdaba(Long idExpediente, BigDecimal idTarea, Long idTipoTarea, Long anyoExpediente) {
		TareaIdaba tareaDatosGenerales = getDatosTareaIdaba(idExpediente, idTarea, idTipoTarea, anyoExpediente);
		TareaIdaba tareaDatosDocumentos = getTipoDocumentoTareaIdaba(idExpediente, anyoExpediente);
		TareaIdaba tareaDatosEntidad = getDatosEntidadTareaIdba(idExpediente, anyoExpediente);
		tareaDatosGenerales.setDescEntidades(tareaDatosEntidad.getDescEntidades());
		tareaDatosGenerales.setDescEntidadeu(tareaDatosEntidad.getDescEntidadeu());
		tareaDatosGenerales.setDescDoces(tareaDatosDocumentos.getDescDoces());
		tareaDatosGenerales.setDescDoceu(tareaDatosDocumentos.getDescDoceu());
		return tareaDatosGenerales;
	}

	public TareaIdaba getDatosEntidadTareaIdba(Long idExpediente, Long anyoExpediente) {
		StringBuilder str = new StringBuilder();
		List<Object> params = new ArrayList<Object>();
		str.append("SELECT t3.DESC_ES DESCENTIDES, t3.DESC_EU DESCENTIDEU ");
		str.append(
				" FROM AA79B81S01 t1 LEFT JOIN AA79B54S01 t2 on t1.NUM_EXP_081=t2.NUM_EXP_054 AND t1.ANYO_081=t2.ANYO_054 ");
		str.append(
				" LEFT JOIN X54JAPI_ENTIDADES_SOLIC t3 on t2.ID_ENTIDAD_054=t3.CODIGO AND t2.TIPO_ENTIDAD_054 = t3.TIPO");
		str.append(" WHERE t1.NUM_EXP_081 = ? AND t1.ANYO_081 = ?  AND ROWNUM=1 ");
		params.add(idExpediente);
		params.add(anyoExpediente);
		return this.getJdbcTemplate().queryForObject(str.toString(), this.getRwMapEntidad(), params.toArray());
	}

	private RowMapper<TareaIdaba> getRwMapEntidad() {
		return this.rwMapEntidad;
	}

	/* Tareas tipo NO CONFORMIDAD CLIENTE */
	private RowMapper<Tareas> rwMapTareasBasicas = new TareasBasicasRowMapper();

	private RowMapper<Tareas> getrwMapTareasBasicas() {
		return this.rwMapTareasBasicas;
	}

	@Override
	public Tareas findTareaBasica(BigDecimal idTarea) {
		StringBuilder query = new StringBuilder(this.getSelectTareaBasica());
		List<Object> params = new ArrayList<Object>();

		query.append(this.getFromTareaBasica());
		query.append(" WHERE t1.ID_TAREA_081 = ? ");
		params.add(idTarea);
		List<Tareas> tareaList = this.getJdbcTemplate().query(query.toString(), this.getrwMapTareasBasicas(),
				params.toArray());
		return DataAccessUtils.uniqueResult(tareaList);
	}

	private String getFromTareaBasica() {

		return " FROM AA79B81S01 t1 LEFT JOIN AA79B82S01 t2 on t1.ID_TAREA_081=t2.ID_TAREA_082 LEFT JOIN AA79B85S01 t3 on t1.ID_TAREA_081=t3.ID_TAREA_085 ";
	}

	private String getSelectTareaBasica() {
		StringBuilder query = new StringBuilder();
		query.append(this.getQueryTareaBasica());
		query.append(" ,t2.HORAS_TAREA_082 HORASTAREA ");
		query.append(" ,t3.OBSV_EJECUCION_085 OBSVEJEC ");
		query.append(" ,t2.IND_REALIZADA_082 INDREALIZADA ");
		query.append(" ,t2.POR_USO_EUSKERA_082 PORUSOEUSKERA ");
		query.append(" ,t2.IND_OBSV_082 " + DBConstants.INDOBSERVACIONES + DaoConstants.BLANK);
		return query.toString();
	}

	/**
	 * Obtiene el tipo de documento de los metadatos del CSV de la tarea IDABA
	 *
	 * @param numExp
	 * @param anyo
	 * @return
	 */
	private TareaIdaba getTipoDocumentoTareaIdaba(Long numExp, Long anyo) {
		StringBuilder str = new StringBuilder();
		List<Object> params = new ArrayList<Object>();
		str.append("SELECT t1.DESC_EU_042 DESCDOCEU, t1.DESC_EU_042 DESCDOCES ");
		str.append(" FROM AA79B42S01 t1 LEFT JOIN AA79B56S01 t2 on t2.TIPO_DOCUMENTO_056 = t1.ID_042 ");
		str.append(" WHERE t2.NUM_EXP_056 = ? AND t2.ANYO_056 = ? AND ROWNUM=1 ORDER BY t2.FECHA_ALTA_056 ASC");
		params.add(numExp);
		params.add(anyo);
		return this.getJdbcTemplate().queryForObject(str.toString(), this.getRwMapTipoDocTareaIdaba(),
				params.toArray());

	}

	/**
	 *
	 * @return query no conformidad cliente
	 */
	private String getQueryTareaBasica() {
		StringBuilder str = new StringBuilder();
		str.append("SELECT t1.ID_TAREA_081 IDTAREA");
		str.append(" ,t1.ID_TIPO_TAREA_081 IDTIPOTAREA ");
		str.append(", t1.IND_NO_CONFORMIDAD_081 INDNOCONF ");
		str.append(", t1.OBSERV_081 OBSERV ");
		return str.toString();
	}

	/* Tareas tipo TRADUCCION - INICIO */

	@Override
	public List<DocumentoTarea> findAllDocsTipoTraduccion(DocumentoTarea documentoTarea,
			JQGridRequestDto jqGridRequestDto, boolean b) {
		final List<Object> params = new ArrayList<Object>();
		StringBuilder query = new StringBuilder();
		query = this.getQueryTraduccion(query);

		params.add(documentoTarea.getIdTarea());
		params.add(ClasificacionDocumentosEnum.TRADUCCION.getValue());
		params.add(ClasificacionDocumentosEnum.TRABAJO.getValue());
		if (jqGridRequestDto != null) {
			query = JQGridManager.getPaginationQuery(jqGridRequestDto, query, new String[] { DBConstants.ID_DOC_056 });
		}

		return this.getJdbcTemplate().query(query.toString(), this.rwMapDocTareasTraduccion, params.toArray());
	}

	private StringBuilder getQueryTraduccion(StringBuilder query) {
		query.append(" SELECT " + T1ID_TAREA_083 + ID_TAREA_083COMA);
		query.append(" " + T2ID_DOC_056
				+ " ID_DOC_056, t2.TITULO_056 TITULO_056, t2.EXTENSION_DOC_056 EXTENSION_DOC_056,t2.NOMBRE_FICHERO_056 NOMBREDOCORIGINAL, "
				+ " t2.OID_FICHERO_056 OID_FICHERO_056,t2.CLASE_DOCUMENTO_056 CLASE_DOCUMENTO_056, t2.IND_ENCRIPTADO_056 IND_ENCRIPTADO_056, ");
		query.append(" t3.ID_FICHERO_TRADUCIDO_087 ID_FICHERO_TRADUCIDO_087, ");
		query.append(
				" t4.IND_ENCRIPTADO_088 IND_ENCRIPTADO_088,t4.OID_FICHERO_088 OID_FICHERO_088,t4.NOMBRE_FICHERO_088 NOMBREFICHEROTAREA, ");

		query.append(" 0 ESTADOFIRMA, 0 IDDOCFINALFIRMADO, 0 IDDOCORIGFIRMADO , 0 IDDOCFINALORIG ");

		query.append(FROM_AA79B83S01_T1);
		query.append(LEFT_JOIN_AA79B56S01_ON_ID_DOC_83 + T2ID_DOC_056 + " ");
		query.append(" LEFT JOIN AA79B87S01 t3 ON (" + T2ID_DOC_056 + " = t3.ID_DOC_ORIG_087 AND t3.ID_TAREA_087 = "
				+ T1ID_TAREA_083 + ") ");
		query.append(" LEFT JOIN AA79B88S01 t4 ON t3.ID_FICHERO_TRADUCIDO_087 = t4.ID_FICHERO_088 ");
		query.append(DaoConstants.WHERE + T1ID_TAREA_083 + " = ?");
		query.append(" AND (t2.CLASE_DOCUMENTO_056 = ? OR t2.CLASE_DOCUMENTO_056 = ?)");
		return query;
	}

	@Override
	public Long findAllDocsTipoTraduccionCount(DocumentoTarea documentoTarea, boolean b) {
		List<Object> params = new ArrayList<Object>();
		StringBuilder query = new StringBuilder();
		query.append(DaoConstants.SELECT_COUNT);
		query.append(DaoConstants.FROM);
		query.append(DaoConstants.ABRIR_PARENTESIS);
		this.getQueryTraduccion(query);
		query.append(DaoConstants.CERRAR_PARENTESIS);
		params.add(documentoTarea.getIdTarea());
		params.add(ClasificacionDocumentosEnum.TRADUCCION.getValue());
		params.add(ClasificacionDocumentosEnum.TRABAJO.getValue());
		return this.getJdbcTemplate().queryForObject(query.toString(), params.toArray(), Long.class);
	}

	@Override
	public DocumentoTarea findRegTraduccionRevision(DocumentoTarea bean) {
		List<Object> params = new ArrayList<Object>();
		StringBuilder query = new StringBuilder();
		query = this.getQueryTraduccion(query);
		query.deleteCharAt(query.length() - 1);
		query.append(" OR t2.CLASE_DOCUMENTO_056 = ?) ");
		query.append(" " + AND_ID_DOC_056_EQUALS + " ");
		params.add(bean.getIdTarea());
		params.add(ClasificacionDocumentosEnum.TRADUCCION.getValue());
		params.add(ClasificacionDocumentosEnum.REVISION.getValue());
		params.add(ClasificacionDocumentosEnum.TRABAJO.getValue());
		params.add(bean.getDocumentoOriginal().getIdDoc());
		List<DocumentoTarea> beanList = this.jdbcTemplate.query(query.toString(), this.rwMapDocTareasTraduccion,
				params.toArray());
		return DataAccessUtils.uniqueResult(beanList);
	}

	@Override
	public Integer validarDocumentosTareaFinalizar(BigDecimal idTarea, Long idTipoTarea) {
		List<Object> params = new ArrayList<Object>();
		StringBuilder query = new StringBuilder();
		query.append(DaoConstants.SELECT_COUNT);
		query.append(DaoConstants.FROM);
		query.append(DaoConstants.ABRIR_PARENTESIS);
		// metodo
		if (tipoTareaAsociadoATabla87(idTipoTarea)
				|| idTipoTarea == Long.valueOf(TipoTareaGestionAsociadaEnum.REVISAR_TRADUCCION_INTERNA.getValue())) {
			this.validarDocsTareaFinPorIdTipoTarea(idTarea, DBConstants.PREFIX_087, DBConstants.TABLA_87,
					DBConstants.ID_FICHERO_TRADUCIDO_087, query, true);
		} else if (idTipoTarea == Long.valueOf(TipoTareaGestionAsociadaEnum.CORREDACTAR.getValue())) {
			this.validarDocsTareaFinPorIdTipoTarea(idTarea, DBConstants.PREFIX_092, DBConstants.TABLA_92,
					DBConstants.ID_FICHERO_FINAL_092, query, false);
		} else if (idTipoTarea == Long.valueOf(TipoTareaGestionAsociadaEnum.ENTREGA_CLIENTE_REVISION.getValue())
				|| idTipoTarea == Long.valueOf(TipoTareaGestionAsociadaEnum.ENTREGA_CLIENTE_TRADUCCION.getValue())
				|| idTipoTarea == Long
						.valueOf(TipoTareaGestionAsociadaEnum.TRAD_ENTREGA_CLIENTE_TRADUCCION.getValue())) {
			this.validarDocsTareaFinPorIdTipoTarea(idTarea, DBConstants.PREFIX_092, DBConstants.TABLA_92,
					DBConstants.ID_FICHERO_FINAL_092, query, false);
		}

		query.append(DaoConstants.CERRAR_PARENTESIS);

		// Siempre va a buscar sobre el idTarea
		params.add(idTarea);
		return this.getJdbcTemplate().queryForObject(query.toString(), params.toArray(), Integer.class);
	}

	private boolean tipoTareaAsociadoATabla87(Long idTipoTarea) {
		return idTipoTarea == Long.valueOf(TipoTareaGestionAsociadaEnum.TRADUCIR.getValue())
				|| idTipoTarea == Long.valueOf(TipoTareaGestionAsociadaEnum.REVISAR.getValue())
				|| idTipoTarea == Long.valueOf(TipoTareaGestionAsociadaEnum.REVISAR_TRADUCCION.getValue())
				|| idTipoTarea == Long.valueOf(TipoTareaGestionAsociadaEnum.NO_CONFORMIDAD_TRADUCTOR.getValue());
	}

	@Override
	public Integer validarDocumentosTareaFinalizarEntregaTrad(BigDecimal idTarea, Integer iFirmaNecesaria) {
		List<Object> params = new ArrayList<Object>();
		StringBuilder query = new StringBuilder();
		query.append(DaoConstants.SELECT_COUNT);
		query.append(DaoConstants.FROM);
		query.append(DBConstants.TABLA_081 + " t1 ");
		query.append(
				" JOIN AA79B56S01 t2 ON t1.ANYO_081 = t2.ANYO_056 AND t1.NUM_EXP_081 = t2.NUM_EXP_056 AND (t2.CLASE_DOCUMENTO_056 = 1 OR t2.CLASE_DOCUMENTO_056 = 2) AND ID_DOC_REL_056 IS NULL ");
		query.append(
				" LEFT JOIN AA79B92S01 t3 ON t1.ID_TAREA_081 = t3.ID_TAREA_092  AND t2.ID_DOC_056 = t3.ID_DOC_ORIG_092 ");
		query.append(" WHERE t1.ID_TAREA_081 = ? AND t1.ID_TIPO_TAREA_081 IN (?,?,?,?) AND ");
		if (Constants.CERO == iFirmaNecesaria) {
			// firma no necesaria
			query.append(" t3.ID_FICHERO_FINAL_092 IS NULL ");
		} else {
			// firma necesaria
			query.append("( t3.ID_FICHERO_FINAL_092 IS NULL OR t3.ID_DOC_FIRMADO_FINAL_092 IS NULL)");

		}

		// Siempre va a buscar sobre el idTarea
		params.add(idTarea);
		params.add(TipoTareaGestionAsociadaEnum.ENTREGA_CLIENTE_TRADUCCION.getValue());
		params.add(TipoTareaGestionAsociadaEnum.TRAD_ENTREGA_CLIENTE_TRADUCCION.getValue());
		params.add(TipoTareaGestionAsociadaEnum.ENTREGA_CLIENTE_REVISION.getValue());
		params.add(TipoTareaGestionAsociadaEnum.CORREDACTAR.getValue());
		return this.getJdbcTemplate().queryForObject(query.toString(), params.toArray(), Integer.class);
	}

	/**
	 *
	 * @param idTarea          BigDecimal
	 * @param prefix           String
	 * @param tabla            String
	 * @param campo            String
	 * @param tieneDocsTrabajo
	 */
	public void validarDocsTareaFinPorIdTipoTarea(BigDecimal idTarea, String prefix, String tabla, String campo,
			StringBuilder query, boolean tieneDocsTrabajo) {
		query.append(DaoConstants.SELECT);
		query.append(" t1." + DBConstants.ID_TAREA_083 + " " + DBConstants.ID_TAREA_083 + DaoConstants.SIGNO_COMA);
		query.append(" t1." + DBConstants.ID_DOC_083 + " " + DBConstants.ID_DOC_083 + DaoConstants.SIGNO_COMA);
		query.append(" t2." + campo + " " + campo + " ");
		query.append(DaoConstants.FROM);
		query.append(DBConstants.TABLA_83 + " t1 ");
		query.append(DaoConstants.LEFT_JOIN);
		query.append(tabla + " t2 ");
		query.append(DaoConstants.ON);
		query.append(DaoConstants.ABRIR_PARENTESIS);
		query.append("t1." + DBConstants.ID_DOC_083 + " = t2.ID_DOC_ORIG_" + prefix + " ");
		query.append(DaoConstants.AND);
		query.append("t2.ID_TAREA_" + prefix + " = t1." + DBConstants.ID_TAREA_083 + " ");
		query.append(DaoConstants.CERRAR_PARENTESIS);
		query.append(DaoConstants.JOIN + DBConstants.TABLA_56 + " t3 ");
		query.append(DaoConstants.ON + " t1." + DBConstants.ID_DOC_083 + " = t3.ID_DOC_056 ");
		query.append(DaoConstants.AND + DaoConstants.ABRIR_PARENTESIS + T3_CLASE_DOCUMENTO_056_EQUALS
				+ ClasificacionDocumentosEnum.TRADUCCION.getValue());
		query.append(DaoConstants.OR + T3_CLASE_DOCUMENTO_056_EQUALS + ClasificacionDocumentosEnum.REVISION.getValue());
		if (tieneDocsTrabajo) {
			query.append(
					DaoConstants.OR + T3_CLASE_DOCUMENTO_056_EQUALS + ClasificacionDocumentosEnum.TRABAJO.getValue());
		}
		query.append(DaoConstants.CERRAR_PARENTESIS);
		query.append(DaoConstants.WHERE);
		query.append("t1." + DBConstants.ID_TAREA_083 + " ");
		query.append(DaoConstants.SIGNOIGUAL_INTERROGACION);
		query.append(DaoConstants.AND);
		query.append("t2." + campo);
		query.append(DaoConstants.IS_NULL);
	}

	@Override
	public List<DocumentosExpediente> findAllDocumentosTarea(Tareas filterTareas, JQGridRequestDto jqGridRequestDto,
			boolean b) {
		final List<Object> params = new ArrayList<Object>();
		StringBuilder query = new StringBuilder(DaoConstants.SELECT);
		StringBuilder paginatedQuery = new StringBuilder(FacturasDaoImpl.STRING_BUILDER_INIT);
		query = this.getQueryDocumentosTarea(query);

		params.add(filterTareas.getIdTarea());
		params.add(filterTareas.getAnyo());
		params.add(filterTareas.getNumExp());
		paginatedQuery.append(Utils.getPaginationQuery(jqGridRequestDto, false, query));

		return this.getJdbcTemplate().query(paginatedQuery.toString(), this.getRwMaprwMapDocumentosTarea(),
				params.toArray());
	}

	private StringBuilder getQueryDocumentosTarea(StringBuilder query) {
		query.append("d2.ID_DOC_056 IDDOC056, ");
		query.append("d2.TITULO_056 TITULO056, ");
		query.append("d2.CLASE_DOCUMENTO_056 CLASEDOCUMENTO056, ");
		query.append("d2.NUM_PAL_SOLIC_056 NUMPALSOLIC056, ");
		query.append("d2.NUM_PAL_IZO_056 NUMPALIZO056, ");
		query.append("t2.NUM_TOTAL_PAL_091 NUMTOTALPAL091, ");
		query.append("t2.NUM_PAL_CONCOR_0_84_091 NUMPALCONCOR084091, ");
		query.append("t2.NUM_PAL_CONCOR_85_94_091 NUMPALCONCOR8594091, ");
		query.append("t2.NUM_PAL_CONCOR_95_100_091 NUMPALCONCOR95100091, ");
		query.append("t2.NUM_PAL_CONCOR_95_99_091 NUMPALCONCOR9599091, ");
		query.append("t2.NUM_PAL_CONCOR_100_091 NUMPALCONCOR100091 ");
		query.append("FROM AA79B81T00 t1 ");
		query.append("LEFT JOIN AA79B83T00 d1 ");
		query.append("ON t1.ID_TAREA_081 = d1.ID_TAREA_083 ");
		query.append("JOIN AA79B56T00 d2 ");
		query.append("ON d1.ID_DOC_083 = d2.ID_DOC_056 ");
		query.append("LEFT JOIN AA79B91T00 t2 ");
		query.append("ON d1.ID_DOC_083 = t2.ID_DOC_ORIG_091 ");
		query.append("WHERE t1.ID_TAREA_081 = ? AND t1.ANYO_081 = ? AND t1.NUM_EXP_081 = ? ");

		return query;
	}

	@Override
	public Long findAllDocumentosTareaCount(Tareas filterTareas, boolean b) {
		List<Object> params = new ArrayList<Object>();
		StringBuilder query = new StringBuilder();
		query.append(DaoConstants.SELECT_COUNT);
		query.append("FROM AA79B81T00 t1 ");
		query.append("LEFT JOIN AA79B83T00 d1 ");
		query.append("ON t1.ID_TAREA_081 = d1.ID_TAREA_083 ");
		query.append("JOIN AA79B56T00 d2 ");
		query.append("ON d1.ID_DOC_083 = d2.ID_DOC_056 ");
		query.append("LEFT JOIN AA79B91T00 t2 ");
		query.append("ON d1.ID_DOC_083 = t2.ID_DOC_ORIG_091 ");
		query.append("WHERE t1.ID_TAREA_081 = ? AND t1.ANYO_081 = ? AND t1.NUM_EXP_081 = ? ");

		params.add(filterTareas.getIdTarea());
		params.add(filterTareas.getAnyo());
		params.add(filterTareas.getNumExp());
		return this.getJdbcTemplate().queryForObject(query.toString(), params.toArray(), Long.class);
	}

	@Override
	public Integer getPalPresupuesto() {
		StringBuilder strArea = new StringBuilder();
		strArea.append("SELECT PAL_PRESUPUESTO_003");
		strArea.append(" FROM AA79B03T00");
		return this.getJdbcTemplate().queryForObject(strArea.toString(), null, Integer.class);
	}

	@Override
	public Integer getPalTrados() {
		StringBuilder strArea = new StringBuilder();
		strArea.append("SELECT PAL_TRADOS_003");
		strArea.append(" FROM AA79B03T00");
		return this.getJdbcTemplate().queryForObject(strArea.toString(), null, Integer.class);
	}

	@Override
	public Integer getIVA() {
		StringBuilder query = new StringBuilder();
		query.append("SELECT POR_IVA_005 ");
		query.append("FROM AA79B05T00 ");
		query.append("WHERE VIGENTE_005 = '" + Constants.SI + "' ");
		return this.getJdbcTemplate().queryForObject(query.toString(), null, Integer.class);
	}

	@Override
	public List<TradosExp> findTrados(BigDecimal idTarea) {
		StringBuilder query = new StringBuilder();
		List<Object> params = new ArrayList<Object>();

		/**
		 *
		 * @return query no conformidad cliente
		 */
		query.append("SELECT ");
		query.append("ID_TAREA_091 ");
		query.append(", ID_DOC_ORIG_091 ");
		query.append(", NUM_TOTAL_PAL_091 ");
		query.append(", NUM_PAL_CONCOR_0_84_091 ");
		query.append(", NUM_PAL_CONCOR_85_94_091 ");
		query.append(", NUM_PAL_CONCOR_95_100_091 ");
		query.append("FROM AA79B91T00 ");
		query.append("WHERE ID_TAREA_091 = ? ");
		params.add(idTarea);
		return this.getJdbcTemplate().query(query.toString(), this.getRwMapTrados(), params.toArray());
	}

	/**
	 *
	 * @param bean DocumentoTarea
	 * @return DocumentoTarea
	 */
	@Override()
	public DocumentoTarea findRegTrados(DocumentoTarea bean) {
		List<Object> params = new ArrayList<Object>();
		StringBuilder query = new StringBuilder();
		query = this.getQueryTrados(query);
		params.add(bean.getIdTarea());
		List<DocumentoTarea> beanList = this.jdbcTemplate.query(query.toString(), this.rwMapTrados, params.toArray());
		return DataAccessUtils.uniqueResult(beanList);
	}

	@Override
	public List<DocumentoTarea> findAllDocsTipoRevision(DocumentoTarea documentoTarea,
			JQGridRequestDto jqGridRequestDto, boolean startsWith) {
		final List<Object> params = new ArrayList<Object>();
		StringBuilder query = new StringBuilder();
		query = this.getQueryRevision(query);

		params.add(documentoTarea.getIdTarea());
		params.add(ClasificacionDocumentosEnum.REVISION.getValue());
		params.add(ClasificacionDocumentosEnum.TRABAJO.getValue());
		if (jqGridRequestDto != null) {
			query = JQGridManager.getPaginationQuery(jqGridRequestDto, query, new String[] { "IDDOC" });
		}

		return this.getJdbcTemplate().query(query.toString(), this.rwMapDocTareasRevision, params.toArray());
	}

	private StringBuilder getQueryRevision(StringBuilder query) {
		query.append(
				DaoConstants.SELECT + " " + T1ID_TAREA_083 + " " + DBConstants.IDTAREA83 + DaoConstants.SIGNO_COMA);
		query.append(" " + T2ID_DOC_056 + " " + DBConstants.IDDOC + DaoConstants.SIGNO_COMA);
		query.append(" t3.ID_DOC_056 " + DBConstants.IDDOCREL + DaoConstants.SIGNO_COMA);
		query.append(" t2.TITULO_056 " + DBConstants.TITULO + DaoConstants.SIGNO_COMA);
		query.append(" t2.OID_FICHERO_056 " + DBConstants.OIDFICHERO + DaoConstants.SIGNO_COMA);
		query.append("  t2.CLASE_DOCUMENTO_056 " + DBConstants.CLASEDOCUMENTO + DaoConstants.SIGNO_COMA);
		query.append("  t2.IND_ENCRIPTADO_056 " + DBConstants.INDENCRIPTADO + DaoConstants.SIGNO_COMA);
		query.append(" t2.EXTENSION_DOC_056 " + DBConstants.EXTENSIONDOC + DaoConstants.SIGNO_COMA);
		query.append(" t2.NOMBRE_FICHERO_056 NOMBREDOCORIGINAL, ");
		query.append(" t3.TITULO_056 " + DBConstants.TITULOREL + DaoConstants.SIGNO_COMA);
		query.append(" t3.OID_FICHERO_056 " + DBConstants.OIDFICHEROREL + DaoConstants.SIGNO_COMA);
		query.append(" t3.CLASE_DOCUMENTO_056 " + DBConstants.CLASEDOCUMENTOREL + DaoConstants.SIGNO_COMA);
		query.append("  t3.IND_ENCRIPTADO_056 " + DBConstants.INDENCRIPTADOREL + DaoConstants.SIGNO_COMA);
		query.append("  t3.EXTENSION_DOC_056 " + DBConstants.EXTENSIONDOCREL + DaoConstants.SIGNO_COMA);
		query.append(" t3.NOMBRE_FICHERO_056 NOMBREDOCREL, ");
		query.append(" t4.ID_FICHERO_TRADUCIDO_087 " + DBConstants.IDFICHEROREVISADO + DaoConstants.SIGNO_COMA);
		query.append("  t5.IND_ENCRIPTADO_088 " + DBConstants.INDENCRIPTADOFICHREV + DaoConstants.SIGNO_COMA);
		query.append(" t5.TITULO_FICHERO_088 " + DBConstants.TITULOFICHREV + DaoConstants.SIGNO_COMA);
		query.append(" t5.OID_FICHERO_088 " + DBConstants.OIDFICHEROREV + DaoConstants.SIGNO_COMA);
		query.append(" t5.NOMBRE_FICHERO_088 NOMBREFICHEROREV, ");
		query.append(" t6.ID_FICHERO_JUSTIFICANTE_093 " + DBConstants.IDFICHJUST + DaoConstants.SIGNO_COMA);
		query.append(" t6.IND_VISIBLE_093 " + DBConstants.INDVISIBLEFICHJUST + DaoConstants.SIGNO_COMA);
		query.append(" t7.NOMBRE_FICHERO_088 " + DBConstants.NOMBREFICHJUST + DaoConstants.SIGNO_COMA);
		query.append(" t7.IND_ENCRIPTADO_088 " + DBConstants.INDENCRIPTADOJUST);
		query.append(DaoConstants.FROM + DBConstants.TABLA_83 + " t1 ");
		query.append(DaoConstants.LEFT_JOIN + DBConstants.TABLA_56 + " t2 ");
		query.append(DaoConstants.ON + " t1.ID_DOC_083 = " + T2ID_DOC_056 + " ");
		query.append(DaoConstants.LEFT_JOIN + DBConstants.TABLA_56 + " t3 ");
		query.append(DaoConstants.ON + " t1.ID_DOC_083 = t3.ID_DOC_REL_056 ");
		query.append(DaoConstants.LEFT_JOIN + DBConstants.TABLA_87 + " t4 ");
		query.append(DaoConstants.ON + DaoConstants.ABRIR_PARENTESIS + " t1.ID_DOC_083   = t4.ID_DOC_ORIG_087 ");
		query.append(DaoConstants.AND + " t4.ID_TAREA_087 = " + T1ID_TAREA_083 + " " + DaoConstants.CERRAR_PARENTESIS);
		query.append(DaoConstants.LEFT_JOIN + DBConstants.TABLA_88 + " t5 ");
		query.append(DaoConstants.ON + " t4.ID_FICHERO_TRADUCIDO_087 = t5.ID_FICHERO_088 ");
		query.append(DaoConstants.LEFT_JOIN + DBConstants.TABLA_93 + " t6 ");
		query.append(DaoConstants.ON + " t6.ID_TAREA_093 = " + T1ID_TAREA_083 + " ");
		query.append(DaoConstants.AND + " t6.ID_DOC_ORIG_093 = " + T2ID_DOC_056 + " ");
		query.append(DaoConstants.LEFT_JOIN + DBConstants.TABLA_88 + " t7 ");
		query.append(DaoConstants.ON + " t6.ID_FICHERO_JUSTIFICANTE_093 = t7.ID_FICHERO_088 ");
		query.append(DaoConstants.WHERE + "" + T1ID_TAREA_083 + " " + DaoConstants.SIGNOIGUAL_INTERROGACION);
		query.append(DaoConstants.AND + DaoConstants.ABRIR_PARENTESIS + "t2.CLASE_DOCUMENTO_056"
				+ DaoConstants.SIGNOIGUAL_INTERROGACION);
		query.append(DaoConstants.OR + "t2.CLASE_DOCUMENTO_056" + DaoConstants.SIGNOIGUAL_INTERROGACION
				+ DaoConstants.CERRAR_PARENTESIS);

		return query;
	}

	@Override
	public Long findAllDocsTipoRevisionCount(DocumentoTarea documentoTarea, boolean startsWith) {
		List<Object> params = new ArrayList<Object>();
		StringBuilder query = new StringBuilder();
		query.append(DaoConstants.SELECT_COUNT);
		query.append(DaoConstants.FROM);
		query.append(DaoConstants.ABRIR_PARENTESIS);
		this.getQueryRevision(query);
		query.append(DaoConstants.CERRAR_PARENTESIS);
		params.add(documentoTarea.getIdTarea());
		params.add(ClasificacionDocumentosEnum.REVISION.getValue());
		params.add(ClasificacionDocumentosEnum.TRABAJO.getValue());
		return this.getJdbcTemplate().queryForObject(query.toString(), params.toArray(), Long.class);
	}

	@Override
	public DocumentoTarea findRegJustificante(DocumentoTarea bean) {
		List<Object> params = new ArrayList<Object>();
		StringBuilder query = new StringBuilder();
		query = this.getQueryJustificante(query);
		query.append(" " + AND_ID_DOC_056_EQUALS + " ");
		params.add(bean.getIdTarea());
		params.add(bean.getDocumentoOriginal().getIdDoc());
		List<DocumentoTarea> beanList = this.jdbcTemplate.query(query.toString(), this.rwMapDocJustificante,
				params.toArray());
		return DataAccessUtils.uniqueResult(beanList);
	}

	private StringBuilder getQueryJustificante(StringBuilder query) {
		query.append(DaoConstants.SELECT);
		query.append(" " + T1ID_TAREA_083 + " " + DBConstants.IDTAREA83 + DaoConstants.SIGNO_COMA);
		query.append(" " + T2ID_DOC_056 + " " + DBConstants.IDDOC + DaoConstants.SIGNO_COMA);
		query.append("  t2.TITULO_056  " + DBConstants.TITULO + DaoConstants.SIGNO_COMA);
		query.append("t2.OID_FICHERO_056 " + DBConstants.OIDFICHERO + DaoConstants.SIGNO_COMA);
		query.append("t2.CLASE_DOCUMENTO_056 " + DBConstants.CLASEDOCUMENTO + DaoConstants.SIGNO_COMA);
		query.append("t2.IND_ENCRIPTADO_056 " + DBConstants.INDENCRIPTADO + DaoConstants.SIGNO_COMA);
		query.append(" t3.ID_FICHERO_JUSTIFICANTE_093 " + DBConstants.IDFICHEROJUSTIFICANTE + DaoConstants.SIGNO_COMA);
		query.append(" t4.IND_ENCRIPTADO_088 " + DBConstants.INDENCRIPTADOREL + DaoConstants.SIGNO_COMA);
		query.append(" t4.OID_FICHERO_088 " + DBConstants.OIDFICHEROJUST);
		query.append(DaoConstants.FROM);
		query.append(DBConstants.TABLA_83 + " t1 ");
		query.append(DaoConstants.LEFT_JOIN);
		query.append(DBConstants.TABLA_56 + " t2 ");
		query.append(DaoConstants.ON);
		query.append(" t1.ID_DOC_083 = " + T2ID_DOC_056 + " ");
		query.append(DaoConstants.LEFT_JOIN);
		query.append(DBConstants.TABLA_93 + " t3 ");
		query.append(DaoConstants.ON);
		query.append(DaoConstants.ABRIR_PARENTESIS);
		query.append(" " + T2ID_DOC_056 + " " + DaoConstants.SIGNOIGUAL + " t3.ID_DOC_ORIG_093 ");
		query.append(DaoConstants.AND);
		query.append(" t3.ID_TAREA_093 " + DaoConstants.SIGNOIGUAL + " " + T1ID_TAREA_083 + " ");
		query.append(DaoConstants.CERRAR_PARENTESIS);
		query.append(DaoConstants.LEFT_JOIN);
		query.append(DBConstants.TABLA_88 + " t4 ");
		query.append(DaoConstants.ON);
		query.append(" t3.ID_FICHERO_JUSTIFICANTE_093 " + DaoConstants.SIGNOIGUAL + " t4.ID_FICHERO_088 ");
		query.append(DaoConstants.WHERE);
		query.append(" " + T1ID_TAREA_083 + " ");
		query.append(DaoConstants.SIGNOIGUAL_INTERROGACION);

		return query;
	}

	@Override
	public TareaTrados cargaInicialTareaTrados(Long anyoExp, Integer numExp, BigDecimal idTarea) {
		List<Object> params = new ArrayList<Object>();
		StringBuilder query = new StringBuilder();
		query = this.getQueryTareaTrados(query);
		params.add(anyoExp);
		params.add(numExp);
		return this.getJdbcTemplate().queryForObject(query.toString(), this.getRwMapTareaTrados(), params.toArray());
	}

	private StringBuilder getQueryTareaTrados(StringBuilder query) {
		Locale es = new Locale("es");
		Locale eu = new Locale("eu");
		query.append(DaoConstants.SELECT);
		query.append(" " + T1ANYO_051 + " " + DBConstants.ANYO + DaoConstants.SIGNO_COMA);
		query.append(" " + T1NUM_EXP_051 + " " + DBConstants.NUMEXP + DaoConstants.SIGNO_COMA);
		query.append(" t1.TITULO_051 " + DBConstants.TITULO + DaoConstants.SIGNO_COMA);
		query.append(" t1.FECHA_ALTA_051 " + DBConstants.FECHAALTA + DaoConstants.SIGNO_COMA);
		query.append(" TO_CHAR(t1.FECHA_ALTA_051,'HH24:MI') " + DBConstants.HORAALTA + DaoConstants.SIGNO_COMA);
		query.append(" t1.ID_TIPO_EXPEDIENTE_051 " + DBConstants.IDTIPOEXPEDIENTE + DaoConstants.SIGNO_COMA);
		query.append(" DECODE(t1.ID_TIPO_EXPEDIENTE_051, '" + TipoExpedienteEnum.INTERPRETACION.getValue() + "', '")
				.append(this.msg.getMessage("label.interpretacionAbr", null, es))
				.append("', '" + TipoExpedienteEnum.TRADUCCION.getValue() + "', '")
				.append(this.msg.getMessage("label.traduccionAbr", null, es))
				.append("', '" + TipoExpedienteEnum.REVISION.getValue() + "', '")
				.append(this.msg.getMessage("label.revisionAbr", null, es))
				.append("') AS " + DBConstants.TIPOEXPEDIENTEDESCES + DaoConstants.SIGNO_COMA);
		query.append(" DECODE(t1.ID_TIPO_EXPEDIENTE_051, '" + TipoExpedienteEnum.INTERPRETACION.getValue() + "', '")
				.append(this.msg.getMessage("label.interpretacionAbr", null, eu))
				.append("', '" + TipoExpedienteEnum.TRADUCCION.getValue() + "', '")
				.append(this.msg.getMessage("label.traduccionAbr", null, eu))
				.append("', '" + TipoExpedienteEnum.REVISION.getValue() + "', '")
				.append(this.msg.getMessage("label.revisionAbr", null, eu))
				.append("') AS " + DBConstants.TIPOEXPEDIENTEDESCEU + DaoConstants.SIGNO_COMA);
		query.append(" t2.ID_IDIOMA_053 " + DBConstants.IDIDIOMA + DaoConstants.SIGNO_COMA);
		query.append(" t3.COD_IDIOMA_009 " + DBConstants.CODIDIOMA + DaoConstants.SIGNO_COMA);
		query.append(" t3.DESC_IDIOMA_EU_009 " + DBConstants.DESCIDIOMAEU + DaoConstants.SIGNO_COMA);
		query.append(" t3.DESC_IDIOMA_ES_009 " + DBConstants.DESCIDIOMAES + DaoConstants.SIGNO_COMA);
		query.append(" t2.ID_RELEVANCIA_053 " + DBConstants.IDRELEVANCIA + DaoConstants.SIGNO_COMA);
		query.append(" t4.DESC_RELEVANCIA_EU_010 " + DBConstants.DESCRELEVANCIAEU + DaoConstants.SIGNO_COMA);
		query.append(" t4.DESC_RELEVANCIA_ES_010 " + DBConstants.DESCRELEVANCIAES + DaoConstants.SIGNO_COMA);
		query.append(" t4.PRIORIDAD_010 " + DBConstants.PRIORIDADRELEVANCIA + DaoConstants.SIGNO_COMA);
		query.append(" " + T2IND_PUBLICAR_BOPV_053 + " " + DBConstants.INDPUBLICARBOPV);
		query.append(DAOUtils.getDecodeAcciones(" " + T2IND_PUBLICAR_BOPV_053 + " ", DBConstants.PUBLICARBOPVDESCES,
				this.msg, ACTIVOENUM, es));
		query.append(DAOUtils.getDecodeAcciones(" " + T2IND_PUBLICAR_BOPV_053 + " ", DBConstants.PUBLICARBOPVDESCEU,
				this.msg, ACTIVOENUM, eu) + DaoConstants.SIGNO_COMA);
		query.append(" " + T2IND_DIFICIL_053 + " " + DBConstants.INDDIFICIL);
		query.append(DAOUtils.getDecodeAcciones(" " + T2IND_DIFICIL_053 + " ", DBConstants.DIFICILDESCES, this.msg,
				ACTIVOENUM, es));
		query.append(DAOUtils.getDecodeAcciones(" " + T2IND_DIFICIL_053 + " ", DBConstants.DIFICILDESCEU, this.msg,
				ACTIVOENUM, eu) + DaoConstants.SIGNO_COMA);
		query.append(" t2.IND_PRESUPUESTO_053 " + DBConstants.INDPRESUPUESTO + DaoConstants.SIGNO_COMA);
		query.append(" " + T2IND_URGENTE_053 + " " + DBConstants.INDURGENTE);
		query.append(DAOUtils.getDecodeAcciones(" " + T2IND_URGENTE_053 + " ", DBConstants.URGENTEDESCES, this.msg,
				ACTIVOENUM, es));
		query.append(DAOUtils.getDecodeAcciones(" " + T2IND_URGENTE_053 + " ", DBConstants.URGENTEDESCEU, this.msg,
				ACTIVOENUM, eu) + DaoConstants.SIGNO_COMA);
		query.append(" " + T2IND_DIFICIL_053 + " " + DBConstants.INDDIFICIL);
		query.append(DAOUtils.getDecodeAcciones(" " + T2IND_DIFICIL_053 + " ", DBConstants.DIFICILDESCES, this.msg,
				ACTIVOENUM, es));
		query.append(DAOUtils.getDecodeAcciones(" " + T2IND_DIFICIL_053 + " ", DBConstants.DIFICILDESCEU, this.msg,
				ACTIVOENUM, eu) + DaoConstants.SIGNO_COMA);
		query.append(" t2.NUM_TOTAL_PAL_SOLIC_053 " + DBConstants.NUMPALSOLIC + DaoConstants.SIGNO_COMA);
		query.append(" t2.NUM_TOTAL_PAL_IZO_053 " + DBConstants.NUMPALIZO + DaoConstants.SIGNO_COMA);
		query.append(" t2.FECHA_FINAL_IZO_053 " + DBConstants.FECHAFINALIZO + DaoConstants.SIGNO_COMA);
		query.append(
				" TO_CHAR(t2.FECHA_FINAL_IZO_053,'HH24:MI') " + DBConstants.HORAFINALIZO + DaoConstants.SIGNO_COMA);
		query.append(" t5.ID_TAREA_081 " + DBConstants.IDTAREA + DaoConstants.SIGNO_COMA);
		query.append(
				" NVL(t5.ID_REQUERIMIENTO_081," + Constants.MINUS_UNO + ") IDREQUERIMIENTO " + DaoConstants.SIGNO_COMA);
		query.append(" t6.ID_FICHERO_TRADOS_090 " + DBConstants.IDFICHEROTRADOS + DaoConstants.SIGNO_COMA);
		query.append(" t7.NOMBRE_FICHERO_088 " + DBConstants.NOMBREFICHERO + DaoConstants.SIGNO_COMA);
		query.append(" t7.EXTENSION_FICHERO_088 " + DBConstants.EXTENSIONFICHERO + DaoConstants.SIGNO_COMA);
		query.append(" t7.IND_ENCRIPTADO_088 " + DBConstants.INDENCRIPTADO + DaoConstants.SIGNO_COMA);
		query.append(" t7.OID_FICHERO_088 " + DBConstants.OIDFICHERO + DaoConstants.SIGNO_COMA);
		query.append(" t6.IND_VISIBLE_090 " + DBConstants.INDVISIBLE + DaoConstants.SIGNO_COMA);
		query.append(" t6.PRESUPUESTO_090 " + DBConstants.PRESUPUESTO + DaoConstants.SIGNO_COMA);
		query.append(" t6.IMPORTE_BASE_090 " + DBConstants.IMPORTEBASE + DaoConstants.SIGNO_COMA);
		query.append(" t6.IMPORTE_IVA_090 " + DBConstants.IMPORTEIVA + DaoConstants.SIGNO_COMA);
		query.append(" t6.POR_IVA_090 " + DBConstants.PORIVA + DaoConstants.SIGNO_COMA);
		query.append(" t6.FECHA_ENTREGA_090 " + DBConstants.FECHAENTREGA + DaoConstants.SIGNO_COMA);
		query.append(" TO_CHAR(t6.FECHA_ENTREGA_090,'HH24:MI') " + DBConstants.HORAENTREGA + DaoConstants.SIGNO_COMA);
		query.append(" t6.TARIFA_PAL_090 " + DBConstants.TARIFAPAL + DaoConstants.SIGNO_COMA);
		query.append(" t6.NUM_TOTAL_PAL_090 " + DBConstants.NUMTOTALPAL + DaoConstants.SIGNO_COMA);
		query.append(" t6.NUM_PAL_CONCOR_0_84_090 " + DBConstants.NUMPALCONCOR084 + DaoConstants.SIGNO_COMA);
		query.append(" t6.NUM_PAL_CONCOR_85_94_090 " + DBConstants.NUMPALCONCOR8594 + DaoConstants.SIGNO_COMA);
		query.append(" t6.NUM_PAL_CONCOR_95_100_090 " + DBConstants.NUMPALCONCOR95100 + DaoConstants.SIGNO_COMA);
		query.append(" t6.NUM_PAL_CONCOR_95_99_090 " + DBConstants.NUMPALCONCOR9599 + DaoConstants.SIGNO_COMA);
		query.append(" t6.NUM_PAL_CONCOR_100_090 " + DBConstants.NUMPALCONCOR100 + DaoConstants.SIGNO_COMA);
		query.append(" t6.NOMBRE_PROYECTO_090 " + DBConstants.NOMBREPROYECTO + DaoConstants.SIGNO_COMA);
		query.append(" t6.FECHA_PROYECTO_090 " + DBConstants.FECHAPROYECTO + DaoConstants.SIGNO_COMA);
		query.append(" TO_CHAR(t6.FECHA_PROYECTO_090,'HH24:MI') " + DBConstants.HORAPROYECTO + DaoConstants.SIGNO_COMA);
		query.append(" t8.PAL_PRESUPUESTO_003 " + DBConstants.PALPRESUPUESTO + DaoConstants.SIGNO_COMA);
		query.append(" t8.PAL_TRADOS_003 " + DBConstants.PALTRADOS + DaoConstants.SIGNO_COMA);
		query.append(" t8.POR_DESVIACION_PAL_003 " + DBConstants.PORDESVIACIONPAL + DaoConstants.SIGNO_COMA);
		query.append(" t10.FECHA_LIMITE_064 " + DBConstants.FECHALIMITE + DaoConstants.SIGNO_COMA);
		query.append(DaoConstants.TO_CHAR + DaoConstants.ABRIR_PARENTESIS + " t10.FECHA_LIMITE_064 "
				+ DaoConstants.SIGNO_COMA + " 'HH24:MI' " + DaoConstants.CERRAR_PARENTESIS + DBConstants.HORALIMITE);
		query.append(DaoConstants.FROM);
		query.append(DBConstants.TABLA_51 + " t1 ");
		query.append(DaoConstants.JOIN);
		query.append(DBConstants.TABLA_53 + " t2 ");
		query.append(DaoConstants.ON + " " + T1ANYO_051 + " " + DaoConstants.SIGNOIGUAL + " t2.ANYO_053 ");
		query.append(DaoConstants.AND + " " + T1NUM_EXP_051 + " " + DaoConstants.SIGNOIGUAL + " t2.NUM_EXP_053 ");
		query.append(DaoConstants.LEFT_JOIN);
		query.append(DBConstants.TABLA_09 + " t3 ");
		query.append(DaoConstants.ON + " t2.ID_IDIOMA_053 " + DaoConstants.SIGNOIGUAL + " t3.ID_IDIOMA_009 ");
		query.append(DaoConstants.AND + " t3.ESTADO_009 " + DaoConstants.SIGNOIGUAL + "'" + Constants.ALTA + "' ");
		query.append(DaoConstants.LEFT_JOIN);
		query.append(DBConstants.TABLA_10 + " t4 ");
		query.append(
				DaoConstants.ON + " t2.ID_RELEVANCIA_053 " + DaoConstants.SIGNOIGUAL + " t4.ID_TIPO_RELEVANCIA_010 ");
		query.append(DaoConstants.AND + " t4.ESTADO_010 " + DaoConstants.SIGNOIGUAL + "'" + Constants.ALTA + "' ");
		query.append(DaoConstants.LEFT_JOIN);
		query.append(DBConstants.TABLA_81 + " t5 ");
		query.append(DaoConstants.ON + " t5.ANYO_081 " + DaoConstants.SIGNOIGUAL + " " + T1ANYO_051 + " ");
		query.append(DaoConstants.AND + " t5.NUM_EXP_081 " + DaoConstants.SIGNOIGUAL + " " + T1NUM_EXP_051 + " ");
		query.append(DaoConstants.AND + " t5.ID_TIPO_TAREA_081 " + DaoConstants.SIGNOIGUAL
				+ TipoTareaGestionAsociadaEnum.PROYECTO_TRADOS.getValue());
		query.append(DaoConstants.LEFT_JOIN);
		query.append(DBConstants.TABLA_90 + " t6 ");
		query.append(DaoConstants.ON + " t6.ID_TAREA_090 " + DaoConstants.SIGNOIGUAL + " t5.ID_TAREA_081 ");
		query.append(DaoConstants.LEFT_JOIN);
		query.append(DBConstants.TABLA_88 + " t7 ");
		query.append(DaoConstants.ON + " t6.ID_FICHERO_TRADOS_090 " + DaoConstants.SIGNOIGUAL + " t7.ID_FICHERO_088 ");
		query.append(DaoConstants.JOIN);
		query.append(DBConstants.TABLA_03 + " t8 ");
		query.append(DaoConstants.ON);
		query.append(" t8.ID_003 " + DaoConstants.SIGNOIGUAL + Constants.CERO);
		query.append(DaoConstants.LEFT_JOIN);
		query.append(DBConstants.TABLA_01);
		query.append(" t9 ");
		query.append(DaoConstants.ON);
		query.append(" NIVEL_USUARIO_001" + DaoConstants.SIGNOIGUAL + " 'N'");
		query.append(DaoConstants.LEFT_JOIN + DBConstants.TABLA_064 + " t10 ");
		query.append(DaoConstants.ON + " t10.ID_064 " + DaoConstants.SIGNOIGUAL + " t5.ID_REQUERIMIENTO_081 ");
		query.append(DaoConstants.WHERE);
		query.append(" " + T1ANYO_051 + " " + DaoConstants.SIGNOIGUAL_INTERROGACION);
		query.append(DaoConstants.AND);
		query.append(" " + T1NUM_EXP_051 + " " + DaoConstants.SIGNOIGUAL_INTERROGACION);
		return query;
	}

	@Override
	public List<Tareas> findDocsRevisionTraduccionExterna(DocumentoTarea documentoTarea,
			JQGridRequestDto jqGridRequestDto, boolean startsWith) {
		final List<Object> params = new ArrayList<Object>();
		StringBuilder query = new StringBuilder();
		query.append(this.getQueryRevisionTraduccionExterna());

		params.add(documentoTarea.getIdTarea());
		params.add(documentoTarea.getIdTarea());
		params.add(documentoTarea.getIdTarea());
		params.add(EstadoEjecucionTareaEnum.EJECUTADA.getValue());

		if (jqGridRequestDto != null && jqGridRequestDto.getSidx() != null) {
			jqGridRequestDto.setSidx(DBConstants.FECHAEJECUCIONTAREA + DaoConstants.SIGNO_COMA
					+ DBConstants.IDTAREAAGRUPACION + DaoConstants.SIGNO_COMA + DBConstants.IDDOCORIGINAL);

			query = JQGridManager.getPaginationQuery(jqGridRequestDto, query, new String[] {
					DBConstants.FECHAEJECUCIONTAREA, DBConstants.IDTAREAAGRUPACION, DBConstants.IDDOCORIGINAL });
		}

		return this.getJdbcTemplate().query(query.toString(), this.rwMapDocsTareaRevTradExt, params.toArray());
	}

	@Override
	public Lotes cargarDatosLoteAsignado(Tareas tarea) {
		StringBuilder query = new StringBuilder();
		List<Object> params = new ArrayList<Object>();
		query.append(
				"SELECT POR_RECARGO_FORMATO_029, IND_RECARGO_APREMIO_029, POR_RECARGO_APREMIO_029, ID_TIPO_PENALIZACION_029, POR_PENALIZACION_029 ");
		query.append("FROM AA79B81T00 tareaRev ");
		query.append(
				"JOIN AA79B81T00 tareaTrad ON tareaRev.ID_TAREA_REL_081 = tareaTrad.ID_TAREA_081 AND tareaTrad.IND_FACTURABLE_081 = '"
						+ Constants.SI + "' ");
		query.append("JOIN AA79B29T00 ON tareaTrad.ID_LOTE_081 = ID_LOTE_029 WHERE tareaRev.ID_TAREA_081 = ? ");
		params.add(tarea.getIdTarea());

		List<Lotes> resultList = this.getJdbcTemplate().query(query.toString(), this.rwMapDatosLoteAsignado,
				params.toArray());

		return DataAccessUtils.uniqueResult(resultList);
	}

	@Override
	public DatosPagoProveedores cargarDatosDePagoAProveedorAsignado(Tareas tarea) {
		StringBuilder query = new StringBuilder();
		List<Object> params = new ArrayList<Object>();
		query.append("SELECT ID_TAREA_094, IND_RECARGO_FORMATO_094, NUM_PAL_RECARGO_FORMATO_094, ");
		query.append("IND_RECARGO_APREMIO_094, POR_RECARGO_APREMIO_094, IND_PENALIZACION_094, ");
		query.append("POR_PENALIZACION_094, NIVEL_CALIDAD_094 FROM AA79B81T00 ");
		query.append("JOIN AA79B94T00 ON ID_TAREA_094 = ID_TAREA_081 ");
		query.append(
				"WHERE ID_TAREA_REL_081 = (Select ID_TAREA_REL_081 FROM AA79B81T00 WHERE ID_TAREA_081 = ?) AND ID_TIPO_TAREA_081 = ? ");
		params.add(tarea.getIdTarea());
		params.add(TipoTareaGestionAsociadaEnum.REVISION_PAGO_PROVEEDOR.getValue());

		List<DatosPagoProveedores> resultList = this.getJdbcTemplate().query(query.toString(),
				this.rwMapDatosDePagoAProveedorAsignado, params.toArray());

		return DataAccessUtils.uniqueResult(resultList);
	}

	@Override
	public Lotes cargarDatosLoteAsignadoRevisionExterna(Tareas tarea) {
		StringBuilder query = new StringBuilder();
		List<Object> params = new ArrayList<Object>();
		query.append(
				"SELECT POR_RECARGO_FORMATO_029, IND_RECARGO_APREMIO_029, POR_RECARGO_APREMIO_029, ID_TIPO_PENALIZACION_029, POR_PENALIZACION_029 ");
		query.append("FROM AA79B81T00 tareaEntr ");
		query.append("JOIN AA79B81T00 tareaRev ON tareaRev.ANYO_081 = tareaEntr.ANYO_081 AND ");
		query.append("tareaRev.NUM_EXP_081 = tareaEntr.NUM_EXP_081 AND tareaRev.ID_TIPO_TAREA_081 = ?  ");
		query.append("AND tareaRev.ORDEN_081 < tareaEntr.ORDEN_081 AND tareaRev.IND_FACTURABLE_081 = '" + Constants.SI
				+ "' ");
		query.append("JOIN AA79B29T00 ON tareaRev.ID_LOTE_081 = ID_LOTE_029 ");
		query.append("WHERE tareaEntr.ID_TAREA_081 = ? ");
		query.append("ORDER BY tareaRev.ORDEN_081 DESC FETCH first 1 ROWS ONLY ");
		params.add(TipoTareaGestionAsociadaEnum.REVISAR.getValue());
		params.add(tarea.getIdTarea());

		List<Lotes> resultList = this.getJdbcTemplate().query(query.toString(), this.rwMapDatosLoteAsignado,
				params.toArray());

		return DataAccessUtils.uniqueResult(resultList);
	}

	@Override
	public DatosPagoProveedores cargarDatosDePagoAProveedorAsignadoRevisionExterna(Tareas tarea) {
		StringBuilder query = new StringBuilder();
		List<Object> params = new ArrayList<Object>();
		query.append("SELECT ID_TAREA_094, IND_RECARGO_FORMATO_094, NUM_PAL_RECARGO_FORMATO_094, ");
		query.append("IND_RECARGO_APREMIO_094, POR_RECARGO_APREMIO_094, IND_PENALIZACION_094, ");
		query.append("POR_PENALIZACION_094, NIVEL_CALIDAD_094 FROM AA79B81T00 ");
		query.append("JOIN AA79B94T00 ON ID_TAREA_094 = ID_TAREA_081 ");
		query.append("WHERE ID_TAREA_REL_081 = (Select tareaRev.ID_TAREA_081 FROM AA79B81T00 tareaEntr ");
		query.append("JOIN AA79B81T00 tareaRev ON tareaRev.ANYO_081 = tareaEntr.ANYO_081 ");
		query.append(" AND tareaRev.ORDEN_081 < tareaEntr.ORDEN_081 AND ");
		query.append(
				"tareaRev.NUM_EXP_081 = tareaEntr.NUM_EXP_081 AND tareaRev.ID_TIPO_TAREA_081 = ? WHERE tareaEntr.ID_TAREA_081 = ? ");
		query.append("ORDER BY tareaRev.ORDEN_081 DESC FETCH first 1 ROWS ONLY ");
		query.append(")  AND ID_TIPO_TAREA_081 = ? ");
		params.add(TipoTareaGestionAsociadaEnum.REVISAR.getValue());
		params.add(tarea.getIdTarea());
		params.add(TipoTareaGestionAsociadaEnum.REVISION_PAGO_PROVEEDOR.getValue());

		List<DatosPagoProveedores> resultList = this.getJdbcTemplate().query(query.toString(),
				this.rwMapDatosDePagoAProveedorAsignado, params.toArray());

		return DataAccessUtils.uniqueResult(resultList);
	}

	@Override
	public Long findDocsRevisionTraduccionExternaCount(DocumentoTarea documentoTarea, boolean startsWith) {
		List<Object> params = new ArrayList<Object>();
		StringBuilder query = new StringBuilder();
		query.append(DaoConstants.SELECT_COUNT);
		query.append(DaoConstants.FROM);
		query.append(DaoConstants.ABRIR_PARENTESIS);
		query.append(this.getQueryRevisionTraduccionExterna());
		query.append(DaoConstants.CERRAR_PARENTESIS);

		params.add(documentoTarea.getIdTarea());
		params.add(documentoTarea.getIdTarea());
		params.add(documentoTarea.getIdTarea());
		params.add(EstadoEjecucionTareaEnum.EJECUTADA.getValue());

		return this.getJdbcTemplate().queryForObject(query.toString(), params.toArray(), Long.class);
	}

	private String getQueryRevisionTraduccionExterna() {
		StringBuilder query = new StringBuilder();

		query.append(DaoConstants.SELECT);
		query.append(DaoConstants.BLANK + TAREAS_ID_TAREA_081 + DaoConstants.BLANK + DBConstants.IDTAREA
				+ DaoConstants.SIGNO_COMA);
		query.append(DaoConstants.BLANK + TAREAS_ID_TAREA_081 + DaoConstants.BLANK + DBConstants.IDTAREAAGRUPACION
				+ DaoConstants.SIGNO_COMA);
		query.append(TIPOSTAREA_DESC_ES_015_TIPOSTAREAES);
		query.append(TIPOSTAREA_DESC_EU_015_TIPOSTAREAEU);
		query.append(LOTES_NOMBRE_LOTE_029_NOMBRELOTE);
		query.append(" entidadesSolic.DESC_AMP_ES DESCAMPES, ");
		query.append(" entidadesSolic.DESC_AMP_EU DESCAMPEU, ");
		query.append(ENTIDADESSOLIC_DESC_ES_DESCES);
		query.append(ENTIDADESSOLIC_DESC_EU_DESCEU);
		query.append(EJECUCIONTAREAS_FECHA_EJECUCION_082_FECHAEJECUCIONTAREA);
		query.append(EJECUCIONTAREAS_IND_OBSV_082_INDOBSERVACIONES);
		query.append("docOriginal.ID_DOC_056");
		query.append(DaoConstants.BLANK);
		query.append(DBConstants.IDDOCORIGINAL);
		query.append(DaoConstants.SIGNO_COMA);
		query.append("docOriginal.TITULO_056");
		query.append(DaoConstants.BLANK);
		query.append(DBConstants.TITULODOCORIGINAL);
		query.append(DaoConstants.SIGNO_COMA);
		query.append("docOriginal.OID_FICHERO_056");
		query.append(DaoConstants.BLANK);
		query.append(DBConstants.OIDFICHERODOCORIG);
		query.append(" ,docOriginal.EXTENSION_DOC_056 EXTENSIONDOC");
		query.append(DaoConstants.SIGNO_COMA);
		query.append(DOCORIGINAL_CLASE_DOCUMENTO_056);
		query.append(DaoConstants.BLANK);
		query.append(DBConstants.CLASEDOCUMENTODOCORIG);
		query.append(DaoConstants.SIGNO_COMA);
		query.append("docOriginal.IND_ENCRIPTADO_056");
		query.append(DaoConstants.BLANK);
		query.append(DBConstants.INDENCRIPTADODOCORIG);
		query.append(DaoConstants.SIGNO_COMA);
		query.append(" docOriginal.NOMBRE_FICHERO_056 NOMBREDOCORIGINAL, ");
		query.append("docTraducido.ID_FICHERO_TRADUCIDO_087");
		query.append(DaoConstants.BLANK);
		query.append(DBConstants.IDDOCTRADUCIDO);
		query.append(DaoConstants.SIGNO_COMA);
		query.append("ficheroTraducido.TITULO_FICHERO_088");
		query.append(DaoConstants.BLANK);
		query.append(DBConstants.TITULODOCTRADUCIDO);
		query.append(DaoConstants.SIGNO_COMA);
		query.append("ficheroTraducido.OID_FICHERO_088");
		query.append(DaoConstants.BLANK);
		query.append(DBConstants.OIDFICHERODOCTRAD);
		query.append(DaoConstants.SIGNO_COMA);
		query.append("ficheroTraducido.IND_ENCRIPTADO_088");
		query.append(DaoConstants.BLANK);
		query.append(DBConstants.INDENCRIPTADODOCTRAD);
		query.append(DaoConstants.SIGNO_COMA);
		query.append(" ficheroTraducido.NOMBRE_FICHERO_088 NOMBREDOCTRADUCIDO, ");
		query.append("docRevisado.ID_FICHERO_TRADUCIDO_087");
		query.append(DaoConstants.BLANK);
		query.append(DBConstants.IDDOCREVISADO);
		query.append(DaoConstants.SIGNO_COMA);
		query.append("ficheroRevisado.TITULO_FICHERO_088");
		query.append(DaoConstants.BLANK);
		query.append(DBConstants.TITULODOCREVISADO);
		query.append(DaoConstants.SIGNO_COMA);
		query.append("ficheroRevisado.OID_FICHERO_088");
		query.append(DaoConstants.BLANK);
		query.append(DBConstants.OIDFICHERODOCREV);
		query.append(DaoConstants.SIGNO_COMA);
		query.append("ficheroRevisado.IND_ENCRIPTADO_088");
		query.append(DaoConstants.BLANK);
		query.append(DBConstants.INDENCRIPTADODOCREV);
		query.append(DaoConstants.SIGNO_COMA);
		query.append(DaoConstants.BLANK);
		query.append(" ficheroRevisado.NOMBRE_FICHERO_088 NOMBREFICHEROREVISADO, ");
		query.append(groupByRevTradExt());
		query.append(DaoConstants.BLANK).append(DBConstants.GROUPBYTEXT).append(DaoConstants.BLANK);
		query.append(DaoConstants.FROM);
		query.append(DBConstants.TABLA_81 + DaoConstants.BLANK + DaoConstants.TAREAS);
		query.append(DaoConstants.JOIN);
		query.append(DBConstants.TABLA_83);
		query.append(DaoConstants.BLANK);
		query.append(DBConstants.DOCUMENTOS_TAREA_ALIAS);
		query.append(DaoConstants.ON);
		query.append(DaoConstants.TAREAS + DaoConstants.SIGNO_PUNTO + DBConstants.ID_TAREA_081 + DaoConstants.SIGNOIGUAL
				+ DaoConstants.DOCUMENTOS_TAREA_MINUSCULA + DaoConstants.SIGNO_PUNTO + DBConstants.ID_TAREA_083);
		query.append(DaoConstants.JOIN);
		query.append(DBConstants.TABLA_56);
		query.append(DaoConstants.BLANK);
		query.append(DBConstants.DOC_ORIGINAL_ALIAS);
		query.append(DaoConstants.ON);
		query.append("documentosTarea.ID_DOC_083 = docOriginal.ID_DOC_056 ");
		query.append(DaoConstants.AND + DBConstants.DOC_ORIGINAL_ALIAS + DaoConstants.SIGNO_PUNTO
				+ DBConstants.CLASE_DOCUMENTO_056 + DaoConstants.BLANK);
		query.append(DaoConstants.IN).append(DaoConstants.ABRIR_PARENTESIS);
		query.append(ClasificacionDocumentosEnum.TRADUCCION.getValue()).append(DaoConstants.SIGNO_COMA);
		query.append(ClasificacionDocumentosEnum.TRABAJO.getValue());
		query.append(DaoConstants.BLANK).append(DaoConstants.CERRAR_PARENTESIS);
		query.append(DaoConstants.LEFT_JOIN);
		query.append("AA79B87S01 docTraducido");
		query.append(DaoConstants.ON);
		query.append("documentosTarea.ID_DOC_083 = docTraducido.ID_DOC_ORIG_087");
		query.append(DaoConstants.AND);
		query.append("documentosTarea.ID_TAREA_083 = docTraducido.ID_TAREA_087");
		query.append(DaoConstants.LEFT_JOIN);
		query.append("AA79B88S01 ficheroTraducido");
		query.append(DaoConstants.ON);
		query.append("docTraducido.ID_FICHERO_TRADUCIDO_087 = ficheroTraducido.ID_FICHERO_088");
		query.append(DaoConstants.LEFT_JOIN);
		query.append("AA79B87S01 docRevisado");
		query.append(DaoConstants.ON);
		query.append("ID_DOC_083 = docRevisado.ID_DOC_ORIG_087");
		query.append(DaoConstants.AND);
		query.append("docRevisado.ID_TAREA_087");
		query.append(DaoConstants.SIGNOIGUAL_INTERROGACION);
		query.append(DaoConstants.LEFT_JOIN);
		query.append("AA79B88S01 ficheroRevisado");
		query.append(DaoConstants.ON);
		query.append("docRevisado.ID_FICHERO_TRADUCIDO_087 = ficheroRevisado.ID_FICHERO_088");
		// TiposTarea
		query.append(DaoConstants.LEFT_JOIN);
		query.append("AA79B15S01 tiposTarea");
		query.append(DaoConstants.ON);
		query.append("tareas.ID_TIPO_TAREA_081 = tiposTarea.ID_015 ");
		// Lotes
		query.append(DaoConstants.LEFT_JOIN);
		query.append("AA79B29S01 lotes");
		query.append(DaoConstants.ON);
		query.append("tareas.ID_LOTE_081 = lotes.ID_LOTE_029 ");
		// Vista entidades solicitantes
		query.append(DaoConstants.LEFT_JOIN);
		query.append("X54JAPI_ENTIDADES_SOLIC entidadesSolic");
		query.append(DaoConstants.ON);
		query.append("lotes.TIPO_ENTIDAD_029 = entidadesSolic.TIPO");
		query.append(DaoConstants.AND);
		query.append("lotes.ID_EMPRESA_PROV_029 = entidadesSolic.CODIGO");
		query.append(DaoConstants.LEFT_JOIN);
		query.append("AA79B82S01 ejecucionTareas");
		query.append(DaoConstants.ON);
		query.append("tareas.ID_TAREA_081 = ejecucionTareas.ID_TAREA_082");
		query.append(DaoConstants.WHERE);
		query.append("((ID_TIPO_TAREA_081 = ").append(TipoTareaGestionAsociadaEnum.TRADUCIR.getValue());
		query.append(DaoConstants.AND);
		query.append("ID_TAREA_081 = (SELECT ID_TAREA_REL_081 FROM AA79B81S01 WHERE ID_TAREA_081 = ? )) ");
		query.append(DaoConstants.OR);
		query.append("(ID_TIPO_TAREA_081 = ").append(TipoTareaGestionAsociadaEnum.NO_CONFORMIDAD_PROVEEDOR.getValue());
		query.append(DaoConstants.AND);
		query.append("ID_TAREA_REL_081 = (SELECT ID_TAREA_REL_081 FROM AA79B81S01 WHERE ID_TAREA_081 = ? ) ");
		query.append(DaoConstants.AND + DBConstants.ESTADO_EJECUCION_081 + DaoConstants.SIGNOIGUAL_INTERROGACION);
		query.append(" )) ");

		return query.toString();
	}

	/**
	 * @return
	 */
	private String groupByRevTradExt() {
		Locale locale = LocaleContextHolder.getLocale();
		StringBuilder groupByText = new StringBuilder();

		groupByText.append(DaoConstants.ABRIR_PARENTESIS);
		groupByText.append(DaoConstants.BLANK);
		groupByText.append(DBConstants.EJECUCIONTAREAS_FECHA_EJECUCION_082);
		groupByText.append(DaoConstants.BLANK);
		groupByText.append(DaoConstants.SIGNO_CONCATENACION);
		groupByText.append(DaoConstants.SIGNO_APOSTROFO);
		groupByText.append(DaoConstants.BLANK);
		groupByText.append(DaoConstants.SIGNO_GUION);
		groupByText.append(DaoConstants.BLANK);
		groupByText.append(DaoConstants.SIGNO_APOSTROFO);
		groupByText.append(DaoConstants.SIGNO_CONCATENACION);
		groupByText.append(DaoConstants.BLANK);
		if (locale.getLanguage().equals(Constants.LANG_EUSKERA)) {
			groupByText.append(DBConstants.TIPOSTAREA_DESC_EU_015);
		} else {
			groupByText.append(DBConstants.TIPOSTAREA_DESC_ES_015);
		}
		groupByText.append(DaoConstants.BLANK);
		groupByText.append(DaoConstants.SIGNO_CONCATENACION);
		groupByText.append(DaoConstants.SIGNO_APOSTROFO);
		groupByText.append(DaoConstants.BLANK);
		groupByText.append(DaoConstants.SIGNO_GUION);
		groupByText.append(DaoConstants.BLANK);
		groupByText.append(DaoConstants.SIGNO_APOSTROFO);
		groupByText.append(DaoConstants.SIGNO_CONCATENACION);
		groupByText.append(DaoConstants.BLANK);
		groupByText.append(DBConstants.LOTES_NOMBRE_LOTE_029);
		groupByText.append(DaoConstants.BLANK);
		groupByText.append(DaoConstants.SIGNO_CONCATENACION);
		groupByText.append(DaoConstants.SIGNO_APOSTROFO);
		groupByText.append(DaoConstants.ABRIR_PARENTESIS);
		groupByText.append(DaoConstants.BLANK);
		groupByText.append(DaoConstants.SIGNO_APOSTROFO);
		groupByText.append(DaoConstants.SIGNO_CONCATENACION);
		groupByText.append(DaoConstants.BLANK);
		if (locale.getLanguage().equals(Constants.LANG_EUSKERA)) {
			groupByText.append(DBConstants.ENTIDADESSOLIC_DESC_EU);
		} else {
			groupByText.append(DBConstants.ENTIDADESSOLIC_DESC_ES);
		}
		groupByText.append(DaoConstants.BLANK);
		groupByText.append(DaoConstants.SIGNO_CONCATENACION);
		groupByText.append(DaoConstants.SIGNO_APOSTROFO);
		groupByText.append(DaoConstants.BLANK);
		groupByText.append(DaoConstants.CERRAR_PARENTESIS);
		groupByText.append(DaoConstants.SIGNO_APOSTROFO);
		groupByText.append(DaoConstants.CERRAR_PARENTESIS);

		return groupByText.toString();
	}

	@Override
	public List<Tareas> findDocsRevisionEntregaCliente(DocumentoTarea documentoTarea, JQGridRequestDto jqGridRequestDto,
			boolean startsWith) {
		final List<Object> params = new ArrayList<Object>();
		StringBuilder query = new StringBuilder();
		query.append(this.getQueryRevisionEntregaCliente());

		params.add(documentoTarea.getIdTarea());
		params.add(documentoTarea.getIdTarea());
		params.add(documentoTarea.getIdTarea());

		if (jqGridRequestDto != null && jqGridRequestDto.getSidx() != null) {
			jqGridRequestDto.setSidx(DBConstants.IDTAREA + DaoConstants.SIGNO_COMA + DBConstants.IDDOCORIGINAL);

			query = JQGridManager.getPaginationQuery(jqGridRequestDto, query,
					new String[] { DBConstants.IDTAREA, DBConstants.IDDOCORIGINAL });
		}

		return this.getJdbcTemplate().query(query.toString(), this.rwMapDocsRevEntregaClte, params.toArray());
	}

	@Override
	public List<Tareas> findDocsTraduccionEntregaCliente(DocumentoTarea documentoTarea,
			JQGridRequestDto jqGridRequestDto, boolean startsWith) {
		final List<Object> params = new ArrayList<Object>();
		StringBuilder query = new StringBuilder();

		query = this.getQueryTraduccionEntregaCliente(query, true);

		params.add(documentoTarea.getIdTarea());
		params.add(ClasificacionDocumentosEnum.TRADUCCION.getValue());

		if (jqGridRequestDto != null && jqGridRequestDto.getSidx() != null) {
			jqGridRequestDto.setSidx(DBConstants.IDTAREA + DaoConstants.SIGNO_COMA + DBConstants.IDDOCORIGINAL);

			query = JQGridManager.getPaginationQuery(jqGridRequestDto, query,
					new String[] { DBConstants.IDTAREA, DBConstants.IDDOCORIGINAL });
		}

		return this.getJdbcTemplate().query(query.toString(), this.rwMapDocTareasTraduccionFirma, params.toArray());
	}

	@Override
	public ExpedienteTradRev findDatosExpFinIzoberri(BigDecimal idTarea) {
		final List<Object> params = new ArrayList<Object>();
		StringBuilder query = new StringBuilder();
		query.append(
				" SELECT ANYO_053 ANYO, NUM_EXP_053 NUMEXP, REF_TRAMITAGUNE_053 REFTRAMITAGUNE FROM AA79B81T00 t1 ");
		query.append(" JOIN AA79B53T00 t2 ON ANYO_053 = ANYO_081 AND NUM_EXP_053 = NUM_EXP_081 ");
		query.append(" WHERE t1.ID_TAREA_081 = ? ");

		params.add(idTarea);

		List<ExpedienteTradRev> listaDatos = this.getJdbcTemplate().query(query.toString(), this.rwMapInfoExp,
				params.toArray());
		return DataAccessUtils.uniqueResult(listaDatos);
	}

	@Override
	public Long findDocsRevisionEntregaClienteCount(DocumentoTarea documentoTarea, boolean startsWith) {
		List<Object> params = new ArrayList<Object>();
		StringBuilder query = new StringBuilder();
		query.append(DaoConstants.SELECT_COUNT);
		query.append(DaoConstants.FROM);
		query.append(DaoConstants.ABRIR_PARENTESIS);
		query.append(this.getQueryRevisionEntregaCliente());
		query.append(DaoConstants.CERRAR_PARENTESIS);

		params.add(documentoTarea.getIdTarea());
		params.add(documentoTarea.getIdTarea());
		params.add(documentoTarea.getIdTarea());

		return this.getJdbcTemplate().queryForObject(query.toString(), params.toArray(), Long.class);
	}

	private String getQueryRevisionEntregaCliente() {
		StringBuilder query = new StringBuilder();

		query.append("SELECT documentosTarea.ID_TAREA_083 IDTAREA, ");
		this.getDocOriginal(query);
		query.append(" docOriginal.EXTENSION_DOC_056 EXTENSIONDOC, ");
		query.append(" docFinal.ID_FICHERO_FINAL_092 IDDOCFINAL, ");
		query.append(" ficheroFinal.TITULO_FICHERO_088 TITULODOCFINAL, ");
		query.append(" ficheroFinal.OID_FICHERO_088 OIDFICHERODOCFINAL, ");
		query.append(" ficheroFinal.NOMBRE_FICHERO_088 NOMBREFICHERODOCFINAL, ");
		query.append(" ficheroFinal.IND_ENCRIPTADO_088 INDENCRIPTDOCFINAL, ");
		query.append(" docJustificante.ID_FICHERO_JUSTIFICANTE_093 IDDOCJUST, ");
		query.append(DOCJUSTIFICANTE_IND_VISIBLE_093_INDVISIBLEDOCJUST);
		query.append(JUSTIFICANTE_TITULO_FICHERO_088_TITULODOCJUST);
		query.append(JUSTIFICANTE_OID_FICHERO_088_OIDFICHERODOCJUST);
		query.append(JUSTIFICANTE_IND_ENCRIPTADO_088_INDENCRIPTDOCJUST);
		query.append(" justificante.NOMBRE_FICHERO_088 NOMBREFICHERODOCJUST, ");
		query.append(" DOCFINAL.ID_DOC_FINAL_ORIG_092 IDDOCFINALORIG, ");
		query.append(" DOCFINAL.ESTADO_FIRMA_092 ESTADOFIRMA, ");
		query.append(" DOCFINAL.ID_DOC_FIRMADO_FINAL_092 IDDOCFINALFIRMADO, ");
		query.append(" DOCFINAL.ID_DOC_FIRMADO_ORIG_092 IDDOCORIGFIRMADO ");
		query.append(
				",FICHEROORIGINALFIRMADO.OID_FICHERO_088 OIDFICHEROORIGFIRMADO, FICHEROFINALFIRMADO.OID_FICHERO_088 OIDFICHEROFINALFIRMADO, FICHEROFINALFIRMADO.NOMBRE_FICHERO_088 NOMBREFICHEROFINALFIRMADO ");

		query.append(DaoConstants.FROM);
		query.append(DBConstants.TABLA_83);
		query.append(DaoConstants.BLANK);
		query.append(DBConstants.DOCUMENTOS_TAREA_ALIAS);
		query.append(DaoConstants.JOIN);
		query.append(
				"AA79B56S01 docOriginal ON documentosTarea.ID_DOC_083 = docOriginal.ID_DOC_056 AND docOriginal.CLASE_DOCUMENTO_056 = ");
		query.append(ClasificacionDocumentosEnum.REVISION.getValue()).append(DaoConstants.BLANK);
		query.append(DaoConstants.LEFT_JOIN);
		query.append(AA7956_PAREJADOC_ON_DOCORIGINAL);
		query.append(DaoConstants.LEFT_JOIN);
		query.append(
				"AA79B92S01 docFinal ON documentosTarea.ID_DOC_083 = docFinal.ID_DOC_ORIG_092 AND docFinal.ID_TAREA_092 = ? ");
		query.append(DaoConstants.LEFT_JOIN);
		query.append("AA79B88S01 ficheroFinal ON docFinal.ID_FICHERO_FINAL_092 = ficheroFinal.ID_FICHERO_088 ");
		query.append(DaoConstants.LEFT_JOIN);
		query.append(
				"AA79B93S01 docJustificante ON documentosTarea.ID_DOC_083 = docJustificante.ID_DOC_ORIG_093 AND docJustificante.ID_TAREA_093 = ? ");
		query.append(DaoConstants.LEFT_JOIN);
		query.append(AA7988_JUSTIFICANTE_ON_DOCJUSTIFICANTE);
		query.append(
				" LEFT JOIN AA79B88S01 FICHEROFINALFIRMADO ON DOCFINAL.ID_DOC_FIRMADO_FINAL_092 = FICHEROFINALFIRMADO.ID_FICHERO_088 ");
		query.append(
				" LEFT JOIN AA79B88S01 FICHEROORIGINALFIRMADO ON DOCFINAL.ID_DOC_FIRMADO_ORIG_092 = FICHEROORIGINALFIRMADO.ID_FICHERO_088 ");

		query.append(DaoConstants.WHERE);
		query.append(DBConstants.DOCUMENTOS_TAREA_ALIAS);
		query.append(".ID_TAREA_083");
		query.append(DaoConstants.SIGNOIGUAL_INTERROGACION);

		return query.toString();
	}

	private String getQueryTraducidosEntregaCliente() {
		StringBuilder query = new StringBuilder();

		query.append(DaoConstants.SELECT + DOCUMENTOSTAREA_ID_TAREA_083 + DaoConstants.BLANK + DBConstants.IDTAREA
				+ DaoConstants.SIGNO_COMA);
		query.append(DOCUMENTOSTAREA_ID_TAREA_083 + DaoConstants.BLANK + DBConstants.IDTAREAAGRUPACION
				+ DaoConstants.SIGNO_COMA);
		query.append(TIPOSTAREA_DESC_ES_015_TIPOSTAREAES);
		query.append(TIPOSTAREA_DESC_EU_015_TIPOSTAREAEU);
		query.append(LOTES_NOMBRE_LOTE_029_NOMBRELOTE);
		query.append(ENTIDADESSOLIC_DESC_ES_DESCES);
		query.append(ENTIDADESSOLIC_DESC_EU_DESCEU);
		query.append(EJECUCIONTAREAS_FECHA_EJECUCION_082_FECHAEJECUCIONTAREA);
		query.append(EJECUCIONTAREAS_IND_OBSV_082_INDOBSERVACIONES);
		this.getDocOriginal(query);
		query.append(" nvl(docFinal.ID_FICHERO_TRADUCIDO_087, docFinalEntrega.ID_FICHERO_FINAL_092) IDDOCFINAL, ");
		query.append(" nvl(ficheroFinal.TITULO_FICHERO_088, ficheroFinalEntrega.TITULO_FICHERO_088) TITULODOCFINAL, ");
		query.append(" nvl(ficheroFinal.OID_FICHERO_088, ficheroFinalEntrega.OID_FICHERO_088) OIDFICHERODOCFINAL, ");
		query.append(
				" nvl(ficheroFinal.IND_ENCRIPTADO_088, ficheroFinalEntrega.IND_ENCRIPTADO_088) INDENCRIPTDOCFINAL, ");
		query.append(" nvl(ficheroFinal.NOMBRE_FICHERO_088, ficheroFinalEntrega.NOMBRE_FICHERO_088) NOMBREDOCFINAL, ");
		query.append(" docJustificante.ID_DOC_ORIG_093 IDDOCJUST, ");
		query.append(DOCJUSTIFICANTE_IND_VISIBLE_093_INDVISIBLEDOCJUST);
		query.append(JUSTIFICANTE_TITULO_FICHERO_088_TITULODOCJUST);
		query.append(JUSTIFICANTE_OID_FICHERO_088_OIDFICHERODOCJUST);
		query.append(JUSTIFICANTE_IND_ENCRIPTADO_088_INDENCRIPTDOCJUST);
		query.append(" justificante.NOMBRE_FICHERO_088 NOMBREDOCJUST, ");
		query.append(DaoConstants.BLANK);
		query.append(groupByDocsEntregaClte(Constants.SI));
		query.append(DaoConstants.BLANK).append(DBConstants.GROUPBYTEXT).append(DaoConstants.BLANK);
		query.append(DaoConstants.FROM);
		query.append(DBConstants.TABLA_83);
		query.append(DaoConstants.BLANK);
		query.append(DBConstants.DOCUMENTOS_TAREA_ALIAS);
		query.append(DaoConstants.LEFT_JOIN);
		query.append("AA79B81S01 depTareas ON documentosTarea.ID_TAREA_083 = depTareas.ID_TAREA_081 ");
		query.append(DaoConstants.JOIN);
		query.append("AA79B56S01 docOriginal ON documentosTarea.ID_DOC_083 = docOriginal.ID_DOC_056 ");
		query.append(DaoConstants.LEFT_JOIN);
		query.append(AA7956_PAREJADOC_ON_DOCORIGINAL);
		query.append(DaoConstants.LEFT_JOIN);
		query.append(
				"AA79B87S01 docFinal ON documentosTarea.ID_DOC_083 = docFinal.ID_DOC_ORIG_087 AND docFinal.ID_TAREA_087 = depTareas.ID_TAREA_081 ");
		query.append(DaoConstants.LEFT_JOIN);
		query.append("AA79B88S01 ficheroFinal ON docFinal.ID_FICHERO_TRADUCIDO_087 = ficheroFinal.ID_FICHERO_088 ");
		/** nuevo **/
		query.append(DaoConstants.LEFT_JOIN);
		query.append(
				"AA79B92S01 docFinalEntrega ON documentosTarea.ID_DOC_083 = docFinalEntrega.ID_DOC_ORIG_092 AND docFinalEntrega.ID_TAREA_092 = depTareas.ID_TAREA_081 ");
		query.append(DaoConstants.LEFT_JOIN);
		query.append(
				"AA79B88S01 ficheroFinalEntrega ON docFinalEntrega.ID_FICHERO_FINAL_092 = ficheroFinalEntrega.ID_FICHERO_088 ");
		/**/
		query.append(DaoConstants.LEFT_JOIN);
		query.append(
				"AA79B93S01 docJustificante ON documentosTarea.ID_DOC_083 = docJustificante.ID_DOC_ORIG_093 AND docJustificante.ID_TAREA_093 = depTareas.ID_TAREA_081 ");
		query.append(DaoConstants.LEFT_JOIN);
		query.append(AA7988_JUSTIFICANTE_ON_DOCJUSTIFICANTE);
		query.append(DaoConstants.LEFT_JOIN);
		query.append(
				"AA79B81S01 tareas ON depTareas.ANYO_081 = tareas.ANYO_081 AND depTareas.NUM_EXP_081 = tareas.NUM_EXP_081");
		query.append(DaoConstants.LEFT_JOIN);
		query.append("AA79B15S01 tiposTarea ON depTareas.ID_TIPO_TAREA_081 = tiposTarea.ID_015 ");
		query.append(DaoConstants.LEFT_JOIN);
		query.append("AA79B29S01 lotes ON depTareas.ID_LOTE_081 = lotes.ID_LOTE_029 ");
		query.append(DaoConstants.LEFT_JOIN);
		query.append(X54JAPI_ENTIDADES_ON_LOTES_EQUALS_TIPO_AND_CODIGO);
		query.append(DaoConstants.LEFT_JOIN);
		query.append("AA79B82S01 ejecucionTareas ON depTareas.ID_TAREA_081 = ejecucionTareas.ID_TAREA_082 ");
		query.append(DaoConstants.LEFT_JOIN);
		query.append("AA79B77S01 datosContacto ON depTareas.DNI_RECURSO_081 = datosContacto.DNI_077 ");
		query.append(DaoConstants.WHERE);
		query.append(TAREAS_ID_TAREA_081);
		query.append(DaoConstants.SIGNOIGUAL_INTERROGACION);
		query.append(DaoConstants.AND);
		query.append(DaoConstants.ABRIR_PARENTESIS);
		query.append(TIPOSTAREA_ID_015);
		query.append(DaoConstants.SIGNOIGUAL_INTERROGACION);
		query.append(DaoConstants.OR);
		query.append(TIPOSTAREA_ID_015);
		query.append(DaoConstants.SIGNOIGUAL_INTERROGACION);
		query.append(DaoConstants.OR);
		query.append(TIPOSTAREA_ID_015);
		query.append(DaoConstants.SIGNOIGUAL_INTERROGACION);
		query.append(DaoConstants.OR);
		query.append(TIPOSTAREA_ID_015);
		query.append(DaoConstants.SIGNOIGUAL_INTERROGACION);
		query.append(DaoConstants.OR);
		query.append(TIPOSTAREA_ID_015);
		query.append(DaoConstants.SIGNOIGUAL_INTERROGACION);
		query.append(DaoConstants.CERRAR_PARENTESIS);
		query.append(DaoConstants.AND);
		query.append("depTareas.ORDEN_081 < tareas.ORDEN_081 ");
		query.append(DaoConstants.AND);
		query.append("docOriginal.CLASE_DOCUMENTO_056 <> ? ");

		return query.toString();
	}

	@Override
	public List<Tareas> findDocsRevisadosEntregaClte(Tareas tarea, JQGridRequestDto jqGridRequestDto,
			boolean startsWith) {
		StringBuilder query = new StringBuilder();
		query.append(this.getQueryDocsRevisados(tarea));

		if (jqGridRequestDto != null && jqGridRequestDto.getSidx() != null) {
			jqGridRequestDto.setSidx(DBConstants.FECHAEJECUCIONTAREA + DaoConstants.SIGNO_COMA
					+ DBConstants.IDTAREAAGRUPACION + DaoConstants.SIGNO_COMA + DBConstants.IDDOCORIGINAL);

			query = JQGridManager.getPaginationQuery(jqGridRequestDto, query, new String[] {
					DBConstants.FECHAEJECUCIONTAREA, DBConstants.IDTAREAAGRUPACION, DBConstants.IDDOCORIGINAL });
		}

		return this.getJdbcTemplate().query(query.toString(), this.rwMapDocsRevidadosEntregaClte);
	}

	@Override
	public List<Tareas> findDocsTraducidosEntregaClte(Tareas tarea, JQGridRequestDto jqGridRequestDto,
			boolean startsWith) {
		final List<Object> params = new ArrayList<Object>();
		StringBuilder query = new StringBuilder();
		query.append(this.getQueryTraducidosEntregaCliente());

		params.add(tarea.getIdTarea());
		params.add(TipoTareaGestionAsociadaEnum.TRADUCIR.getValue());
		params.add(TipoTareaGestionAsociadaEnum.NO_CONFORMIDAD_PROVEEDOR.getValue());
		params.add(TipoTareaGestionAsociadaEnum.REVISAR_TRADUCCION.getValue());
		// Para poder ver los de alguna entrega anterior si ha habido no
		// conformidad
		params.add(TipoTareaGestionAsociadaEnum.ENTREGA_CLIENTE_TRADUCCION.getValue());
		params.add(TipoTareaGestionAsociadaEnum.TRAD_ENTREGA_CLIENTE_TRADUCCION.getValue());
		// Para descartar los documentos de apoyo.
		params.add(ClasificacionDocumentosEnum.APOYO.getValue());

		if (jqGridRequestDto != null && jqGridRequestDto.getSidx() != null) {
			jqGridRequestDto.setSidx(DBConstants.FECHAEJECUCIONTAREA + DaoConstants.SIGNO_COMA
					+ DBConstants.IDTAREAAGRUPACION + DaoConstants.SIGNO_COMA + DBConstants.IDDOCORIGINAL);

			query = JQGridManager.getPaginationQuery(jqGridRequestDto, query, new String[] {
					DBConstants.FECHAEJECUCIONTAREA, DBConstants.IDTAREAAGRUPACION, DBConstants.IDDOCORIGINAL });
		}

		return this.getJdbcTemplate().query(query.toString(), this.rwMapDocsTraducidosEntregaClte, params.toArray());
	}

	public StringBuilder getQueryEntregaClteTradXliff(StringBuilder query) {
		getQueryDocsXliff(query);
		query.append(DaoConstants.WHERE);
		query.append(
				"tareas" + DaoConstants.SIGNO_PUNTO + DBConstants.ANYO_081 + DaoConstants.SIGNOIGUAL_INTERROGACION);
		query.append(DaoConstants.AND + "tareas" + DaoConstants.SIGNO_PUNTO + DBConstants.NUM_EXP_081
				+ DaoConstants.SIGNOIGUAL_INTERROGACION);
		query.append(DaoConstants.AND);
		query.append("tareas.ORDEN_081" + DaoConstants.SIGNO_MENOR_IGUAL_QUE);
		query.append(DaoConstants.ABRIR_PARENTESIS);
		query.append(DaoConstants.SELECT);
		query.append("t2.ORDEN_081 ");
		query.append(DaoConstants.FROM);
		query.append("AA79B81S01 t2 ");
		query.append(DaoConstants.WHERE + "t2" + DaoConstants.SIGNO_PUNTO + DBConstants.ID_TAREA_081
				+ DaoConstants.SIGNOIGUAL_INTERROGACION);
		query.append(DaoConstants.CERRAR_PARENTESIS);
		return query;
	}

	public StringBuilder getQueryTraduccionXliff(StringBuilder query) {
		getSelectQueryDocsXliff(query);
		query.append(" FROM ");
		query.append(" AA79B96S01 t1 ");
		query.append(" LEFT JOIN AA79B88S01 t2 ON t1.ID_FICHERO_XLIFF_096 = t2.ID_FICHERO_088 ");
		query.append(" LEFT JOIN AA79B82S01 ejecucionTareas ON t1.ID_TAREA_096 = ejecucionTareas.ID_TAREA_082 ");
		query.append(" LEFT JOIN AA79B81S01  tareas ON t1.ID_TAREA_096 = tareas.ID_TAREA_081");
		query.append(" LEFT JOIN AA79B15S01 tiposTarea ON tareas.ID_TIPO_TAREA_081 = tiposTarea.ID_015 ");
		query.append(" LEFT JOIN AA79B29S01 lotes ON tareas.ID_LOTE_081 = lotes.ID_LOTE_029 ");
		query.append(
				" LEFT JOIN X54JAPI_ENTIDADES_SOLIC entidadesSolic ON lotes.TIPO_ENTIDAD_029 = entidadesSolic.TIPO "
						+ "AND lotes.ID_EMPRESA_PROV_029 = entidadesSolic.CODIGO");
		query.append(" LEFT JOIN AA79B77S01 datosContacto ON tareas.DNI_RECURSO_081 = datosContacto.DNI_077 ");
		query.append(" WHERE ");
		query.append(" tareas.ANYO_081 = ? ");
		query.append(" AND tareas.NUM_EXP_081 = ? ");
		query.append(" AND tareas.ORDEN_081 <= (");
		query.append(" SELECT t2.ORDEN_081 FROM AA79B81S01 t2 WHERE t2.ID_TAREA_081 = ? ) ");

		return query;
	}

	/**
	 * @param query StringBuilder
	 */
	private void getQueryDocsXliff(StringBuilder query) {
		getSelectQueryDocsXliff(query);
		query.append(" FROM AA79B96S01 t1 ");
		query.append(" LEFT JOIN AA79B88S01 t2 ON t1.ID_FICHERO_XLIFF_096 = t2.ID_FICHERO_088 ");
		query.append(DaoConstants.LEFT_JOIN);
		query.append("AA79B82S01 ejecucionTareas ON t1.ID_TAREA_096 = ejecucionTareas.ID_TAREA_082 ");
		query.append(DaoConstants.LEFT_JOIN);
		query.append("AA79B81S01 depTareas ON t1.ID_TAREA_096 = depTareas.ID_TAREA_081");
		query.append(DaoConstants.LEFT_JOIN);
		query.append("AA79B81S01 tareas ON depTareas.ID_TAREA_081 = tareas.ID_TAREA_081");
		query.append(DaoConstants.LEFT_JOIN);
		query.append("AA79B15S01 tiposTarea ON depTareas.ID_TIPO_TAREA_081 = tiposTarea.ID_015 ");
		query.append(DaoConstants.LEFT_JOIN);
		query.append("AA79B29S01 lotes ON depTareas.ID_LOTE_081 = lotes.ID_LOTE_029 ");
		query.append(DaoConstants.LEFT_JOIN);
		query.append(X54JAPI_ENTIDADES_ON_LOTES_EQUALS_TIPO_AND_CODIGO);
		query.append(DaoConstants.LEFT_JOIN);
		query.append("AA79B77S01 datosContacto ON tareas.DNI_RECURSO_081 = datosContacto.DNI_077 ");
	}

	/**
	 *
	 * @param query StringBuilder
	 */
	private void getSelectQueryDocsXliff(StringBuilder query) {
		query.append(" SELECT t1.ID_TAREA_096 ID_TAREA_096, t1.ID_FICHERO_XLIFF_096 ID_FICHERO_XLIFF_096,");
		query.append(
				" t2.IND_ENCRIPTADO_088 IND_ENCRIPTADO_088,t2.OID_FICHERO_088 OID_FICHERO_088,t2.TITULO_FICHERO_088 TITULO_FICHERO_088, ");
		query.append(DaoConstants.BLANK + DaoConstants.T1_MINUSCULA_PUNTO + DBConstants.ID_TAREA_096
				+ DaoConstants.BLANK + DBConstants.IDTAREAAGRUPACION + DaoConstants.SIGNO_COMA);
		query.append(EJECUCIONTAREAS_FECHA_EJECUCION_082_FECHAEJECUCIONTAREA);
		query.append(groupByDocsEntregaClte(Constants.SI));
		query.append(DaoConstants.BLANK).append(DBConstants.GROUPBYTEXT).append(DaoConstants.BLANK);
	}

	@Override
	public List<DocumentoTarea> findAllDocsEntregaClteTradXliff(DocumentoTarea documentoTarea,
			JQGridRequestDto jqGridRequestDto, boolean startsWith) {
		final List<Object> params = new ArrayList<Object>();
		StringBuilder query = new StringBuilder();
		query = this.getQueryEntregaClteTradXliff(query);

		params.add(documentoTarea.getDocumentoOriginal().getAnyo());
		params.add(documentoTarea.getDocumentoOriginal().getNumExp());
		params.add(documentoTarea.getIdTarea());

		if (jqGridRequestDto != null && jqGridRequestDto.getSidx() != null) {
			jqGridRequestDto.setSidx(DBConstants.FECHAEJECUCIONTAREA + DaoConstants.SIGNO_COMA
					+ DBConstants.IDTAREAAGRUPACION + DaoConstants.SIGNO_COMA + DBConstants.ID_FICHERO_XLIFF_096);

			query = JQGridManager.getPaginationQuery(jqGridRequestDto, query, new String[] {
					DBConstants.FECHAEJECUCIONTAREA, DBConstants.IDTAREAAGRUPACION, DBConstants.ID_FICHERO_XLIFF_096 });
		}

		return this.getJdbcTemplate().query(query.toString(), this.rwMapDocTareasGroupXliff, params.toArray());

	}

	@Override
	public Long findAllDocsEntregaClteTradXliffCount(DocumentoTarea documentoTarea, boolean b) {
		List<Object> params = new ArrayList<Object>();
		StringBuilder query = new StringBuilder(SELECT_COUNT1_FROM);
		this.getQueryEntregaClteTradXliff(query);
		query.append(" )");
		params.add(documentoTarea.getDocumentoOriginal().getAnyo());
		params.add(documentoTarea.getDocumentoOriginal().getNumExp());
		params.add(documentoTarea.getIdTarea());
		return this.getJdbcTemplate().queryForObject(query.toString(), params.toArray(), Long.class);
	}

	@Override
	public Long findDocsRevisadosEntregaClteCount(Tareas tarea, boolean startsWith) {
		StringBuilder query = new StringBuilder();
		query.append(DaoConstants.SELECT_COUNT);
		query.append(DaoConstants.FROM);
		query.append(DaoConstants.ABRIR_PARENTESIS);
		query.append(this.getQueryDocsRevisados(tarea));
		query.append(DaoConstants.CERRAR_PARENTESIS);

		return this.getJdbcTemplate().queryForObject(query.toString(), Long.class);
	}

	@Override
	public Long findDocsTraducidosEntregaClteCount(Tareas tarea, boolean startsWith) {
		List<Object> params = new ArrayList<Object>();
		StringBuilder query = new StringBuilder();
		query.append(DaoConstants.SELECT_COUNT);
		query.append(DaoConstants.FROM);
		query.append(DaoConstants.ABRIR_PARENTESIS);
		query.append(this.getQueryTraducidosEntregaCliente());
		query.append(DaoConstants.CERRAR_PARENTESIS);

		params.add(tarea.getIdTarea());
		params.add(TipoTareaGestionAsociadaEnum.TRADUCIR.getValue());
		params.add(TipoTareaGestionAsociadaEnum.NO_CONFORMIDAD_PROVEEDOR.getValue());
		params.add(TipoTareaGestionAsociadaEnum.REVISAR_TRADUCCION.getValue());
		params.add(TipoTareaGestionAsociadaEnum.ENTREGA_CLIENTE_TRADUCCION.getValue());
		params.add(TipoTareaGestionAsociadaEnum.TRAD_ENTREGA_CLIENTE_TRADUCCION.getValue());
		// Para descartar los documentos de apoyo.
		params.add(ClasificacionDocumentosEnum.APOYO.getValue());

		return this.getJdbcTemplate().queryForObject(query.toString(), params.toArray(), Long.class);
	}

	private String getQueryDocsRevisadosEntregaClte(Tareas tarea) {
		StringBuilder query = new StringBuilder();

		query.append(DaoConstants.SELECT);
		query.append(DaoConstants.BLANK + TAREAS_ID_TAREA_081 + DaoConstants.BLANK + DBConstants.IDTAREA
				+ DaoConstants.SIGNO_COMA);
		query.append(DaoConstants.BLANK + TAREAS_ID_TAREA_081 + DaoConstants.BLANK + DBConstants.IDTAREAAGRUPACION
				+ DaoConstants.SIGNO_COMA);
		query.append(TIPOSTAREA_DESC_ES_015_TIPOSTAREAES);
		query.append(TIPOSTAREA_DESC_EU_015_TIPOSTAREAEU);
		query.append(LOTES_NOMBRE_LOTE_029_NOMBRELOTE);
		query.append(ENTIDADESSOLIC_DESC_ES_DESCES);
		query.append(ENTIDADESSOLIC_DESC_EU_DESCEU);
		query.append(EJECUCIONTAREAS_FECHA_EJECUCION_082_FECHAEJECUCIONTAREA);
		query.append(EJECUCIONTAREAS_IND_OBSV_082_INDOBSERVACIONES);
		this.getDocOriginal(query);
		query.append(" docRevisado.ID_FICHERO_TRADUCIDO_087 IDDOCFINAL, ");
		query.append(" ficheroRevisado.TITULO_FICHERO_088 TITULODOCFINAL, ");
		query.append(" ficheroRevisado.OID_FICHERO_088 OIDFICHERODOCFINAL, ");
		query.append(" ficheroRevisado.IND_ENCRIPTADO_088 INDENCRIPTDOCFINAL, ");
		query.append(" ficheroRevisado.NOMBRE_FICHERO_088 NOMBREDOCFINAL, ");
		query.append(" docJustificante.ID_FICHERO_JUSTIFICANTE_093 IDDOCJUST, ");
		query.append(DOCJUSTIFICANTE_IND_VISIBLE_093_INDVISIBLEDOCJUST);
		query.append(JUSTIFICANTE_TITULO_FICHERO_088_TITULODOCJUST);
		query.append(JUSTIFICANTE_OID_FICHERO_088_OIDFICHERODOCJUST);
		query.append(JUSTIFICANTE_IND_ENCRIPTADO_088_INDENCRIPTDOCJUST);
		query.append(" justificante.NOMBRE_FICHERO_088 NOMBREFICHERODOCJUST, ");
		query.append(DaoConstants.BLANK);
		query.append(groupByDocsRevisadosEntregaClte());
		query.append(DaoConstants.BLANK).append(DBConstants.GROUPBYTEXT).append(DaoConstants.BLANK);
		query.append(DaoConstants.FROM);
		query.append("AA79B81S01 tareas");
		query.append(DaoConstants.BLANK);
		query.append(DaoConstants.JOIN);
		query.append(DBConstants.TABLA_83);
		query.append(DaoConstants.BLANK);
		query.append(DBConstants.DOCUMENTOS_TAREA_ALIAS);
		query.append(DaoConstants.ON);
		query.append("tareas.ID_TAREA_081 = documentosTarea.ID_TAREA_083 ");
		query.append(DaoConstants.JOIN);
		query.append(
				"AA79B56S01 docOriginal ON documentosTarea.ID_DOC_083 = docOriginal.ID_DOC_056 AND docOriginal.CLASE_DOCUMENTO_056 ");
		query.append(DaoConstants.IN).append(DaoConstants.ABRIR_PARENTESIS);
		query.append(ClasificacionDocumentosEnum.REVISION.getValue()).append(DaoConstants.SIGNO_COMA);
		query.append(ClasificacionDocumentosEnum.TRABAJO.getValue());
		query.append(DaoConstants.BLANK).append(DaoConstants.CERRAR_PARENTESIS);
		query.append(DaoConstants.LEFT_JOIN);
		query.append(AA7956_PAREJADOC_ON_DOCORIGINAL);
		query.append(DaoConstants.LEFT_JOIN);
		query.append(
				"AA79B87S01 docRevisado ON documentosTarea.ID_DOC_083 = docRevisado.ID_DOC_ORIG_087 AND tareas.ID_TAREA_081 = docRevisado.ID_TAREA_087 ");
		query.append(DaoConstants.LEFT_JOIN);
		query.append(
				"AA79B88S01 ficheroRevisado ON docRevisado.ID_FICHERO_TRADUCIDO_087 = ficheroRevisado.ID_FICHERO_088 ");
		query.append(DaoConstants.LEFT_JOIN);
		query.append(
				"AA79B93S01 docJustificante ON documentosTarea.ID_DOC_083 = docJustificante.ID_DOC_ORIG_093 AND tareas.ID_TAREA_081 = docJustificante.ID_TAREA_093 ");
		query.append(DaoConstants.LEFT_JOIN);
		query.append(AA7988_JUSTIFICANTE_ON_DOCJUSTIFICANTE);
		query.append(DaoConstants.LEFT_JOIN);
		query.append("AA79B15S01 tiposTarea ON tareas.ID_TIPO_TAREA_081 = tiposTarea.ID_015 ");
		query.append(DaoConstants.LEFT_JOIN);
		query.append("AA79B29S01 lotes ON tareas.ID_LOTE_081 = lotes.ID_LOTE_029 ");
		query.append(DaoConstants.LEFT_JOIN);
		query.append(X54JAPI_ENTIDADES_ON_LOTES_EQUALS_TIPO_AND_CODIGO);
		query.append(DaoConstants.LEFT_JOIN);
		query.append("AA79B82S01 ejecucionTareas ON tareas.ID_TAREA_081 = ejecucionTareas.ID_TAREA_082 ");
		query.append(DaoConstants.LEFT_JOIN);
		query.append("AA79B77S01 datosContacto ON tareas.DNI_RECURSO_081 = datosContacto.DNI_077 ");
		query.append(DaoConstants.WHERE);
		query.append("tareas.ID_TIPO_TAREA_081");
		query.append(DaoConstants.IN);
		query.append(DaoConstants.ABRIR_PARENTESIS);
		query.append(TipoTareaGestionAsociadaEnum.REVISAR.getValue());
		query.append(DaoConstants.SIGNO_COMA);
		query.append(TipoTareaGestionAsociadaEnum.NO_CONFORMIDAD_PROVEEDOR.getValue());
		query.append(DaoConstants.CERRAR_PARENTESIS);
		query.append(DaoConstants.AND);
		query.append("tareas.ANYO_081");
		query.append(DaoConstants.SIGNOIGUAL);
		query.append(tarea.getAnyo());
		query.append(DaoConstants.AND);
		query.append("tareas.NUM_EXP_081");
		query.append(DaoConstants.SIGNOIGUAL);
		query.append(tarea.getNumExp());
		query.append(
				DaoConstants.AND + DaoConstants.TAREAS + DaoConstants.SIGNO_PUNTO + DBConstants.ESTADO_EJECUCION_081
						+ DaoConstants.SIGNOIGUAL + EstadoEjecucionTareaEnum.EJECUTADA.getValue());

		return query.toString();
	}

	private String getQueryDocsRevisadosRevEntregaClte(Tareas tarea) {
		StringBuilder query = new StringBuilder();

		query.append(DaoConstants.SELECT);
		query.append(DaoConstants.BLANK + TAREAS_ID_TAREA_081 + DaoConstants.BLANK + DBConstants.IDTAREA
				+ DaoConstants.SIGNO_COMA);
		query.append(DaoConstants.BLANK + TAREAS_ID_TAREA_081 + DaoConstants.BLANK + DBConstants.IDTAREAAGRUPACION
				+ DaoConstants.SIGNO_COMA);
		query.append(TIPOSTAREA_DESC_ES_015_TIPOSTAREAES);
		query.append(TIPOSTAREA_DESC_EU_015_TIPOSTAREAEU);
		query.append(LOTES_NOMBRE_LOTE_029_NOMBRELOTE);
		query.append(ENTIDADESSOLIC_DESC_ES_DESCES);
		query.append(ENTIDADESSOLIC_DESC_EU_DESCEU);
		query.append(EJECUCIONTAREAS_FECHA_EJECUCION_082_FECHAEJECUCIONTAREA);
		query.append(EJECUCIONTAREAS_IND_OBSV_082_INDOBSERVACIONES);
		this.getDocOriginal(query);
		query.append(" docRevisado.ID_FICHERO_FINAL_092 IDDOCFINAL, ");
		query.append(" ficheroRevisado.TITULO_FICHERO_088 TITULODOCFINAL, ");
		query.append(" ficheroRevisado.OID_FICHERO_088 OIDFICHERODOCFINAL, ");
		query.append(" ficheroRevisado.IND_ENCRIPTADO_088 INDENCRIPTDOCFINAL, ");
		query.append(" ficheroRevisado.NOMBRE_FICHERO_088 NOMBREDOCFINAL, ");
		query.append(" docJustificante.ID_FICHERO_JUSTIFICANTE_093 IDDOCJUST, ");
		query.append(DOCJUSTIFICANTE_IND_VISIBLE_093_INDVISIBLEDOCJUST);
		query.append(JUSTIFICANTE_TITULO_FICHERO_088_TITULODOCJUST);
		query.append(JUSTIFICANTE_OID_FICHERO_088_OIDFICHERODOCJUST);
		query.append(JUSTIFICANTE_IND_ENCRIPTADO_088_INDENCRIPTDOCJUST);
		query.append(" justificante.NOMBRE_FICHERO_088 NOMBREFICHERODOCJUST, ");
		query.append(DaoConstants.BLANK);
		query.append(groupByDocsRevisadosEntregaClte());
		query.append(DaoConstants.BLANK).append(DBConstants.GROUPBYTEXT).append(DaoConstants.BLANK);
		query.append(DaoConstants.FROM);
		query.append("AA79B81S01 tareas");
		query.append(DaoConstants.BLANK);
		query.append(DaoConstants.JOIN);
		query.append(DBConstants.TABLA_83);
		query.append(DaoConstants.BLANK);
		query.append(DBConstants.DOCUMENTOS_TAREA_ALIAS);
		query.append(DaoConstants.ON);
		query.append("tareas.ID_TAREA_081 = documentosTarea.ID_TAREA_083 ");
		query.append(DaoConstants.JOIN);
		query.append(
				"AA79B56S01 docOriginal ON documentosTarea.ID_DOC_083 = docOriginal.ID_DOC_056 AND docOriginal.CLASE_DOCUMENTO_056 ");
		query.append(DaoConstants.IN).append(DaoConstants.ABRIR_PARENTESIS);
		query.append(ClasificacionDocumentosEnum.REVISION.getValue()).append(DaoConstants.SIGNO_COMA);
		query.append(ClasificacionDocumentosEnum.TRABAJO.getValue());
		query.append(DaoConstants.BLANK).append(DaoConstants.CERRAR_PARENTESIS);
		query.append(DaoConstants.LEFT_JOIN);
		query.append(AA7956_PAREJADOC_ON_DOCORIGINAL);
		query.append(DaoConstants.LEFT_JOIN);
		query.append(
				"AA79B92S01 docRevisado ON documentosTarea.ID_DOC_083 = docRevisado.ID_DOC_ORIG_092 AND tareas.ID_TAREA_081 = docRevisado.ID_TAREA_092 ");
		query.append(DaoConstants.LEFT_JOIN);
		query.append(
				"AA79B88S01 ficheroRevisado ON docRevisado.ID_FICHERO_FINAL_092 = ficheroRevisado.ID_FICHERO_088 ");
		query.append(DaoConstants.LEFT_JOIN);
		query.append(
				"AA79B93S01 docJustificante ON documentosTarea.ID_DOC_083 = docJustificante.ID_DOC_ORIG_093 AND tareas.ID_TAREA_081 = docJustificante.ID_TAREA_093 ");
		query.append(DaoConstants.LEFT_JOIN);
		query.append(AA7988_JUSTIFICANTE_ON_DOCJUSTIFICANTE);
		query.append(DaoConstants.LEFT_JOIN);
		query.append("AA79B15S01 tiposTarea ON tareas.ID_TIPO_TAREA_081 = tiposTarea.ID_015 ");
		query.append(DaoConstants.LEFT_JOIN);
		query.append("AA79B29S01 lotes ON tareas.ID_LOTE_081 = lotes.ID_LOTE_029 ");
		query.append(DaoConstants.LEFT_JOIN);
		query.append(X54JAPI_ENTIDADES_ON_LOTES_EQUALS_TIPO_AND_CODIGO);
		query.append(DaoConstants.LEFT_JOIN);
		query.append("AA79B82S01 ejecucionTareas ON tareas.ID_TAREA_081 = ejecucionTareas.ID_TAREA_082 ");
		query.append(DaoConstants.LEFT_JOIN);
		query.append("AA79B77S01 datosContacto ON tareas.DNI_RECURSO_081 = datosContacto.DNI_077 ");
		query.append(DaoConstants.WHERE);
		query.append("tareas.ID_TIPO_TAREA_081");
		query.append(DaoConstants.IN);
		query.append(DaoConstants.ABRIR_PARENTESIS);
		query.append(TipoTareaGestionAsociadaEnum.ENTREGA_CLIENTE_REVISION.getValue());
		query.append(DaoConstants.CERRAR_PARENTESIS);
		query.append(DaoConstants.AND);
		query.append("tareas.ANYO_081");
		query.append(DaoConstants.SIGNOIGUAL);
		query.append(tarea.getAnyo());
		query.append(DaoConstants.AND);
		query.append("tareas.NUM_EXP_081");
		query.append(DaoConstants.SIGNOIGUAL);
		query.append(tarea.getNumExp());
		query.append(DaoConstants.AND + DaoConstants.TAREAS + DaoConstants.SIGNO_PUNTO + DBConstants.ORDEN_081
				+ DaoConstants.SIGNO_MENOR_QUE);
		query.append(DaoConstants.ABRIR_PARENTESIS + DaoConstants.SELECT + DaoConstants.T2_MINUSCULA_PUNTO
				+ DBConstants.ORDEN_081);
		query.append(DaoConstants.FROM + DBConstants.TABLA_81 + DaoConstants.BLANK + DaoConstants.T2_MINUSCULA);
		query.append(DaoConstants.WHERE + DaoConstants.T2_MINUSCULA_PUNTO + DBConstants.ID_TAREA_081);
		query.append(DaoConstants.SIGNOIGUAL + tarea.getIdTarea() + DaoConstants.CERRAR_PARENTESIS);

		return query.toString();
	}

	private String getQueryDocsRevisados(Tareas tarea) {
		StringBuilder query = new StringBuilder();

		query.append(DaoConstants.ABRIR_PARENTESIS + getQueryDocsRevisadosEntregaClte(tarea)
				+ DaoConstants.CERRAR_PARENTESIS);
		query.append(DaoConstants.UNION);
		query.append(DaoConstants.ABRIR_PARENTESIS + getQueryDocsRevisadosRevEntregaClte(tarea)
				+ DaoConstants.CERRAR_PARENTESIS);

		return query.toString();
	}

	/**
	 * @return String
	 */
	private String groupByDocsRevisadosEntregaClte() {
		return groupByDocsEntregaClte(Constants.NO);
	}

	public String groupByDocsEntregaClte(String buscarTraduccion) {
		Locale locale = LocaleContextHolder.getLocale();
		StringBuilder groupByText = new StringBuilder();

		groupByText.append(DaoConstants.ABRIR_PARENTESIS);
		groupByText.append(DaoConstants.BLANK);
		if (Constants.NO.equals(buscarTraduccion)) {
			groupByText.append(TAREAS_ID_TAREA_081);
			groupByText.append(DaoConstants.SIGNO_CONCATENACION);
			groupByText.append(DaoConstants.SIGNO_APOSTROFO);
			groupByText.append(DaoConstants.ALMOHADILLA);
			groupByText.append(DaoConstants.SIGNO_APOSTROFO);
			groupByText.append(DaoConstants.SIGNO_CONCATENACION);
		}
		groupByText.append(" NVL(TO_CHAR(" + DBConstants.EJECUCIONTAREAS_FECHA_EJECUCION_082 + ",'YY/MM/DD'),'') ");
		groupByText.append(DaoConstants.BLANK);
		groupByText.append(DaoConstants.SIGNO_CONCATENACION);
		groupByText.append(DaoConstants.SIGNO_APOSTROFO);
		groupByText.append(DaoConstants.BLANK);
		groupByText.append(DaoConstants.SIGNO_GUION);
		groupByText.append(DaoConstants.BLANK);
		groupByText.append(DaoConstants.SIGNO_APOSTROFO);
		groupByText.append(DaoConstants.SIGNO_CONCATENACION);
		groupByText.append(DaoConstants.BLANK);
		if (locale.getLanguage().equals(Constants.LANG_EUSKERA)) {
			groupByText.append(DBConstants.TIPOSTAREA_DESC_EU_015);
		} else {
			groupByText.append(DBConstants.TIPOSTAREA_DESC_ES_015);
		}
		groupByText.append(DaoConstants.BLANK);
		groupByText.append(DaoConstants.SIGNO_CONCATENACION);
		groupByText.append(DaoConstants.SIGNO_APOSTROFO);
		groupByText.append(DaoConstants.BLANK);
		groupByText.append(DaoConstants.SIGNO_GUION);
		groupByText.append(DaoConstants.BLANK);
		groupByText.append(DaoConstants.SIGNO_APOSTROFO);
		groupByText.append(DaoConstants.SIGNO_CONCATENACION);
		groupByText.append(DaoConstants.DECODE);
		groupByText.append(DaoConstants.ABRIR_PARENTESIS);
		groupByText.append(DaoConstants.NVL);
		groupByText.append(DaoConstants.ABRIR_PARENTESIS);
		groupByText.append("lotes.ID_LOTE_029");
		groupByText.append(DaoConstants.SIGNO_COMA);
		groupByText.append(Constants.CERO);
		groupByText.append(DaoConstants.CERRAR_PARENTESIS);
		groupByText.append(DaoConstants.SIGNO_COMA);
		groupByText.append(Constants.CERO);
		groupByText.append(DaoConstants.SIGNO_COMA);
		groupByText.append(DaoConstants.ABRIR_PARENTESIS);
		groupByText.append("datosContacto.APEL1_077");
		groupByText.append(DaoConstants.SIGNO_CONCATENACION);
		groupByText.append(DaoConstants.SIGNO_APOSTROFO);
		groupByText.append(DaoConstants.BLANK);
		groupByText.append(DaoConstants.SIGNO_APOSTROFO);
		groupByText.append(DaoConstants.SIGNO_CONCATENACION);
		groupByText.append("datosContacto.APEL2_077");
		groupByText.append(DaoConstants.SIGNO_CONCATENACION);
		groupByText.append(DaoConstants.SIGNO_APOSTROFO);
		groupByText.append(DaoConstants.SIGNO_COMA);
		groupByText.append(DaoConstants.SIGNO_APOSTROFO);
		groupByText.append(DaoConstants.SIGNO_CONCATENACION);
		groupByText.append("datosContacto.NOMBRE_077");
		groupByText.append(DaoConstants.CERRAR_PARENTESIS);
		groupByText.append(DaoConstants.SIGNO_COMA);
		groupByText.append(DaoConstants.BLANK);
		groupByText.append(DBConstants.LOTES_NOMBRE_LOTE_029);
		groupByText.append(DaoConstants.BLANK);
		groupByText.append(DaoConstants.SIGNO_CONCATENACION);
		groupByText.append(DaoConstants.SIGNO_APOSTROFO);
		groupByText.append(DaoConstants.ABRIR_PARENTESIS);
		groupByText.append(DaoConstants.BLANK);
		groupByText.append(DaoConstants.SIGNO_APOSTROFO);
		groupByText.append(DaoConstants.SIGNO_CONCATENACION);
		groupByText.append(DaoConstants.BLANK);
		if (locale.getLanguage().equals(Constants.LANG_EUSKERA)) {
			groupByText.append(DBConstants.ENTIDADESSOLIC_DESC_EU);
		} else {
			groupByText.append(DBConstants.ENTIDADESSOLIC_DESC_ES);
		}
		groupByText.append(DaoConstants.BLANK);
		groupByText.append(DaoConstants.SIGNO_CONCATENACION);
		groupByText.append(DaoConstants.SIGNO_APOSTROFO);
		groupByText.append(DaoConstants.BLANK);
		groupByText.append(DaoConstants.CERRAR_PARENTESIS);
		groupByText.append(DaoConstants.SIGNO_APOSTROFO);
		groupByText.append(DaoConstants.CERRAR_PARENTESIS);
		groupByText.append(DaoConstants.CERRAR_PARENTESIS);

		return groupByText.toString();
	}

	@Override()
	public List<DocumentoTarea> findDocsDetalleTarea(BigDecimal idTarea, String idioma) {

		Locale locale = new Locale(idioma);
		final List<Object> params = new ArrayList<Object>();
		StringBuilder query = new StringBuilder();

		query.append(DaoConstants.SELECT);
		query.append("docOriginal.ID_DOC_056");
		query.append(DaoConstants.BLANK);
		query.append(DBConstants.IDDOCORIGINAL);
		query.append(DaoConstants.BLANK);
		query.append(DaoConstants.SIGNO_COMA);
		query.append("docOriginal.TITULO_056");
		query.append(DaoConstants.BLANK);
		query.append(DBConstants.TITULODOCORIGINAL);
		query.append(DaoConstants.BLANK);
		query.append(DaoConstants.SIGNO_COMA);
		query.append("docOriginal.EXTENSION_DOC_056");
		query.append(DaoConstants.BLANK);
		query.append(DBConstants.EXTENSIONDOC);
		query.append(DaoConstants.BLANK);
		query.append(DaoConstants.SIGNO_COMA);
		if (locale.getLanguage().equals(Constants.LANG_CASTELLANO)) {
			query.append("clasificacionDoc.DESC_ES_075");
		} else {
			query.append("clasificacionDoc.DESC_EU_075");
		}
		query.append(DaoConstants.BLANK);
		query.append(DBConstants.CLASEDOCUMENTODOCORIG);
		query.append(DaoConstants.BLANK);
		query.append(DaoConstants.SIGNO_COMA);
		query.append("docOriginal.OID_FICHERO_056");
		query.append(DaoConstants.BLANK);
		query.append(DBConstants.OIDFICHERODOCORIG);
		query.append(DaoConstants.BLANK);
		query.append(DaoConstants.SIGNO_COMA);
		query.append("docOriginal.NOMBRE_FICHERO_056");
		query.append(DaoConstants.BLANK);
		query.append(DBConstants.NOMBREFICHERO);
		query.append(DaoConstants.BLANK);
		query.append(DaoConstants.SIGNO_COMA);
		query.append(DaoConstants.BLANK);
		query.append("docOriginal.CONTENT_TYPE_056");
		query.append(DaoConstants.BLANK);
		query.append(DBConstants.CONTENTTYPE);
		query.append(DaoConstants.BLANK);
		query.append(DaoConstants.SIGNO_COMA);
		query.append(DaoConstants.BLANK);
		query.append("docOriginal.TAMANO_DOC_056");
		query.append(DaoConstants.BLANK);
		query.append(DBConstants.TAMANODOC);
		query.append(DaoConstants.BLANK);
		query.append(DaoConstants.SIGNO_COMA);
		query.append("parejaDocOriginal.ID_DOC_056");
		query.append(DaoConstants.BLANK);
		query.append(DBConstants.IDDOCPAREJAORIG);
		query.append(DaoConstants.BLANK);
		query.append(DaoConstants.SIGNO_COMA);
		query.append("parejaDocOriginal.OID_FICHERO_056");
		query.append(DaoConstants.BLANK);
		query.append(DBConstants.OIDFICHERODOCPAREJAORIG);
		query.append(DaoConstants.BLANK);
		query.append(DaoConstants.SIGNO_COMA);
		query.append("parejaDocOriginal.NOMBRE_FICHERO_056");
		query.append(DaoConstants.BLANK);
		query.append(DBConstants.NOMBREFICHEROPAREJAORIG);
		query.append(DaoConstants.BLANK);
		query.append(DaoConstants.SIGNO_COMA);
		query.append(DaoConstants.BLANK);
		query.append("parejaDocOriginal.CONTENT_TYPE_056");
		query.append(DaoConstants.BLANK);
		query.append(DBConstants.CONTENTTYPE2);
		query.append(DaoConstants.BLANK);
		query.append(DaoConstants.SIGNO_COMA);
		query.append(DaoConstants.BLANK);
		query.append("parejaDocOriginal.TAMANO_DOC_056");
		query.append(DaoConstants.BLANK);
		query.append(DBConstants.TAMANODOC2);
		query.append(DaoConstants.BLANK);
		query.append(DaoConstants.SIGNO_COMA);
		query.append(DaoConstants.BLANK);
		query.append("NVL(docOriginal.PERSONA_CONTACTO_056,'-') AS");
		query.append(DaoConstants.BLANK);
		query.append("PERSONA");
		query.append(DaoConstants.BLANK);
		query.append(DaoConstants.SIGNO_COMA);
		query.append(DaoConstants.BLANK);
		query.append("NVL(docOriginal.EMAIL_CONTACTO_056,'-') AS");
		query.append(DaoConstants.BLANK);
		query.append("EMAIL");
		query.append(DaoConstants.BLANK);
		query.append(DaoConstants.SIGNO_COMA);
		query.append(DaoConstants.BLANK);
		query.append("NVL(docOriginal.TELEFONO_CONTACTO_056,'-') AS");
		query.append(DaoConstants.BLANK);
		query.append("TELEFONO");
		query.append(DaoConstants.BLANK);
		query.append(DaoConstants.FROM);
		query.append(DBConstants.TABLA_83);
		query.append(DaoConstants.BLANK);
		query.append(DBConstants.DOCUMENTOS_TAREA_ALIAS);
		query.append(DaoConstants.JOIN);
		query.append("AA79B56S01 docOriginal");
		query.append(DaoConstants.ON);
		query.append("documentosTarea.ID_DOC_083 = docOriginal.ID_DOC_056 ");
		query.append(DaoConstants.LEFT_JOIN);
		query.append("AA79B56S01 parejaDocOriginal");
		query.append(DaoConstants.ON);
		query.append("parejaDocOriginal.ID_DOC_REL_056 = docOriginal.ID_DOC_056 ");
		query.append(DaoConstants.LEFT_JOIN);
		query.append("AA79B75S01 clasificacionDoc");
		query.append(DaoConstants.ON);
		query.append("clasificacionDoc.ID_075 = docOriginal.CLASE_DOCUMENTO_056 ");
		query.append(DaoConstants.WHERE);
		query.append(DOCUMENTOSTAREA_ID_TAREA_083);
		query.append(DaoConstants.SIGNOIGUAL_INTERROGACION);
		query.append(DaoConstants.ORDER_BY + "docOriginal.ID_DOC_056 ASC ");

		params.add(idTarea);

		return this.getJdbcTemplate().query(query.toString(), this.rwMapDocsDetalleTarea, params.toArray());
	}

	@Override()
	public DatosTareaTrados findDatosTareaTradosEjecutada(BigDecimal idTarea, BigDecimal idTareaTrados) {

		StringBuilder query = new StringBuilder();
		List<Object> params = new ArrayList<Object>();

		query.append(DaoConstants.SELECT);
		query.append(DaoConstants.SUM_ABRIR_PARENTESIS);
		query.append("datosTrados.NUM_TOTAL_PAL_091");
		query.append(DaoConstants.CERRAR_PARENTESIS);
		query.append(DBConstants.NUMTOTALPAL);
		query.append(DaoConstants.BLANK);
		query.append(DaoConstants.SIGNO_COMA);
		query.append(DaoConstants.SUM_ABRIR_PARENTESIS);
		query.append("datosTrados.NUM_PAL_CONCOR_0_84_091");
		query.append(DaoConstants.CERRAR_PARENTESIS);
		query.append(DBConstants.NUMPALCONCOR084);
		query.append(DaoConstants.BLANK);
		query.append(DaoConstants.SIGNO_COMA);
		query.append(DaoConstants.SUM_ABRIR_PARENTESIS);
		query.append("datosTrados.NUM_PAL_CONCOR_85_94_091");
		query.append(DaoConstants.CERRAR_PARENTESIS);
		query.append(DBConstants.NUMPALCONCOR8594);
		query.append(DaoConstants.BLANK);
		query.append(DaoConstants.SIGNO_COMA);
		query.append(DaoConstants.SUM_ABRIR_PARENTESIS);
		query.append("datosTrados.NUM_PAL_CONCOR_95_100_091");
		query.append(DaoConstants.CERRAR_PARENTESIS);
		query.append(DBConstants.NUMPALCONCOR95100);
		query.append(DaoConstants.SIGNO_COMA);
		query.append(DaoConstants.SUM_ABRIR_PARENTESIS);
		query.append("datosTrados.NUM_PAL_CONCOR_95_99_091");
		query.append(DaoConstants.CERRAR_PARENTESIS);
		query.append(DBConstants.NUMPALCONCOR9599);
		query.append(DaoConstants.SIGNO_COMA);
		query.append(DaoConstants.SUM_ABRIR_PARENTESIS);
		query.append("datosTrados.NUM_PAL_CONCOR_100_091");
		query.append(DaoConstants.CERRAR_PARENTESIS);
		query.append(DBConstants.NUMPALCONCOR100);

		query.append(DaoConstants.FROM);
		query.append("AA79B91S01 datosTrados");
		query.append(DaoConstants.JOIN);
		query.append(DBConstants.TABLA_83);
		query.append(DaoConstants.BLANK);
		query.append(DBConstants.DOCUMENTOS_TAREA_ALIAS);
		query.append(DaoConstants.ON);
		query.append("documentosTarea.ID_DOC_083 = datosTrados.ID_DOC_ORIG_091");
		query.append(DaoConstants.AND);
		query.append(DOCUMENTOSTAREA_ID_TAREA_083);
		query.append(DaoConstants.SIGNOIGUAL_INTERROGACION);
		query.append(DaoConstants.WHERE);
		query.append("datosTrados.ID_TAREA_091");
		query.append(DaoConstants.SIGNOIGUAL_INTERROGACION);

		params.add(idTarea);
		params.add(idTareaTrados);

		List<DatosTareaTrados> lstDatosTrados = this.getJdbcTemplate().query(query.toString(),
				this.rwMapTareaTradosEjec, params.toArray());

		return DataAccessUtils.uniqueResult(lstDatosTrados);
	}

	@Override()
	public DatosTareaTrados findDatosTareaTradosSinEjecutar(BigDecimal idTarea) {
		StringBuilder query = new StringBuilder();
		List<Object> params = new ArrayList<Object>();

		query.append(DaoConstants.SELECT);
		query.append(DaoConstants.SUM_ABRIR_PARENTESIS);
		query.append("docOriginal.NUM_PAL_IZO_056");
		query.append(DaoConstants.CERRAR_PARENTESIS);
		query.append(DBConstants.NUMTOTALPAL);
		query.append(DaoConstants.FROM);
		query.append(DBConstants.TABLA_83);
		query.append(DaoConstants.BLANK);
		query.append(DBConstants.DOCUMENTOS_TAREA_ALIAS);
		query.append(DaoConstants.JOIN);
		query.append(DBConstants.TABLA_56);
		query.append(DaoConstants.BLANK);
		query.append(DBConstants.DOC_ORIGINAL_ALIAS);
		query.append(DaoConstants.ON);
		query.append("documentosTarea.ID_DOC_083 = docOriginal.ID_DOC_056");
		query.append(DaoConstants.WHERE);
		query.append(DOCUMENTOSTAREA_ID_TAREA_083);
		query.append(DaoConstants.SIGNOIGUAL_INTERROGACION);

		params.add(idTarea);

		List<DatosTareaTrados> lstDatosTrados = this.getJdbcTemplate().query(query.toString(),
				this.rwMapTareaTradosSinEjec, params.toArray());

		return DataAccessUtils.uniqueResult(lstDatosTrados);
	}

	@Override
	public List<DocumentoTarea> findAllDocsTipoTraduccionEntregaCliente(DocumentoTarea filterDocumentoTarea,
			JQGridRequestDto jqGridRequestDto, Boolean startsWith) {
		final List<Object> params = new ArrayList<Object>();
		StringBuilder query = new StringBuilder();
		query = this.getQueryTraduccionEntregaCliente(query);

		params.add(filterDocumentoTarea.getIdTarea());
		params.add(ClasificacionDocumentosEnum.TRADUCCION.getValue());
		if (jqGridRequestDto != null) {
			query = JQGridManager.getPaginationQuery(jqGridRequestDto, query, new String[] { DBConstants.ID_DOC_056 });
		}

		return this.getJdbcTemplate().query(query.toString(), this.rwMapDocTareasTraduccion, params.toArray());
	}

	private StringBuilder getQueryTraduccionEntregaCliente(StringBuilder query) {
		return getQueryTraduccionEntregaCliente(query, false);
	}

	private StringBuilder getQueryTraduccionEntregaCliente(StringBuilder query, boolean conFirma) {
		query.append(DaoConstants.SELECT + T1ID_TAREA_083 + ID_TAREA_083COMA);
		query.append(" " + T2ID_DOC_056
				+ " ID_DOC_056, t2.TITULO_056 TITULO_056, t2.EXTENSION_DOC_056 EXTENSION_DOC_056,t2.NOMBRE_FICHERO_056 NOMBREDOCORIGINAL, "
				+ " t2.OID_FICHERO_056 OID_FICHERO_056,t2.CLASE_DOCUMENTO_056 CLASE_DOCUMENTO_056, t2.IND_ENCRIPTADO_056 IND_ENCRIPTADO_056, ");
		query.append(" t3.ID_FICHERO_FINAL_092 ID_FICHERO_TRADUCIDO_087, ");
		query.append(
				" t4.IND_ENCRIPTADO_088 IND_ENCRIPTADO_088,t4.OID_FICHERO_088 OID_FICHERO_088,t4.NOMBRE_FICHERO_088 NOMBREFICHEROTAREA, ");

		query.append(
				" t3.ESTADO_FIRMA_092 ESTADOFIRMA, t3.ID_DOC_FIRMADO_FINAL_092 IDDOCFINALFIRMADO, t3.ID_DOC_FIRMADO_ORIG_092 IDDOCORIGFIRMADO, t3.ID_DOC_FINAL_ORIG_092 IDDOCFINALORIG ");

		if (conFirma) {
			query.append(
					" ,FICHEROORIGINALFIRMADO.OID_FICHERO_088 OIDFICHEROORIGFIRMADO, FICHEROFINALFIRMADO.OID_FICHERO_088 OIDFICHEROFINALFIRMADO, FICHEROFINALFIRMADO.NOMBRE_FICHERO_088 NOMBREFICHEROFINALFIRMADO ");
		}
		query.append(FROM_AA79B83S01_T1);
		query.append(LEFT_JOIN_AA79B56S01_ON_ID_DOC_83 + T2ID_DOC_056 + " ");
		query.append(" LEFT JOIN AA79B92S01 t3 ON (" + T2ID_DOC_056 + " = t3.ID_DOC_ORIG_092 AND t3.ID_TAREA_092 = "
				+ T1ID_TAREA_083 + ") ");
		query.append(" LEFT JOIN AA79B88S01 t4 ON t3.ID_FICHERO_FINAL_092 = t4.ID_FICHERO_088 ");

		if (conFirma) {
			query.append(
					" LEFT JOIN AA79B88S01 FICHEROFINALFIRMADO ON T3.ID_DOC_FIRMADO_FINAL_092 = FICHEROFINALFIRMADO.ID_FICHERO_088  ");
			query.append(
					" LEFT JOIN AA79B88S01 FICHEROORIGINALFIRMADO ON T3.ID_DOC_FIRMADO_ORIG_092 = FICHEROORIGINALFIRMADO.ID_FICHERO_088 ");
		}

		query.append(DaoConstants.WHERE + T1ID_TAREA_083 + " = ?");
		query.append(" AND t2.CLASE_DOCUMENTO_056 = ? ");
		return query;
	}

	@Override
	public Long findAllDocsTipoTraduccionEntregaClienteCount(DocumentoTarea filterDocumentoTarea, Boolean startsWith) {
		List<Object> params = new ArrayList<Object>();
		StringBuilder query = new StringBuilder();
		query.append(DaoConstants.SELECT_COUNT);
		query.append(DaoConstants.FROM);
		query.append(DaoConstants.ABRIR_PARENTESIS);
		this.getQueryTraduccionEntregaCliente(query);
		query.append(DaoConstants.CERRAR_PARENTESIS);
		params.add(filterDocumentoTarea.getIdTarea());
		params.add(ClasificacionDocumentosEnum.TRADUCCION.getValue());
		return this.getJdbcTemplate().queryForObject(query.toString(), params.toArray(), Long.class);
	}

	private StringBuilder getDocOriginal(StringBuilder query) {
		query.append(" docOriginal.ID_DOC_056 IDDOCORIGINAL, ");
		query.append(" docOriginal.TITULO_056 TITULODOCORIGINAL, ");
		query.append(" docOriginal.NOMBRE_FICHERO_056 NOMBREDOCORIGINAL, ");
		query.append(" docOriginal.OID_FICHERO_056 OIDFICHERODOCORIG, ");
		query.append(" docOriginal.CLASE_DOCUMENTO_056 CLASEDOCUMENTODOCORIG, ");
		query.append(" docOriginal.IND_ENCRIPTADO_056 INDENCRIPTADODOCORIG, ");
		query.append(" parejaDocOriginal.ID_DOC_056 IDDOCPAREJAORIG, ");
		query.append(" parejaDocOriginal.TITULO_056 TITULODOCPAREJAORIG, ");
		query.append(" parejaDocOriginal.NOMBRE_FICHERO_056 NOMBREDOCPAREJAORIG, ");
		query.append(" parejaDocOriginal.OID_FICHERO_056 OIDFICHERODOCPAREJAORIG, ");
		query.append(" parejaDocOriginal.CLASE_DOCUMENTO_056 CLASEDOCPAREJAORIG, ");
		query.append(" parejaDocOriginal.IND_ENCRIPTADO_056 INDENCRIPTDOCPAREJAORIG, ");
		return query;
	}

	@Override
	public String obtenerIndFactTareaTradRel(BigDecimal idTarea) {
		List<Object> params = new ArrayList<Object>();
		StringBuilder query = new StringBuilder();
		Locale es = new Locale("es");
		query.append(DaoConstants.SELECT + " DECODE(t2.IND_FACTURABLE_081, '").append(ActivoEnum.SI.getValue())
				.append("', '").append(this.msg.getMessage(ActivoEnum.SI.getLabel(), null, es)).append("', '")
				.append(ActivoEnum.NO.getValue()).append("', '")
				.append(this.msg.getMessage(ActivoEnum.NO.getLabel(), null, es)).append("')");
		query.append(DaoConstants.FROM + DBConstants.TABLA_081 + " t1 ");
		query.append(DaoConstants.JOIN + DBConstants.TABLA_081 + " t2 ");
		query.append(DaoConstants.ON + " t1.ID_TAREA_REL_081 " + DaoConstants.SIGNOIGUAL + " t2.ID_TAREA_081 ");
		query.append(DaoConstants.WHERE + " t1.ID_TAREA_081 " + DaoConstants.SIGNOIGUAL_INTERROGACION);
		params.add(idTarea);
		return this.getJdbcTemplate().queryForObject(query.toString(), params.toArray(), String.class);

	}

	@Override
	public List<Expediente> obtenerAnyoNumexpEstadoBitacoraInIdTarea(String[] idTareasList) {
		List<Object> params = new ArrayList<Object>();
		StringBuilder query = new StringBuilder();
		query.append(DaoConstants.SELECT);
		query.append(DBConstants.ANYO_051 + DaoConstants.BLANK + DBConstants.ANYO + DaoConstants.SIGNO_COMA);
		query.append(DBConstants.NUM_EXP_051 + DaoConstants.BLANK + DBConstants.NUMEXP + DaoConstants.SIGNO_COMA);
		query.append(DBConstants.ESTADO_BITACORA_051 + DaoConstants.BLANK + DBConstants.ESTADOBITACORA
				+ DaoConstants.SIGNO_COMA);
		query.append(DBConstants.ID_TAREA_081 + DaoConstants.BLANK + DBConstants.IDTAREA);
		query.append(DaoConstants.FROM + DBConstants.TABLA_081);
		query.append(DaoConstants.LEFT_JOIN + DBConstants.TABLA_51);
		query.append(DaoConstants.ON + DBConstants.ANYO_051 + DaoConstants.SIGNOIGUAL + DBConstants.ANYO_081);
		query.append(DaoConstants.AND + DBConstants.NUM_EXP_051 + DaoConstants.SIGNOIGUAL + DBConstants.NUM_EXP_081);
		query.append(DaoConstants.WHERE);
		query.append(SqlUtils.generarWhereInWithOutAnd(DBConstants.ID_TAREA_081, idTareasList, params));
		return this.getJdbcTemplate().query(query.toString(), this.rwMapObtenerAnyoNumexpEstadoBitacora,
				params.toArray());

	}

	@Override()
	public List<PersonalIZO> findPersonasPorRecursoAsignacion(Tareas tarea, String idTipoExp) {
		List<Object> params = new ArrayList<Object>();
		StringBuilder query = new StringBuilder();

		query.append(DaoConstants.SELECT + DaoConstants.DISTINCT);
		query.append("t1." + DBConstants.DNI_RECURSO_081 + DaoConstants.BLANK + DBConstants.DNIRECURSO);
		query.append(DaoConstants.SIGNO_COMA);
		query.append("p1." + DBConstants.NOMBRE_077 + DaoConstants.BLANK + DBConstants.NOMBRE);
		query.append(DaoConstants.SIGNO_COMA);
		query.append("p1." + DBConstants.APEL1_077 + DaoConstants.BLANK + DBConstants.APEL1);
		query.append(DaoConstants.SIGNO_COMA);
		query.append("p1." + DBConstants.APEL2_077 + DaoConstants.BLANK + DBConstants.APEL2);
		query.append(DaoConstants.FROM + DaoConstants.BLANK + DBConstants.TABLA_081 + DaoConstants.BLANK + "t1");
		query.append(DaoConstants.JOIN + DaoConstants.BLANK + DBConstants.TABLA_77 + DaoConstants.BLANK + "p1");
		query.append(DaoConstants.ON);
		query.append("p1." + DBConstants.DNI_077 + DaoConstants.SIGNOIGUAL + "t1." + DBConstants.DNI_RECURSO_081);
		query.append(" JOIN AA79B51S01 t2 ");
		query.append(" ON t1.ANYO_081 = t2.ANYO_051 ");
		query.append(" AND t1.NUM_EXP_081 = t2.NUM_EXP_051 ");
		query.append(DaoConstants.WHERE);
		query.append(DBConstants.RECURSO_ASIGNACION_081 + DaoConstants.SIGNOIGUAL_INTERROGACION);
		params.add(tarea.getRecursoAsignacion());

		if (idTipoExp != null && !idTipoExp.isEmpty()) {
			if (idTipoExp.equals(TipoExpedienteGrupoEnum.TRADUCCION_REVISION.getCode())) {
				List<String> listaExpedientes = new ArrayList<String>();
				listaExpedientes.add(TipoExpedienteEnum.REVISION.getValue());
				listaExpedientes.add(TipoExpedienteEnum.TRADUCCION.getValue());
				query.append(SqlUtils.generarWhereIn("t2.ID_TIPO_EXPEDIENTE_051", listaExpedientes, params));
			} else {
				query.append(SqlUtils.generarWhereIgual("t2.ID_TIPO_EXPEDIENTE_051", idTipoExp, params));
			}
		}

		return this.getJdbcTemplate().query(query.toString(), this.rwMapPersonasPorRecursoAsig, params.toArray());
	}

	@Override()
	public List<PersonalIZO> findProveedoresPorRecursoAsignacion(Tareas tarea, String idTipoExp) {
		List<Object> params = new ArrayList<Object>();
		StringBuilder query = new StringBuilder();

		query.append(DaoConstants.SELECT + DaoConstants.DISTINCT);
		query.append("s1." + DBConstants.TIPO + DaoConstants.BLANK + DBConstants.TIPO);
		query.append(DaoConstants.SIGNO_COMA);
		query.append("s1." + DBConstants.CODIGO + DaoConstants.BLANK + DBConstants.CODIGO);
		query.append(DaoConstants.SIGNO_COMA);
		query.append("s1." + DBConstants.DESC_ES + DaoConstants.BLANK + DBConstants.DESCES);
		query.append(DaoConstants.SIGNO_COMA);
		query.append("s1." + DBConstants.DESC_EU + DaoConstants.BLANK + DBConstants.DESCEU);
		query.append(DaoConstants.FROM + DaoConstants.BLANK + DBConstants.TABLA_081 + DaoConstants.BLANK + "t1");
		query.append(DaoConstants.JOIN + DaoConstants.BLANK + DBConstants.TABLA_29 + DaoConstants.BLANK + "l1");
		query.append(DaoConstants.ON);
		query.append("l1." + DBConstants.ID_LOTE_029 + DaoConstants.SIGNOIGUAL + "t1." + DBConstants.ID_LOTE_081);
		query.append(" JOIN AA79B51S01 t2 ");
		query.append(" ON t1.ANYO_081 = t2.ANYO_051 ");
		query.append(" AND t1.NUM_EXP_081 = t2.NUM_EXP_051 ");
		query.append(DaoConstants.LEFT_JOIN + DBConstants.VISTAX54JAPIENTIDADESSOLIC + DaoConstants.BLANK + "s1");
		query.append(DaoConstants.ON);
		query.append("l1." + DBConstants.TIPO_ENTIDAD_029 + DaoConstants.SIGNOIGUAL + "s1." + DBConstants.TIPO);
		query.append(DaoConstants.AND);
		query.append("l1." + DBConstants.ID_EMPRESA_PROV_029 + DaoConstants.SIGNOIGUAL + "s1." + DBConstants.CODIGO);
		query.append(DaoConstants.WHERE);
		query.append(DBConstants.RECURSO_ASIGNACION_081 + DaoConstants.SIGNOIGUAL_INTERROGACION);
		params.add(tarea.getRecursoAsignacion());
		if (idTipoExp != null && !idTipoExp.isEmpty()) {
			query.append(SqlUtils.generarWhereIgual("t2.ID_TIPO_EXPEDIENTE_051", idTipoExp, params));
		}

		return this.getJdbcTemplate().query(query.toString(), this.rwMapProvedoresPorRecursoAsig, params.toArray());
	}

	@Override
	public List<DocumentoTarea> findAllRevTradExtTradXliff(DocumentoTarea documentoTarea,
			JQGridRequestDto jqGridRequestDto, boolean startsWith) {
		final List<Object> params = new ArrayList<Object>();
		StringBuilder query = new StringBuilder();
		query.append(this.getQueryRevTradExtXliff(documentoTarea));

		if (jqGridRequestDto != null && jqGridRequestDto.getSidx() != null) {
			jqGridRequestDto.setSidx(DBConstants.FECHAEJECUCIONTAREA + DaoConstants.SIGNO_COMA
					+ DBConstants.IDTAREAAGRUPACION + DaoConstants.SIGNO_COMA + DBConstants.ID_FICHERO_XLIFF_096);

			query = JQGridManager.getPaginationQuery(jqGridRequestDto, query, new String[] {
					DBConstants.FECHAEJECUCIONTAREA, DBConstants.IDTAREAAGRUPACION, DBConstants.ID_FICHERO_XLIFF_096 });
		}

		return this.getJdbcTemplate().query(query.toString(), this.rwMapDocTareasGroupXliff, params.toArray());
	}

	@Override
	public Long findAllDocsRevTradExtXliffCount(DocumentoTarea documentoTarea, boolean b) {
		List<Object> params = new ArrayList<Object>();
		StringBuilder query = new StringBuilder(SELECT_COUNT1_FROM);
		query.append(this.getQueryRevTradExtXliff(documentoTarea));
		query.append(" )");
		return this.getJdbcTemplate().queryForObject(query.toString(), params.toArray(), Long.class);
	}

	public String getQueryRevTradExtXliff(DocumentoTarea documentoTarea) {
		StringBuilder query = new StringBuilder();
		query.append(DaoConstants.ABRIR_PARENTESIS + getQueryDocsRevTradExtXliff(documentoTarea));
		query.append(DaoConstants.AND + TAREAS_ID_TAREA_081 + DaoConstants.SIGNOIGUAL + documentoTarea.getIdTareaRel()
				+ DaoConstants.CERRAR_PARENTESIS);
		query.append(DaoConstants.UNION);
		query.append(DaoConstants.ABRIR_PARENTESIS + getQueryDocsRevTradExtXliff(documentoTarea));
		query.append(DaoConstants.AND + DaoConstants.TAREAS + DaoConstants.SIGNO_PUNTO + DBConstants.ID_TAREA_REL_081
				+ DaoConstants.SIGNOIGUAL + documentoTarea.getIdTareaRel());
		query.append(DaoConstants.AND + DaoConstants.TAREAS + DaoConstants.SIGNO_PUNTO + DBConstants.ID_TIPO_TAREA_081
				+ DaoConstants.SIGNOIGUAL + TipoTareaGestionAsociadaEnum.NO_CONFORMIDAD_PROVEEDOR.getValue()
				+ DaoConstants.BLANK);
		query.append(DaoConstants.AND + DaoConstants.TAREAS + DaoConstants.SIGNO_PUNTO + DBConstants.ORDEN_081
				+ DaoConstants.SIGNO_MENOR_IGUAL_QUE);
		query.append(DaoConstants.ABRIR_PARENTESIS);
		query.append(DaoConstants.SELECT + DaoConstants.T2_MINUSCULA_PUNTO + DBConstants.ORDEN_081);
		query.append(DaoConstants.FROM + DBConstants.TABLA_81 + DaoConstants.BLANK + DaoConstants.T2_MINUSCULA
				+ DaoConstants.BLANK);
		query.append(DaoConstants.WHERE + DaoConstants.T2_MINUSCULA_PUNTO + DBConstants.ID_TAREA_081
				+ DaoConstants.SIGNOIGUAL + documentoTarea.getIdTarea());
		query.append(DaoConstants.CERRAR_PARENTESIS);
		query.append(DaoConstants.UNION);
		query.append(DaoConstants.ABRIR_PARENTESIS + getQueryDocsRevTradExtXliff(documentoTarea));
		query.append(DaoConstants.AND + TAREAS_ID_TAREA_081 + DaoConstants.SIGNOIGUAL + documentoTarea.getIdTarea()
				+ DaoConstants.CERRAR_PARENTESIS);
		query.append(DaoConstants.CERRAR_PARENTESIS);

		return query.toString();
	}

	/**
	 * @param query
	 * @param documentoTarea
	 */
	private String getQueryDocsRevTradExtXliff(DocumentoTarea documentoTarea) {
		StringBuilder query = new StringBuilder();
		getQueryDocsXliff(query);
		query.append(DaoConstants.WHERE);
		query.append(DaoConstants.TAREAS + DaoConstants.SIGNO_PUNTO + DBConstants.ANYO_081 + DaoConstants.SIGNOIGUAL
				+ documentoTarea.getDocumentoOriginal().getAnyo());
		query.append(DaoConstants.AND + DaoConstants.TAREAS + DaoConstants.SIGNO_PUNTO + DBConstants.NUM_EXP_081
				+ DaoConstants.SIGNOIGUAL + documentoTarea.getDocumentoOriginal().getNumExp());
		return query.toString();
	}

	@Override
	public LimitePresupuesto obtenerLimitePresupuesto(Long anyoExp, Integer numExp) {
		List<Object> params = new ArrayList<Object>();
		params.add(anyoExp);
		params.add(numExp);

		StringBuilder query = new StringBuilder();

		query.append(DaoConstants.SELECT + DBConstants.FECHA_PROPUESTA + DaoConstants.BLANK + DBConstants.FECHAPROPUESTA
				+ DaoConstants.SIGNO_COMA);
		query.append(DaoConstants.TO_CHAR + DaoConstants.ABRIR_PARENTESIS + DBConstants.FECHA_PROPUESTA
				+ DaoConstants.SIGNO_COMA + DaoConstants.TO_CHAR_FECHA + DaoConstants.CERRAR_PARENTESIS
				+ DaoConstants.BLANK + DBConstants.HORAPROPUESTA + DaoConstants.SIGNO_COMA);
		query.append(DBConstants.FECHA_LIMITE + DaoConstants.BLANK + DBConstants.FECHALIMITE + DaoConstants.SIGNO_COMA);
		query.append(DaoConstants.TO_CHAR + DaoConstants.ABRIR_PARENTESIS + DBConstants.FECHA_LIMITE
				+ DaoConstants.SIGNO_COMA + DaoConstants.TO_CHAR_FECHA + DaoConstants.CERRAR_PARENTESIS
				+ DaoConstants.BLANK + DBConstants.HORALIMITE);
		query.append(DaoConstants.FROM + DaoConstants.TABLE + DaoConstants.ABRIR_PARENTESIS
				+ DBConstants.PL_OBTENER_LIM_PRESUPUESTO + DaoConstants.CERRAR_PARENTESIS);

		return this.getJdbcTemplate().queryForObject(query.toString(), params.toArray(),
				this.getRwMapLimitePresupuesto());
	}

	@SuppressWarnings({ "unchecked", "rawtypes" })
	@Override()
	public Integer crearTareasExpediente(final Long anyo, final Integer numExp, final String usuario) {

		List<SqlParameter> paramList = new ArrayList<SqlParameter>();
		paramList.add(new SqlParameter(Types.NUMERIC));

		return (Integer) this.getJdbcTemplate().execute(new CallableStatementCreator() {
			@Override()
			public CallableStatement createCallableStatement(Connection connection) throws SQLException {
				CallableStatement callableStatement = connection
						.prepareCall("{? = call CREAR_TAREAS_EXPEDIENTE(?,?,?)}");
				callableStatement.registerOutParameter(1, Types.NUMERIC);
				callableStatement.setLong(2, anyo);
				callableStatement.setInt(3, numExp);
				callableStatement.setString(4, usuario);
				return callableStatement;
			}
		}, new CallableStatementCallback() {
			@Override
			public Object doInCallableStatement(CallableStatement cs) throws SQLException {
				cs.execute();
				return cs.getInt(1);
			}
		});

	}

	@Override
	public List<DocumentoTarea> findAllDocsTraduccionXliff(DocumentoTarea documentoTarea,
			JQGridRequestDto jqGridRequestDto, boolean startsWith) {
		final List<Object> params = new ArrayList<Object>();
		StringBuilder query = new StringBuilder();
		query = this.getQueryTraduccionXliff(query);

		params.add(documentoTarea.getDocumentoOriginal().getAnyo());
		params.add(documentoTarea.getDocumentoOriginal().getNumExp());
		params.add(documentoTarea.getIdTarea());

		if (jqGridRequestDto != null && jqGridRequestDto.getSidx() != null) {
			jqGridRequestDto.setSidx(DBConstants.FECHAEJECUCIONTAREA + DaoConstants.SIGNO_COMA
					+ DBConstants.IDTAREAAGRUPACION + DaoConstants.SIGNO_COMA + DBConstants.ID_FICHERO_XLIFF_096);

			query = JQGridManager.getPaginationQuery(jqGridRequestDto, query, new String[] {
					DBConstants.FECHAEJECUCIONTAREA, DBConstants.IDTAREAAGRUPACION, DBConstants.ID_FICHERO_XLIFF_096 });
		}

		return this.getJdbcTemplate().query(query.toString(), this.rwMapDocTareasGroupXliff, params.toArray());
	}

	@Override
	public Long findAllDocsTraduccionXliffCount(DocumentoTarea documentoTarea, boolean startsWith) {
		List<Object> params = new ArrayList<Object>();
		StringBuilder query = new StringBuilder(SELECT_COUNT1_FROM);
		this.getQueryTraduccionXliff(query);
		query.append(" )");
		params.add(documentoTarea.getDocumentoOriginal().getAnyo());
		params.add(documentoTarea.getDocumentoOriginal().getNumExp());
		params.add(documentoTarea.getIdTarea());
		return this.getJdbcTemplate().queryForObject(query.toString(), params.toArray(), Long.class);
	}

	@Override
	public List<DocumentoTarea> findAllDocsNoConformidadProveedorTrad(DocumentoTarea filterDocumentoTarea,
			JQGridRequestDto jqGridRequestDto, boolean startsWith) {
		final List<Object> params = new ArrayList<Object>();
		StringBuilder query = new StringBuilder();
		query = this.getQueryNoConformidadProveedorTrad(query, params, filterDocumentoTarea);

		if (jqGridRequestDto != null) {
			query = JQGridManager.getPaginationQuery(jqGridRequestDto, query, new String[] { DBConstants.IDDOC });
		}
		return this.getJdbcTemplate().query(query.toString(), this.rwMapDocsTareaOrigenNoConformidadTraduccion,
				params.toArray());
	}

	private StringBuilder getQueryNoConformidadProveedorTrad(StringBuilder query, List<Object> params,
			DocumentoTarea filterDocumentoTarea) {
		query.append(" SELECT t1.ID_TAREA_083 IDTAREA, ");
		query.append(" t2.ID_DOC_056 IDDOC, ");
		query.append(" t2.TITULO_056                 TITULO, ");
		query.append(" t2.OID_FICHERO_056            OIDFICHERO, ");
		query.append(" t2.EXTENSION_DOC_056          EXTENSIONDOC, ");
		query.append(" t2.CLASE_DOCUMENTO_056        CLASEDOCUMENTO, ");
		query.append(" t2.IND_ENCRIPTADO_056         INDENCRIPTADO, ");
		query.append(" t2.NOMBRE_FICHERO_056         NOMBREDOCORIGINAL, ");
		query.append(" t3.ID_FICHERO_TRADUCIDO_087   IDFICHEROTRADUCIDO, ");
		query.append(" t4.IND_ENCRIPTADO_088         INDENCRIPTADODOCTRAD, ");
		query.append(" t4.OID_FICHERO_088            OIDFICHERODOCTRAD, ");
		query.append(" t4.TITULO_FICHERO_088         TITULODOCTRADUCIDO, ");
		query.append(" t4.NOMBRE_FICHERO_088         NOMBREFICHEROTRADUCIDO, ");
		query.append(" t6.ID_FICHERO_TRADUCIDO_087   IDFICHEROSUBSANADO, ");
		query.append(" t7.IND_ENCRIPTADO_088         INDENCRIPTADODOCSUBS, ");
		query.append(" t7.OID_FICHERO_088            OIDFICHERODOCSUBS, ");
		query.append(" t7.TITULO_FICHERO_088         TITULODOCSUBSANADO, ");
		query.append(" t7.NOMBRE_FICHERO_088         NOMBREFICHEROSUBSANADO ");
		query.append(" FROM AA79B83S01   t1 ");
		query.append(" LEFT JOIN AA79B56S01 t2 ");
		query.append(" ON t1.ID_DOC_083 = t2.ID_DOC_056 ");
		query.append(" LEFT JOIN AA79B87S01   t3 ");
		query.append(" ON ( t2.ID_DOC_056 = t3.ID_DOC_ORIG_087 ");
		query.append(" AND t3.ID_TAREA_087 = t1.ID_TAREA_083 ) ");
		query.append(" LEFT JOIN AA79B88S01   t4 ");
		query.append(" ON t3.ID_FICHERO_TRADUCIDO_087 = t4.ID_FICHERO_088 ");
		query.append(" JOIN AA79B83S01   t5 ");
		query.append(" ON t1.ID_DOC_083 = t5.ID_DOC_083 ");
		query.append(SqlUtils.generarWhereIgual("t5.ID_TAREA_083", filterDocumentoTarea.getIdTarea(), params));
		query.append(" LEFT JOIN AA79B87S01   t6 ");
		query.append(" ON ( t2.ID_DOC_056 = t6.ID_DOC_ORIG_087 ");
		query.append(SqlUtils.generarWhereIgual("t6.ID_TAREA_087", filterDocumentoTarea.getIdTarea(), params) + " ) ");
		query.append(" LEFT JOIN AA79B88S01   t7 ");
		query.append(" ON t6.ID_FICHERO_TRADUCIDO_087 = t7.ID_FICHERO_088 ");
		query.append(" WHERE 1=1 ");
		query.append(SqlUtils.generarWhereIn("t2.CLASE_DOCUMENTO_056",
				Arrays.asList(ClasificacionDocumentosEnum.REVISION.getValue(),
						ClasificacionDocumentosEnum.TRADUCCION.getValue(),
						ClasificacionDocumentosEnum.TRABAJO.getValue()),
				params));
		query.append(" AND t1.ID_TAREA_083 = ( ");
		query.append(" SELECT ID_TAREA_REL_081 ");
		query.append(" FROM AA79B81S01 ");
		query.append(" WHERE 1=1 ");
		query.append(SqlUtils.generarWhereIgual("ID_TAREA_081", filterDocumentoTarea.getIdTarea(), params));
		query.append(" ) ");
		return query;
	}

	@Override
	public Long findAllDocsNoConformidadProveedorTradCount(DocumentoTarea filterDocumentoTarea, boolean startsWith) {
		List<Object> params = new ArrayList<Object>();
		StringBuilder query = new StringBuilder(" SELECT COUNT(1) FROM ( ");
		this.getQueryNoConformidadProveedorTrad(query, params, filterDocumentoTarea);
		query.append(" )");
		return this.getJdbcTemplate().queryForObject(query.toString(), params.toArray(), Long.class);
	}

	@Override
	public List<DocumentoTarea> findAllDocsXliffNoConformidadProveedorTrad(DocumentoTarea filterDocumentoTarea,
			JQGridRequestDto jqGridRequestDto, boolean startsWith) {
		final List<Object> params = new ArrayList<Object>();
		StringBuilder query = new StringBuilder();
		query = this.getQueryXliffNoConformidadProveedorTrad(query, params, filterDocumentoTarea);

		if (jqGridRequestDto != null) {
			query = JQGridManager.getPaginationQuery(jqGridRequestDto, query,
					new String[] { DBConstants.IDFICHEROXLIFF });
		}
		return this.getJdbcTemplate().query(query.toString(), this.rwMapDocsXliffTareaOrigenNoConformidadTraduccion,
				params.toArray());
	}

	private StringBuilder getQueryXliffNoConformidadProveedorTrad(StringBuilder query, List<Object> params,
			DocumentoTarea filterDocumentoTarea) {
		query.append(" SELECT t1.ID_TAREA_096           IDTAREA, ");
		query.append(" t1.ID_FICHERO_XLIFF_096   IDFICHEROXLIFF, ");
		query.append(" t2.IND_ENCRIPTADO_088     INDENCRIPTADO, ");
		query.append(" t2.OID_FICHERO_088        OIDFICHERO, ");
		query.append(" t2.TITULO_FICHERO_088     TITULO ");
		query.append(" FROM AA79B96S01   t1 ");
		query.append(" LEFT JOIN AA79B88S01   t2 ");
		query.append(" ON t1.ID_FICHERO_XLIFF_096 = t2.ID_FICHERO_088 ");
		query.append(" WHERE 1=1 ");
		query.append(SqlUtils.generarWhereIgual("t1.ID_TAREA_096", filterDocumentoTarea.getIdTarea(), params));
		return query;
	}

	@Override
	public Long findAllDocsXliffNoConformidadProveedorTradCount(DocumentoTarea filterDocumentoTarea,
			boolean startsWith) {
		List<Object> params = new ArrayList<Object>();
		StringBuilder query = new StringBuilder(" SELECT COUNT(1) FROM ( ");
		this.getQueryXliffNoConformidadProveedorTrad(query, params, filterDocumentoTarea);
		query.append(" )");
		return this.getJdbcTemplate().queryForObject(query.toString(), params.toArray(), Long.class);
	}

	@Override
	public List<DocumentoTarea> findAllDocsNoConformidadProveedorRev(DocumentoTarea filterDocumentoTarea,
			JQGridRequestDto jqGridRequestDto, boolean startsWith) {
		final List<Object> params = new ArrayList<Object>();
		StringBuilder query = new StringBuilder();
		query = this.getQueryNoConformidadProveedorRev(query, params, filterDocumentoTarea);

		if (jqGridRequestDto != null) {
			query = JQGridManager.getPaginationQuery(jqGridRequestDto, query, new String[] { DBConstants.IDDOC });
		}
		return this.getJdbcTemplate().query(query.toString(), this.rwMapDocsTareaOrigenNoConformidadRevision,
				params.toArray());
	}

	private StringBuilder getQueryNoConformidadProveedorRev(StringBuilder query, List<Object> params,
			DocumentoTarea filterDocumentoTarea) {
		query.append(" SELECT t1.ID_TAREA_083                  IDTAREA, ");
		query.append(" t2.ID_DOC_056                    IDDOC, ");
		query.append(" t2.TITULO_056                    TITULO, ");
		query.append(" t2.OID_FICHERO_056               OIDFICHERO, ");
		query.append(" t2.EXTENSION_DOC_056             EXTENSIONDOC, ");
		query.append(" t2.CLASE_DOCUMENTO_056           CLASEDOCUMENTO, ");
		query.append(" t2.IND_ENCRIPTADO_056            INDENCRIPTADO, ");
		query.append(" t3.ID_DOC_056                    IDDOCREL, ");
		query.append(" t3.TITULO_056                    TITULOREL, ");
		query.append(" t3.OID_FICHERO_056               OIDFICHEROREL, ");
		query.append(" t3.CLASE_DOCUMENTO_056           CLASEDOCUMENTOREL, ");
		query.append(" t3.IND_ENCRIPTADO_056            INDENCRIPTADOREL, ");
		query.append(" t4.ID_FICHERO_TRADUCIDO_087      IDFICHEROREVISADO, ");
		query.append(" t5.IND_ENCRIPTADO_088            INDENCRIPTADOFICHREV, ");
		query.append(" t5.TITULO_FICHERO_088            TITULOFICHREV, ");
		query.append(" t5.OID_FICHERO_088               OIDFICHEROREV, ");
		query.append(" t6.ID_FICHERO_JUSTIFICANTE_093   IDFICHJUST, ");
		query.append(" t6.IND_VISIBLE_093               INDVISIBLEFICHJUST, ");
		query.append(" t7.NOMBRE_FICHERO_088            NOMBREFICHJUST, ");
		query.append(" t7.IND_ENCRIPTADO_088            INDENCRIPTADOJUST, ");
		query.append(" t8.ID_FICHERO_TRADUCIDO_087      IDFICHEROSUBSANADO, ");
		query.append(" t9.IND_ENCRIPTADO_088            INDENCRIPTADODOCSUBS, ");
		query.append(" t9.OID_FICHERO_088               OIDFICHERODOCSUBS, ");
		query.append(" t9.TITULO_FICHERO_088            TITULODOCSUBSANADO ");
		query.append(" FROM AA79B83S01   t1 ");
		query.append(" LEFT JOIN AA79B56S01   t2 ON t1.ID_DOC_083 = t2.ID_DOC_056 ");
		query.append(" LEFT JOIN AA79B56S01   t3 ON t2.ID_DOC_056 = t3.ID_DOC_REL_056 ");
		query.append(" LEFT JOIN AA79B87S01   t4 ON ( t1.ID_DOC_083 = t4.ID_DOC_ORIG_087 ");
		query.append(" AND t4.ID_TAREA_087 = t1.ID_TAREA_083 ) ");
		query.append(" LEFT JOIN AA79B88S01   t5 ON t4.ID_FICHERO_TRADUCIDO_087 = t5.ID_FICHERO_088 ");
		query.append(" JOIN AA79B83S01   t10 ON t1.ID_DOC_083 = t10.ID_DOC_083 ");
		query.append(SqlUtils.generarWhereIgual("t10.ID_TAREA_083", filterDocumentoTarea.getIdTarea(), params));
		query.append(" LEFT JOIN AA79B93S01   t6 ON t6.ID_DOC_ORIG_093 = t2.ID_DOC_056 ");
		query.append(SqlUtils.generarWhereIgual("t6.ID_TAREA_093", filterDocumentoTarea.getIdTarea(), params));
		query.append(" LEFT JOIN AA79B88S01   t7 ON t6.ID_FICHERO_JUSTIFICANTE_093 = t7.ID_FICHERO_088 ");
		query.append(" LEFT JOIN AA79B87S01   t8 ON ( t2.ID_DOC_056 = t8.ID_DOC_ORIG_087 ");
		query.append(SqlUtils.generarWhereIgual("t8.ID_TAREA_087", filterDocumentoTarea.getIdTarea(), params) + " ) ");
		query.append(" LEFT JOIN AA79B88S01   t9 ON t8.ID_FICHERO_TRADUCIDO_087 = t9.ID_FICHERO_088 ");
		query.append(" WHERE 1=1 ");
		query.append(SqlUtils.generarWhereIn("t2.CLASE_DOCUMENTO_056",
				Arrays.asList(ClasificacionDocumentosEnum.REVISION.getValue(),
						ClasificacionDocumentosEnum.TRADUCCION.getValue(),
						ClasificacionDocumentosEnum.TRABAJO.getValue()),
				params));
		query.append(" AND t1.ID_TAREA_083 = ( ");
		query.append(" SELECT ID_TAREA_REL_081 ");
		query.append(" FROM AA79B81S01 ");
		query.append(" WHERE 1=1 ");
		query.append(SqlUtils.generarWhereIgual("ID_TAREA_081", filterDocumentoTarea.getIdTarea(), params) + " ) ");
		return query;
	}

	@Override
	public Long findAllDocsNoConformidadProveedorRevCount(DocumentoTarea filterDocumentoTarea, boolean startsWith) {
		List<Object> params = new ArrayList<Object>();
		StringBuilder query = new StringBuilder(" SELECT COUNT(1) FROM ( ");
		this.getQueryNoConformidadProveedorRev(query, params, filterDocumentoTarea);
		query.append(" )");
		return this.getJdbcTemplate().queryForObject(query.toString(), params.toArray(), Long.class);
	}

	@Override
	public List<Tareas> findDocsRevisionTraduccionInterna(DocumentoTarea filterDocumentoTarea,
			JQGridRequestDto jqGridRequestDto, boolean startsWith) {
		final List<Object> params = new ArrayList<Object>();
		StringBuilder query = new StringBuilder();
		query.append(this.getQueryRevisionTraduccionInterna());

		params.add(filterDocumentoTarea.getIdTarea());
		params.add(filterDocumentoTarea.getIdTarea());
		params.add(filterDocumentoTarea.getIdTarea());
		params.add(EstadoEjecucionTareaEnum.EJECUTADA.getValue());

		if (jqGridRequestDto != null && jqGridRequestDto.getSidx() != null) {
			jqGridRequestDto.setSidx("FECHAEJECUCIONTAREA,IDTAREAAGRUPACION,IDDOCORIGINAL");

			query = JQGridManager.getPaginationQuery(jqGridRequestDto, query,
					new String[] { "FECHAEJECUCIONTAREA", "IDTAREAAGRUPACION", "IDDOCORIGINAL" });
		}

		return this.getJdbcTemplate().query(query.toString(), this.rwMapDocsTareaRevTradInt, params.toArray());
	}

	private Object getQueryRevisionTraduccionInterna() {
		StringBuilder query = new StringBuilder();

		query.append(" SELECT ");
		query.append(" tareas.ID_TAREA_081 IDTAREA, ");
		query.append(" tareas.ID_TAREA_081 IDTAREAAGRUPACION, ");
		query.append(" tiposTarea.DESC_ES_015 TIPOTAREAES,  ");
		query.append(" tiposTarea.DESC_EU_015 TIPOTAREAEU, ");
		query.append(" ejecucionTareas.FECHA_EJECUCION_082 FECHAEJECUCIONTAREA, ");
		query.append(" ejecucionTareas.IND_OBSV_082 INDOBSERVACIONES, ");
		query.append(" docOriginal.ID_DOC_056 IDDOCORIGINAL, ");
		query.append(" docOriginal.TITULO_056 TITULODOCORIGINAL, ");
		query.append(" docOriginal.OID_FICHERO_056 OIDFICHERODOCORIG, ");
		query.append(" docOriginal.EXTENSION_DOC_056 EXTENSIONDOC, ");
		query.append(" docOriginal.CLASE_DOCUMENTO_056 CLASEDOCUMENTODOCORIG, ");
		query.append(" docOriginal.IND_ENCRIPTADO_056 INDENCRIPTADODOCORIG, ");
		query.append(" docOriginal.NOMBRE_FICHERO_056 NOMBREDOCORIGINAL, ");
		query.append(" docTraducido.ID_FICHERO_TRADUCIDO_087 IDDOCTRADUCIDO, ");
		query.append(" ficheroTraducido.TITULO_FICHERO_088 TITULODOCTRADUCIDO, ");
		query.append(" ficheroTraducido.OID_FICHERO_088 OIDFICHERODOCTRAD, ");
		query.append(" ficheroTraducido.IND_ENCRIPTADO_088 INDENCRIPTADODOCTRAD, ");
		query.append(" ficheroTraducido.NOMBRE_FICHERO_088 NOMBREDOCTRADUCIDO, ");
		query.append(" docRevisado.ID_FICHERO_TRADUCIDO_087 IDDOCREVISADO, ");
		query.append(" ficheroRevisado.TITULO_FICHERO_088 TITULODOCREVISADO, ");
		query.append(" ficheroRevisado.OID_FICHERO_088 OIDFICHERODOCREV, ");
		query.append(" ficheroRevisado.IND_ENCRIPTADO_088 INDENCRIPTADODOCREV, ");
		query.append(" ficheroRevisado.NOMBRE_FICHERO_088 NOMBREDOCREV, ");
		query.append(groupByRevTradInt());
		query.append(" GROUPBYTEXT ");
		query.append(" FROM AA79B81S01 tareas ");
		query.append(" JOIN AA79B83S01 documentosTarea ");
		query.append(" ON tareas.ID_TAREA_081 = documentosTarea.ID_TAREA_083");
		query.append(" JOIN AA79B56S01 docOriginal ");
		query.append(" ON documentosTarea.ID_DOC_083 = docOriginal.ID_DOC_056 ");
		query.append(" AND docOriginal.CLASE_DOCUMENTO_056 IN ( ");
		query.append(ClasificacionDocumentosEnum.TRADUCCION.getValue()).append(DaoConstants.SIGNO_COMA);
		query.append(ClasificacionDocumentosEnum.TRABAJO.getValue());
		query.append(" ) ");
		query.append(" LEFT JOIN AA79B87S01 docTraducido ");
		query.append(" ON documentosTarea.ID_DOC_083 = docTraducido.ID_DOC_ORIG_087 ");
		query.append(" AND documentosTarea.ID_TAREA_083 = docTraducido.ID_TAREA_087 ");
		query.append(" LEFT JOIN AA79B88S01 ficheroTraducido ");
		query.append(" ON docTraducido.ID_FICHERO_TRADUCIDO_087 = ficheroTraducido.ID_FICHERO_088 ");
		query.append(" LEFT JOIN AA79B87S01 docRevisado ");
		query.append(" ON ID_DOC_083 = docRevisado.ID_DOC_ORIG_087");
		query.append(" AND docRevisado.ID_TAREA_087 = ?");
		query.append(" LEFT JOIN AA79B88S01 ficheroRevisado ");
		query.append(" ON docRevisado.ID_FICHERO_TRADUCIDO_087 = ficheroRevisado.ID_FICHERO_088 ");
		// TiposTarea
		query.append(" LEFT JOIN AA79B15S01 tiposTarea ");
		query.append(" ON tareas.ID_TIPO_TAREA_081 = tiposTarea.ID_015 ");
		// Lotes TODO
		query.append(" LEFT JOIN ");
		query.append(" AA79B77S01 datosContacto ON tareas.DNI_RECURSO_081 = datosContacto.DNI_077 ");
		query.append(" LEFT JOIN AA79B82S01 ejecucionTareas ");
		query.append(" ON tareas.ID_TAREA_081 = ejecucionTareas.ID_TAREA_082 ");
		query.append(" WHERE ");
		query.append("((ID_TIPO_TAREA_081 = ").append(TipoTareaGestionAsociadaEnum.TRADUCIR.getValue());
		query.append(" AND ")
				.append("ID_TAREA_081 = (SELECT ID_TAREA_REL_081 FROM AA79B81S01 WHERE ID_TAREA_081 = ? )) ");
		query.append(" OR ").append("(ID_TIPO_TAREA_081 = ")
				.append(TipoTareaGestionAsociadaEnum.NO_CONFORMIDAD_TRADUCTOR.getValue());
		query.append(" AND ")
				.append("ID_TAREA_REL_081 = (SELECT ID_TAREA_REL_081 FROM AA79B81S01 WHERE ID_TAREA_081 = ? ) ");
		query.append(" AND ESTADO_EJECUCION_081 = ?");
		query.append(" )) ");

		return query.toString();
	}

	private String groupByRevTradInt() {
		Locale locale = LocaleContextHolder.getLocale();
		StringBuilder groupByText = new StringBuilder();

		groupByText.append(" ( ejecucionTareas.FECHA_EJECUCION_082 || ' - ' || ");
		if (locale.getLanguage().equals(Constants.LANG_EUSKERA)) {
			groupByText.append("tiposTarea.DESC_EU_015");
		} else {
			groupByText.append("tiposTarea.DESC_ES_015");
		}
		groupByText.append(" || ' - ' || ");
		groupByText.append(" datosContacto.APEL1_077 || ' ' || ");
		groupByText.append(" datosContacto.APEL2_077 || ' , ' || ");
		groupByText.append(" datosContacto.NOMBRE_077 ");
		groupByText.append(" ) ");

		return groupByText.toString();
	}

	@Override
	public Long findDocsRevisionTraduccionInternaCount(DocumentoTarea filterDocumentoTarea, boolean startsWith) {
		List<Object> params = new ArrayList<Object>();
		StringBuilder query = new StringBuilder();
		query.append(" SELECT COUNT(1) ");
		query.append(" FROM ");
		query.append(" ( ");
		query.append(this.getQueryRevisionTraduccionInterna());
		query.append(" ) ");

		params.add(filterDocumentoTarea.getIdTarea());
		params.add(filterDocumentoTarea.getIdTarea());
		params.add(filterDocumentoTarea.getIdTarea());
		params.add(EstadoEjecucionTareaEnum.EJECUTADA.getValue());

		return this.getJdbcTemplate().queryForObject(query.toString(), params.toArray(), Long.class);
	}

	@Override
	public List<DocumentoTarea> findAllRevTradIntTradXliff(DocumentoTarea filterDocumentoTarea,
			JQGridRequestDto jqGridRequestDto, boolean startsWith) {
		final List<Object> params = new ArrayList<Object>();
		StringBuilder query = new StringBuilder();
		query.append(this.getQueryRevTradIntXliff(filterDocumentoTarea));

		if (jqGridRequestDto != null && jqGridRequestDto.getSidx() != null) {
			jqGridRequestDto.setSidx("FECHAEJECUCIONTAREA,IDTAREAAGRUPACION,ID_FICHERO_XLIFF_096");

			query = JQGridManager.getPaginationQuery(jqGridRequestDto, query,
					new String[] { "FECHAEJECUCIONTAREA", "IDTAREAAGRUPACION", "ID_FICHERO_XLIFF_096" });
		}

		return this.getJdbcTemplate().query(query.toString(), this.rwMapDocTareasGroupXliff, params.toArray());
	}

	private String getQueryRevTradIntXliff(DocumentoTarea filterDocumentoTarea) {
		StringBuilder query = new StringBuilder();
		query.append(" ( " + getQueryDocsRevTradIntXliff(filterDocumentoTarea));
		query.append(" AND tareas.ID_TAREA_081 = " + filterDocumentoTarea.getIdTareaRel() + " ) ");
		query.append(" UNION ( " + getQueryDocsRevTradIntXliff(filterDocumentoTarea));
		query.append(" AND tareas.ID_TAREA_REL_081 = ").append(filterDocumentoTarea.getIdTareaRel());
		query.append(" AND tareas.ID_TIPO_TAREA_081 = ")
				.append(TipoTareaGestionAsociadaEnum.NO_CONFORMIDAD_TRADUCTOR.getValue());
		query.append(" AND tareas.ORDEN_081 <= ( ");
		query.append(" SELECT t2.ORDEN_081 FROM AA79B81S01 t2 ");
		query.append(" WHERE t2.ID_TAREA_081 = ").append(filterDocumentoTarea.getIdTarea());
		query.append(" ) ) ");
		query.append(" UNION ( " + getQueryDocsRevTradIntXliff(filterDocumentoTarea));
		query.append(" AND tareas.ID_TAREA_REL_081 = ").append(filterDocumentoTarea.getIdTareaRel());
		query.append(" AND tareas.ID_TIPO_TAREA_081 = ")
				.append(TipoTareaGestionAsociadaEnum.REVISAR_TRADUCCION_INTERNA.getValue());
		query.append(" AND tareas.ORDEN_081 <= ( ");
		query.append(" SELECT t2.ORDEN_081 FROM AA79B81S01 t2 ");
		query.append(" WHERE t2.ID_TAREA_081 = ").append(filterDocumentoTarea.getIdTarea());
		query.append(" ) ) ");

		return query.toString();
	}

	private String getQueryDocsRevTradIntXliff(DocumentoTarea filterDocumentoTarea) {
		StringBuilder query = new StringBuilder();
		getQueryDocsXliff(query);
		query.append(" WHERE tareas.ANYO_081 = ").append(filterDocumentoTarea.getDocumentoOriginal().getAnyo());
		query.append(" AND tareas.NUM_EXP_081 = ").append(filterDocumentoTarea.getDocumentoOriginal().getNumExp());
		return query.toString();
	}

	@Override
	public Long findAllDocsRevTradIntXliffCount(DocumentoTarea filterDocumentoTarea, boolean startsWith) {
		List<Object> params = new ArrayList<Object>();
		StringBuilder query = new StringBuilder(SELECT_COUNT1_FROM);
		query.append(this.getQueryRevTradIntXliff(filterDocumentoTarea));
		query.append(" )");
		return this.getJdbcTemplate().queryForObject(query.toString(), params.toArray(), Long.class);
	}

	@Override
	public List<DocumentoTarea> findAllNoConformidadTraductor(DocumentoTarea filterDocumentoTarea,
			JQGridRequestDto jqGridRequestDto, boolean startsWith) {
		final List<Object> params = new ArrayList<Object>();
		StringBuilder query = new StringBuilder();
		query.append(this.getQueryNoConformidadTraductor(query, params, filterDocumentoTarea));

		if (jqGridRequestDto != null) {
			query = JQGridManager.getPaginationQuery(jqGridRequestDto, query, new String[] { DBConstants.IDDOC });
		}
		return this.getJdbcTemplate().query(query.toString(), this.rwMapDocsTareaOrigenNoConformidadTraductor,
				params.toArray());
	}

	private String getQueryNoConformidadTraductor(StringBuilder query, List<Object> params,
			DocumentoTarea filterDocumentoTarea) {
		StringBuilder queryNCT = new StringBuilder(Aa79bTareaWsDaoImpl.STRING_BUILDER_INIT);

		params.add(filterDocumentoTarea.getIdTarea());
		params.add(filterDocumentoTarea.getIdTarea());
		queryNCT.append(" SELECT ");
		queryNCT.append(" t1.ID_TAREA_083 IDTAREA,");
		queryNCT.append(" t2.ID_DOC_056 IDDOC, ");
		queryNCT.append(" t2.TITULO_056  TITULO, ");
		queryNCT.append(" t2.OID_FICHERO_056 OIDFICHERO, ");
		queryNCT.append(" t2.EXTENSION_DOC_056 EXTENSIONDOC, ");
		queryNCT.append(" t2.CLASE_DOCUMENTO_056  CLASEDOCUMENTO, ");
		queryNCT.append(" t2.IND_ENCRIPTADO_056 INDENCRIPTADO, ");
		queryNCT.append(" t2.NOMBRE_FICHERO_056 NOMBREDOCORIGINAL, ");
		queryNCT.append(" t3.ID_FICHERO_TRADUCIDO_087 IDFICHEROTRADUCIDO, ");
		queryNCT.append(" t4.IND_ENCRIPTADO_088 INDENCRIPTADODOCTRAD, ");
		queryNCT.append(" t4.OID_FICHERO_088 OIDFICHERODOCTRAD, ");
		queryNCT.append(" t4.TITULO_FICHERO_088 TITULODOCTRADUCIDO, ");
		queryNCT.append(" t4.NOMBRE_FICHERO_088 NOMBREFICHEROTRADUCIDO, ");
		queryNCT.append(" t6.ID_FICHERO_TRADUCIDO_087 IDFICHEROSUBSANADO, ");
		queryNCT.append(" t7.IND_ENCRIPTADO_088 INDENCRIPTADODOCSUBS, ");
		queryNCT.append(" t7.OID_FICHERO_088 OIDFICHERODOCSUBS, ");
		queryNCT.append(" t7.TITULO_FICHERO_088 TITULODOCSUBSANADO, ");
		queryNCT.append(" t7.NOMBRE_FICHERO_088 NOMBREFICHEROTAREA ");
		queryNCT.append(" FROM AA79B83S01 t1 ");
		queryNCT.append(" LEFT JOIN AA79B56S01 t2 ");
		queryNCT.append(" ON t1.ID_DOC_083 = t2.ID_DOC_056 ");
		queryNCT.append(" LEFT JOIN AA79B87S01 t3 ");
		queryNCT.append(" ON ( t2.ID_DOC_056 = t3.ID_DOC_ORIG_087 AND ");
		queryNCT.append(" t3.ID_TAREA_087 = t1.ID_TAREA_083 ) ");
		queryNCT.append(" LEFT JOIN AA79B88S01 t4 ");
		queryNCT.append(" ON t3.ID_FICHERO_TRADUCIDO_087 = t4.ID_FICHERO_088 ");
		queryNCT.append(" JOIN AA79B83S01 t5 ");
		queryNCT.append(" ON t1.ID_DOC_083 = t5.ID_DOC_083 ");
		queryNCT.append(" AND t5.ID_TAREA_083 = ? ");
		queryNCT.append(" LEFT JOIN AA79B87S01 t6 ");
		queryNCT.append(" ON ( t2.ID_DOC_056 = t6.ID_DOC_ORIG_087 ");
		queryNCT.append(" AND t6.ID_TAREA_087 = ? ) ");
		queryNCT.append(" LEFT JOIN AA79B88S01 t7 ");
		queryNCT.append(" ON t6.ID_FICHERO_TRADUCIDO_087 = t7.ID_FICHERO_088 ");
		queryNCT.append(" WHERE 1=1 ");
		queryNCT.append(SqlUtils.generarWhereIn("CLASE_DOCUMENTO_056",
				Arrays.asList(ClasificacionDocumentosEnum.REVISION.getValue(),
						ClasificacionDocumentosEnum.TRADUCCION.getValue(),
						ClasificacionDocumentosEnum.TRABAJO.getValue()),
				params));
		queryNCT.append(" AND t1.ID_TAREA_083 = ( ");
		queryNCT.append(" SELECT ID_TAREA_REL_081 FROM AA79B81S01 ");
		queryNCT.append(" WHERE ID_TAREA_081 = ? ) ");
		params.add(filterDocumentoTarea.getIdTarea());

		return queryNCT.toString();
	}

	@Override
	public Long findAllNoConformidadTraductorCount(DocumentoTarea filterDocumentoTarea, boolean startsWith) {
		List<Object> params = new ArrayList<Object>();
		StringBuilder query = new StringBuilder();
		query.append(" SELECT COUNT(1) ");
		query.append(" FROM ");
		query.append(" ( ");
		query.append(this.getQueryNoConformidadTraductor(query, params, filterDocumentoTarea));
		query.append(" ) ");

		return this.getJdbcTemplate().queryForObject(query.toString(), params.toArray(), Long.class);
	}

}
