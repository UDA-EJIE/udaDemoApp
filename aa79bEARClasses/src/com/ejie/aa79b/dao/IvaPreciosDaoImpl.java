package com.ejie.aa79b.dao;

import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.List;

import org.springframework.dao.support.DataAccessUtils;
import org.springframework.jdbc.core.RowMapper;
import org.springframework.stereotype.Repository;
import org.springframework.transaction.annotation.Transactional;

import com.ejie.aa79b.common.BdTablesEnum;
import com.ejie.aa79b.common.Constants;
import com.ejie.aa79b.common.DBConstants;
import com.ejie.aa79b.common.DaoConstants;
import com.ejie.aa79b.common.SqlUtils;
import com.ejie.aa79b.dao.mapper.IvaPreciosRowMapper;
import com.ejie.aa79b.model.IvaPrecios;

/**
 * IvaPreciosDaoImpl generated by UDA, 15-dic-2017 14:11:45.
 * 
 * @author UDA
 */

@Repository
@Transactional
public class IvaPreciosDaoImpl extends GenericoDaoImpl<IvaPrecios> implements IvaPreciosDao {

	protected static final String TABLA = BdTablesEnum.IVA_PRECIOS.getValue();
	protected static final String ID_031 = "ID_031";
	protected static final String ID031 = "ID";
	protected static final String COMPLETE_SELECT = "SELECT t1.ID_031 ID, t1.ID_ORDEN_031 IDORDEN031, t1.FECHA_DESDE_VIGENCIA_031 FECHADESDEVIGENCIA031,t1.FECHA_HASTA_VIGENCIA_031 FECHAHASTAVIGENCIA031,t1.POR_IVA_031 PORIVA031,t1.IND_VIGENTE_031 INDVIGENTE031 ";
	protected static final String COMPLETE_SELECT_COUNT = "SELECT COUNT(1) FROM AA79B31S01 t1 , AA79B30S01 t2 ";
	protected static final String FROM = " FROM AA79B31S01 t1, AA79B30S01 t2 ";
	protected static final String[] ORDER_BY_WHITE_LIST = new String[] { ID031, "IDORDEN031", "FECHADESDEVIGENCIA031",
			"FECHAHASTAVIGENCIA031", "PORIVA031", "INDVIGENTE031" };
	protected static final String T1_FECHA_HASTA_VIGENCIA = "t1.FECHA_HASTA_VIGENCIA_031";

	/*
	 * ROW_MAPPERS
	 */
	private RowMapper<IvaPrecios> rwMap = new IvaPreciosRowMapper();

	private RowMapper<IvaPrecios> rwMapPK = new RowMapper<IvaPrecios>() {
		@Override()
		public IvaPrecios mapRow(ResultSet resultSet, int rowNum) throws SQLException {
			return new IvaPrecios(resultSet.getLong(ID031));
		}
	};

	/**
	 * Constructor
	 */
	public IvaPreciosDaoImpl() {
		super(IvaPrecios.class);
	}

	@Override()
	public IvaPrecios add(IvaPrecios ivaprecios) {
		String query = "INSERT INTO AA79B31S01 (ID_031, ID_ORDEN_031, FECHA_DESDE_VIGENCIA_031, FECHA_HASTA_VIGENCIA_031, POR_IVA_031, IND_VIGENTE_031) VALUES (AA79B31Q00.NEXTVAL,?,?,?,?,?)";
		this.getJdbcTemplate().update(query, ivaprecios.getIdOrden(), ivaprecios.getFechaDesdeVigencia(),
				ivaprecios.getFechaHastaVigencia(), ivaprecios.getPorIva(),
				ivaprecios.getIndVigente() == null ? Constants.NO : ivaprecios.getIndVigente());
		return ivaprecios;
	}

	@Override()
	public IvaPrecios update(IvaPrecios ivaprecios) {
		String query = "UPDATE AA79B31S01 SET ID_ORDEN_031=?, FECHA_DESDE_VIGENCIA_031=?, FECHA_HASTA_VIGENCIA_031=?, POR_IVA_031=?, IND_VIGENTE_031=? WHERE ID_031=?";
		this.getJdbcTemplate().update(query, ivaprecios.getIdOrden(), ivaprecios.getFechaDesdeVigencia(),
				ivaprecios.getFechaHastaVigencia(), ivaprecios.getPorIva(),
				ivaprecios.getIndVigente() == null ? Constants.NO : ivaprecios.getIndVigente(), ivaprecios.getId());
		return ivaprecios;
	}

	@Override()
	public void remove(IvaPrecios ivaprecios) {
		String query = "DELETE FROM AA79B31S01 WHERE ID_031=?";
		this.getJdbcTemplate().update(query, ivaprecios.getId());
	}

	@Override()
	protected String getSelect() {
		return COMPLETE_SELECT;
	}

	@Override()
	protected String getFrom() {
		StringBuilder query = new StringBuilder();
		query.append(" FROM AA79B31S01 t1 ");
		return query.toString();
	}

	@Override()
	protected RowMapper<IvaPrecios> getRwMap() {
		return this.rwMap;
	}

	@Override()
	protected String[] getOrderBy() {
		return IvaPreciosDaoImpl.ORDER_BY_WHITE_LIST;
	}

	@Override()
	protected String getPK() {
		return ID_031;
	}

	@Override()
	protected RowMapper<IvaPrecios> getRwMapPK() {
		return this.rwMapPK;
	}

	@Override()
	protected String getWherePK(IvaPrecios ivaPrecios, List<Object> params) {
		params.add(ivaPrecios.getId());
		return " WHERE t1.ID_031 = ? ";
	}

	@Override
	protected String getWhere(IvaPrecios ivaprecios, List<Object> params) {

		StringBuilder where = new StringBuilder(IvaPreciosDaoImpl.STRING_BUILDER_INIT);

		if (ivaprecios != null) {
			where.append(SqlUtils.generarWhereIgual("t1.ID_031", ivaprecios.getId(), params));
			where.append(SqlUtils.generarWhereIgual("t1.ID_ORDEN_031", ivaprecios.getIdOrden(), params));
			where.append(SqlUtils.generarWhereIgual("t1.FECHA_DESDE_VIGENCIA_031", ivaprecios.getFechaDesdeVigencia(),
					params));
			where.append(
					SqlUtils.generarWhereIgual(T1_FECHA_HASTA_VIGENCIA, ivaprecios.getFechaHastaVigencia(), params));
			where.append(SqlUtils.generarWhereIgual("t1.POR_IVA_031", ivaprecios.getPorIva(), params));
			where.append(SqlUtils.generarWhereIgual("t1.IND_VIGENTE_031", ivaprecios.getIndVigente(), params));
		}

		return where.toString();
	}

	@Override
	protected String getWhereLike(IvaPrecios ivaprecios, Boolean startsWith, List<Object> params, Boolean search) {

		StringBuilder where = new StringBuilder(IvaPreciosDaoImpl.STRING_BUILDER_INIT);

		if (ivaprecios != null) {
			where.append(SqlUtils.generarWhereIgual("t1.ID_031", ivaprecios.getId(), params));
			where.append(SqlUtils.generarWhereIgual("t1.ID_ORDEN_031", ivaprecios.getIdOrden(), params));
			where.append(SqlUtils.generarWhereIgual("t1.FECHA_DESDE_VIGENCIA_031", ivaprecios.getFechaDesdeVigencia(),
					params));
			where.append(
					SqlUtils.generarWhereIgual(T1_FECHA_HASTA_VIGENCIA, ivaprecios.getFechaHastaVigencia(), params));
			where.append(SqlUtils.generarWhereIgual("t1.POR_IVA_031", ivaprecios.getPorIva(), params));
			where.append(SqlUtils.generarWhereIgual("t1.IND_VIGENTE_031", ivaprecios.getIndVigente(), params));
		}

		return where.toString();
	}

	@Override()
	public void updateVigencia(IvaPrecios ivaprecios) {
		String query = "UPDATE AA79B31S01 SET IND_VIGENTE_031=? WHERE ID_ORDEN_031=?";
		this.getJdbcTemplate().update(query, Constants.NO, ivaprecios.getIdOrden());
	}

	@Override()
	public IvaPrecios findIvaOrdePreciosPublicos() {
		List<Object> params = new ArrayList<Object>();
		StringBuilder query = new StringBuilder(this.getWith());
		query.append(this.getSelect());
		query.append(this.getFrom());
		query.append(DaoConstants.JOIN + DBConstants.TABLA_30 + DaoConstants.BLANK + DaoConstants.T2_MINUSCULA
				+ DaoConstants.ON + DBConstants.ID_030 + DaoConstants.SIGNOIGUAL + DBConstants.ID_ORDEN_031);

		query.append(DaoConstants.WHERE_1_1);
		query.append(SqlUtils.generarWhereIgual(DaoConstants.T1_MINUSCULA_PUNTO + DBConstants.IND_VIGENTE_031,
				Constants.SI, params));
		query.append(SqlUtils.generarWhereIgual(DaoConstants.T2_MINUSCULA_PUNTO + DBConstants.IND_VIGOR_030,
				Constants.SI, params));

		List<IvaPrecios> beanList = this.getJdbcTemplate().query(query.toString(), this.getRwMap(), params.toArray());
		return DataAccessUtils.uniqueResult(beanList);
	}

}
