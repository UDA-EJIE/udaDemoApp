package com.ejie.aa79b.dao;

import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.List;
import java.util.Locale;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.i18n.LocaleContextHolder;
import org.springframework.context.support.ReloadableResourceBundleMessageSource;
import org.springframework.jdbc.core.RowMapper;
import org.springframework.stereotype.Repository;
import org.springframework.transaction.annotation.Transactional;

import com.ejie.aa79b.common.SqlUtils;
import com.ejie.aa79b.model.ConfigTextoEmails;
import com.ejie.aa79b.model.enums.DestinatarioEnum;

/**
 * ConfigTextoEmailsDaoImpl generated by UDA, 05-dic-2017 15:17:18.
 * @author UDA
 */

@Repository()
@Transactional()
public class ConfigTextoEmailsDaoImpl extends GenericoDaoImpl<ConfigTextoEmails> implements ConfigTextoEmailsDao {

	@Autowired()
	private ReloadableResourceBundleMessageSource msg;
	
    public ConfigTextoEmailsDaoImpl() {
		super(ConfigTextoEmails.class);
	}

	public static final String[] ORDER_BY_WHITE_LIST = new String[] {"ID006", "TIPOAVISO006", "TEXTOMAILES006", "TEXTOMAILEU006", "ASUNTOES006", "ASUNTOEU006"};

	/*
	 * ROW_MAPPERS
	 */
	private RowMapper<ConfigTextoEmails> rwMap = new RowMapper<ConfigTextoEmails>() {
		@Override()
		public ConfigTextoEmails mapRow(ResultSet resultSet, int rowNum) throws SQLException {
			ConfigTextoEmails bean = new ConfigTextoEmails();
			bean.setId(resultSet.getInt("ID006"));
			bean.getTipoAviso().setId(resultSet.getLong("TIPOAVISO006"));
			bean.getTipoAviso().setDescEs(resultSet.getString("DESCES041"));
			bean.getTipoAviso().setDescEu(resultSet.getString("DESCEU041"));
			bean.getTipoAviso().setDestinatario(resultSet.getInt("DESTINATARIO041"));
			bean.getTipoAviso().setDestinatarioDesc(resultSet.getString("DESTINATARIODESC"));
			bean.setAsuntoEs(resultSet.getString("ASUNTOES006"));
			bean.setAsuntoEu(resultSet.getString("ASUNTOEU006"));
			bean.setTextoMailEs(SqlUtils.getClob(resultSet, "TEXTOMAILES006"));
			bean.setTextoMailEu(SqlUtils.getClob(resultSet, "TEXTOMAILEU006"));
           return bean;
       }
	};

	private RowMapper<ConfigTextoEmails> rwMapPK = new RowMapper<ConfigTextoEmails>() {
		@Override()
		public ConfigTextoEmails mapRow(ResultSet resultSet, int rowNum) throws SQLException {
			ConfigTextoEmails bean = new ConfigTextoEmails();
			bean.setId(resultSet.getInt("ID006"));
           return bean;
		}
	};

	@Override()
	public ConfigTextoEmails add(ConfigTextoEmails configtextoemails) {
    	String query = "INSERT INTO AA79B06S01 (ID_006, TEXTO_MAIL_ES_006, TEXTO_MAIL_EU_006, ASUNTO_ES_006, ASUNTO_EU_006) VALUES (?,?,?,?,?)";
		this.getJdbcTemplate().update(query, configtextoemails.getId(), configtextoemails.getTextoMailEs(), configtextoemails.getTextoMailEu(), configtextoemails.getAsuntoEs(), configtextoemails.getAsuntoEu());
		return configtextoemails;
	}

    @Override()
	public ConfigTextoEmails update(ConfigTextoEmails configtextoemails) {
		String query = "UPDATE AA79B06S01 SET TEXTO_MAIL_ES_006=?, TEXTO_MAIL_EU_006=?, ASUNTO_ES_006=?, ASUNTO_EU_006=? WHERE ID_006=?";
		Integer registros = this.getJdbcTemplate().update(query, configtextoemails.getTextoMailEs(), configtextoemails.getTextoMailEu(), configtextoemails.getAsuntoEs(), configtextoemails.getAsuntoEu(), configtextoemails.getId());
		if (registros <= 0) {
			this.add(configtextoemails);
		}
		return configtextoemails;
	}

    @Override()
	public void remove(ConfigTextoEmails configtextoemails) {
		String query = "DELETE FROM AA79B06S01 WHERE ID_006=?";
		this.getJdbcTemplate().update(query, configtextoemails.getId());
    }

	@Override()
	protected String getSelect() {
		Locale locale = LocaleContextHolder.getLocale();
		StringBuilder select = new StringBuilder();
		select.append("SELECT ID_041 ID006");
		select.append(", ID_041 TIPOAVISO006");
		select.append(", t1.TEXTO_MAIL_ES_006 TEXTOMAILES006");
		select.append(", t1.TEXTO_MAIL_EU_006 TEXTOMAILEU006");
		select.append(", t1.ASUNTO_ES_006 ASUNTOES006");
		select.append(", t1.ASUNTO_EU_006 ASUNTOEU006");
		select.append(", DESC_ES_041 DESCES041");
		select.append(", DESC_EU_041 DESCEU041");
		select.append(", DESTINATARIO_041 DESTINATARIO041");
		select.append(", CASE DESTINATARIO_041");
		for (DestinatarioEnum destinatario : DestinatarioEnum.values()) {
			select.append(" WHEN ").append(destinatario.getValue()).append(" THEN '").append(this.msg.getMessage(destinatario.getLabel(), null, locale)).append("'");
		}
		select.append(" ELSE NULL END DESTINATARIODESC");
		return select.toString();
	}

	@Override()
	protected String getFrom() {
		StringBuilder select = new StringBuilder();
		select.append(" FROM AA79B41S01 t2");
		select.append(" LEFT JOIN AA79B06S01 t1 ON ID_006 = ID_041");
		return select.toString();
	}

	@Override()
	protected RowMapper<ConfigTextoEmails> getRwMap() {
		return this.rwMap;
	}

	@Override()
	protected String[] getOrderBy() {
		return ORDER_BY_WHITE_LIST;
	}

	@Override()
	protected String getPK() {
		return "ID_006";
	}

	@Override()
	protected RowMapper<ConfigTextoEmails> getRwMapPK() {
		return this.rwMapPK;
	}

	@Override()
	protected String getWherePK(ConfigTextoEmails bean, List<Object> params) {
		params.add(bean.getId());
		return " WHERE t1.ID_006 = ?";
	}

	@Override()
	protected String getWhere(ConfigTextoEmails bean, List<Object> params) {
		StringBuilder where = new StringBuilder(ConfigTextoEmailsDaoImpl.STRING_BUILDER_INIT);
		where.append(SqlUtils.generarWhereIgual("ID_006", bean.getId(), params));
		where.append(SqlUtils.generarWhereIgual("ASUNTO_ES_006", bean.getAsuntoEs(), params));
		where.append(SqlUtils.generarWhereIgual("ASUNTO_EU_006", bean.getAsuntoEu(), params));
		return where.toString();
	}

	@Override()
	protected String getWhereLike(ConfigTextoEmails bean, Boolean startsWith, List<Object> params, Boolean search) {
		StringBuilder where = new StringBuilder(ConfigTextoEmailsDaoImpl.STRING_BUILDER_INIT);
		where.append(SqlUtils.generarWhereIgual("ID_006", bean.getId(), params));
		where.append(SqlUtils.generarWhereLikeNormalizado("ASUNTO_ES_006", bean.getAsuntoEs(), params, startsWith));
		where.append(SqlUtils.generarWhereLikeNormalizado("ASUNTO_EU_006", bean.getAsuntoEu(), params, startsWith));
		return where.toString();
	}

	@Override()
	public void update(List<ConfigTextoEmails> textoEmails) {
		String update = "UPDATE AA79B06S01 SET TEXTO_MAIL_ES_006=?, TEXTO_MAIL_EU_006=?, ASUNTO_ES_006=?, ASUNTO_EU_006=? WHERE ID_006=?";
		List<Object[]> params = new ArrayList<Object[]>();
		List<Object> aux = new ArrayList<Object>();
		for (ConfigTextoEmails texto : textoEmails) {
			aux.clear();
			aux.add(texto.getTextoMailEs());
			aux.add(texto.getTextoMailEu());
			aux.add(texto.getAsuntoEs());
			aux.add(texto.getAsuntoEu());
			aux.add(texto.getId());
			params.add(aux.toArray());
		}
		this.getJdbcTemplate().batchUpdate(update, params);
	}
	
}

