package com.ejie.aa79b.dao;

import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.List;

import org.springframework.jdbc.core.RowMapper;
import org.springframework.stereotype.Repository;
import org.springframework.transaction.annotation.Transactional;

import com.ejie.aa79b.common.DBConstants;
import com.ejie.aa79b.common.SqlUtils;
import com.ejie.aa79b.model.EntradaLibroRegistroSol;
import com.ejie.aa79b.model.LibroRegistro;
import com.ejie.aa79b.model.webservices.Aa79bLibroRegistro;
import com.ejie.aa79b.utils.DateUtils;

/**
 * LibroRegistroDaoImpl generated by UDA, 03-abr-2018 9:49:16.
 * 
 * @author UDA
 */

@Repository()
@Transactional()
public class LibroRegistroDaoImpl extends GenericoDaoImpl<LibroRegistro> implements LibroRegistroDao {

	protected static final String ID_080 = "ID_080";
	protected static final String ANYO_080 = "ANYO_080";
	protected static final String NUM_EXP_080 = "NUM_EXP_080";
	protected static final String MATTER_080 = "MATTER_080";
	protected static final String TELEMATICO_080 = "TELEMATICO_080";
	protected static final String FECHA_REGISTRO_080 = "FECHA_REGISTRO_080";
	protected static final String NUM_REGISTRO_080 = "NUM_REGISTRO_080";
	protected static final String[] ORDER_BY_WHITE_LIST = new String[] { DBConstants.ID, DBConstants.ANYO,
			DBConstants.NUMEXP, "MATTER", "TELEMATICO", "FECHAREGISTRO", "NUMREGISTRO" };

	/*
	 * ROW_MAPPERS
	 */
	private RowMapper<LibroRegistro> rwMap = new RowMapper<LibroRegistro>() {
		@Override
		public LibroRegistro mapRow(ResultSet resultSet, int rowNum) throws SQLException {
			LibroRegistro libroRegistro = new LibroRegistro();
			libroRegistro.setId(resultSet.getLong(DBConstants.ID));
			libroRegistro.setAnyo(resultSet.getLong(DBConstants.ANYO));
			libroRegistro.setNumExp(resultSet.getInt(DBConstants.NUMEXP));
			libroRegistro.setMatter(resultSet.getString("MATTER"));
			libroRegistro.setTelematico(resultSet.getString("TELEMATICO"));
			libroRegistro.setFechaRegistro(resultSet.getDate("FECHAREGISTRO"));
			libroRegistro.setNumRegistro(resultSet.getString("NUMREGISTRO"));

			return libroRegistro;
		}
	};

	private RowMapper<LibroRegistro> rwMapPK = new RowMapper<LibroRegistro>() {
		@Override
		public LibroRegistro mapRow(ResultSet resultSet, int rowNum) throws SQLException {
			LibroRegistro libroRegistro = new LibroRegistro();
			libroRegistro.setId(resultSet.getLong(DBConstants.ID));

			return libroRegistro;
		}
	};

	/**
	 * Constructor
	 */
	public LibroRegistroDaoImpl() {
		super(LibroRegistro.class);
	}

	@Override()
	public LibroRegistro add(LibroRegistro libroregistro) {
		String query = "INSERT INTO AA79B80S01 (ID_080, IND_SALIDA_080, ANYO_080, NUM_EXP_080, MATTER_080, TELEMATICO_080, FECHA_REGISTRO_080, NUM_REGISTRO_080) VALUES (AA79B80Q00.NEXTVAL,?,?,?,?,?,?,?)";
		this.getJdbcTemplate().update(query, libroregistro.getIndSalida(), libroregistro.getAnyo(),
				libroregistro.getNumExp(), libroregistro.getMatter(), libroregistro.getTelematico(),
				libroregistro.getFechaRegistro(), libroregistro.getNumRegistro());
		return libroregistro;
	}

	@Override()
	public LibroRegistro update(LibroRegistro libroregistro) {
		String query = "UPDATE AA79B80S01 SET ANYO_080=?, NUM_EXP_080=?, MATTER_080=?, TELEMATICO_080=?, FECHA_REGISTRO_080=?, NUM_REGISTRO_080=? WHERE ID_080=?";
		this.getJdbcTemplate().update(query, libroregistro.getAnyo(), libroregistro.getNumExp(),
				libroregistro.getMatter(), libroregistro.getTelematico(), libroregistro.getFechaRegistro(),
				libroregistro.getNumRegistro(), libroregistro.getId());
		return libroregistro;
	}

	@Override()
	public void remove(LibroRegistro libroregistro) {
		String query = "DELETE FROM AA79B80S01 WHERE ID_080=?";
		this.getJdbcTemplate().update(query, libroregistro.getId());
	}

	@Override()
	protected String getSelect() {
		StringBuilder query = new StringBuilder();

		query.append("SELECT t1.ID_080 ID");
		query.append(", t1.ANYO_080 ANYO");
		query.append(", t1.NUM_EXP_080 NUMEXP");
		query.append(", t1.MATTER_080 MATTER");
		query.append(", t1.TELEMATICO_080 TELEMATICO");
		query.append(", t1.FECHA_REGISTRO_080 FECHAREGISTRO");
		query.append(", t1.NUM_REGISTRO_080 NUMREGISTRO");

		return query.toString();
	}

	@Override()
	protected String getFrom() {
		StringBuilder query = new StringBuilder();

		query.append(" FROM AA79B80S01 t1 ");

		return query.toString();
	}

	@Override()
	protected RowMapper<LibroRegistro> getRwMap() {
		return this.rwMap;
	}

	@Override()
	protected String[] getOrderBy() {
		return LibroRegistroDaoImpl.ORDER_BY_WHITE_LIST;
	}

	@Override()
	protected String getPK() {
		return ID_080;
	}

	@Override()
	protected RowMapper<LibroRegistro> getRwMapPK() {
		return this.rwMapPK;
	}

	@Override()
	protected String getWherePK(LibroRegistro bean, List<Object> params) {
		params.add(bean.getId());
		return " WHERE t1.ID_080 = ?";
	}

	@Override()
	protected String getWhere(LibroRegistro bean, List<Object> params) {
		return this.getWhereClause(bean, params);
	}

	@Override()
	protected String getWhereLike(LibroRegistro bean, Boolean startsWith, List<Object> params, Boolean search) {
		return this.getWhereClause(bean, params);
	}

	/**
	 * @param bean
	 * @param params
	 * @return
	 */
	private String getWhereClause(LibroRegistro bean, List<Object> params) {
		StringBuilder where = new StringBuilder(LibroRegistroDaoImpl.STRING_BUILDER_INIT);

		if (bean != null) {
			where.append(SqlUtils.generarWhereIgual(ID_080, bean.getId(), params));
			where.append(SqlUtils.generarWhereIgual(ANYO_080, bean.getAnyo(), params));
			where.append(SqlUtils.generarWhereIgual(NUM_EXP_080, bean.getNumExp(), params));
			where.append(SqlUtils.generarWhereIgual(MATTER_080, bean.getMatter(), params));
			where.append(SqlUtils.generarWhereIgual(TELEMATICO_080, bean.getTelematico(), params));
			where.append(SqlUtils.generarWhereIgual(FECHA_REGISTRO_080, bean.getFechaRegistro(), params));
			where.append(SqlUtils.generarWhereIgual(NUM_REGISTRO_080, bean.getNumRegistro(), params));
		}

		return where.toString();
	}

	@Override()
	public void setlibroRegistroSol(EntradaLibroRegistroSol entradaLibroRegistroSol) {
		String query = "INSERT INTO AA79B80S01 (ID_080, ANYO_080, NUM_EXP_080, MATTER_080, TELEMATICO_080, FECHA_REGISTRO_080, NUM_REGISTRO_080) VALUES (AA79B80Q00.NEXTVAL,?,?,?,?,?,?)";
		// FALTA EL IND_SALIDA_080, por ahora se mete 'N' por defecto.
		Aa79bLibroRegistro libroRegistro = entradaLibroRegistroSol.getLibroRegistro();
		this.getJdbcTemplate().update(query
				, entradaLibroRegistroSol.getAnyo()
				, entradaLibroRegistroSol.getNumExp()
				, libroRegistro.getMatter()
				, libroRegistro.getTelematico()
				, DateUtils.obtFechaHoraFormateada(libroRegistro.getFechaRegistro(), null)
				, libroRegistro.getNumRegistro());
	}

	@Override()
	public List<LibroRegistro> getlibroRegistroSol(EntradaLibroRegistroSol entradaLibroRegistroSol) {
		List<Object> params = new ArrayList<Object>();
		params.add(entradaLibroRegistroSol.getAnyo());
		params.add(entradaLibroRegistroSol.getNumExp());
		StringBuilder query = new StringBuilder(this.getSelect());
		query.append(this.getFrom());
		query.append("WHERE t1.ANYO_080 = ? AND t1.NUM_EXP_080 = ? ");
		query.append("ORDER BY t1.FECHA_REGISTRO_080");

		return this.getJdbcTemplate().query(query.toString(), this.rwMap, params.toArray());
	}

}
