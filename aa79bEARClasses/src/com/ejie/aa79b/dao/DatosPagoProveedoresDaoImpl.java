
package com.ejie.aa79b.dao;

import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.List;

import org.springframework.dao.support.DataAccessUtils;
import org.springframework.jdbc.core.RowMapper;
import org.springframework.stereotype.Repository;
import org.springframework.transaction.annotation.Transactional;

import com.ejie.aa79b.common.DaoConstants;
import com.ejie.aa79b.common.SqlUtils;
import com.ejie.aa79b.dao.mapper.DatosPagoProveedoresRowMapper;
import com.ejie.aa79b.model.DatosPagoProveedores;
import com.ejie.aa79b.model.Expediente;
import com.ejie.aa79b.model.Tareas;
import com.ejie.aa79b.model.enums.ActivoEnum;
import com.ejie.aa79b.model.enums.TipoTareaGestionAsociadaEnum;

/**
 * DatosPagoProveedoresDaoImpl generated by UDA, 19-jun-2018 13:27:18.
 * 
 * @author UDA
 */

@Repository
@Transactional
public class DatosPagoProveedoresDaoImpl extends GenericoDaoImpl<DatosPagoProveedores>
		implements DatosPagoProveedoresDao {

	protected static final String ID_TAREA_094 = "ID_TAREA_094";
	protected static final String IDTAREA = "IDTAREA";

	protected static final String[] ORDER_BY_WHITE_LIST = new String[] { IDTAREA, "IMPORTEBASE", "IMPORTEIVA",
			"IMPORTEPENALIZACION", "IMPORTERECARGOAPREMIO", "IMPORTERECARGOFORMATO", "IMPORTETAREA", "IMPORTETOTAL",
			"INDPENALIZACION", "INDRECARGOAPREMIO", "INDRECARGOFORMATO", "NUMPALCONCOR084", "NUMPALCONCOR8594",
			"NUMPALCONCOR95100", "NUMPALRECARGOFORMATO", "NUMTOTALPAL", "PORPENALIZACION", "PORRECARGOAPREMIO" };

	/*
	 * ROW_MAPPERS
	 */
	private RowMapper<DatosPagoProveedores> rwMap = new DatosPagoProveedoresRowMapper();

	private RowMapper<DatosPagoProveedores> rwMapPK = new RowMapper<DatosPagoProveedores>() {
		@Override
		public DatosPagoProveedores mapRow(ResultSet resultSet, int rowNum) throws SQLException {
			final DatosPagoProveedores datosPagoProveedores = new DatosPagoProveedores();
			datosPagoProveedores.setIdTarea(resultSet.getBigDecimal(IDTAREA));

			return datosPagoProveedores;
		}
	};

	private RowMapper<DatosPagoProveedores> rwMapDatosTareaRel = new RowMapper<DatosPagoProveedores>() {
		@Override()
		public DatosPagoProveedores mapRow(ResultSet resultSet, int rowNum) throws SQLException {

			DatosPagoProveedores bean = new DatosPagoProveedores();
			bean.setIdTarea(resultSet.getBigDecimal("ID_TAREA_094"));
			bean.setIndRecargoFormato(resultSet.getString("IND_RECARGO_FORMATO_094"));
			bean.setNumPalRecargoFormato(resultSet.getInt("NUM_PAL_RECARGO_FORMATO_094"));
			bean.setIndRecargoApremio(resultSet.getString("IND_RECARGO_APREMIO_094"));
			bean.setPorRecargoApremio(resultSet.getLong("POR_RECARGO_APREMIO_094"));
			bean.setIndPenalizacion(resultSet.getString("IND_PENALIZACION_094"));
			bean.setPorPenalizacion(resultSet.getLong("POR_PENALIZACION_094"));
			return bean;
		}
	};

	private RowMapper<DatosPagoProveedores> rwMapDatosTarea = new RowMapper<DatosPagoProveedores>() {
		@Override()
		public DatosPagoProveedores mapRow(ResultSet resultSet, int rowNum) throws SQLException {

			DatosPagoProveedores bean = new DatosPagoProveedores();
			bean.setImporteTarea(resultSet.getBigDecimal("IMPORTE_TAREA_094"));
			bean.setImporteRecargoFormato(resultSet.getBigDecimal("IMPORTE_RECARGO_FORMATO_094"));
			bean.setImporteRecargoApremio(resultSet.getBigDecimal("IMPORTE_RECARGO_APREMIO_094"));
			bean.setImportePenalizacion(resultSet.getBigDecimal("IMPORTE_PENALIZACION_094"));
			bean.setImportePenalCalidad(resultSet.getBigDecimal("IMP_PENAL_CALIDAD_094"));
			bean.setImporteBase(resultSet.getBigDecimal("IMPORTE_BASE_094"));
			bean.setImporteIva(resultSet.getBigDecimal("IMPORTE_IVA_094"));
			bean.setImporteTotal(resultSet.getBigDecimal("IMPORTE_TOTAL_094"));
			return bean;

		}
	};

	/**
	 * Constructor
	 */
	public DatosPagoProveedoresDaoImpl() {
		super(DatosPagoProveedores.class);
	}

	@Override
	public DatosPagoProveedores add(DatosPagoProveedores datospagoproveedores) {
		String query = "INSERT INTO AA79B94S01 (ID_TAREA_094, IMPORTE_BASE_094, IMPORTE_IVA_094, "
				+ "IMPORTE_PENALIZACION_094, IMPORTE_RECARGO_APREMIO_094, IMPORTE_RECARGO_FORMATO_094, "
				+ "IMPORTE_TAREA_094, IMPORTE_TOTAL_094, IND_PENALIZACION_094, IND_RECARGO_APREMIO_094, "
				+ "IND_RECARGO_FORMATO_094, NUM_PAL_CONCOR_0_84_094, NUM_PAL_CONCOR_85_94_094, "
				+ "NUM_PAL_CONCOR_95_100_094, NUM_PAL_RECARGO_FORMATO_094, NUM_TOTAL_PAL_094,"
				+ " POR_PENALIZACION_094, IVA_APLIC_094, IMPORTE_PAL_APLIC_094, POR_REVISION_APLIC_094, POR_RECARGO_APREMIO_094, IND_ALBARAN_094,"
				+ "NIVEL_CALIDAD_094, POR_PENAL_CALIDAD_094, IMP_PENAL_CALIDAD_094) "
				+ "VALUES (?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)";
		this.getJdbcTemplate().update(query, datospagoproveedores.getIdTarea(), datospagoproveedores.getImporteBase(),
				datospagoproveedores.getImporteIva(), datospagoproveedores.getImportePenalizacion(),
				datospagoproveedores.getImporteRecargoApremio(), datospagoproveedores.getImporteRecargoFormato(),
				datospagoproveedores.getImporteTarea(), datospagoproveedores.getImporteTotal(),
				datospagoproveedores.getIndPenalizacion(), datospagoproveedores.getIndRecargoApremio(),
				datospagoproveedores.getIndRecargoFormato(), datospagoproveedores.getNumPalConcor084(),
				datospagoproveedores.getNumPalConcor8594(), datospagoproveedores.getNumPalConcor95100(),
				datospagoproveedores.getNumPalRecargoFormato(), datospagoproveedores.getNumTotalPal(),
				datospagoproveedores.getPorPenalizacion(), datospagoproveedores.getIvaAplic(),
				datospagoproveedores.getImportePalAplic(), datospagoproveedores.getPorRevision(),
				datospagoproveedores.getPorRecargoApremio(),
				datospagoproveedores.getIndAlbaran() != null ? datospagoproveedores.getIndAlbaran()
						: ActivoEnum.NO.getValue(),
				datospagoproveedores.getNivelCalidad(), datospagoproveedores.getPorPenalizacionCalidad(),
				datospagoproveedores.getImportePenalCalidad());
		return datospagoproveedores;
	}

	@Override
	public DatosPagoProveedores update(DatosPagoProveedores datospagoproveedores) {
		String query = "UPDATE AA79B94S01 SET ID_TAREA_094 = ?, IMPORTE_BASE_094 = ?, IMPORTE_IVA_094 = ?, IMPORTE_PENALIZACION_094 = ?, IMPORTE_RECARGO_APREMIO_094 = ?, IMPORTE_RECARGO_FORMATO_094 = ?, IMPORTE_TAREA_094 = ?, IMPORTE_TOTAL_094 = ?, IND_PENALIZACION_094 = ?, IND_RECARGO_APREMIO_094 = ?, IND_RECARGO_FORMATO_094 = ?, NUM_PAL_CONCOR_0_84_094 = ?, NUM_PAL_CONCOR_85_94_094 = ?, NUM_PAL_CONCOR_95_100_094 = ?, NUM_PAL_RECARGO_FORMATO_094 = ?, NUM_TOTAL_PAL_094 = ?, POR_PENALIZACION_094 = ?, POR_RECARGO_APREMIO_094 = ?, IND_ALBARAN_094 = ?, NIVEL_CALIDAD_094 = ?, POR_PENAL_CALIDAD_094 = ?, IMP_PENAL_CALIDAD_094 = ? WHERE ID_TAREA_094=?";
		this.getJdbcTemplate().update(query, datospagoproveedores.getIdTarea(), datospagoproveedores.getImporteBase(),
				datospagoproveedores.getImporteIva(), datospagoproveedores.getImportePenalizacion(),
				datospagoproveedores.getImporteRecargoApremio(), datospagoproveedores.getImporteRecargoFormato(),
				datospagoproveedores.getImporteTarea(), datospagoproveedores.getImporteTotal(),
				datospagoproveedores.getIndPenalizacion(), datospagoproveedores.getIndRecargoApremio(),
				datospagoproveedores.getIndRecargoFormato(), datospagoproveedores.getNumPalConcor084(),
				datospagoproveedores.getNumPalConcor8594(), datospagoproveedores.getNumPalConcor95100(),
				datospagoproveedores.getNumPalRecargoFormato(), datospagoproveedores.getNumTotalPal(),
				datospagoproveedores.getPorPenalizacion(), datospagoproveedores.getPorRecargoApremio(),
				datospagoproveedores.getIndAlbaran() != null ? datospagoproveedores.getIndAlbaran()
						: ActivoEnum.NO.getValue(),
				datospagoproveedores.getNivelCalidad(), datospagoproveedores.getPorPenalizacionCalidad(),
				datospagoproveedores.getImportePenalCalidad(), datospagoproveedores.getIdTarea());
		return datospagoproveedores;
	}

	@Override
	public int updateReturnInt(DatosPagoProveedores datospagoproveedores) {
		String query = "UPDATE AA79B94S01 SET ID_TAREA_094 = ?, IMPORTE_BASE_094 = ?, IMPORTE_IVA_094 = ?, IMPORTE_PENALIZACION_094 = ?, IMPORTE_RECARGO_APREMIO_094 = ?, IMPORTE_RECARGO_FORMATO_094 = ?, IMPORTE_TAREA_094 = ?, IMPORTE_TOTAL_094 = ?, IND_PENALIZACION_094 = ?, IND_RECARGO_APREMIO_094 = ?, IND_RECARGO_FORMATO_094 = ?, NUM_PAL_CONCOR_0_84_094 = ?, NUM_PAL_CONCOR_85_94_094 = ?, NUM_PAL_CONCOR_95_100_094 = ?, NUM_PAL_RECARGO_FORMATO_094 = ?, NUM_TOTAL_PAL_094 = ?, POR_PENALIZACION_094 = ?, POR_RECARGO_APREMIO_094 = ?, IND_ALBARAN_094 = ?, NIVEL_CALIDAD_094 = ?, POR_PENAL_CALIDAD_094 = ?, IMP_PENAL_CALIDAD_094 = ? WHERE ID_TAREA_094=?";
		return this.getJdbcTemplate().update(query, datospagoproveedores.getIdTarea(),
				datospagoproveedores.getImporteBase(), datospagoproveedores.getImporteIva(),
				datospagoproveedores.getImportePenalizacion(), datospagoproveedores.getImporteRecargoApremio(),
				datospagoproveedores.getImporteRecargoFormato(), datospagoproveedores.getImporteTarea(),
				datospagoproveedores.getImporteTotal(), datospagoproveedores.getIndPenalizacion(),
				datospagoproveedores.getIndRecargoApremio(), datospagoproveedores.getIndRecargoFormato(),
				datospagoproveedores.getNumPalConcor084(), datospagoproveedores.getNumPalConcor8594(),
				datospagoproveedores.getNumPalConcor95100(), datospagoproveedores.getNumPalRecargoFormato(),
				datospagoproveedores.getNumTotalPal(), datospagoproveedores.getPorPenalizacion(),
				datospagoproveedores.getPorRecargoApremio(),
				datospagoproveedores.getIndAlbaran() != null ? datospagoproveedores.getIndAlbaran()
						: ActivoEnum.NO.getValue(),
				datospagoproveedores.getNivelCalidad(), datospagoproveedores.getPorPenalizacionCalidad(),
				datospagoproveedores.getImportePenalCalidad(), datospagoproveedores.getIdTarea());
	}

	@Override
	public void remove(DatosPagoProveedores datospagoproveedores) {
		String query = "DELETE FROM AA79B94S01 WHERE ID_TAREA_094=?";
		this.getJdbcTemplate().update(query, datospagoproveedores.getIdTarea());
	}

	@Override()
	protected String getSelect() {
		StringBuilder query = new StringBuilder();

		query.append("SELECT t1.ID_TAREA_094 IDTAREA, t1.IMPORTE_BASE_094 IMPORTEBASE, "
				+ "t1.IMPORTE_IVA_094 IMPORTEIVA, t1.IMPORTE_PENALIZACION_094 IMPORTEPENALIZACION, "
				+ "t1.IMPORTE_RECARGO_APREMIO_094 IMPORTERECARGOAPREMIO, t1.IMPORTE_RECARGO_FORMATO_094 IMPORTERECARGOFORMATO, "
				+ "t1.IMPORTE_TAREA_094 IMPORTETAREA, t1.IMPORTE_TOTAL_094 IMPORTETOTAL, "
				+ "t1.IND_PENALIZACION_094 INDPENALIZACION, t1.IND_RECARGO_APREMIO_094 INDRECARGOAPREMIO,"
				+ " t1.IND_RECARGO_FORMATO_094 INDRECARGOFORMATO, t1.NUM_PAL_CONCOR_0_84_094 NUMPALCONCOR084,"
				+ " t1.NUM_PAL_CONCOR_85_94_094 NUMPALCONCOR8594, t1.NUM_PAL_CONCOR_95_100_094 NUMPALCONCOR95100, "
				+ "t1.NUM_PAL_RECARGO_FORMATO_094 NUMPALRECARGOFORMATO, t1.NUM_TOTAL_PAL_094 NUMTOTALPAL,"
				+ " t1.POR_PENALIZACION_094 PORPENALIZACION, t1.POR_RECARGO_APREMIO_094 PORRECARGOAPREMIO,"
				+ " t1.IND_ALBARAN_094 INDALBARAN,"
				+ " t1.NIVEL_CALIDAD_094 NIVELCALIDAD, t1.IMP_PENAL_CALIDAD_094 IMPORTEPENALCALIDAD, t1.POR_PENAL_CALIDAD_094 PORPENALCALIDAD");

		return query.toString();
	}

	@Override()
	protected String getFrom() {
		StringBuilder query = new StringBuilder();

		query.append(" FROM AA79B94S01 t1 ");

		return query.toString();
	}

	@Override()
	protected RowMapper<DatosPagoProveedores> getRwMap() {
		return this.rwMap;
	}

	@Override()
	protected String[] getOrderBy() {
		return DatosPagoProveedoresDaoImpl.ORDER_BY_WHITE_LIST;
	}

	@Override()
	protected String getPK() {
		return ID_TAREA_094;
	}

	@Override()
	protected RowMapper<DatosPagoProveedores> getRwMapPK() {
		return this.rwMapPK;
	}

	@Override()
	protected String getWherePK(DatosPagoProveedores bean, List<Object> params) {
		params.add(bean.getIdTarea());
		return " WHERE t1.ID_TAREA_094 = ?";
	}

	@Override()
	protected String getWhere(DatosPagoProveedores bean, List<Object> params) {

		return this.getWhereClause(bean, params);
	}

	@Override()
	protected String getWhereLike(DatosPagoProveedores bean, Boolean startsWith, List<Object> params, Boolean search) {

		return this.getWhereClause(bean, params);
	}

	/**
	 * Obtiene la clausula where
	 * 
	 * @param bean   DatosPagoProveedores
	 * @param params List<Object>
	 * @return String
	 */
	private String getWhereClause(DatosPagoProveedores bean, List<Object> params) {
		StringBuilder where = new StringBuilder(DatosPagoProveedoresDaoImpl.STRING_BUILDER_INIT);

		if (bean != null) {
			where.append(SqlUtils.generarWhereIgual(ID_TAREA_094, bean.getIdTarea(), params));
			/* Añadir según necesidades */
		}

		return where.toString();
	}

	@Override
	public DatosPagoProveedores getDatosPagoProvTareaRel(Tareas tarea) {
		StringBuilder query = new StringBuilder();
		List<Object> params = new ArrayList<Object>();
		query.append("SELECT ID_TAREA_094, IND_RECARGO_FORMATO_094, NUM_PAL_RECARGO_FORMATO_094, ");
		query.append("IND_RECARGO_APREMIO_094, POR_RECARGO_APREMIO_094, IND_PENALIZACION_094, ");
		query.append("POR_PENALIZACION_094 FROM AA79B81T00 ");
		query.append("JOIN AA79B94T00 ON ID_TAREA_094 = ID_TAREA_081 ");
		query.append("WHERE ID_TAREA_REL_081 = ? AND ID_TIPO_TAREA_081 = "
				+ TipoTareaGestionAsociadaEnum.REVISION_PAGO_PROVEEDOR.getValue());
		params.add(tarea.getIdTarea());

		List<DatosPagoProveedores> resultList = this.getJdbcTemplate().query(query.toString(), this.rwMapDatosTareaRel,
				params.toArray());

		return DataAccessUtils.uniqueResult(resultList);
	}

	@Override
	public DatosPagoProveedores getDatosTarea(Expediente exp) {
		StringBuilder query = new StringBuilder();
		List<Object> params = new ArrayList<Object>();
		query.append("SELECT IMPORTE_TAREA_094, IMPORTE_RECARGO_FORMATO_094, IMPORTE_RECARGO_APREMIO_094, ");
		query.append(
				"IMPORTE_PENALIZACION_094, NVL(IMP_PENAL_CALIDAD_094,0) IMP_PENAL_CALIDAD_094, IMPORTE_BASE_094, IMPORTE_IVA_094, IMPORTE_TOTAL_094 ");
		query.append("FROM AA79B81T00 ");
		query.append("JOIN AA79B94T00 ON ID_TAREA_094 = ID_TAREA_081 ");
		query.append("WHERE ID_TIPO_TAREA_081 = " + TipoTareaGestionAsociadaEnum.REVISION_PAGO_PROVEEDOR.getValue()
				+ DaoConstants.AND);
		query.append("NUM_EXP_081 = ? AND ANYO_081 = ? ORDER BY ORDEN_081 DESC ");
		query.append("FETCH first 1 ROWS ONLY ");
		params.add(exp.getNumExp());
		params.add(exp.getAnyo());

		List<DatosPagoProveedores> resultList = this.getJdbcTemplate().query(query.toString(), this.rwMapDatosTarea,
				params.toArray());

		return DataAccessUtils.uniqueResult(resultList);
	}
}
