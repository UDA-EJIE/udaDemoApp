CREATE OR REPLACE VIEW INF_EXPEDIENTES ( 
ESP_ZK, URTEA, ESPEDIENTEA, EHAA, ESPEDIENTE_MOTA, COD_ENTIDAD, TIPO, ESKATZAILEA, HITZ_KOPURUA_IZO, TARIFA_HITZAK,
AMAITUTA, DOCUMENTU_MOTA, ITZULPEN_MOTA, ZENBATEKOA_BEZ_BARNE, DESKRIBAPENA, SOLASKIDEA) AS 
SELECT 
NUM_EXP_051, ANYO_051, SUBSTR(ANYO_051,3,4) || '/' || LPAD(NUM_EXP_051,6,'0'), DECODE(IND_PUBLICAR_BOPV_053, 'S', 'Bai', 'Ez'), 
DECODE(ID_TIPO_EXPEDIENTE_051, 'T', 'ITZULPENA','R', 'BERRIKUSKETA','INTERPRETAZIOA'),
CODIGO,TIPO,
TRIM(t71solici.APEL1_077) || ' ' || TRIM(t71solici.APEL2_077) || ', ' || TRIM(t71solici.NOMBRE_077),
NUM_TOTAL_PAL_IZO_053,
TARIFA_PAL_097,
DECODE(ID_ESTADO_EXP_059, 7, 'Bai', 'Ez'),
tDocs.DOCS,
DESC_RELEVANCIA_EU_010,
IMPORTE_TOTAL_097,
TITULO_051,
DECODE(t71solaski.DNI_077, null, null, TRIM(t71solaski.APEL1_077) || ' ' || TRIM(t71solaski.APEL2_077) || ', ' || TRIM(t71solaski.NOMBRE_077))
FROM AA79B51T00 
LEFT JOIN AA79B53T00 ON ANYO_051 = ANYO_053 AND NUM_EXP_051 = NUM_EXP_053
LEFT JOIN AA79B97T00 ON ANYO_051 = ANYO_097 AND NUM_EXP_051 = NUM_EXP_097
JOIN AA79B59T00 ON NUM_EXP_051 = NUM_EXP_059 AND ANYO_051 = ANYO_059 AND ESTADO_BITACORA_051 = ID_ESTADO_BITACORA_059
LEFT JOIN 
(SELECT NUM_EXP_056, ANYO_056, LISTAGG(DESC_EU_042 , ', ') WITHIN GROUP (ORDER BY DESC_EU_042) AS DOCS 
FROM AA79B56T00 JOIN AA79B42T00 ON TIPO_DOCUMENTO_056 = ID_042 WHERE CLASE_DOCUMENTO_056 in (1,2) GROUP BY NUM_EXP_056, ANYO_056) tDocs ON tDocs.NUM_EXP_056 = NUM_EXP_051 AND tDocs.ANYO_056 = ANYO_051
LEFT JOIN AA79B10T00 ON ID_TIPO_RELEVANCIA_010 = ID_RELEVANCIA_053
JOIN AA79B54T00 ON ANYO_051 = ANYO_054 AND NUM_EXP_051 = NUM_EXP_054
JOIN X54JAPI_ENTIDADES_SOLIC ON TIPO =  TIPO_ENTIDAD_054 AND CODIGO = ID_ENTIDAD_054
JOIN AA79B77T00 t71solici ON t71solici.DNI_077 = DNI_SOLICITANTE_054
LEFT JOIN AA79B77T00 t71solaski ON t71solaski.DNI_077 = DNI_REPRESENTANTE_054
/