create or replace FUNCTION COMPROBAR_TIPO_TAREA ( ANYO IN   NUMBER,
   NUM_EXP IN NUMBER, ID_TIPO_TAREA IN NUMBER) RETURN NUMBER IS

RETORNO NUMBER(1):=0;

CONTADOR NUMBER(1):=0;
CONTADOR_AUX NUMBER(1):=0;

TIPO_TAREA_TRADOS NUMBER(2):= 1;
TIPO_TAREA_TRADUCCION NUMBER(2):= 2;
TIPO_TAREA_CORREDACCION NUMBER(2):= 3;
TIPO_TAREA_REVISAR NUMBER(2):= 4;
TIPO_TAREA_NO_CONF_PROVEEDOR NUMBER(2):= 5;
TIPO_TAREA_GESTION_INTER NUMBER(2):= 6;
TIPO_TAREA_PREP_INTER NUMBER(2):= 7;
TIPO_TAREA_INTERPRETACION NUMBER(2):= 8;
TIPO_TAREA_NO_CONF_CLIENTE NUMBER(2):= 9;
TIPO_TAREA_POST_BOE NUMBER(2):= 10;
TIPO_TAREA_REV_PAGO_PROV NUMBER(2):= 11;
TIPO_TAREA_PAGO_PROF_INTER NUMBER(2):= 12;
TIPO_TAREA_NOT_CORRE_PROV NUMBER(2):= 13;
TIPO_TAREA_ESTUDIAR_SUBS NUMBER(2):= 14;
TIPO_TAREA_ALINEAR NUMBER(2):= 15;
TIPO_TAREA_ACT_MEMORIAS NUMBER(2):= 16;
TIPO_TAREA_ACT_IDABA NUMBER(2):= 17;
TIPO_TAREA_TERMINOLOGIA NUMBER(2):= 18;
TIPO_TAREA_ENTREGA_TRAD NUMBER(2):= 19;
TIPO_TAREA_REV_ENTREGA NUMBER(2):= 20;
TIPO_TAREA_REVISAR_TRAD NUMBER(2):= 21;
TIPO_TAREA_TRAD_ENTREGA NUMBER(2):= 22;

DIAS_NO_CONF NUMBER(2);

BEGIN
			IF (ID_TIPO_TAREA = TIPO_TAREA_TRADOS) THEN
				SELECT count(1) into CONTADOR from AA79B81T00 WHERE ANYO_081 = ANYO AND NUM_EXP_081 = NUM_EXP AND ID_TIPO_TAREA_081 = TIPO_TAREA_TRADOS;
				IF (CONTADOR > 0) THEN
					RETORNO:= 1;
				END IF;
			ELSIF (ID_TIPO_TAREA = TIPO_TAREA_ENTREGA_TRAD) THEN
				SELECT count(1) into CONTADOR from AA79B81T00, AA79B82T00 WHERE ANYO_081 = ANYO AND NUM_EXP_081 = NUM_EXP 
				AND ID_TAREA_081 = ID_TAREA_082 AND ID_TIPO_TAREA_081 = TIPO_TAREA_NO_CONF_CLIENTE AND ESTADO_EJECUCION_081 = 3 
				AND IND_REALIZADA_082 = 'S';
				IF (CONTADOR > 0) THEN
					SELECT count(1) into CONTADOR_AUX from AA79B81T00 WHERE ANYO_081 = ANYO AND NUM_EXP_081 = NUM_EXP AND ID_TIPO_TAREA_081 IN (TIPO_TAREA_ENTREGA_TRAD, TIPO_TAREA_TRAD_ENTREGA);
					IF (CONTADOR_AUX = CONTADOR + 1) THEN
						RETORNO:= 1;
					END IF;
				ELSE
					SELECT count(1) into CONTADOR from AA79B81T00 WHERE ANYO_081 = ANYO AND NUM_EXP_081 = NUM_EXP AND ID_TIPO_TAREA_081 IN (TIPO_TAREA_ENTREGA_TRAD, TIPO_TAREA_TRAD_ENTREGA);
					IF (CONTADOR > 0) THEN
						RETORNO:= 1;
					END IF;
				END IF;
            ELSIF (ID_TIPO_TAREA = TIPO_TAREA_TRAD_ENTREGA) THEN
				SELECT count(1) into CONTADOR from AA79B81T00, AA79B82T00 WHERE ANYO_081 = ANYO AND NUM_EXP_081 = NUM_EXP 
				AND ID_TAREA_081 = ID_TAREA_082 AND ID_TIPO_TAREA_081 = TIPO_TAREA_NO_CONF_CLIENTE AND ESTADO_EJECUCION_081 = 3 
				AND IND_REALIZADA_082 = 'S';
				IF (CONTADOR > 0) THEN
					SELECT count(1) into CONTADOR_AUX from AA79B81T00 WHERE ANYO_081 = ANYO AND NUM_EXP_081 = NUM_EXP AND ID_TIPO_TAREA_081 IN (TIPO_TAREA_ENTREGA_TRAD, TIPO_TAREA_TRAD_ENTREGA);
					IF (CONTADOR_AUX = CONTADOR + 1) THEN
						RETORNO:= 1;
					END IF;
				ELSE
					SELECT count(1) into CONTADOR from AA79B81T00 WHERE ANYO_081 = ANYO AND NUM_EXP_081 = NUM_EXP AND ID_TIPO_TAREA_081 IN (TIPO_TAREA_ENTREGA_TRAD, TIPO_TAREA_TRAD_ENTREGA);
					IF (CONTADOR > 0) THEN
						RETORNO:= 1;
					END IF;
				END IF;
			ELSIF (ID_TIPO_TAREA = TIPO_TAREA_REV_ENTREGA) THEN
				SELECT count(1) into CONTADOR from AA79B81T00, AA79B82T00 WHERE ANYO_081 = ANYO AND NUM_EXP_081 = NUM_EXP 
				AND ID_TAREA_081 = ID_TAREA_082 AND ID_TIPO_TAREA_081 = TIPO_TAREA_NO_CONF_CLIENTE AND ESTADO_EJECUCION_081 = 3 
				AND IND_REALIZADA_082 = 'S';
				IF (CONTADOR > 0) THEN
					SELECT count(1) into CONTADOR_AUX from AA79B81T00 WHERE ANYO_081 = ANYO AND NUM_EXP_081 = NUM_EXP AND ID_TIPO_TAREA_081 = TIPO_TAREA_REV_ENTREGA;
					IF (CONTADOR_AUX = CONTADOR + 1) THEN
						RETORNO:= 1;
					END IF;
				ELSE
					SELECT count(1) into CONTADOR from AA79B81T00 WHERE ANYO_081 = ANYO AND NUM_EXP_081 = NUM_EXP AND ID_TIPO_TAREA_081 = TIPO_TAREA_REV_ENTREGA;
					IF (CONTADOR > 0) THEN
						RETORNO:= 1;
					END IF;
				END IF;
			ELSIF (ID_TIPO_TAREA = TIPO_TAREA_CORREDACCION) THEN
				SELECT count(1) into CONTADOR from AA79B81T00 WHERE ANYO_081 = ANYO AND NUM_EXP_081 = NUM_EXP AND ID_TIPO_TAREA_081 = TIPO_TAREA_CORREDACCION;
				IF (CONTADOR > 0) THEN
					RETORNO:= 1;
				END IF;
			ELSIF (ID_TIPO_TAREA = TIPO_TAREA_GESTION_INTER) THEN
				SELECT count(1) into CONTADOR from AA79B81T00 WHERE ANYO_081 = ANYO AND NUM_EXP_081 = NUM_EXP AND ID_TIPO_TAREA_081 = TIPO_TAREA_GESTION_INTER;
				IF (CONTADOR > 0) THEN
					RETORNO:= 1;
				END IF;
			ELSIF (ID_TIPO_TAREA = TIPO_TAREA_NO_CONF_CLIENTE) THEN
				SELECT count(1) into CONTADOR from AA79B81T00 WHERE ANYO_081 = ANYO AND NUM_EXP_081 = NUM_EXP AND ID_TIPO_TAREA_081 = TIPO_TAREA_NO_CONF_CLIENTE AND ESTADO_EJECUCION_081 <> 3;
				IF (CONTADOR > 0) THEN
					RETORNO:= 1;
				ELSE
					SELECT DIAS_NO_CONFORMIDAD_004 into DIAS_NO_CONF from AA79B04T00 WHERE ID_004 = 0;
					SELECT count(1) into CONTADOR_AUX from AA79B81T00, AA79B82T00 WHERE ANYO_081 = ANYO AND NUM_EXP_081 = NUM_EXP AND ID_TAREA_081 = ID_TAREA_082 AND ID_TIPO_TAREA_081 in (TIPO_TAREA_REV_ENTREGA,TIPO_TAREA_ENTREGA_TRAD) 
					AND ESTADO_EJECUCION_081 = 3 AND FECHA_EJECUCION_082 + DIAS_NO_CONF > sysdate AND IND_NO_CONFORMIDAD_081 = 'N';
					IF (CONTADOR_AUX = 0) THEN
							RETORNO:= 1;
					ELSE
						SELECT count(1) into CONTADOR from AA79B81T00, AA79B82T00 WHERE ANYO_081 = ANYO AND NUM_EXP_081 = NUM_EXP 
						AND ID_TAREA_081 = ID_TAREA_082 AND IND_REALIZADA_082 = 'S'
						AND ID_TIPO_TAREA_081 = TIPO_TAREA_NO_CONF_CLIENTE AND ESTADO_EJECUCION_081 = 3;
						IF (CONTADOR > 0) THEN
							SELECT count(1) into CONTADOR_AUX from AA79B81T00 WHERE ANYO_081 = ANYO AND NUM_EXP_081 = NUM_EXP AND ID_TIPO_TAREA_081 in (TIPO_TAREA_REV_ENTREGA,TIPO_TAREA_ENTREGA_TRAD);
							IF (CONTADOR_AUX <> CONTADOR + 1) THEN
								RETORNO:= 1;
							END IF;
						END IF;
					END IF;
				END IF;
			ELSIF (ID_TIPO_TAREA = TIPO_TAREA_POST_BOE) THEN
				SELECT count(1) into CONTADOR from AA79B81T00 WHERE ANYO_081 = ANYO AND NUM_EXP_081 = NUM_EXP AND ID_TIPO_TAREA_081 = TIPO_TAREA_POST_BOE;
				IF (CONTADOR > 0) THEN
					RETORNO:= 1;
				END IF;
			END IF;
			
	RETURN RETORNO;
END;
/
