CREATE OR REPLACE FUNCTION REQUIERE_TRADOS (TIPO_EXP IN VARCHAR2, ANYO IN   NUMBER,
   NUM_EXP IN NUMBER, NUM_PAL_IZO IN NUMBER, NUM_PAL_TRADOS IN NUMBER
) RETURN NUMBER IS

NO_TRADOS NUMBER(1):=0; 
TRADOS_PDTE_CREACION NUMBER(1):= 1;
TRADOS_PDTE_ASIGNACION NUMBER(1):= 2;
TRADOS_PDTE_EJECUCION NUMBER(1):= 3;
TRADOS_PDTE_RETRASADA NUMBER(1):= 4;
TRADOS_EJECUTADA NUMBER(1):= 5;

RETORNO NUMBER(1):= NO_TRADOS; 

ESTADO_EJECUCION_PENDIENTE NUMBER(1):= 1;
ESTADO_EJECUTADA NUMBER(1):= 3;

ESTADO_PENDIENTE_ASIGNACION NUMBER(1):= 1;
ESTADO_PENDIENTE_ACEPTACION NUMBER(1):= 2;
ESTADO_ACEPTADA NUMBER(1):= 3;
ESTADO_RECHAZADA NUMBER(1):= 4;

TIPO_TAREA_TRADOS NUMBER(2):=1;

FECHA_INICIO DATE;
FECHA_FIN DATE;
ESTADO_ASIGNACION NUMBER(1); 
ESTADO_EJECUCION NUMBER(1); 

TIPO_TRADUCCION      VARCHAR2(1):= 'T';

BEGIN
	IF (TIPO_EXP = TIPO_TRADUCCION) THEN
		IF (NUM_PAL_IZO > NUM_PAL_TRADOS) THEN
			BEGIN 
				SELECT FECHA_INICIO_081, FECHA_FIN_081, ESTADO_ASIGNACION_081, ESTADO_EJECUCION_081 
				INTO FECHA_INICIO, FECHA_FIN, ESTADO_ASIGNACION, ESTADO_EJECUCION
				FROM AA79B81T00 
				WHERE ANYO_081 =  ANYO AND NUM_EXP_081 = NUM_EXP AND ID_TIPO_TAREA_081 = TIPO_TAREA_TRADOS;
				IF (ESTADO_ASIGNACION is NULL OR ESTADO_ASIGNACION = ESTADO_PENDIENTE_ASIGNACION OR ESTADO_ASIGNACION = ESTADO_RECHAZADA) THEN
					RETORNO:= TRADOS_PDTE_ASIGNACION;
				ELSIF (ESTADO_EJECUCION is null OR ESTADO_EJECUCION = ESTADO_EJECUCION_PENDIENTE) THEN
					IF (sysdate < FECHA_FIN) THEN
						RETORNO:= TRADOS_PDTE_RETRASADA;
					ELSE
						RETORNO:= TRADOS_PDTE_EJECUCION;
					END IF;
				ELSIF (ESTADO_EJECUCION = ESTADO_EJECUTADA) THEN
					RETORNO:= TRADOS_EJECUTADA;
				END IF;
			EXCEPTION
	            WHEN NO_DATA_FOUND THEN
	                RETORNO := TRADOS_PDTE_CREACION;                
	        END;
		
		END IF;
	END IF;
	RETURN RETORNO;
END;
/