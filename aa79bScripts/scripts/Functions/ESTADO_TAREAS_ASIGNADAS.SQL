CREATE OR REPLACE FUNCTION ESTADO_TAREAS_ASIGNADAS (ANYO IN   NUMBER,
   NUM_EXP IN NUMBER
) RETURN NUMBER IS

SIN_TAREAS NUMBER(1):=0; 
PDTE_ASIGNACION NUMBER(1):= 1;
PDTE_ACEPTACION NUMBER(1):= 2;
ACEPTADAS NUMBER(1):= 3; 
RECHAZADAS NUMBER(1):= 4;


RETORNO NUMBER(1):= SIN_TAREAS; 

ESTADO_EJECUCION_PENDIENTE NUMBER(1):= 1;

ESTADO_PENDIENTE_ACEPTACION NUMBER(1):= 2;
ESTADO_ACEPTADA NUMBER(1):= 3;
ESTADO_RECHAZADA NUMBER(1):= 4;

ORDEN NUMBER(2);
CONTADOR_TOTAL NUMBER(2):= 0;
CONTADOR_PDTE_ASIGNACION NUMBER(2):= 0;
CONTADOR_PDTE_ACEPTACION NUMBER(2):= 0;
CONTADOR_ACEPTADA NUMBER(2):= 0;
CONTADOR_RECHAZADA NUMBER(2):= 0;


BEGIN
	SELECT count(1), 
nvl(SUM(DECODE(ESTADO_ASIGNACION_081,1,1,0)),0) as pdte_asignacion,
nvl(SUM(DECODE(ESTADO_ASIGNACION_081,2,1,0)),0) as pdte_aceptacion,
nvl(SUM(DECODE(ESTADO_ASIGNACION_081,3,1,0)),0) as aceptada_asignacion,
nvl(SUM(DECODE(ESTADO_ASIGNACION_081,4,1,0)),0) as rechazada_asignacion 
into CONTADOR_TOTAL, CONTADOR_PDTE_ASIGNACION, CONTADOR_PDTE_ACEPTACION, CONTADOR_ACEPTADA, CONTADOR_RECHAZADA 
FROM AA79B81T00 WHERE ANYO_081= ANYO AND 
NUM_EXP_081  = NUM_EXP;

IF (CONTADOR_TOTAL > 0) THEN
		IF (CONTADOR_PDTE_ASIGNACION > 0) THEN
    		RETORNO:= PDTE_ASIGNACION;
    	ELSIF (CONTADOR_PDTE_ACEPTACION > 0) THEN
    		RETORNO:= PDTE_ACEPTACION;
    	ELSIF (CONTADOR_RECHAZADA > 0) THEN
    		RETORNO:= RECHAZADAS;
    	ELSE
    		RETORNO:= ACEPTADAS;
    	END IF;
    END IF;
	RETURN RETORNO;
END;
/
