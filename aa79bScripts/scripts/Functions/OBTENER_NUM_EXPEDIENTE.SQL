CREATE OR REPLACE FUNCTION OBTENER_NUM_EXPEDIENTE (ANYO IN NUMBER) RETURN NUMBER IS

NUMEXPEDIENTE VARCHAR2(10);
NUMSOL NUMBER(8);

SECUENCIA NUMBER(6);

PRIMERA_ANYO VARCHAR2(1):= 'N';

BEGIN
	--ESTE METODO GENERARA EL NUM DE EXPEDIENTE DEPENDIENDO DEL Aï¿½O
	BEGIN
		SELECT AA79B50S01.CORR_EXP_050 INTO SECUENCIA FROM AA79B50S01
		 WHERE AA79B50S01.ANYO_050 = ANYO
		FOR UPDATE OF AA79B50S01.CORR_EXP_050;
	EXCEPTION
		WHEN NO_DATA_FOUND
		THEN
		SECUENCIA := 0;
		PRIMERA_ANYO:= 'S';
	END;
	
	SECUENCIA:= SECUENCIA + 1;

	IF (PRIMERA_ANYO = 'S')THEN
		INSERT INTO AA79B50T00 (ANYO_050,CORR_EXP_050)VALUES(ANYO,SECUENCIA);
	ELSE
		UPDATE AA79B50T00 SET CORR_EXP_050 = SECUENCIA WHERE ANYO_050 = ANYO;
	END IF;
	COMMIT;
	RETURN SECUENCIA;
END;
/
