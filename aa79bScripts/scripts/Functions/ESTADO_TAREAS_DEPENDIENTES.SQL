CREATE OR REPLACE FUNCTION ESTADO_TAREAS_DEPENDIENTES ( ID_TAREA IN   NUMBER, ANYO IN   NUMBER,
   NUM_EXP IN NUMBER
) RETURN NUMBER IS

NO_DEPENDE NUMBER(1):=0; 
DEPENDE_PENDIENTES NUMBER(1):= 1;
DEPENDE_FINALIZADAS NUMBER(1):= 2;

RETORNO NUMBER(1):= NO_DEPENDE; 

ESTADO_EJECUCION_PENDIENTE NUMBER(1):= 1;

ORDEN NUMBER(2);
CONTADOR NUMBER(2):= 0;

BEGIN
	SELECT ORDEN_081 INTO ORDEN FROM AA79B81T00 WHERE ID_TAREA_081 = ID_TAREA;
	IF (ORDEN > 0) THEN -- 0 ES EL ORDEN POR DEFECTO PARA LA TAREA DE TRADOS O DE GESTION DE UNA INTERPRETACION
		SELECT COUNT(1) INTO CONTADOR FROM AA79B81T00 WHERE ORDEN_081 < ORDEN AND ANYO_081= ANYO AND 
    	NUM_EXP_081  = NUM_EXP AND ESTADO_EJECUCION_081 = ESTADO_EJECUCION_PENDIENTE;
    	IF (CONTADOR > 0) THEN
    		RETORNO:= DEPENDE_PENDIENTES;
    	ELSE
    		SELECT COUNT(1) INTO CONTADOR FROM AA79B81T00 WHERE ORDEN_081 < ORDEN AND ANYO_081= ANYO AND NUM_EXP_081  = NUM_EXP;
    		IF (CONTADOR > 0) THEN
    			RETORNO:= DEPENDE_FINALIZADAS;
    		END IF;
    	END IF;
	END IF;
	RETURN RETORNO;
END;
/
