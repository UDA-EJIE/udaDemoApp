create or replace FUNCTION TIENE_TAREAS_ENTREGA( ANYO IN   NUMBER,
   NUM_EXP IN NUMBER) RETURN VARCHAR IS

RETORNO VARCHAR2(1):='S';

CONTADORPLANIF NUMBER(2):= 0;
CONTADORENTREGA NUMBER(2):= 0;

TIPO_TAREA_ENTREGA_TRADUCCION NUMBER(2):= 19;
TIPO_TAREA_TRADUCCION_ENTREGA NUMBER(2):= 22;
TIPO_TAREA_ENTREGA_REVISION NUMBER(2):= 20;
TIPO_TAREA_CORREDACCION NUMBER(2):= 3;


BEGIN
	
	-- COMPROBAMOS QUE EL EXPEDIENTE ESTE PLANIFICADO, ESTO ES TIENE ALGUNA TAREA CREADA CON RECURSO ASIGNADO. Y SI TIENE TAREAS DE ENTREGA
	SELECT SUM(
        CASE WHEN (DNI_RECURSO_081 is not null OR ID_LOTE_081 is not null) THEN 1
        ELSE  0 END), SUM(
        DECODE(ID_TIPO_TAREA_081,TIPO_TAREA_CORREDACCION,1,TIPO_TAREA_ENTREGA_TRADUCCION,1,TIPO_TAREA_ENTREGA_REVISION,1,TIPO_TAREA_TRADUCCION_ENTREGA,1,0)
        ) into contadorplanif, contadorentrega
    FROM AA79B81T00 WHERE ANYO_081= ANYO AND NUM_EXP_081  = NUM_EXP;
	IF (CONTADORPLANIF > 0 AND CONTADORENTREGA = 0) THEN
		RETORNO:= 'N';
	END IF; 
	RETURN RETORNO;
END;
/
