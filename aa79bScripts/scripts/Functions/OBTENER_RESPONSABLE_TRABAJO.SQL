CREATE OR REPLACE FUNCTION OBTENER_RESPONSABLE_TRABAJO (ANYO IN NUMBER,
   CORR_EXP IN NUMBER) RETURN VARCHAR IS

RETORNO VARCHAR2(250);
ESTADO_ASIGNACION_PDTE NUMBER(1):= 1;
ESTADO_EJECUCION_PDTE NUMBER(1):= 1;

BEGIN
 
  
  IF (RETORNO IS NULL) THEN
    SELECT 
    CASE WHEN DNI_RECURSO_081 IS NULL THEN NOMBRE_LOTE_029
    ELSE 
    (NOMBRE_077 || ' ' || APEL1_077 || ' ' ||  APEL2_077) END INTO RETORNO FROM AA79B81T00
    LEFT JOIN AA79B77T00 ON DNI_RECURSO_081 = DNI_077 
    LEFT JOIN AA79B29S01 on ID_LOTE_081 = ID_LOTE_029 
    WHERE ANYO_081 = ANYO AND NUM_EXP_081 = CORR_EXP
    AND ESTADO_ASIGNACION_081 <> ESTADO_ASIGNACION_PDTE
    AND ESTADO_EJECUCION_081 = ESTADO_EJECUCION_PDTE
    ORDER BY ORDEN_081 ASC, FECHA_INICIO_081 DESC fetch first 1 row only;
  END IF;
		
	RETURN RETORNO;
END;
/
