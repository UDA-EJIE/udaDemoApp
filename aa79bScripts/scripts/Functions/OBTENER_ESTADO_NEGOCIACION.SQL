create or replace
FUNCTION OBTENER_ESTADO_NEGOCIACION( ANYO IN NUMBER,
  NUM_EXP IN NUMBER) RETURN NUMBER IS
  
  RETORNO NUMBER(2):= NULL;
  TIPO_REQ_NUEVA_FECHA NUMBER(1):= 3;

BEGIN
    -- obtenemos los datos del expediente
    SELECT 
  	t2.ESTADO_SUBSANACION_064 into RETORNO
	FROM AA79B59S01 t1
	JOIN AA79B64S01 t2
	ON t2.ID_064                  = t1.ID_REQUERIMIENTO_059
	WHERE t1.ANYO_059             = ANYO
	AND t1.NUM_EXP_059            = NUM_EXP
	AND t2.TIPO_REQUERIMIENTO_064 = TIPO_REQ_NUEVA_FECHA
	ORDER BY ID_064 desc
	FETCH first 1 ROWS ONLY;
    
    RETURN RETORNO;
	
    EXCEPTION
        WHEN NO_DATA_FOUND THEN
   
        RETURN RETORNO;
   
END;
/