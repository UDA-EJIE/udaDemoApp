create or replace PROCEDURE CREAR_TAREAS_DEFECTO (
   ANYO IN   NUMBER,
   NUM_EXP IN NUMBER
)
IS

TIPO_EXPEDIENTE VARCHAR2(1);
IND_CORREDACCION VARCHAR2(1);
NUM_TOTAL_PAL_IZO NUMBER(6):= 0;
ID_DATOS_BASICOS NUMBER(1):= 0;
PAL_PRESUPUESTO_TRADOS NUMBER(6):= 0;
NUM_DOC NUMBER(2):= 0;
TIPO_ENTIDAD VARCHAR2(1);
ID_ENTIDAD NUMBER(8);
ID_ENTIDAD_BOE NUMBER(8);

TIPO_INTERPRETACION VARCHAR2(1):= 'I';
TIPO_TRADUCCION VARCHAR2(1):= 'T';
TIPO_REVISION VARCHAR2(1):= 'R';

GESTION_INTERPRETACION NUMBER(2):= 6;
PREPARAR_INTERPRETACION NUMBER(2):= 7;
INTERPRETAR NUMBER(2):= 8;
IS_GESTION_INTERPRETACION BOOLEAN := FALSE;
IS_PREPARAR_INTERPRETACION BOOLEAN := FALSE;
IS_INTERPRETAR BOOLEAN := FALSE;

REVISAR NUMBER(2):= 4;
ENTREGA_CLIENTE_REVISION NUMBER(2):= 20;
IS_REVISAR BOOLEAN := FALSE;
IS_ENTREGA_CLIENTE_REVISION BOOLEAN := FALSE;

PROYECTO_TRADOS NUMBER(2):= 1;
TRADUCIR NUMBER(2):= 2;
CORREDACTAR NUMBER(2):= 3;
ENTREGA_CLIENTE_TRADUCCION NUMBER(2):= 22;
REVISION_ENTREGA_TRADUCCION NUMBER(2):= 19;

--ACTUALIZAR_MEMORIAS_TRADUCCION NUMBER(2):= 16;
POST_TRADUCCION_BOE NUMBER(2):= 10;
IS_PROYECTO_TRADOS BOOLEAN := FALSE;
IS_TRADUCIR BOOLEAN := FALSE;
IS_CORREDACTAR BOOLEAN := FALSE;
IS_ENTREGA_CLIENTE_TRADUCCION BOOLEAN := FALSE;
--IS_ACT_MEMORIAS_TRAD BOOLEAN := FALSE;
IS_POST_TRAD_BOE BOOLEAN := FALSE;

ESTADO_ASIGNACION_TAREA NUMBER(1):= 1;
TAREA_PENDIENTE_EJECUCION NUMBER(1):= 1;
ID_TAREA NUMBER(20):= 0;

EXPEDIENTE_EN_CURSO NUMBER(1):= 3;
FASE_EXP_PDTE_PROY_TRADOS NUMBER(1):= 6;
ESTADO_BITACORA NUMBER(3);
FECHA_INICIO DATE;
FECHA_FIN DATE;

ORDEN NUMBER(2);

IND_PRESUPUESTO_INTER VARCHAR2(1);

CURSOR C_TIPOS_TAREA IS
	(SELECT ID_TIPO_TAREA_081
	FROM AA79B81S01 WHERE ANYO_081 = ANYO
	AND NUM_EXP_081 = NUM_EXP);

BEGIN

  SELECT ID_TIPO_EXPEDIENTE_051, TIPO_ENTIDAD_054, ID_ENTIDAD_054 INTO TIPO_EXPEDIENTE,  TIPO_ENTIDAD, ID_ENTIDAD FROM AA79B51S01, AA79B54S01 WHERE ANYO_051 = ANYO AND NUM_EXP_051 = NUM_EXP
  AND ANYO_051 = ANYO_054 AND NUM_EXP_051 = NUM_EXP_054;

    IF(TIPO_EXPEDIENTE = TIPO_INTERPRETACION) THEN 
        SELECT IND_PRESUPUESTO_052 INTO IND_PRESUPUESTO_INTER FROM AA79B52S01 WHERE ANYO_052 = ANYO AND NUM_EXP_052 = NUM_EXP;
    END IF;
  FOR R_TIPOS_TAREA IN C_TIPOS_TAREA LOOP
    CASE
         WHEN (TIPO_EXPEDIENTE = TIPO_INTERPRETACION) THEN

            IF (R_TIPOS_TAREA.ID_TIPO_TAREA_081 = GESTION_INTERPRETACION) THEN
              IS_GESTION_INTERPRETACION := TRUE;
            END IF;
            IF (R_TIPOS_TAREA.ID_TIPO_TAREA_081 = PREPARAR_INTERPRETACION) THEN
              IS_PREPARAR_INTERPRETACION := TRUE;
            END IF;
            IF (R_TIPOS_TAREA.ID_TIPO_TAREA_081 = INTERPRETAR) THEN
              IS_INTERPRETAR := TRUE;
            END IF;

         WHEN (TIPO_EXPEDIENTE = TIPO_REVISION) THEN

            IF (R_TIPOS_TAREA.ID_TIPO_TAREA_081 = ENTREGA_CLIENTE_REVISION) THEN
              IS_ENTREGA_CLIENTE_REVISION := TRUE;
            END IF;

         WHEN (TIPO_EXPEDIENTE = TIPO_TRADUCCION) THEN

            IF (R_TIPOS_TAREA.ID_TIPO_TAREA_081 = PROYECTO_TRADOS) THEN
              IS_PROYECTO_TRADOS := TRUE;
            END IF;
            IF (R_TIPOS_TAREA.ID_TIPO_TAREA_081 = TRADUCIR) THEN
              IS_TRADUCIR := TRUE;
            END IF;
            IF (R_TIPOS_TAREA.ID_TIPO_TAREA_081 = ENTREGA_CLIENTE_TRADUCCION) THEN
              IS_ENTREGA_CLIENTE_TRADUCCION := TRUE;
            END IF;
            IF (R_TIPOS_TAREA.ID_TIPO_TAREA_081 = REVISION_ENTREGA_TRADUCCION) THEN
              IS_ENTREGA_CLIENTE_TRADUCCION := TRUE;
            END IF;
            /*IF (R_TIPOS_TAREA.ID_TIPO_TAREA_081 = ACTUALIZAR_MEMORIAS_TRADUCCION) THEN
              IS_ACT_MEMORIAS_TRAD := TRUE;
            END IF;*/
            IF (R_TIPOS_TAREA.ID_TIPO_TAREA_081 = CORREDACTAR) THEN
              IS_CORREDACTAR := TRUE;
            END IF;
            IF (R_TIPOS_TAREA.ID_TIPO_TAREA_081 = POST_TRADUCCION_BOE) THEN
              IS_POST_TRAD_BOE := TRUE;
            END IF;

    END CASE;
  END LOOP;

  CASE
       WHEN (TIPO_EXPEDIENTE = TIPO_INTERPRETACION) THEN

          IF (IS_GESTION_INTERPRETACION = FALSE AND IND_PRESUPUESTO_INTER = 'S' ) THEN
            SELECT AA79B81Q00.NEXTVAL INTO ID_TAREA FROM dual;
            INSERT INTO AA79B81S01 (ANYO_081, DNI_RECURSO_081, ESTADO_ASIGNACION_081, ESTADO_EJECUCION_081, FECHA_ACEPTACION_081, FECHA_ASIGNACION_081, FECHA_FIN_081, FECHA_INICIO_081, HORAS_PREVISTAS_081, ID_TAREA_081, ID_TAREA_REL_081, ID_REQUERIMIENTO_081, IND_NO_CONFORMIDAD_081, IND_FACTURABLE_081, ID_LOTE_081, NUM_EXP_081, OBSERV_081, ORDEN_081, RECURSO_ASIGNACION_081, ID_TIPO_TAREA_081, TIPO_ENTIDAD_081, ID_ENTIDAD_081, DNI_ASIGNADOR_081, ID_TIPO_REVISION_081) VALUES (ANYO,null,ESTADO_ASIGNACION_TAREA,TAREA_PENDIENTE_EJECUCION,null,null,null,null,'',ID_TAREA,null,null,'N','N',null,NUM_EXP,null,0,null,GESTION_INTERPRETACION,null,null,null,null);
            INSERT INTO AA79B82T00 (ID_TAREA_082) values (ID_TAREA);

            insert into AA79B83T00 (ID_TAREA_083, ID_DOC_083)
			select ID_TAREA, ID_DOC_056 from AA79B56T00 where ANYO_056 = ANYO  AND
    		NUM_EXP_056 = NUM_EXP AND ID_DOC_REL_056 is null AND ID_DOC_VERSION_056 is null;

          END IF;

          IF (IS_PREPARAR_INTERPRETACION = FALSE) THEN
            SELECT AA79B81Q00.NEXTVAL INTO ID_TAREA FROM dual;

            UPDATE AA79B81S01 set ORDEN_081 = ORDEN_081 + 1 WHERE ORDEN_081 = 1 AND ANYO_081 = ANYO AND NUM_EXP_081 = NUM_EXP;

            INSERT INTO AA79B81S01 (ANYO_081, DNI_RECURSO_081, ESTADO_ASIGNACION_081, ESTADO_EJECUCION_081, FECHA_ACEPTACION_081, FECHA_ASIGNACION_081, FECHA_FIN_081, FECHA_INICIO_081, HORAS_PREVISTAS_081, ID_TAREA_081, ID_TAREA_REL_081, ID_REQUERIMIENTO_081, IND_NO_CONFORMIDAD_081, IND_FACTURABLE_081, ID_LOTE_081, NUM_EXP_081, OBSERV_081, ORDEN_081, RECURSO_ASIGNACION_081, ID_TIPO_TAREA_081, TIPO_ENTIDAD_081, ID_ENTIDAD_081, DNI_ASIGNADOR_081, ID_TIPO_REVISION_081)
            VALUES (ANYO,null,ESTADO_ASIGNACION_TAREA,TAREA_PENDIENTE_EJECUCION,null,null,null,null,'',ID_TAREA,null,null,'N','N',null,NUM_EXP,null,1,null,PREPARAR_INTERPRETACION,null,null,null,null);
            INSERT INTO AA79B82T00 (ID_TAREA_082) values (ID_TAREA);

            insert into AA79B83T00 (ID_TAREA_083, ID_DOC_083)
			select ID_TAREA, ID_DOC_056 from AA79B56T00 where ANYO_056 = ANYO  AND
    		NUM_EXP_056 = NUM_EXP AND ID_DOC_REL_056 is null AND ID_DOC_VERSION_056 is null;

          END IF;

          IF (IS_INTERPRETAR = FALSE) THEN
            SELECT AA79B81Q00.NEXTVAL INTO ID_TAREA FROM dual;

            -- CALCULAMOS EL ORDEN
            SELECT nvl(MAX(ORDEN_081),0) + 1 into orden FROM AA79B81T00, AA79B15T00  WHERE ANYO_081 = ANYO AND NUM_EXP_081 = NUM_EXP AND ID_TIPO_TAREA_081 = ID_015 AND IND_REQ_CIERRE_015 = 'S';

             UPDATE AA79B81S01 set ORDEN_081 = ORDEN_081 + 1 WHERE ORDEN_081 = orden AND ANYO_081 = ANYO AND NUM_EXP_081 = NUM_EXP;

            SELECT FECHA_INI_052, FECHA_FIN_052 INTO FECHA_INICIO, FECHA_FIN FROM AA79B52S01 WHERE ANYO_052 = ANYO AND NUM_EXP_052 = NUM_EXP;
            INSERT INTO AA79B81S01 (ANYO_081, DNI_RECURSO_081, ESTADO_ASIGNACION_081, ESTADO_EJECUCION_081, FECHA_ACEPTACION_081, FECHA_ASIGNACION_081, FECHA_FIN_081, FECHA_INICIO_081, HORAS_PREVISTAS_081, ID_TAREA_081, ID_TAREA_REL_081, ID_REQUERIMIENTO_081, IND_NO_CONFORMIDAD_081, IND_FACTURABLE_081, ID_LOTE_081, NUM_EXP_081, OBSERV_081, ORDEN_081, RECURSO_ASIGNACION_081, ID_TIPO_TAREA_081, TIPO_ENTIDAD_081, ID_ENTIDAD_081, DNI_ASIGNADOR_081, ID_TIPO_REVISION_081)
            VALUES (ANYO,null,ESTADO_ASIGNACION_TAREA,TAREA_PENDIENTE_EJECUCION,null,null,FECHA_FIN,FECHA_INICIO,'',ID_TAREA,null,null,'N','S',null,NUM_EXP,null,ORDEN,null,INTERPRETAR,null,null,null,null);
            INSERT INTO AA79B82T00 (ID_TAREA_082) values (ID_TAREA);

            insert into AA79B83T00 (ID_TAREA_083, ID_DOC_083)
			select ID_TAREA, ID_DOC_056 from AA79B56T00 where ANYO_056 = ANYO  AND
    		NUM_EXP_056 = NUM_EXP AND ID_DOC_REL_056 is null AND ID_DOC_VERSION_056 is null;

          END IF;

       WHEN (TIPO_EXPEDIENTE = TIPO_REVISION) THEN

          /*IF (IS_REVISAR = FALSE) THEN
            SELECT AA79B81Q00.NEXTVAL INTO ID_TAREA FROM dual;
            INSERT INTO AA79B81S01 (ANYO_081, DNI_RECURSO_081, ESTADO_ASIGNACION_081, ESTADO_EJECUCION_081, FECHA_ACEPTACION_081, FECHA_ASIGNACION_081, FECHA_FIN_081, FECHA_INICIO_081, HORAS_PREVISTAS_081, ID_TAREA_081, ID_TAREA_REL_081, ID_REQUERIMIENTO_081, IND_NO_CONFORMIDAD_081, IND_FACTURABLE_081, ID_LOTE_081, NUM_EXP_081, OBSERV_081, ORDEN_081, RECURSO_ASIGNACION_081, ID_TIPO_TAREA_081, TIPO_ENTIDAD_081, ID_ENTIDAD_081, DNI_ASIGNADOR_081, ID_TIPO_REVISION_081) VALUES (ANYO,null,ESTADO_ASIGNACION_TAREA,TAREA_PENDIENTE_EJECUCION,null,null,null,null,'',ID_TAREA,null,null,'N','N',null,NUM_EXP,null,1,null,REVISAR,null,null,null,1);
            INSERT INTO AA79B82T00 (ID_TAREA_082) values (ID_TAREA);

            insert into AA79B83T00 (ID_TAREA_083, ID_DOC_083)
			select ID_TAREA, ID_DOC_056 from AA79B56T00 where ANYO_056 = ANYO  AND
    		NUM_EXP_056 = NUM_EXP AND ID_DOC_REL_056 is null AND ID_DOC_VERSION_056 is null;
          END IF;*/

          IF (IS_ENTREGA_CLIENTE_REVISION = FALSE) THEN
            SELECT AA79B81Q00.NEXTVAL INTO ID_TAREA FROM dual;
            -- CALCULAMOS EL ORDEN
            SELECT nvl(MAX(ORDEN_081),0) + 1 into orden FROM AA79B81T00, AA79B15T00  WHERE ANYO_081 = ANYO AND NUM_EXP_081 = NUM_EXP AND ID_TIPO_TAREA_081 = ID_015 AND IND_REQ_CIERRE_015 = 'S';

            UPDATE AA79B81S01 set ORDEN_081 = ORDEN_081 + 1 WHERE ORDEN_081 = ORDEN AND ANYO_081 = ANYO AND NUM_EXP_081 = NUM_EXP;

            INSERT INTO AA79B81S01 (ANYO_081, DNI_RECURSO_081, ESTADO_ASIGNACION_081, ESTADO_EJECUCION_081, FECHA_ACEPTACION_081, FECHA_ASIGNACION_081, FECHA_FIN_081, FECHA_INICIO_081, HORAS_PREVISTAS_081, ID_TAREA_081, ID_TAREA_REL_081, ID_REQUERIMIENTO_081, IND_NO_CONFORMIDAD_081, IND_FACTURABLE_081, ID_LOTE_081, NUM_EXP_081, OBSERV_081, ORDEN_081, RECURSO_ASIGNACION_081, ID_TIPO_TAREA_081, TIPO_ENTIDAD_081, ID_ENTIDAD_081, DNI_ASIGNADOR_081, ID_TIPO_REVISION_081) VALUES (ANYO,null,ESTADO_ASIGNACION_TAREA,TAREA_PENDIENTE_EJECUCION,null,null,null,null,'',ID_TAREA,null,null,'N','N',null,NUM_EXP,null,ORDEN,null,ENTREGA_CLIENTE_REVISION,null,null,null,1);
            INSERT INTO AA79B82T00 (ID_TAREA_082) values (ID_TAREA);

            insert into AA79B83T00 (ID_TAREA_083, ID_DOC_083)
			select ID_TAREA, ID_DOC_056 from AA79B56T00 where ANYO_056 = ANYO  AND
    		NUM_EXP_056 = NUM_EXP AND ID_DOC_REL_056 is null AND ID_DOC_VERSION_056 is null
    		AND CLASE_DOCUMENTO_056 <> 4 ;

          END IF;

       WHEN (TIPO_EXPEDIENTE = TIPO_TRADUCCION) THEN
          -- RECUPERAMOS SI ES CORREDACCION
       	  Select IND_CORREDACCION_053 into IND_CORREDACCION from AA79B53T00 where ANYO_053 = ANYO AND NUM_EXP_053 = NUM_EXP;

       	  SELECT COUNT(1) INTO NUM_DOC FROM AA79B56S01 t1 RIGHT JOIN AA79B42S01 t2 ON t1.TIPO_DOCUMENTO_056 = t2.ID_042
          WHERE t2.IND_ACTUALIZA_MEMORIAS_042 = 'S' AND t1.ANYO_056 = ANYO AND t1.NUM_EXP_056 = NUM_EXP;

          SELECT NUM_TOTAL_PAL_IZO_053 INTO NUM_TOTAL_PAL_IZO FROM AA79B53S01 WHERE ANYO_053 = ANYO AND NUM_EXP_053 = NUM_EXP;
          SELECT PAL_TRADOS_003 INTO PAL_PRESUPUESTO_TRADOS FROM AA79B03S01 WHERE ID_003 = ID_DATOS_BASICOS;

          IF (NUM_TOTAL_PAL_IZO > PAL_PRESUPUESTO_TRADOS AND IS_PROYECTO_TRADOS = FALSE) THEN

            SELECT AA79B81Q00.NEXTVAL INTO ID_TAREA FROM dual;
            INSERT INTO AA79B81S01 (ANYO_081, DNI_RECURSO_081, ESTADO_ASIGNACION_081, ESTADO_EJECUCION_081, FECHA_ACEPTACION_081, FECHA_ASIGNACION_081, FECHA_FIN_081, FECHA_INICIO_081, HORAS_PREVISTAS_081, ID_TAREA_081, ID_TAREA_REL_081, ID_REQUERIMIENTO_081, IND_NO_CONFORMIDAD_081, IND_FACTURABLE_081, ID_LOTE_081, NUM_EXP_081, OBSERV_081, ORDEN_081, RECURSO_ASIGNACION_081, ID_TIPO_TAREA_081, TIPO_ENTIDAD_081, ID_ENTIDAD_081, DNI_ASIGNADOR_081, ID_TIPO_REVISION_081) VALUES (ANYO,null,ESTADO_ASIGNACION_TAREA,TAREA_PENDIENTE_EJECUCION,null,null,null,null,'',ID_TAREA,null,null,'N','N',null,NUM_EXP,null,0,null,PROYECTO_TRADOS,null,null,null,null);
            INSERT INTO AA79B82T00 (ID_TAREA_082) values (ID_TAREA);

            insert into AA79B83T00 (ID_TAREA_083, ID_DOC_083)
			select ID_TAREA, ID_DOC_056 from AA79B56T00 where ANYO_056 = ANYO  AND
    		NUM_EXP_056 = NUM_EXP AND ID_DOC_REL_056 is null AND ID_DOC_VERSION_056 is null;

            SELECT nvl(max(ID_ESTADO_BITACORA_059),0) + 1 INTO ESTADO_BITACORA FROM AA79B59S01 t1 WHERE NUM_EXP_059 = NUM_EXP AND ANYO_059 = ANYO;
            INSERT INTO AA79B59S01 (ANYO_059, NUM_EXP_059, ID_ESTADO_BITACORA_059, ID_ESTADO_EXP_059, ID_FASE_EXPEDIENTE_059, DATO_ADIC_059, INFO_ADIC_059, ID_RECHAZO_059, ID_REQUERIMIENTO_059, FECHA_ALTA_059) VALUES (ANYO,NUM_EXP,ESTADO_BITACORA,EXPEDIENTE_EN_CURSO,FASE_EXP_PDTE_PROY_TRADOS,null,null,null,null, SYSDATE);
            UPDATE AA79B51S01 SET ESTADO_BITACORA_051= ESTADO_BITACORA WHERE ANYO_051 = ANYO AND NUM_EXP_051 = NUM_EXP;
          END IF;

          IF (IND_CORREDACCION = 'N') THEN

	          IF (IS_TRADUCIR = FALSE) THEN

	          	UPDATE AA79B81S01 set ORDEN_081 = ORDEN_081 + 1 WHERE ORDEN_081 = 1 AND ANYO_081 = ANYO AND NUM_EXP_081 = NUM_EXP;

	            SELECT AA79B81Q00.NEXTVAL INTO ID_TAREA FROM dual;
	            INSERT INTO AA79B81S01 (ANYO_081, DNI_RECURSO_081, ESTADO_ASIGNACION_081, ESTADO_EJECUCION_081, FECHA_ACEPTACION_081, FECHA_ASIGNACION_081, FECHA_FIN_081, FECHA_INICIO_081, HORAS_PREVISTAS_081, ID_TAREA_081, ID_TAREA_REL_081, ID_REQUERIMIENTO_081, IND_NO_CONFORMIDAD_081, IND_FACTURABLE_081, ID_LOTE_081, NUM_EXP_081, OBSERV_081, ORDEN_081, RECURSO_ASIGNACION_081, ID_TIPO_TAREA_081, TIPO_ENTIDAD_081, ID_ENTIDAD_081, DNI_ASIGNADOR_081, ID_TIPO_REVISION_081)
	            VALUES (ANYO,null,ESTADO_ASIGNACION_TAREA,TAREA_PENDIENTE_EJECUCION,null,null,null,null,'',ID_TAREA,null,null,'N','S',null,NUM_EXP,null,1,null,TRADUCIR,null,null,null,null);
	            INSERT INTO AA79B82T00 (ID_TAREA_082) values (ID_TAREA);

	            insert into AA79B83T00 (ID_TAREA_083, ID_DOC_083)
				select ID_TAREA, ID_DOC_056 from AA79B56T00 where ANYO_056 = ANYO  AND
	    		NUM_EXP_056 = NUM_EXP AND ID_DOC_REL_056 is null AND ID_DOC_VERSION_056 is null;
	          END IF;
	          IF (IS_POST_TRAD_BOE = FALSE) THEN
	            SELECT VALOR_000 INTO ID_ENTIDAD_BOE FROM AA79B00T00 WHERE ID_000 = 1;
	            IF (ID_ENTIDAD_BOE = ID_ENTIDAD AND TIPO_ENTIDAD = 'B') THEN

	            	UPDATE AA79B81S01 set ORDEN_081 = ORDEN_081 + 1 WHERE ORDEN_081 = 2 AND ANYO_081 = ANYO AND NUM_EXP_081 = NUM_EXP;

		          	SELECT AA79B81Q00.NEXTVAL INTO ID_TAREA FROM dual;
		            INSERT INTO AA79B81S01 (ANYO_081, DNI_RECURSO_081, ESTADO_ASIGNACION_081, ESTADO_EJECUCION_081, FECHA_ACEPTACION_081, FECHA_ASIGNACION_081, FECHA_FIN_081, FECHA_INICIO_081, HORAS_PREVISTAS_081, ID_TAREA_081, ID_TAREA_REL_081, ID_REQUERIMIENTO_081, IND_NO_CONFORMIDAD_081, IND_FACTURABLE_081, ID_LOTE_081, NUM_EXP_081, OBSERV_081, ORDEN_081, RECURSO_ASIGNACION_081, ID_TIPO_TAREA_081, TIPO_ENTIDAD_081, ID_ENTIDAD_081, DNI_ASIGNADOR_081, ID_TIPO_REVISION_081)
		            VALUES (ANYO,null,ESTADO_ASIGNACION_TAREA,TAREA_PENDIENTE_EJECUCION,null,null,null,null,'',ID_TAREA,null,null,'N','S',null,NUM_EXP,null,2,null,POST_TRADUCCION_BOE,null,null,null,null);
		            INSERT INTO AA79B82T00 (ID_TAREA_082) values (ID_TAREA);

		            insert into AA79B83T00 (ID_TAREA_083, ID_DOC_083)
					select ID_TAREA, ID_DOC_056 from AA79B56T00 where ANYO_056 = ANYO  AND
		    		NUM_EXP_056 = NUM_EXP AND ID_DOC_REL_056 is null AND ID_DOC_VERSION_056 is null;
		    	END IF;
	          END IF;
	          IF (IS_ENTREGA_CLIENTE_TRADUCCION = FALSE) THEN
	            SELECT AA79B81Q00.NEXTVAL INTO ID_TAREA FROM dual;

	            -- CALCULAMOS EL ORDEN
            	SELECT nvl(MAX(ORDEN_081),0) + 1 into orden FROM AA79B81T00, AA79B15T00  WHERE ANYO_081 = ANYO AND NUM_EXP_081 = NUM_EXP AND ID_TIPO_TAREA_081 = ID_015 AND IND_REQ_CIERRE_015 = 'S';

            	UPDATE AA79B81S01 set ORDEN_081 = ORDEN_081 + 1 WHERE ORDEN_081 = ORDEN AND ANYO_081 = ANYO AND NUM_EXP_081 = NUM_EXP;

	            INSERT INTO AA79B81S01 (ANYO_081, DNI_RECURSO_081, ESTADO_ASIGNACION_081, ESTADO_EJECUCION_081, FECHA_ACEPTACION_081, FECHA_ASIGNACION_081, FECHA_FIN_081, FECHA_INICIO_081, HORAS_PREVISTAS_081, ID_TAREA_081, ID_TAREA_REL_081, ID_REQUERIMIENTO_081, IND_NO_CONFORMIDAD_081, IND_FACTURABLE_081, ID_LOTE_081, NUM_EXP_081, OBSERV_081, ORDEN_081, RECURSO_ASIGNACION_081, ID_TIPO_TAREA_081, TIPO_ENTIDAD_081, ID_ENTIDAD_081, DNI_ASIGNADOR_081, ID_TIPO_REVISION_081) VALUES (ANYO,null,ESTADO_ASIGNACION_TAREA,TAREA_PENDIENTE_EJECUCION,null,null,null,null,'',ID_TAREA,null,null,'N','N',null,NUM_EXP,null,ORDEN,null,ENTREGA_CLIENTE_TRADUCCION,null,null,null,null);
	            INSERT INTO AA79B82T00 (ID_TAREA_082) values (ID_TAREA);

	            insert into AA79B83T00 (ID_TAREA_083, ID_DOC_083)
				select ID_TAREA, ID_DOC_056 from AA79B56T00 where ANYO_056 = ANYO  AND
	    		NUM_EXP_056 = NUM_EXP AND ID_DOC_REL_056 is null AND ID_DOC_VERSION_056 is null
	    		AND CLASE_DOCUMENTO_056 <> 4 ;

	          END IF;


	     END IF;

	     IF (IND_CORREDACCION = 'S') THEN
	          IF (IS_CORREDACTAR = FALSE) THEN

	          	UPDATE AA79B81S01 set ORDEN_081 = ORDEN_081 + 1 WHERE ORDEN_081 = 1 AND ANYO_081 = ANYO AND NUM_EXP_081 = NUM_EXP;

	            SELECT AA79B81Q00.NEXTVAL INTO ID_TAREA FROM dual;
	            INSERT INTO AA79B81S01 (ANYO_081, DNI_RECURSO_081, ESTADO_ASIGNACION_081, ESTADO_EJECUCION_081, FECHA_ACEPTACION_081, FECHA_ASIGNACION_081, FECHA_FIN_081, FECHA_INICIO_081, HORAS_PREVISTAS_081, ID_TAREA_081, ID_TAREA_REL_081, ID_REQUERIMIENTO_081, IND_NO_CONFORMIDAD_081, IND_FACTURABLE_081, ID_LOTE_081, NUM_EXP_081, OBSERV_081, ORDEN_081, RECURSO_ASIGNACION_081, ID_TIPO_TAREA_081, TIPO_ENTIDAD_081, ID_ENTIDAD_081, DNI_ASIGNADOR_081, ID_TIPO_REVISION_081) VALUES (ANYO,null,ESTADO_ASIGNACION_TAREA,TAREA_PENDIENTE_EJECUCION,null,null,null,null,'',ID_TAREA,null,null,'N','N',null,NUM_EXP,null,1,null,CORREDACTAR,null,null,null,null);
	            INSERT INTO AA79B82T00 (ID_TAREA_082) values (ID_TAREA);

	            insert into AA79B83T00 (ID_TAREA_083, ID_DOC_083)
				select ID_TAREA, ID_DOC_056 from AA79B56T00 where ANYO_056 = ANYO  AND
	    		NUM_EXP_056 = NUM_EXP AND ID_DOC_REL_056 is null AND ID_DOC_VERSION_056 is null;
	          END IF;

	     END IF;
  END CASE;

END;
/