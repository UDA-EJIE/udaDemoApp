create or replace PROCEDURE CAMBIO_TIPO_EXPEDIENTE (
   ANYO IN   NUMBER,
   NUM_EXP IN NUMBER,
   TIPO_EXP IN VARCHAR2
)
IS

CLASE_TRADUCCION NUMBER(2):= 1;
CLASE_REVISION NUMBER(2):= 2;
TIPO_TRADUCCION VARCHAR2(1):= 'T';
TIPO_REVISION VARCHAR2(1):= 'R';

ID_DOC NUMBER(20):= 0;

CURSOR DOCUMENTOS_EXPEDIENTE IS
	(SELECT ID_DOC_056, ANYO_056, NUM_EXP_056, OID_FICHERO_056, 
	RUTA_PIF_FICHERO_056, EXTENSION_DOC_056, TAMANO_DOC_056, 
	IND_ENCRIPTADO_056, CONTENT_TYPE_056, CLASE_DOCUMENTO_056, 
	TIPO_DOCUMENTO_056, TITULO_056, NUM_PAL_SOLIC_056, NUM_PAL_IZO_056, 
	PERSONA_CONTACTO_056, EMAIL_CONTACTO_056, TELEFONO_CONTACTO_056, 
	DIRECCION_CONTACTO_056, ENTIDAD_CONTACTO_056, IND_VISIBLE_056, FECHA_ALTA_056, 
	DNI_ALTA_056, ID_DOC_VERSION_056, NOMBRE_FICHERO_056, IND_ORIGEN_056 
	FROM AA79B56S01 WHERE ANYO_056 = ANYO AND NUM_EXP_056 = NUM_EXP AND CLASE_DOCUMENTO_056 IN (CLASE_TRADUCCION, CLASE_REVISION));

BEGIN

	FOR DOCUMENTO IN DOCUMENTOS_EXPEDIENTE LOOP
	    CASE
	         WHEN (TIPO_EXP = TIPO_TRADUCCION) THEN
	         
	         	UPDATE AA79B56S01 SET CLASE_DOCUMENTO_056 = CLASE_TRADUCCION, ID_DOC_REL_056 = NULL WHERE ID_DOC_056 = DOCUMENTO.ID_DOC_056;
	         	
	         WHEN (TIPO_EXP = TIPO_REVISION) THEN
	         
	         	UPDATE AA79B56S01 SET CLASE_DOCUMENTO_056 = CLASE_REVISION, ID_DOC_REL_056 = null WHERE ID_DOC_056 = DOCUMENTO.ID_DOC_056;
	         	
	         	IF (DOCUMENTO.EXTENSION_DOC_056 != 'zip') THEN
	         		
	         		SELECT AA79B56Q00.NEXTVAL INTO ID_DOC FROM dual; 
	         	
					INSERT INTO AA79B56S01 (ID_DOC_056, ANYO_056, NUM_EXP_056, OID_FICHERO_056, 
					RUTA_PIF_FICHERO_056, EXTENSION_DOC_056, TAMANO_DOC_056, IND_ENCRIPTADO_056, 
					CONTENT_TYPE_056, ID_DOC_REL_056, CLASE_DOCUMENTO_056, TIPO_DOCUMENTO_056, 
					TITULO_056, NUM_PAL_SOLIC_056, NUM_PAL_IZO_056, PERSONA_CONTACTO_056, 
					EMAIL_CONTACTO_056, TELEFONO_CONTACTO_056, DIRECCION_CONTACTO_056, ENTIDAD_CONTACTO_056, 
					IND_VISIBLE_056, FECHA_ALTA_056, DNI_ALTA_056, ID_DOC_VERSION_056, NOMBRE_FICHERO_056, IND_ORIGEN_056) 
					VALUES (ID_DOC, DOCUMENTO.ANYO_056, DOCUMENTO.NUM_EXP_056, DOCUMENTO.OID_FICHERO_056, 
					DOCUMENTO.RUTA_PIF_FICHERO_056, DOCUMENTO.EXTENSION_DOC_056, DOCUMENTO.TAMANO_DOC_056, DOCUMENTO.IND_ENCRIPTADO_056, 
					DOCUMENTO.CONTENT_TYPE_056, DOCUMENTO.ID_DOC_056, DOCUMENTO.CLASE_DOCUMENTO_056, DOCUMENTO.TIPO_DOCUMENTO_056, 
					DOCUMENTO.TITULO_056, DOCUMENTO.NUM_PAL_SOLIC_056, DOCUMENTO.NUM_PAL_IZO_056, DOCUMENTO.PERSONA_CONTACTO_056, 
					DOCUMENTO.EMAIL_CONTACTO_056, DOCUMENTO.TELEFONO_CONTACTO_056, DOCUMENTO.DIRECCION_CONTACTO_056, DOCUMENTO.ENTIDAD_CONTACTO_056, 
					DOCUMENTO.IND_VISIBLE_056, DOCUMENTO.FECHA_ALTA_056, DOCUMENTO.DNI_ALTA_056, DOCUMENTO.ID_DOC_VERSION_056, DOCUMENTO.NOMBRE_FICHERO_056, DOCUMENTO.IND_ORIGEN_056);
	            END IF;
	    END CASE;
  	END LOOP;

  	ACT_DATOS_DOCUMENTACION(ANYO,NUM_EXP);
  	
END;
/