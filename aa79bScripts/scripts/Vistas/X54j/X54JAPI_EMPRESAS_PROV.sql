CREATE OR REPLACE VIEW X54JAPI_EMPRESAS_PROV AS 
SELECT TIPO, CODIGO, DESC_ES, DESC_EU, DESC_AMP_ES, DESC_AMP_EU, CIF, ESTADO
, FACTURABLE_036 AS FACTURABLE
, IVA_036 AS IVA
, CDIRNORA
FROM (
SELECT 'E' AS TIPO
, CDEPARTAMENTOS_023 AS CODIGO
, DDEPARTCRED_023 AS DESC_ES
, DDEPARTERED_023 AS DESC_EU
, DDEPARTCAMP_023 AS DESC_AMP_ES
, DDEPARTEAMP_023 AS DESC_AMP_EU
, CIF_023 AS CIF
, ESTADO_023 AS ESTADO
, CDIRNORA_023 AS CDIRNORA
FROM X54J23T00
UNION ALL
SELECT 'B' AS TIPO
, CENTIDAD_001 AS CODIGO
, DENTICRED_001 AS DESC_ES
, DENTIERED_001 AS DESC_EU
, DENTICAMP_001 AS DESC_AMP_ES
, DENTIEAMP_001 AS DESC_AMP_EU
, CIF_001 AS CIF
, ESTADO_001 AS ESTADO
, CDIRNORA_001 AS CDIRNORA
FROM X54J01T00
UNION ALL
SELECT 'L' AS TIPO
, CEMPRESA_037 AS CODIGO
, NOMBRE_037 AS DESC_ES
, NOMBRE_037 AS DESC_EU
, NOMBRE_037 AS DESC_AMP_ES
, NOMBRE_037 AS DESC_AMP_EU
, CIF_037 AS CIF
, SITUACION_037 AS ESTADO
, CDIRNORA_037 AS CDIRNORA
FROM X54J37T00) 
JOIN (SELECT CAPLIC_044, ITIPENT_044, ENTDPTO_044
FROM X54J44T00
JOIN X54J42T00 ON DNI_042 = DNI_044 AND CAPLIC_042 = CAPLIC_044
JOIN X54J43T00 ON DNI_043 = DNI_042 AND CAPLIC_043 = CAPLIC_042 AND CROL_043 = CROL_042
WHERE CAPLIC_044 = 7
AND ESTADO_044='V'
AND CROL_042 = 3
AND CPER_043 = 1 --IN (1, 2)
GROUP BY CAPLIC_044, ITIPENT_044, ENTDPTO_044) ON TIPO = ITIPENT_044 AND CODIGO = ENTDPTO_044
LEFT JOIN X54J36T00 ON CAPLIC_036 = CAPLIC_044 AND ITIPENT_036 = ITIPENT_044 AND CODENT_036 = ENTDPTO_044;
/
