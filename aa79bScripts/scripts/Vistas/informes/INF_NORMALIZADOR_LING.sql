CREATE OR REPLACE VIEW INF_NORMALIZADOR_LING ( 
SOLICITANTE_ES, SOLICITANTE_EU, TIPO_ENTIDAD_ES, TIPO_ENTIDAD_EU,  NUM_IDENT_CONTACTO, CONTACTO_SOLICITANTE, ANYO, NUMERO, NUM_EXP, 
TIPO_EXPEDIENTE, TITULO, FECHA_SOLICITUD, FECHA_ENTREGA, PUBLICAR_BOPV, NUM_PALABRAS_IZO, DOCUMENTOS,
FACTURABLE_ES, FACTURABLE_EU, TARIFA_PALABRA, IMPORTE, REF_TRAMITAGUNE, ESTADO_ES, ESTADO_EU, PAGADO_ES, PAGADO_EU)
AS 
SELECT 
DESC_ES,
DESC_EU,
DECODE(TIPO_ENTIDAD_054, 'B', 'Entidad', 'E', 'Departamento', 'L', 'Empresa'),
DECODE(TIPO_ENTIDAD_054, 'B', 'Entitatea', 'E', 'Saila', 'L', 'Enpresa'),
(PREDNI_077 ||DNI_077 || SUFDNI_077),
TRIM(APEL1_077) || ' ' || TRIM(APEL2_077) || ', ' || TRIM(NOMBRE_077) ,
ANYO_051, NUM_EXP_051, SUBSTR(ANYO_051,3,4) || '/' || LPAD(NUM_EXP_051,6,'0') ,
ID_TIPO_EXPEDIENTE_051, TITULO_051, FECHA_ALTA_051 ,
nvl(FECHA_FINAL_SOLIC_053,FECHA_INI_052) ,
IND_PUBLICAR_BOPV_053 ,
NUM_TOTAL_PAL_IZO_053,
tDocs.DOCS,
DECODE(nvl(IND_FACTURABLE_053, 'S'),'S', 'Si', 'No') ,
DECODE(nvl(IND_FACTURABLE_053, 'S'),'S', 'Bai', 'Ez') ,
TARIFA_PAL_097 ,
IMPORTE_TOTAL_097 ,
REF_TRAMITAGUNE_053,
DESC_ES_060 AS ESTADO_ES,
DESC_EU_060 AS ESTADO_EU,
DECODE(COMPROBAR_PAGADO(ANYO_051,NUM_EXP_051),'S','Si','No') AS INDPAGADO_ES,
DECODE(COMPROBAR_PAGADO(ANYO_051,NUM_EXP_051),'S','Bai','Ez') AS INDPAGADO_EU
from  AA79B51T00
JOIN AA79B54T00 ON NUM_EXP_051 = NUM_EXP_054 AND ANYO_051 = ANYO_054
JOIN AA79B77T00 ON DNI_SOLICITANTE_054 = DNI_077
JOIN x54japi_entidades_solic ON CODIGO = ID_ENTIDAD_054
LEFT JOIN AA79B52T00 ON NUM_EXP_051 = NUM_EXP_052 AND ANYO_051 = ANYO_052
LEFT JOIN AA79B53T00 ON NUM_EXP_051 = NUM_EXP_053 AND ANYO_051 = ANYO_053
LEFT JOIN 
(SELECT NUM_EXP_056, ANYO_056, LISTAGG(DESC_EU_042 , ', ' ) WITHIN GROUP (ORDER BY DESC_EU_042) AS DOCS 
FROM AA79B56T00 JOIN AA79B42T00 ON TIPO_DOCUMENTO_056 = ID_042 GROUP BY NUM_EXP_056, ANYO_056) tDocs ON NUM_EXP_051 = tDocs.NUM_EXP_056 AND ANYO_051 = tDocs.ANYO_056
LEFT JOIN AA79B97T00 ON ANYO_051 = ANYO_097 AND NUM_EXP_051 = NUM_EXP_097
JOIN AA79B59T00 ON ANYO_051 = ANYO_059 AND NUM_EXP_051 = NUM_EXP_059 AND ESTADO_BITACORA_051 = ID_ESTADO_BITACORA_059
JOIN AA79B60T00 ON ID_ESTADO_EXP_059 = ID_060;
/