DEFINE DIR_SCRIPTS = '/aplic/aa79b/scripts';

-- CREACION DE LA TABLA DE COMUNICACIONES 

CREATE TABLE AA79BD4T00
(
	ID_0D4 NUMBER(8) NOT NULL, 
	ANYO_0D4 NUMBER(4) NOT NULL, 
	NUM_EXP_0D4 NUMBER(6) NOT NULL,
  	REF_TRAMITAGUNE_0D4 VARCHAR2(50 BYTE),
  	FECHA_0D4 DATE NOT NULL,
  	TIPO_0D4 VARCHAR2(1 BYTE) NOT NULL,
  	REMITENTE_0D4 VARCHAR2(500 BYTE),
    ASUNTO_0D4 VARCHAR2(500 BYTE),
    MENSAJE_0D4 VARCHAR2(4000 BYTE),
    ID_FICHERO_0D4 NUMBER(20,0)
) TABLESPACE AA7901E00;

ALTER TABLE AA79BD4T00 ADD CONSTRAINT PK_AA79BD4T00 PRIMARY KEY (ID_0D4);
ALTER INDEX PK_AA79BD4T00 REBUILD TABLESPACE AA7902E00;
ALTER TABLE AA79BD4T00 ADD CONSTRAINT AA79B51T00_D4_FK FOREIGN KEY (ANYO_0D4, NUM_EXP_0D4) REFERENCES AA79B51T00 (ANYO_051, NUM_EXP_051);
ALTER TABLE AA79BD4T00 ADD CONSTRAINT AA79B88T00_D4_FK FOREIGN KEY (ID_FICHERO_0D4) REFERENCES AA79B88T00 (ID_FICHERO_088);

COMMENT ON TABLE AA79BD4T00 IS 'Comunicaciones del expediente';
COMMENT ON COLUMN AA79BD4T00.ID_0D4 IS 'Identificador';
COMMENT ON COLUMN AA79BD4T00.ANYO_0D4 IS 'Año del expediente';
COMMENT ON COLUMN AA79BD4T00.NUM_EXP_0D4 IS 'Número del expediente';
COMMENT ON COLUMN AA79BD4T00.REF_TRAMITAGUNE_0D4 IS 'Número de expediente externo';
COMMENT ON COLUMN AA79BD4T00.FECHA_0D4 IS 'Fecha y hora';
COMMENT ON COLUMN AA79BD4T00.TIPO_0D4 IS 'Tipo: E-Enviado / R-Recibido';
COMMENT ON COLUMN AA79BD4T00.REMITENTE_0D4 IS 'Persona que enví­a la comunicación';
COMMENT ON COLUMN AA79BD4T00.ASUNTO_0D4 IS 'Asunto de la comunicación';
COMMENT ON COLUMN AA79BD4T00.MENSAJE_0D4 IS 'Texto de la comunicación';
COMMENT ON COLUMN AA79BD4T00.ID_FICHERO_0D4 IS 'Id fichero en la tabla AA79B88T00';

CREATE OR REPLACE SYNONYM AA79BD4S01 FOR AA79BD4T00;
CREATE SEQUENCE AA79B.AA79BD4Q00 MINVALUE 1 MAXVALUE 99999 INCREMENT BY 1 START WITH 1 NOCACHE ORDER;

-- NUEVA FILA CONFIGURACION APPS QUE SOPORTAN COMUNICACIONES 
INSERT INTO AA79B00T00 (ID_000, VALOR_000) VALUES (7, 'P43'); 

-- ANADIR LOS CAMPO PARA EL ENVIO DEL EMAIL EN LAS TABLAS AA79B41T00 Y AA79B06T00 
set define off;
INSERT INTO AA79B41T00 (ID_041, DESC_ES_041, DESC_EU_041, DESTINATARIO_041, ESTADO_041) VALUES (38, 'Nueva comunicación del expediente', 'Komunikazio berria ', 1, 'A');
INSERT INTO AA79B06T00 (ID_006, TEXTO_MAIL_ES_006, TEXTO_MAIL_EU_006, ASUNTO_ES_006, ASUNTO_EU_006) VALUES (38, '<p>Ha llegado una nueva comunicaci&oacute;n al expediente <strong>{{numExp}}</strong>.</p>', '<p>Komunikazio berri bat iritsi da <strong>{{numExp}}</strong> espedientera.</p>', 'Nueva comunicación del expediente {{numExp}}', 'Komunikazio berria {{numExp}} espedientean');
set define on;

ALTER TABLE AA79B54T00 ADD ES_GRUPO_BOLETIN_054 VARCHAR2(1 BYTE) DEFAULT 'N';
COMMENT ON COLUMN AA79B54T00.ES_GRUPO_BOLETIN_054 IS 'La persona solicitante pertenece al grupo de boletín';

COMMIT;
EXIT;