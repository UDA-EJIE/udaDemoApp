DEFINE DIR_SCRIPTS = '/aplic/aa79b/scripts';

ALTER TABLE AA79B15T00
ADD "IND_VISIBLE_TRABAJO_015" VARCHAR2(1) DEFAULT 'N' NULL;
COMMENT ON COLUMN AA79B15T00.IND_VISIBLE_TRABAJO_015 IS 'Indicador de si la tarea es visible en otros trabajos';

UPDATE AA79B15T00 SET IND_VISIBLE_TRABAJO_015 = 'N' WHERE IND_GESTION_ASOC_015 = 'S';
UPDATE AA79B15T00 SET IND_VISIBLE_TRABAJO_015 = 'S' WHERE IND_GESTION_ASOC_015 = 'N';


CREATE TABLE AA79BC6T00 (
	ID_TRABAJO_0C6 NUMBER(20) NOT NULL,
	DESC_TRABAJO_0C6 VARCHAR2(250) NOT NULL,	
	FECHA_INICIO_0C6 DATE NOT NULL,
	FECHA_FIN_PREVISTA_0C6 DATE NULL,
FECHA_FIN_0C6 DATE NULL
)TABLESPACE AA7901E00;

ALTER TABLE AA79BC6T00 ADD CONSTRAINT PK_AA79BC6T00 PRIMARY KEY (ID_TRABAJO_0C6);
ALTER INDEX PK_AA79BC6T00 REBUILD TABLESPACE AA7902E00;

COMMENT ON TABLE AA79BC6T00 IS 'Otros trabajos. Para tareas no ligadas a expedientes';
COMMENT ON COLUMN AA79BC6T00.ID_TRABAJO_0C6 IS 'Id del trabajo';
COMMENT ON COLUMN AA79BC6T00.DESC_TRABAJO_0C6 IS 'Breve descripción del trabajo';
COMMENT ON COLUMN AA79BC6T00.FECHA_INICIO_0C6 IS 'fecha de inicio del trabajo la tarea';
COMMENT ON COLUMN AA79BC6T00.FECHA_PREVISTA_FIN_0C6 IS 'fecha de fin prevista para el trabajo';
COMMENT ON COLUMN AA79BC6T00.FECHA_FIN_0C6 IS 'fecha de fin real del trabajo';

CREATE OR REPLACE SYNONYM AA79BC6S01 FOR AA79BC6T00;

CREATE SEQUENCE AA79B.AA79BC6Q00 MINVALUE 1 MAXVALUE 99999999999999999999 INCREMENT BY 1 START WITH 1 NOCACHE ORDER;


CREATE TABLE AA79BC7T00 (
	ID_TAREA_0C7 NUMBER(20) NOT NULL,
	ID_TIPO_TAREA_0C7 NUMBER(2) NOT NULL,-- 15
	ID_TRABAJO_0C7 NUMBER(20) NOT NULL,	
	FECHA_INICIO_0C7 DATE NULL,
	FECHA_FIN_0C7 DATE NULL,
	DNI_RECURSO_0C7 VARCHAR2(10) NULL,
	ESTADO_ASIGNACION_0C7 NUMBER(1) DEFAULT 1 NOT NULL, 
	ESTADO_EJECUCION_0C7 NUMBER(1) DEFAULT 1 NOT NULL, 
	OBSERV_0C7 VARCHAR2(2000) NULL,
	ORDEN_0C7 NUMBER(2) NOT NULL,
	DNI_ASIGNADOR_0C7 VARCHAR2(10) NULL,
	FECHA_ASIGNACION_0C7 DATE NULL,
	FECHA_ACEPTACION_0C7 DATE NULL,
	FECHA_EJECUCION_0C7 DATE NULL,
	HORAS_TAREA_0C7 VARCHAR2(10) NULL,
	IND_REALIZADA_0C7 VARCHAR2(1) DEFAULT 'N' NOT NULL,
	IND_OBSV_EJEC_0C7 VARCHAR2(1) DEFAULT 'N' NOT NULL
)TABLESPACE AA7901E00;

ALTER TABLE AA79BC7T00 ADD CONSTRAINT PK_AA79BC7T00 PRIMARY KEY (ID_TAREA_0C7);
ALTER INDEX PK_ AA79BC7T00 REBUILD TABLESPACE AA7902E00;

COMMENT ON TABLE AA79BC7T00 IS 'Tareas de un trabajo';
COMMENT ON COLUMN AA79BC7T00.ID_TAREA_0C7 IS 'Id de la tarea';
COMMENT ON COLUMN AA79BC7T00.ID_TIPO_TAREA_0C7 IS 'Tipo de la tarea';
COMMENT ON COLUMN AA79BC7T00.ID_TRABAJO_0C7 IS 'ID. Del trabajo al que está asociado la tarea';
COMMENT ON COLUMN AA79BC7T00.FECHA_INICIO_0C7 IS 'fecha de inicio de la tarea';
COMMENT ON COLUMN AA79BC7T00.FECHA_FIN_0C7 IS 'fecha de fin de la tarea';
COMMENT ON COLUMN AA79BC7T00.DNI_RECURSO_0C7 IS 'DNI recurso asignado a la tarea';
COMMENT ON COLUMN AA79BC7T00.ESTADO_ASIGNACION_0C7 IS 'Estado de asignacion de la tarea';
COMMENT ON COLUMN AA79BC7T00.ESTADO_EJECUCION_0C7 IS 'Estado de ejecución';
COMMENT ON COLUMN AA79BC7T00.OBSERV_0C7 IS 'Observaciones sobre la tarea.';
COMMENT ON COLUMN AA79BC7T00.ORDEN_0C7 IS 'Orden de ejecución de la tarea.';
COMMENT ON COLUMN AA79BC7T00.FECHA_ASIGNACION_0C7 IS 'Fecha de asignación de la tarea.';
COMMENT ON COLUMN AA79BC7T00.FECHA_ACEPTACION_0C7 IS 'Fecha de aceptacion/rechazo de la tarea por parte del recurso asignado.';
COMMENT ON COLUMN AA79BC7T00.FECHA_EJECUCION_0C7 IS 'Fecha de ejecución de la tarea.';
COMMENT ON COLUMN AA79BC7T00.HORAS_TAREA_0C7 IS 'Horas reales empleadas en la ejecución de la tarea.';
COMMENT ON COLUMN AA79BC7T00.IND_REALIZADA_0C7 IS 'Indicador de si la tarea se ha realizado o no';
COMMENT ON COLUMN AA79BC7T00.IND_OBSV_EJEC_0C7 IS 'Indicador de si la tarea tiene observaciones en su ejecución';

CREATE OR REPLACE SYNONYM AA79BC7S01 FOR AA79BC7T00;

CREATE SEQUENCE AA79B.AA79BC7Q00 MINVALUE 1 MAXVALUE 99999999999999999999 INCREMENT BY 1 START WITH 1 NOCACHE ORDER;

CREATE TABLE AA79BC8T00 (
	ID_TAREA_0C8 NUMBER(20) NOT NULL, -- C7
	ID_FICHERO_0C8 NUMBER(20) NOT NULL -- 88
)TABLESPACE AA7901E00;

ALTER TABLE AA79BC8T00 ADD CONSTRAINT PK_AA79BC8T00 PRIMARY KEY (ID_TAREA_0C8, ID_FICHERO_0C8);
ALTER INDEX PK_AA79BC8T00 REBUILD TABLESPACE AA7902E00;

COMMENT ON TABLE AA79BC8T00 IS 'Documentos requeridos para la tarea del trabajo';
COMMENT ON COLUMN AA79BC8T00.ID_TAREA_0C8 IS 'Id. interno de la tarea';
COMMENT ON COLUMN AA79BC8T00.ID_FICHERO_0C8 IS 'Id del fichero adjunto';

ALTER TABLE AA79BC8T00 ADD CONSTRAINT AA79BC7T00_C8_FK
FOREIGN KEY (ID_TAREA_0C8)
REFERENCES AA79BC7T00 (ID_TAREA_0C7)
ON DELETE CASCADE;

ALTER TABLE AA79BC8T00 ADD CONSTRAINT AA79B88T00_C8_FK
FOREIGN KEY (ID_FICHERO_0C8)
REFERENCES AA79B88T00 (ID_FICHERO_088);

CREATE OR REPLACE SYNONYM AA79BC8S01 FOR AA79BC8T00;

CREATE TABLE AA79BC9T00 (
	ID_TAREA_0C9 NUMBER(20) NOT NULL, -- C7
    OBSV_RECHAZO_0C9 VARCHAR2(2000) NOT NULL 
)TABLESPACE AA7901E00;

ALTER TABLE AA79BC9T00 ADD CONSTRAINT PK_AA79BC9T00 PRIMARY KEY (ID_TAREA_0C9);
ALTER INDEX PK_AA79BC9T00 REBUILD TABLESPACE AA7902E00;

COMMENT ON TABLE AA79BC9T00 IS 'Observaciones rechazo asignacion tarea de un trabajo';
COMMENT ON COLUMN AA79BC9T00.ID_TAREA_0C9 IS 'Id. interno de la tarea de un trabajo';
COMMENT ON COLUMN AA79BC9T00.OBSV_RECHAZO_0C9 IS 'Observaciones del rechazo de una tarea de un trabajo';

ALTER TABLE AA79BC9T00 ADD CONSTRAINT AA79BC7T00_C9_FK
FOREIGN KEY (ID_TAREA_0C9)
REFERENCES AA79BC7T00 (ID_TAREA_0C7)
ON DELETE CASCADE;


CREATE OR REPLACE SYNONYM AA79BC9S01 FOR AA79BC9T00;


-- OBSERVACIONES EJECUCION TAREA (LOPD)
CREATE TABLE AA79BD0T00 (
	ID_TAREA_0D0 NUMBER(20) NOT NULL, -- C7
    OBSV_EJECUCION_0D0 VARCHAR2(2000) NOT NULL 
)TABLESPACE AA7901E00;

ALTER TABLE AA79BD0T00 ADD CONSTRAINT PK_AA79BD0T00 PRIMARY KEY (ID_TAREA_0D0);
ALTER INDEX PK_AA79BD0T00 REBUILD TABLESPACE AA7902E00;

COMMENT ON TABLE AA79BD0T00 IS 'Observaciones ejecución tarea de un trabajo';
COMMENT ON COLUMN AA79BD0T00.ID_TAREA_0D0 IS 'Id. interno de la tarea de un trabajo';
COMMENT ON COLUMN AA79BD0T00.OBSV_EJECUCION_0D0 IS 'Observaciones de la ejecución de una tarea de un trabajo';

ALTER TABLE AA79BD0T00 ADD CONSTRAINT AA79BC7T00_D0_FK
FOREIGN KEY (ID_TAREA_0D0)
REFERENCES AA79BC7T00 (ID_TAREA_0C7)
ON DELETE CASCADE;

CREATE OR REPLACE SYNONYM AA79BD0S01 FOR AA79BD0T00;


-- (Documentos de ejecución de una tarea)
CREATE TABLE AA79BD1T00 (
ID_TAREA_0D1 NUMBER(20) NOT NULL, -- C7
ID_FICHERO_0D1 NUMBER(20) NOT NULL -- 88
)TABLESPACE AA7901E00;

ALTER TABLE AA79BD1T00 ADD CONSTRAINT PK_AA79BD1T00 PRIMARY KEY (ID_TAREA_0D1, ID_FICHERO_0D1);
ALTER INDEX PK_AA79BD1T00 REBUILD TABLESPACE AA7902E00;

COMMENT ON TABLE AA79BD1T00 IS 'Documentos de ejecución de la tarea de un trabajo';
COMMENT ON COLUMN AA79BD1T00.ID_TAREA_0D1 IS 'Id. interno de la tarea de un trabajo';
COMMENT ON COLUMN AA79BD1T00.ID_FICHERO_0D1 IS 'Id interno del fichero';

ALTER TABLE AA79BD1T00 ADD CONSTRAINT AA79BC7T00_D1_FK
FOREIGN KEY (ID_TAREA_0D1)
REFERENCES AA79BC7T00 (ID_TAREA_0C7)
ON DELETE CASCADE;

CREATE OR REPLACE SYNONYM AA79BD1S01 FOR AA79BD1T00;

@@&DIR_SCRIPTS/Functions/CLONAR_TRABAJO.SQL;
@@&DIR_SCRIPTS/Functions/ES_RECURSO_DISPONIBLE.SQL
@@&DIR_SCRIPTS/Functions/TIENE_OTRAS_TAREAS.SQL

EXIT;